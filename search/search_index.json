{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u9996\u9801","text":""},{"location":"#docker-containers-kubernetes","title":"Docker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406","text":"<p>\u6b61\u8fce\u4f86\u5230 \u6046\u9038\u6559\u80b2\u8a13\u7df4\u4e2d\u5fc3 DCKA \u8ab2\u7a0b \u5b78\u7fd2\u7b46\u8a18\uff01</p> <p>\u8ab2\u7a0b\u8cc7\u8a0a</p> <ul> <li>\u8ab2\u7a0b\u540d\u7a31\uff1aDocker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406</li> <li>\u8ab2\u7a0b\u4ee3\u865f\uff1aDCKA</li> <li>\u7e3d\u6642\u6578\uff1a21 \u5c0f\u6642\uff083 \u5929\uff09</li> <li>\u9069\u5408\u5c0d\u8c61\uff1a\u7db2\u8def\u5de5\u7a0b\u5e2b\u3001\u96f2\u7aef\u904b\u7b97\u5de5\u7a0b\u5e2b</li> </ul>"},{"location":"#_1","title":"\u8ab2\u7a0b\u7c21\u4ecb","text":"<p>\u672c\u8ab2\u7a0b\u65e8\u5728\u5e6b\u52a9\u5b78\u54e1\u638c\u63e1 Docker Container\uff08\u5bb9\u5668\uff09\u6280\u8853\u8207 Kubernetes\uff08\u7c21\u7a31 K8S\uff09\u5bb9\u5668\u7de8\u6392\u5e73\u53f0\u7684\u6838\u5fc3\u6982\u5ff5\u8207\u5be6\u52d9\u64cd\u4f5c\u3002\u900f\u904e\u7406\u8ad6\u8b1b\u89e3\u8207\u52d5\u624b\u5be6\u4f5c\uff0c\u4f60\u5c07\u5b78\u6703\u5982\u4f55\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u90e8\u7f72\u5bb9\u5668\u5316\u61c9\u7528\u7a0b\u5f0f\u3002</p> <pre><code>graph LR\n    A[\u50b3\u7d71\u90e8\u7f72] --&gt; B[\u865b\u64ec\u5316\u90e8\u7f72]\n    B --&gt; C[\u5bb9\u5668\u5316\u90e8\u7f72]\n    C --&gt; D[\u5bb9\u5668\u7de8\u6392 K8S]\n\n    style A fill:#f9f,stroke:#333\n    style B fill:#bbf,stroke:#333\n    style C fill:#bfb,stroke:#333\n    style D fill:#ff9,stroke:#333</code></pre>"},{"location":"#_2","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u8ab2\u7a0b\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3\u5bb9\u5668\u5316\u6280\u8853\u7684\u512a\u52e2\u8207\u61c9\u7528\u5834\u666f</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u5bb9\u5668\u7684\u5efa\u7acb\u3001\u555f\u52d5\u3001\u505c\u6b62\u8207\u522a\u9664</li> <li> \u5ba2\u88fd\u5316 Docker Image\uff08\u6620\u50cf\u6a94\uff09</li> <li> \u4f7f\u7528 Kubernetes \u90e8\u7f72\u8207\u7ba1\u7406\u5bb9\u5668\u5316\u61c9\u7528</li> <li> \u5be6\u4f5c WordPress + MySQL \u7684\u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"#_3","title":"\u8ab2\u7a0b\u5927\u7db1","text":""},{"location":"#1-docker-lab-01-08","title":"1. Docker \u57fa\u790e\u8207\u7ba1\u7406 (LAB 01-08)","text":"<ul> <li>\u74b0\u5883\u521d\u59cb\u5316\u8207\u57fa\u672c\u64cd\u4f5c</li> <li>Docker \u5b89\u88dd (Docker/Podman)</li> <li>Private Registry \u5efa\u7f6e</li> <li>Persistent Storage \u8207 WordPress \u5be6\u4f5c</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#2-docker-lab-09-10","title":"2. Docker \u9032\u968e\u61c9\u7528 (LAB 09-10)","text":"<ul> <li>\u5ba2\u88fd\u5316 Docker Images (commit &amp; Dockerfile)</li> <li>Dockerfile \u6307\u4ee4\u8207\u6700\u4f73\u5be6\u8e10</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#3-kubernetes-lab-11-15","title":"3. Kubernetes \u57fa\u790e (LAB 11-15)","text":"<ul> <li>Kubernetes \u5b89\u88dd (Standalone &amp; Cluster)</li> <li>\u5e38\u7528\u6307\u4ee4\u8207 Namespaces</li> <li>Rolling Update \u8207 Service \u8ca0\u8f09\u5747\u8861</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#4-kubernetes-lab-16-20","title":"4. Kubernetes \u9032\u968e\u7ba1\u7406 (LAB 16-20)","text":"<ul> <li>\u5132\u5b58\u7ba1\u7406 (PV/PVC)</li> <li>\u8a2d\u5b9a\u7ba1\u7406 (Secret/ConfigMap)</li> <li>\u6b0a\u9650\u63a7\u5236 (RBAC)</li> <li>\u5be6\u4f5c\uff1aWordPress + MySQL \u5b8c\u6574\u90e8\u7f72</li> <li>Kubernetes Dashboard</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#_4","title":"\u9810\u5099\u77e5\u8b58","text":"<p>\u958b\u59cb\u672c\u8ab2\u7a0b\u4e4b\u524d\uff0c\u5efa\u8b70\u4f60\u5177\u5099\uff1a</p> <p>\u5fc5\u5099\u77e5\u8b58</p> <ul> <li>Linux \u57fa\u790e\u6307\u4ee4\u64cd\u4f5c\uff08cd\u3001ls\u3001cat\u3001vim \u7b49\uff09</li> <li>Linux \u57fa\u672c\u7cfb\u7d71\u7ba1\u7406\u6982\u5ff5</li> <li>\u5efa\u8b70\u5177\u5099 RHCE \u8a8d\u8b49\u80fd\u529b\u6216\u540c\u7b49\u7d93\u9a57</li> </ul>"},{"location":"#_5","title":"\u9644\u9304\u8cc7\u6e90","text":"\u8cc7\u6e90 \u8aaa\u660e Docker \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 Docker \u6307\u4ee4\u5feb\u901f\u53c3\u8003 Kubernetes \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 kubectl \u6307\u4ee4\u5feb\u901f\u53c3\u8003 \u7591\u96e3\u6392\u89e3\u6307\u5357 \u5e38\u898b\u554f\u984c\u8207\u89e3\u6c7a\u65b9\u6848"},{"location":"#_6","title":"\u76f8\u95dc\u8cc7\u6e90","text":"<ul> <li> Docker \u5b98\u65b9\u6587\u4ef6</li> <li> Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li> Docker Hub</li> <li>:material-podman: Podman \u5b98\u65b9\u6587\u4ef6</li> <li> \u6046\u9038 DCKA \u8ab2\u7a0b\u9801\u9762</li> </ul> <p>\u5b78\u7fd2\u5efa\u8b70</p> <ol> <li>\u5efa\u8b70\u6309\u7ae0\u7bc0\u9806\u5e8f\u5b78\u7fd2</li> <li>\u6bcf\u500b\u7ae0\u7bc0\u7684 Lab \u5be6\u4f5c\u52d9\u5fc5\u89aa\u81ea\u52d5\u624b\u64cd\u4f5c</li> <li>\u9047\u5230\u554f\u984c\u5148\u67e5\u95b1 FAQ\uff0c\u518d\u53c3\u8003\u7591\u96e3\u6392\u89e3\u6307\u5357</li> <li>\u5584\u7528\u6307\u4ee4\u901f\u67e5\u8868\u52a0\u901f\u5b78\u7fd2</li> </ol>"},{"location":"lab01_environment_setup/","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#lab-01-lab","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5b89\u88dd\u4e26\u8a2d\u5b9a VMware Workstation</li> <li> \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def\uff08Virtual Network Editor\uff09</li> <li> \u555f\u52d5\u4e26\u9a57\u8b49\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u6e96\u5099\u597d Windows \u4e3b\u6a5f\uff08\u5efa\u8b70 16GB+ RAM\uff09</li> <li>\u4e0b\u8f09 DCKA \u8ab2\u7a0b\u865b\u64ec\u6a5f\u6620\u50cf\u6a94</li> <li>\u4e0b\u8f09 VMware Workstation \u5b89\u88dd\u7a0b\u5f0f</li> </ul>"},{"location":"lab01_environment_setup/#01-vmware-workstation","title":"0.1 \u5b89\u88dd VMware Workstation","text":""},{"location":"lab01_environment_setup/#_3","title":"\u53d6\u5f97\u5b89\u88dd\u7a0b\u5f0f","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u7684 VMware Workstation 17.6.4 \u5b89\u88dd\u6a94\u6848\u4f4d\u65bc\uff1a</p> <pre><code>C:\\DCKA-v8 (C:)\\VMware\\VMwareWorkstation_17.6.4\\\n</code></pre> <p></p> <p>\u8cc7\u6599\u593e\u5167\u5305\u542b\uff1a</p> \u6a94\u6848 \u8aaa\u660e <code>VMware-workstation-full-17.6.4-2483....exe</code> VMware Workstation \u5b89\u88dd\u7a0b\u5f0f <code>md5sum.txt</code> MD5 \u6821\u9a57\u78bc <code>md5sum.png</code> \u6821\u9a57\u78bc\u622a\u5716"},{"location":"lab01_environment_setup/#_4","title":"\u5b89\u88dd\u6b65\u9a5f","text":"<ol> <li>\u57f7\u884c <code>VMware-workstation-full-17.6.4-2483....exe</code></li> <li>\u4f9d\u7167\u5b89\u88dd\u7cbe\u9748\u5b8c\u6210\u5b89\u88dd</li> <li>\u5b89\u88dd\u5b8c\u6210\u5f8c\u91cd\u65b0\u555f\u52d5\u96fb\u8166</li> </ol> <p>\u5b89\u88dd\u63d0\u793a</p> <p>\u5b89\u88dd\u904e\u7a0b\u4e2d\u5efa\u8b70\u9078\u64c7\u300c\u5178\u578b\u5b89\u88dd\u300d\uff0c\u4f7f\u7528\u9810\u8a2d\u8a2d\u5b9a\u5373\u53ef\u3002</p>"},{"location":"lab01_environment_setup/#02","title":"0.2 \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def","text":""},{"location":"lab01_environment_setup/#virtual-network-editor","title":"\u958b\u555f Virtual Network Editor","text":"<ol> <li>\u958b\u555f VMware Workstation</li> <li>\u9078\u64c7 Edit \u2192 Virtual Network Editor</li> <li>\u9ede\u9078 Change Settings \u53d6\u5f97\u7ba1\u7406\u54e1\u6b0a\u9650</li> </ol>"},{"location":"lab01_environment_setup/#vmnet8-nat","title":"\u8a2d\u5b9a VMnet8 (NAT)","text":"<p>\u9078\u64c7 VMnet8\uff08NAT \u6a21\u5f0f\uff09\uff0c\u9032\u884c\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p>"},{"location":"lab01_environment_setup/#1-subnet-ip","title":"\u6b65\u9a5f 1\uff1a\u8a2d\u5b9a Subnet IP","text":"<p>\u5c07 Subnet IP \u4fee\u6539\u70ba\uff1a</p> <pre><code>192.168.66.0\n</code></pre>"},{"location":"lab01_environment_setup/#2-nat-settings","title":"\u6b65\u9a5f 2\uff1a\u8a2d\u5b9a NAT Settings","text":"<p>\u9ede\u9078 NAT Settings...\uff0c\u5c07 Gateway IP \u8a2d\u5b9a\u70ba\uff1a</p> <pre><code>192.168.66.2\n</code></pre>"},{"location":"lab01_environment_setup/#3-dhcp-settings","title":"\u6b65\u9a5f 3\uff1a\u8a2d\u5b9a DHCP Settings","text":"<p>\u9ede\u9078 DHCP Settings...\uff0c\u78ba\u8a8d\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p> \u8a2d\u5b9a\u9805\u76ee \u503c Starting IP address <code>192.168.66.128</code> Ending IP address <code>192.168.66.254</code> <p>\u91cd\u8981</p> <p>\u8acb\u78ba\u4fdd Subnet IP \u70ba <code>192.168.66.0</code>\uff0cGateway \u70ba <code>192.168.66.2</code>\uff0c\u5426\u5247\u5f8c\u7e8c\u5be6\u4f5c\u53ef\u80fd\u7121\u6cd5\u6b63\u5e38\u9023\u7dda\u3002</p> <p>\u9ede\u9078 OK \u5132\u5b58\u8a2d\u5b9a\u3002</p>"},{"location":"lab01_environment_setup/#03","title":"0.3 \u7db2\u8def\u62d3\u6a38\u8207\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#_5","title":"\u7db2\u8def\u67b6\u69cb","text":"<p>\u8ab2\u7a0b\u74b0\u5883\u4f7f\u7528 VMware Workstation \u7684 NAT \u7db2\u8def\uff08VMnet8\uff09\uff0c\u7db2\u6bb5\u70ba <code>192.168.66.0/24</code>\uff1a</p> <p></p> <pre><code>graph TB\n    subgraph \"\u5916\u90e8\u7db2\u8def\"\n        Internet((Internet))\n        ExtNet[10.0.1.0/24]\n    end\n\n    subgraph \"VMware NAT Gateway\"\n        NAT[\".254\"]\n    end\n\n    subgraph \"VMnet8 - 192.168.66.0/24\"\n        Host[\".xxx&lt;br/&gt;VMware Workstation\"]\n        D1[\"docker1&lt;br/&gt;.51\"]\n        D2[\"docker2&lt;br/&gt;.52\"]\n        KS[\"k8s-standalone&lt;br/&gt;.61\"]\n        KM[\"k8s-master1&lt;br/&gt;.71\"]\n        KN1[\"k8s-node1&lt;br/&gt;.81\"]\n        KN2[\"k8s-node2&lt;br/&gt;.82\"]\n    end\n\n    Internet --&gt; ExtNet --&gt; NAT\n    NAT --&gt; Host\n    Host --&gt; D1\n    Host --&gt; D2\n    Host --&gt; KS\n    Host --&gt; KM\n    Host --&gt; KN1\n    Host --&gt; KN2</code></pre>"},{"location":"lab01_environment_setup/#ip","title":"\u865b\u64ec\u6a5f\u6e05\u55ae\u8207 IP \u914d\u7f6e","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u516d\u53f0\u5df2\u9810\u5148\u8a2d\u5b9a\u597d\u7684 Rocky Linux 9 \u865b\u64ec\u6a5f\uff1a</p> <p></p> \u865b\u64ec\u6a5f\u540d\u7a31 IP \u4f4d\u5740 \u7528\u9014 <code>docker1</code> 192.168.66.51 Docker \u5be6\u4f5c\u4e3b\u6a5f 1 <code>docker2</code> 192.168.66.52 Docker \u5be6\u4f5c\u4e3b\u6a5f 2 <code>k8s-standalone</code> 192.168.66.61 \u7368\u7acb Kubernetes \u74b0\u5883\uff08\u55ae\u7bc0\u9ede\uff09 <code>k8s-master1</code> 192.168.66.71 Kubernetes Master\uff08\u63a7\u5236\u5e73\u9762\uff09\u7bc0\u9ede <code>k8s-node1</code> 192.168.66.81 Kubernetes Worker \u7bc0\u9ede 1 <code>k8s-node2</code> 192.168.66.82 Kubernetes Worker \u7bc0\u9ede 2 <code>mirror</code> - \u672c\u5730 Mirror \u4f3a\u670d\u5668\uff08\u5957\u4ef6\u5eab\u6620\u5c04\uff09 <p>IP \u914d\u7f6e\u898f\u5247</p> <ul> <li>Docker \u74b0\u5883\uff1a192.168.66.5x</li> <li>K8s Standalone\uff1a192.168.66.6x</li> <li>K8s Master\uff1a192.168.66.7x</li> <li>K8s Worker\uff1a192.168.66.8x</li> <li>NAT Gateway\uff1a192.168.66.254</li> </ul>"},{"location":"lab01_environment_setup/#_6","title":"\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#1","title":"\u65b9\u6cd5 1\uff1a\u4f7f\u7528\u6279\u6b21\u6a94\uff08\u63a8\u85a6\uff09","text":"<p>\u57f7\u884c <code>PowerON-allVM.bat</code> \u4e00\u6b21\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f\uff1a</p> PowerON-allVM.bat<pre><code>\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n</code></pre> <p>\u6279\u6b21\u6a94\u4f7f\u7528\u8aaa\u660e</p> <ul> <li>\u6b64\u6279\u6b21\u6a94\u4f7f\u7528 VMware \u7684 <code>vmrun</code> \u547d\u4ee4\u5217\u5de5\u5177</li> <li><code>-T ws</code> \u6307\u5b9a\u4f7f\u7528 VMware Workstation</li> <li><code>start</code> \u53c3\u6578\u8868\u793a\u555f\u52d5\u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#2","title":"\u65b9\u6cd5 2\uff1a\u624b\u52d5\u555f\u52d5","text":"<ol> <li>\u5728 VMware Workstation \u4e2d\u4f9d\u5e8f\u958b\u555f\u6bcf\u53f0\u865b\u64ec\u6a5f\u7684 <code>.vmx</code> \u6a94\u6848</li> <li>\u9ede\u9078 Power on this virtual machine</li> </ol>"},{"location":"lab01_environment_setup/#_7","title":"\u95dc\u9589\u6240\u6709\u865b\u64ec\u6a5f","text":"<p>\u8ab2\u7a0b\u7d50\u675f\u5f8c\uff0c\u53ef\u4f7f\u7528 <code>Shutdown-allVM.bat</code> \u4e00\u6b21\u95dc\u9589\u6240\u6709\u865b\u64ec\u6a5f\uff1a</p> Shutdown-allVM.bat<pre><code>\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n</code></pre> <p>\u6b63\u78ba\u95dc\u6a5f</p> <p>\u4f7f\u7528 <code>stop</code> \u547d\u4ee4\u6703\u57f7\u884c\u6b63\u5e38\u95dc\u6a5f\u7a0b\u5e8f\uff08\u76f8\u7576\u65bc\u6309\u4e0b\u96fb\u6e90\u6309\u9215\uff09\u3002\u5982\u9700\u5f37\u5236\u95dc\u6a5f\uff0c\u53ef\u6539\u7528 <code>stop hard</code> \u53c3\u6578\uff0c\u4f46\u4e0d\u5efa\u8b70\u7d93\u5e38\u4f7f\u7528\u3002</p>"},{"location":"lab01_environment_setup/#_8","title":"\u9a57\u8b49\u865b\u64ec\u6a5f\u72c0\u614b","text":"<p>\u555f\u52d5\u5b8c\u6210\u5f8c\uff0c\u61c9\u8a72\u53ef\u4ee5\u770b\u5230\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u5728\u904b\u884c\u4e2d\uff0c\u4e26\u986f\u793a Rocky Linux \u767b\u5165\u756b\u9762\uff1a</p> <p></p>"},{"location":"lab01_environment_setup/#_9","title":"\u767b\u5165\u8cc7\u8a0a","text":"\u5e33\u865f \u5bc6\u78bc <code>root</code> <code>container</code> <p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210</p> <p>\u7576\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u6210\u529f\u555f\u52d5\u4e26\u53ef\u4ee5\u767b\u5165\u5f8c\uff0c\u5373\u53ef\u958b\u59cb\u9032\u884c Docker \u8207 Kubernetes \u5be6\u4f5c\u7df4\u7fd2\u3002</p>"},{"location":"lab01_environment_setup/#04-mirror","title":"0.4 Mirror \u4f3a\u670d\u5668","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u672c\u5730 Mirror \u4f3a\u670d\u5668\uff0c\u52a0\u901f\u5957\u4ef6\u4e0b\u8f09\u4e26\u652f\u63f4\u96e2\u7dda\u74b0\u5883\u3002</p>"},{"location":"lab01_environment_setup/#mirror","title":"Mirror \u7db2\u5740","text":"\u7db2\u8def\u74b0\u5883 \u7db2\u5740 \u5167\u90e8\u7db2\u8def\uff08VMnet8\uff09 <code>http://192.168.66.248/k8s/</code> \u5916\u90e8\u7db2\u8def\uff08\u6559\u5ba4\u7db2\u8def\uff09 <code>http://10.0.1.249/k8s/</code>"},{"location":"lab01_environment_setup/#mirror_1","title":"Mirror \u8cc7\u6e90\u5167\u5bb9","text":"\u8cc7\u6599\u593e/\u6a94\u6848 \u7528\u9014 <code>248.repo</code> YUM/DNF \u5957\u4ef6\u5eab\u8a2d\u5b9a\u6a94 <code>ContainerImages/</code> Docker/Container \u6620\u50cf\u6a94 <code>Packages/</code> RPM \u5957\u4ef6 <code>command.txt</code> \u6307\u4ee4\u53c3\u8003 <code>docs/</code> \u8ab2\u7a0b\u6587\u4ef6 <code>scripts/</code> \u81ea\u52d5\u5316\u8173\u672c <code>yaml/</code> Kubernetes YAML \u8a2d\u5b9a\u6a94 <code>VMwareWorkstation_17.6.4/</code> VMware \u5b89\u88dd\u7a0b\u5f0f\uff08\u5916\u90e8\u7db2\u8def\uff09 <p>\u70ba\u4ec0\u9ebc\u9700\u8981 Mirror\uff1f</p> <ul> <li>\u52a0\u901f\u4e0b\u8f09\uff1a\u5f9e\u672c\u5730\u4f3a\u670d\u5668\u4e0b\u8f09\u6bd4\u7db2\u969b\u7db2\u8def\u5feb\u5f88\u591a</li> <li>\u96e2\u7dda\u74b0\u5883\uff1a\u6559\u5ba4\u53ef\u80fd\u6c92\u6709\u5c0d\u5916\u7db2\u8def</li> <li>\u7248\u672c\u4e00\u81f4\uff1a\u78ba\u4fdd\u6240\u6709\u5b78\u54e1\u4f7f\u7528\u76f8\u540c\u7248\u672c\u7684\u5957\u4ef6\u3002</li> </ul>"},{"location":"lab01_environment_setup/#_10","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u865b\u64ec\u6a5f\u7121\u6cd5\u958b\u6a5f\uff0c\u986f\u793a VT-x \u932f\u8aa4 <p>\u539f\u56e0\uff1aBIOS \u672a\u555f\u7528\u865b\u64ec\u5316\u6280\u8853</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u91cd\u65b0\u555f\u52d5\u96fb\u8166\uff0c\u9032\u5165 BIOS \u8a2d\u5b9a 2. \u627e\u5230 Intel VT-x \u6216 AMD-V \u9078\u9805 3. \u5c07\u5176\u8a2d\u5b9a\u70ba Enabled 4. \u5132\u5b58\u4e26\u91cd\u65b0\u555f\u52d5</p> Q2\uff1a\u7db2\u8def\u7121\u6cd5\u9023\u7dda <p>\u539f\u56e0\uff1aVirtual Network Editor \u8a2d\u5b9a\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d VMnet8 \u7684 Subnet IP \u70ba <code>192.168.66.0</code> 2. \u78ba\u8a8d Gateway IP \u70ba <code>192.168.66.2</code> 3. \u78ba\u8a8d\u865b\u64ec\u6a5f\u7db2\u8def\u4ecb\u9762\u8a2d\u5b9a\u70ba NAT \u6a21\u5f0f</p> Q3\uff1a\u8a18\u61b6\u9ad4\u4e0d\u8db3 <p>\u539f\u56e0\uff1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e0d\u8db3\u4ee5\u904b\u884c\u6240\u6709\u865b\u64ec\u6a5f</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a - \u4f9d\u5e8f\u555f\u52d5\u9700\u8981\u7684\u865b\u64ec\u6a5f\uff0c\u4e0d\u8981\u4e00\u6b21\u5168\u90e8\u555f\u52d5 - \u6216\u5347\u7d1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u81f3 16GB \u4ee5\u4e0a</p>"},{"location":"lab01_environment_setup/#_11","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 VMware \u5b89\u88dd\uff1a\u5b89\u88dd VMware Workstation 17.6.4</li> <li>\u2705 \u7db2\u8def\u8a2d\u5b9a\uff1aVMnet8 \u8a2d\u5b9a\u70ba 192.168.66.0/24 \u7db2\u6bb5</li> <li>\u2705 \u865b\u64ec\u6a5f\u555f\u52d5\uff1a\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f\u5168\u90e8\u555f\u52d5</li> <li>\u2705 \u74b0\u5883\u9a57\u8b49\uff1a\u78ba\u8a8d\u53ef\u4ee5\u6b63\u5e38\u767b\u5165\u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_12","title":"\u4e0b\u4e00\u6b65","text":"<p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210\u5f8c\uff0c\u8acb\u7e7c\u7e8c\u524d\u5f80 LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE</p>"},{"location":"lab02_docker_install/","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#lab-02-dockerdocker-ce","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 RHEL/Rocky Linux \u9810\u8a2d <code>docker</code> \u6307\u4ee4\u7684\u884c\u70ba (Podman Emulation)</li> <li> \u79fb\u9664\u9810\u8a2d\u7684 <code>podman-docker</code> \u5957\u4ef6</li> <li> \u8a2d\u5b9a Docker CE \u5b98\u65b9 Repository</li> <li> \u5b89\u88dd\u4e26\u555f\u52d5 Docker CE (Community Edition)</li> <li> \u4f7f\u7528 <code>docker pull</code> \u4e0b\u8f09 Image \u4e26\u5099\u4efd</li> </ul>"},{"location":"lab02_docker_install/#11","title":"1.1 \u6838\u5fc3\u6982\u5ff5\u8207\u6bd4\u8f03","text":"<p>\u5728 RHEL/CentOS 9 \u74b0\u5883\u4e2d\uff0c\u5957\u4ef6\u540d\u7a31\u8207\u80cc\u5f8c\u7684\u6280\u8853\u53ef\u80fd\u6703\u8b93\u4eba\u6df7\u6dc6\u3002\u4ee5\u4e0b\u662f\u4e09\u8005\u7684\u4e3b\u8981\u5dee\u7570\uff1a</p> \u9805\u76ee docker (Red Hat \u5957\u4ef6) docker-ce (Docker Inc. \u5957\u4ef6) podman \u4f86\u6e90 Red Hat \u5b98\u65b9 Repository Docker \u5b98\u65b9 Repository Red Hat \u5b98\u65b9 Repository \u672c\u8cea \u5176\u5be6\u662f podman-docker \u539f\u751f Docker Engine \u4e0b\u4e00\u4ee3\u5bb9\u5668\u5de5\u5177 \u5b88\u8b77\u884c\u7a0b (Daemon) \u7121 (Daemonless) dockerd (\u5fc5\u9808\u555f\u52d5\u670d\u52d9) \u7121 (Daemonless) \u67b6\u69cb \u6a21\u64ec Docker CLI \u6307\u4ee4 Client-Server \u67b6\u69cb Fork/Exec \u6a21\u578b Root \u6b0a\u9650 \u652f\u63f4 Rootless \u9810\u8a2d\u9700\u8981 Root (Rootless \u9700\u8a2d\u5b9a) \u539f\u751f\u652f\u63f4 Rootless \u6307\u4ee4\u76f8\u5bb9\u6027 \u9ad8\u5ea6\u76f8\u5bb9 \u539f\u751f\u6307\u4ee4 \u9ad8\u5ea6\u76f8\u5bb9 Docker <p>\u70ba\u4ec0\u9ebc <code>dnf install docker</code> \u88dd\u7684\u662f Podman\uff1f</p> <p>Red Hat \u70ba\u4e86\u63a8\u5ee3\u81ea\u5df1\u7684\u5bb9\u5668\u6280\u8853 (Podman/Buildah/Skopeo)\uff0c\u5728 RHEL 8/9 \u7684\u5957\u4ef6\u5eab\u4e2d\uff0c\u5c07 <code>docker</code> \u5957\u4ef6\u6307\u5411\u4e86 <code>podman-docker</code>\u3002\u9019\u500b\u5957\u4ef6\u4e3b\u8981\u63d0\u4f9b\u4e00\u500b shell script\uff0c\u5c07 <code>docker</code> \u6307\u4ee4\u8f49\u5c0e\u7d66 <code>podman</code> \u57f7\u884c\u3002</p> <p>\u82e5\u4f60\u7fd2\u6163\u4f7f\u7528\u539f\u672c\u7684 Docker Daemon (\u4f8b\u5982\u9700\u8981\u8207\u820a\u6709\u7684 Docker Compose \u6d41\u7a0b\u6574\u5408)\uff0c\u5247\u5fc5\u9808\u79fb\u9664\u6b64\u5957\u4ef6\uff0c\u4e26\u5b89\u88dd <code>docker-ce</code>\u3002</p>"},{"location":"lab02_docker_install/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab02_docker_install/#1-docker-podman","title":"\u6b65\u9a5f 1\uff1a\u89c0\u5bdf\u9810\u8a2d\u7684 Docker \u5957\u4ef6 (Podman)","text":"<p>\u5728 RHEL 9 / Rocky Linux 9 \u4e2d\uff0c\u5b98\u65b9\u9810\u8a2d\u7684 <code>docker</code> \u6307\u4ee4\u5176\u5be6\u662f <code>podman</code> \u7684\u6a21\u64ec\u5668\u3002</p> <ol> <li> <p>\u5b89\u88dd\u9810\u8a2d docker \u5957\u4ef6 </p><pre><code>dnf install docker -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>dnf</code>: (Dandified YUM) \u662f RHEL 8/9 \u8207 Rocky Linux \u7684\u9810\u8a2d\u5957\u4ef6\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4f86\u53d6\u4ee3\u820a\u7684 <code>yum</code>\u3002     &gt; - <code>install</code>: \u5b89\u88dd\u5957\u4ef6\u3002     &gt; - <code>-y</code>: \u81ea\u52d5\u56de\u7b54 \"Yes\" \u78ba\u8a8d\u5b89\u88dd\uff0c\u4e0d\u9700\u4eba\u5de5\u4ecb\u5165\u3002<p></p> <p></p> </li> <li> <p>\u6aa2\u67e5 docker \u6307\u4ee4\u4f86\u6e90 </p><pre><code>ls -l /usr/bin/docker\nfile /usr/bin/docker\ncat /usr/bin/docker\n</code></pre>     &gt; \u4f60\u6703\u767c\u73fe <code>/usr/bin/docker</code> \u5176\u5be6\u662f\u4e00\u500b Shell Script\uff0c\u5167\u5bb9\u662f\u57f7\u884c <code>/usr/bin/podman</code>\u3002     &gt; <pre><code>exec /usr/bin/podman \"$@\"\n</code></pre><p></p> </li> <li> <p>\u5617\u8a66\u555f\u52d5 Docker \u670d\u52d9 </p><pre><code>systemctl start docker\n</code></pre>     &gt; \u274c \u5931\u6557\uff1a\u56e0\u70ba\u6839\u672c\u6c92\u6709\u5b89\u88dd\u771f\u6b63\u7684 Docker Daemon\uff0c\u986f\u793a <code>Unit docker.service not found</code>\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c </p><pre><code>docker version\n</code></pre>     &gt; \u8f38\u51fa\u986f\u793a <code>Client: Podman Engine</code>\uff0c\u4e26\u63d0\u793a <code>Emulate Docker CLI using podman</code>\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#2-podman-docker-docker-ce","title":"\u6b65\u9a5f 2\uff1a\u79fb\u9664 Podman-Docker \u4e26\u5b89\u88dd Docker CE","text":"<p>\u70ba\u4e86\u4f7f\u7528\u539f\u751f\u7684 Docker Engine\uff0c\u6211\u5011\u9700\u8981\u79fb\u9664\u6a21\u64ec\u5957\u4ef6\u4e26\u5b89\u88dd\u5b98\u65b9\u7248\u672c\u3002</p> <ol> <li> <p>\u79fb\u9664\u9810\u8a2d\u5957\u4ef6 </p><pre><code>dnf remove docker -y\n</code></pre>     &gt; \u9019\u6703\u79fb\u9664 <code>podman-docker</code> \u5957\u4ef6\u3002<p></p> </li> <li> <p>\u65b0\u589e Docker CE Repository </p><pre><code>dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>config-manager</code>: <code>dnf</code> \u7684\u5916\u639b\u6a21\u7d44\uff0c\u7528\u65bc\u7ba1\u7406\u8a2d\u5b9a\u3002     &gt; - <code>--add-repo</code>: \u65b0\u589e\u4e00\u500b\u5916\u90e8\u7684\u5957\u4ef6\u4f86\u6e90 (Repository)\u3002\u9019\u88e1\u6211\u5011\u6307\u5411 Docker \u5b98\u65b9\u70ba CentOS \u7dad\u8b77\u7684 Repo\u3002<p></p> <p>\u9a57\u8b49 Repo \u662f\u5426\u52a0\u5165\u6210\u529f\uff1a </p><pre><code>cat /etc/yum.repos.d/docker-ce.repo\n</code></pre><p></p> </li> <li> <p>\u5b89\u88dd Docker CE </p><pre><code>dnf install docker-ce -y\n</code></pre>     &gt; \u5b89\u88dd\u904e\u7a0b\u4e2d\u6703\u4e0b\u8f09 <code>docker-ce</code> (Daemon), <code>docker-ce-cli</code> (\u6307\u4ee4\u5de5\u5177), <code>containerd.io</code> (Runtime) \u7b49\u5957\u4ef6\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#3-docker","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 Docker \u670d\u52d9","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u771f\u6b63\u7684 Docker Daemon (<code>dockerd</code>) \u5c31\u5df2\u7d93\u5c31\u7dd2\u4e86\u3002</p> <ol> <li> <p>\u555f\u52d5\u4e26\u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5 </p><pre><code>systemctl start docker\nsystemctl enable docker\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>systemctl</code>: \u7528\u65bc\u7ba1\u7406\u7cfb\u7d71\u670d\u52d9 (Systemd)\u3002     &gt; - <code>start</code>: \u7acb\u5373\u555f\u52d5\u670d\u52d9\u3002     &gt; - <code>enable</code>: \u8a2d\u5b9a\u670d\u52d9\u5728\u958b\u6a5f\u6642\u81ea\u52d5\u555f\u52d5\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u670d\u52d9\u72c0\u614b </p><pre><code>systemctl status docker\n</code></pre>     &gt; \u2705 \u61c9\u986f\u793a <code>Active: active (running)</code>\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c </p><pre><code>docker version\n</code></pre>     &gt; \u73fe\u5728\u61c9\u8a72\u986f\u793a <code>Client: Docker Engine - Community</code> \u548c <code>Server: Docker Engine - Community</code>\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#4-container-image","title":"\u6b65\u9a5f 4\uff1a\u4e0b\u8f09\u8207\u7ba1\u7406 Container Image","text":"<ol> <li> <p>\u4e0b\u8f09\u6620\u50cf\u6a94 </p><pre><code>docker pull rockylinux:9\n</code></pre><p></p> </li> <li> <p>\u67e5\u770b\u6620\u50cf\u6a94\u5217\u8868 </p><pre><code>docker images\n</code></pre><p></p> </li> <li> <p>\u67e5\u770b\u6620\u50cf\u6a94\u6b77\u53f2 </p><pre><code>docker history rockylinux:9\n</code></pre><p></p> </li> <li> <p>\u5099\u4efd\u6620\u50cf\u6a94 (Docker Save)     \u5c07\u6620\u50cf\u6a94\u532f\u51fa\u70ba tar \u6a94\u6848\u3002     </p><pre><code>docker save --output=/root/rockylinux-9.tar rockylinux:9\nls -lh /root/rockylinux-9.tar\n</code></pre><p></p> </li> </ol>"},{"location":"lab02_docker_install/#_3","title":"\u5c0f\u7d50","text":"<p>\u5728\u672c Lab \u4e2d\uff0c\u6211\u5011\u767c\u73fe Linux \u767c\u884c\u7248\u53ef\u80fd\u6703\u7528 Podman \u4f86\u6a21\u64ec Docker\u3002\u82e5\u8981\u4f7f\u7528\u6a19\u6e96 Docker Engine\uff0c\u5fc5\u9808\u624b\u52d5\u8a2d\u5b9a Docker \u5b98\u65b9 Repository \u4e26\u5b89\u88dd <code>docker-ce</code>\u3002</p>"},{"location":"lab03_podman/","title":"LAB 03 \u5b89\u88dd podman","text":""},{"location":"lab03_podman/#lab-03-podman","title":"LAB 03 \u5b89\u88dd Podman","text":""},{"location":"lab03_podman/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Podman \u7684\u6838\u5fc3\u67b6\u69cb (Daemonless &amp; Rootless)</li> <li> \u5728 Linux \u4e0a\u5b89\u88dd Podman</li> <li> \u9a57\u8b49 Podman \u7121\u9700\u5b88\u8b77\u884c\u7a0b (Daemon) \u5373\u53ef\u904b\u4f5c</li> <li> \u8655\u7406 Image Registry \u641c\u5c0b\u9806\u5e8f\u8207\u9a57\u8b49\u554f\u984c</li> </ul>"},{"location":"lab03_podman/#11-podman","title":"1.1 Podman \u7c21\u4ecb","text":"<p>Podman (Pod Manager) \u662f\u4e00\u500b\u7531 Red Hat \u958b\u767c\u7684\u958b\u6e90\u5bb9\u5668\u5f15\u64ce\uff0c\u7528\u65bc\u5728 Linux \u7cfb\u7d71\u4e0a\u958b\u767c\u3001\u7ba1\u7406\u548c\u57f7\u884c OCI (Open Container Initiative) \u5bb9\u5668\u3002</p> <ul> <li>\u5b98\u65b9\u7db2\u7ad9\uff1ahttps://podman.io/</li> <li>\u6700\u65b0\u6587\u4ef6\uff1aPodman Documentation</li> </ul>"},{"location":"lab03_podman/#podman-docker","title":"Podman \u8207 Docker \u7684\u95dc\u9375\u5dee\u7570","text":"\u7279\u6027 Docker Podman \u67b6\u69cb Client-Server (\u4f9d\u8cf4 dockerd \u5b88\u8b77\u884c\u7a0b) Daemonless (\u76f4\u63a5 Fork/Exec \u7a0b\u5e8f) \u57f7\u884c\u6b0a\u9650 \u9810\u8a2d\u9700\u8981 Root \u539f\u751f\u652f\u63f4 Rootless (\u4e00\u822c\u4f7f\u7528\u8005\u53ef\u57f7\u884c) Pod \u652f\u63f4 \u9700\u900f\u904e Docker Compose \u6216 K8S \u539f\u751f\u652f\u63f4 Pod (\u53ef\u5728\u4e00\u500b Pod \u8dd1\u591a\u500b\u5bb9\u5668) \u670d\u52d9\u76f8\u4f9d \u82e5 Daemon \u639b\u6389\uff0c\u6240\u6709\u5bb9\u5668\u90fd\u53d7\u5f71\u97ff \u5bb9\u5668\u662f\u7368\u7acb\u7a0b\u5e8f\uff0c\u4e92\u4e0d\u5f71\u97ff Systemd \u6574\u5408\u8f03\u5f31 \u539f\u751f\u6574\u5408\uff0c\u5bb9\u6613\u5c07\u5bb9\u5668\u4f5c\u6210\u7cfb\u7d71\u670d\u52d9 <p>Podman \u7684\u8a2d\u8a08\u7406\u5ff5</p> <p>\"Alias docker=podman\" \u2014\u2014 Podman \u7684 CLI \u6307\u4ee4\u8207 Docker \u9ad8\u5ea6\u76f8\u5bb9\uff0c\u7d55\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u628a <code>docker</code> \u6307\u4ee4\u63db\u6210 <code>podman</code> \u57f7\u884c\u3002</p>"},{"location":"lab03_podman/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab03_podman/#1-podman","title":"\u6b65\u9a5f 1\uff1a\u5b89\u88dd Podman \u5957\u4ef6","text":"<p>\u5728 RHEL 9 / Rocky Linux 9 \u4e2d\uff0cPodman \u901a\u5e38\u5df2\u7d93\u9810\u88dd\u3002\u5982\u679c\u6c92\u6709\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>dnf</code> \u5b89\u88dd\u3002</p> <ol> <li> <p>\u5b89\u88dd Podman </p><pre><code>dnf install podman -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - \u5957\u4ef6\u540d\u7a31\u5c31\u662f <code>podman</code>\uff0c\u4e0d\u9700\u8981\u50cf Docker \u9084\u8981\u53bb\u627e <code>docker-ce</code>\u3002     &gt; - \u5982\u679c\u7cfb\u7d71\u986f\u793a <code>Nothing to do</code>\uff0c\u8868\u793a\u5df2\u7d93\u5b89\u88dd\u904e\u4e86\u3002<p></p> <p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c\u8207\u74b0\u5883\u8cc7\u8a0a </p><pre><code>podman version\npodman info\n</code></pre>     &gt; - <code>podman version</code>: \u986f\u793a Client/Server \u7248\u672c\uff08\u6ce8\u610f\uff1aPodman \u7684 Client \u548c Server \u901a\u5e38\u662f\u540c\u4e00\u500b binary\uff0c\u9664\u975e\u662f\u9060\u7aef\u64cd\u4f5c\uff09\u3002     &gt; - <code>podman info</code>: \u986f\u793a\u8a73\u7d30\u7684\u7cfb\u7d71\u8a2d\u5b9a\uff0c\u5305\u62ec Storage Driver (\u901a\u5e38\u662f overlay)\u3001cgroup version (v2) \u4ee5\u53ca\u9810\u8a2d\u7684 Registry\u3002<p></p> </li> </ol>"},{"location":"lab03_podman/#2-daemonless","title":"\u6b65\u9a5f 2\uff1a\u9a57\u8b49 Daemonless \u67b6\u69cb\uff08\u7121\u9700\u555f\u52d5\u670d\u52d9\uff09","text":"<p>\u9019\u662f Podman \u6700\u7279\u5225\u7684\u5730\u65b9\uff1a\u4f60\u4e0d\u9700\u8981\u555f\u52d5\u4efb\u4f55\u670d\u52d9\u3002</p> <ol> <li> <p>\u5617\u8a66\u5c0b\u627e podman \u670d\u52d9     \u5728\u4f60\u5b89\u88dd\u5b8c Docker \u6642\uff0c\u901a\u5e38\u4e0b\u4e00\u6b65\u662f <code>systemctl start docker</code>\u3002\u4f46\u5728 Podman\uff1a</p> <p>\u4f60**\u4e0d\u9700\u8981**\u57f7\u884c <code>systemctl start podman</code>\u3002</p> <p>Podman \u662f\u4e00\u500b\u55ae\u7d14\u7684 binary\u57f7\u884c\u6a94\u3002\u7576\u4f60\u57f7\u884c <code>podman run</code> \u6642\uff0c\u5b83\u6703\u76f4\u63a5\u5728\u7576\u524d\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u4e0b\u7522\u751f\u5bb9\u5668\u7a0b\u5e8f\u3002</p> </li> <li> <p>\u70ba\u4ec0\u9ebc\u6703\u6709 <code>podman.socket</code>\uff1f     \u5982\u679c\u4f60\u6aa2\u67e5 systemd\uff0c\u53ef\u80fd\u6703\u770b\u5230 <code>podman.socket</code> \u6216 <code>podman.service</code>\u3002\u9019\u4e3b\u8981\u662f\u70ba\u4e86\u63d0\u4f9b API \u7d66\u9060\u7aef\u5de5\u5177\uff08\u5982 Docker Compose \u6216 IDE\uff09\u9023\u7dda\u4f7f\u7528\uff0c\u5c0d\u65bc\u672c\u5730 CLI \u64cd\u4f5c\u4e26\u975e\u5fc5\u8981\u3002</p> </li> </ol>"},{"location":"lab03_podman/#3-podman-container-image","title":"\u6b65\u9a5f 3\uff1a\u4f7f\u7528 Podman \u4e0b\u8f09 Container Image","text":"<p>Podman \u9810\u8a2d\u6703\u641c\u5c0b\u591a\u500b Registry\u3002</p> <ol> <li> <p>\u67e5\u770b\u76ee\u524d\u7684 Image </p><pre><code>podman images\n</code></pre><p></p> </li> <li> <p>\u5617\u8a66\u4e0b\u8f09 MySQL Image     \u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a     </p><pre><code>podman pull mysql\n</code></pre><p></p> <p>\u89c0\u5bdf\u8f38\u51fa\u7d50\u679c\uff1a</p> <p>Podman \u6703\u4f9d\u5e8f\u5617\u8a66\u8a2d\u5b9a\u6a94 (<code>/etc/containers/registries.conf</code>) \u4e2d\u5b9a\u7fa9\u7684 Registry\uff1a</p> <ol> <li> <p>\u274c <code>registry.access.redhat.com/mysql:latest</code>     &gt; <code>name unknown: Repo not found</code> (Red Hat \u5b98\u65b9\u5eab\u6c92\u6709\u9019\u500b Image)</p> </li> <li> <p>\u274c <code>registry.redhat.io/mysql:latest</code>     &gt; <code>unauthorized: Please login</code> (\u9700\u8981 Red Hat \u8a02\u95b1\u5e33\u865f\u624d\u80fd\u5b58\u53d6)</p> </li> <li> <p>\u2705 <code>docker.io/library/mysql:latest</code>     &gt; \u6210\u529f\u5f9e Docker Hub \u4e0b\u8f09\u3002</p> </li> </ol> </li> <li> <p>\u9a57\u8b49\u4e0b\u8f09\u7d50\u679c </p><pre><code>podman images\n</code></pre>     &gt; \u61c9\u8a72\u6703\u770b\u5230\u4f86\u81ea <code>docker.io/library/mysql</code> \u7684 Image\u3002<p></p> </li> </ol> <p>Registry \u641c\u5c0b\u9806\u5e8f\u4e26\u975e\u96a8\u6a5f</p> <p>RHEL/CentOS \u9810\u8a2d\u7684 <code>/etc/containers/registries.conf</code> \u6a94\u6848\u5b9a\u7fa9\u4e86\u641c\u5c0b\u9806\u5e8f (Search Registries)\u3002\u9019\u5c31\u662f\u70ba\u4ec0\u9ebc Podman \u6703\u5148\u53bb\u554f Red Hat\uff0c\u6700\u5f8c\u624d\u554f Docker Hub\u3002 \u800c Docker CE \u9810\u8a2d\u53ea\u6703\u627e Docker Hub (<code>docker.io</code>)\u3002</p>"},{"location":"lab04_docker_hub_rate_limit/","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#lab-04-docker-hub-rate-limiting","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Docker Hub \u7684\u4e0b\u8f09\u9650\u5236 (Rate Limiting)</li> <li> \u4f7f\u7528 <code>curl</code> \u8207 <code>jq</code> \u6307\u4ee4\u6aa2\u67e5\u7576\u524d\u7684 Rate Limit \u72c0\u614b</li> <li> \u6bd4\u8f03\u533f\u540d\u4f7f\u7528\u8005\u8207\u514d\u8cbb\u5e33\u865f (Free Account) \u7684\u9650\u5236\u5dee\u7570</li> </ul>"},{"location":"lab04_docker_hub_rate_limit/#11-docker-hub-rate-limiting","title":"1.1 \u4ec0\u9ebc\u662f Docker Hub Rate Limiting\uff1f","text":"<p>Docker Hub \u70ba\u4e86\u9632\u6b62\u8cc7\u6e90\u6feb\u7528\uff0c\u5c0d Container Image \u7684 <code>pull</code> (\u4e0b\u8f09) \u6b21\u6578\u9032\u884c\u4e86\u9650\u5236\uff1a</p> \u5e33\u865f\u985e\u578b \u9650\u5236\u5167\u5bb9 \u533f\u540d\u4f7f\u7528\u8005 (Anonymous) \u6bcf 6 \u5c0f\u6642 100 \u6b21 pull (\u4ee5 IP \u70ba\u6e96) \u514d\u8cbb\u5e33\u865f (Free Account) \u6bcf 6 \u5c0f\u6642 200 \u6b21 pull (\u4ee5\u5e33\u865f\u70ba\u6e96) Pro / Team / Business 5000 \u6b21 (\u6bcf\u65e5) \u6216 \u7121\u9650\u5236 <p>\u7576\u4f60\u9047\u5230 <code>Before you can look around... 429 Too Many Requests</code> \u932f\u8aa4\u6642\uff0c\u901a\u5e38\u5c31\u662f\u88ab\u9650\u6d41\u4e86\u3002</p>"},{"location":"lab04_docker_hub_rate_limit/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab04_docker_hub_rate_limit/#1-jq","title":"\u6b65\u9a5f 1\uff1a\u5b89\u88dd\u5fc5\u8981\u5de5\u5177 jq","text":"<p>\u70ba\u4e86\u65b9\u4fbf\u89e3\u6790 Docker Hub API \u56de\u50b3\u7684 JSON \u683c\u5f0f Token\uff0c\u6211\u5011\u9700\u8981\u5b89\u88dd <code>jq</code> \u5de5\u5177\u3002</p> <ol> <li> <p>\u5b89\u88dd jq </p><pre><code>yum install jq -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a<code>jq</code> \u662f\u4e00\u500b\u8f15\u91cf\u7d1a\u4e14\u9748\u6d3b\u7684 command-line JSON \u8655\u7406\u5668\u3002<p></p> <p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#2","title":"\u6b65\u9a5f 2\uff1a\u4e0b\u8f09\u6aa2\u67e5\u8173\u672c","text":"<p>\u6211\u5011\u4f7f\u7528\u4e00\u6bb5 Shell Script \u4f86\u7c21\u5316\u6aa2\u67e5\u6d41\u7a0b\u3002\u9019\u500b Script \u6703\u5411 Docker Hub \u7533\u8acb Token \u4e26\u67e5\u8a62 Header \u8cc7\u8a0a\u3002</p> <ol> <li> <p>\u4e0b\u8f09 Script (\u5047\u8a2d\u8ab2\u5802\u74b0\u5883\u63d0\u4f9b)     </p><pre><code># \u4f7f\u7528 wget \u4e0b\u8f09\u8173\u672c\nwget http://10.0.1.248/k8s/scripts/check_docker_pull_rate_limit.sh\n\n# \u82e5\u4e0a\u8ff0\u9023\u7d50\u7121\u6cd5\u9023\u7dda (Connection refused)\uff0c\u8acb\u5617\u8a66\u5099\u7528\u4f4d\u7f6e\nwget http://10.0.1.249/k8s/scripts/check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u8ce6\u4e88\u57f7\u884c\u6b0a\u9650 </p><pre><code>chmod 755 check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#3-anonymous","title":"\u6b65\u9a5f 3\uff1a\u6aa2\u67e5\u533f\u540d\u4f7f\u7528\u8005\u9650\u5236 (Anonymous)","text":"<ol> <li> <p>\u57f7\u884c Script </p><pre><code>./check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u89c0\u5bdf\u8f38\u51fa\u7d50\u679c </p><pre><code>ratelimit-limit: 100;w=21600\nratelimit-remaining: 58;w=21600\ndocker-ratelimit-source: 118.163.116.129\n</code></pre>     &gt; \u8f38\u51fa\u89e3\u6790\uff1a     &gt; - <code>ratelimit-limit: 100;w=21600</code>: \u9650\u5236\u70ba\u6bcf 21600 \u79d2 (6\u5c0f\u6642) 100 \u6b21\u3002     &gt; - <code>ratelimit-remaining: 58</code>: \u76ee\u524d\u5269\u9918 58 \u6b21\u984d\u5ea6\u3002     &gt; - <code>docker-ratelimit-source</code>: \u8b58\u5225\u4f86\u6e90 IP\u3002<p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#4-free-account","title":"\u6b65\u9a5f 4\uff1a\u6aa2\u67e5\u514d\u8cbb\u5e33\u865f\u9650\u5236 (Free Account)","text":"<p>\u82e5\u8981\u7372\u5f97\u66f4\u9ad8\u7684\u984d\u5ea6\uff0c\u53ef\u4ee5\u767b\u5165 Docker Hub \u5e33\u865f\u3002</p> <ol> <li> <p>\u4fee\u6539 Script \u52a0\u5165\u8a8d\u8b49\u8cc7\u8a0a     \u7de8\u8f2f <code>check_docker_pull_rate_limit.sh</code>\uff0c\u5c07\u4f60\u7684 Docker Hub \u5e33\u865f\u5bc6\u78bc\u586b\u5165\u8b8a\u6578 (\u6216\u662f\u900f\u904e <code>docker login</code> \u5f8c\u4fee\u6539 Script \u4ee5\u4f7f\u7528 Token)\u3002</p> <p>\u5047\u8a2d Script \u652f\u63f4\u4ee5\u8b8a\u6578\u65b9\u5f0f\u5e36\u5165\u5e33\u5bc6\uff1a </p><pre><code># \u7de8\u8f2f\u8173\u672c\u586b\u5165 USER=\"\u4f60\u7684\u5e33\u865f\" PASSWORD=\"\u4f60\u7684\u5bc6\u78bc\"\nvi check_docker_pull_rate_limit.sh\n</code></pre><p></p> <p>\u624b\u52d5\u6aa2\u67e5\u6307\u4ee4 (\u53c3\u8003)</p> <p>\u5982\u679c\u6c92\u6709 Script\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528\u4ee5\u4e0b\u6307\u4ee4\u624b\u52d5\u6aa2\u67e5 (\u8a18\u5f97\u66ff\u63db\u5e33\u5bc6)\uff1a </p><pre><code># 1. \u53d6\u5f97 Token\nTOKEN=$(curl -s -u \"\u4f60\u7684\u5e33\u865f:\u4f60\u7684\u5bc6\u78bc\" \"https://auth.docker.io/token?service=registry.docker.io&amp;scope=repository:ratelimitpreview/test:pull\" | jq -r .token)\n\n# 2. \u67e5\u8a62 Header\ncurl --head -H \"Authorization: Bearer $TOKEN\" https://registry-1.docker.io/v2/ratelimitpreview/test/manifests/latest\n</code></pre><p></p> </li> <li> <p>\u518d\u6b21\u57f7\u884c Script </p><pre><code>./check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u9810\u671f\u7d50\u679c </p><pre><code>ratelimit-limit: 200;w=21600   &lt;-- \u984d\u5ea6\u8b8a\u70ba 200\nratelimit-remaining: 198;w=21600\ndocker-ratelimit-source: [\u4f60\u7684\u5e33\u865fUUID]\n</code></pre>     &gt; \u767b\u5165\u5f8c\uff0c<code>ratelimit-source</code> \u901a\u5e38\u6703\u8b8a\u6210\u4f60\u7684 User ID\uff0c\u4e14\u984d\u5ea6\u6703\u63d0\u5347\u81f3 200 \u6b21\u3002<p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#_3","title":"\u5c0f\u7d50","text":"<ul> <li>\u533f\u540d\u4e0b\u8f09\uff1a\u65b9\u4fbf\u4f46\u9650\u5236\u56b4\u683c (100\u6b21/6hr)\uff0c\u591a\u53f0\u6a5f\u5668\u5171\u7528 Public IP \u6642\u5bb9\u6613\u88ab\u9396\u3002</li> <li>\u767b\u5165\u4e0b\u8f09\uff1a\u5efa\u8b70\u5728 Server \u4e0a\u900f\u904e <code>docker login</code> \u767b\u5165\uff0c\u53ef\u5c07\u984d\u5ea6\u63d0\u5347\u81f3 (200\u6b21/6hr)\uff0c\u6216\u8cfc\u8cb7 Pro \u65b9\u6848\u89e3\u9664\u9650\u5236\u3002</li> </ul>"},{"location":"lab05_private_registry/","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#lab-05-private-registry","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5340\u5206 Public Registry \u8207 Private Registry \u7684\u7528\u9014</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u57fa\u672c\u6307\u4ee4\uff08run\u3001exec\u3001logs\u3001inspect \u7b49\uff09</li> <li> \u8a2d\u5b9a Docker \u6301\u4e45\u5316\u5132\u5b58\uff08Volumes \u8207 Bind Mounts\uff09</li> <li> \u7406\u89e3\u4e26\u8a2d\u5b9a Docker \u7db2\u8def</li> <li> \u5f9e Docker Hub \u641c\u5c0b\u3001\u62c9\u53d6\u3001\u63a8\u9001 Image</li> <li> \u5b8c\u6210 WordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72\u5be6\u4f5c</li> </ul>"},{"location":"lab05_private_registry/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210\u7b2c 1 \u7ae0\u7684\u5167\u5bb9</li> <li>Docker \u5df2\u6b63\u78ba\u5b89\u88dd\u4e26\u53ef\u57f7\u884c</li> <li>\u7406\u89e3 Image \u8207 Container \u7684\u95dc\u4fc2</li> </ul>"},{"location":"lab05_private_registry/#21-public-registry-private-registry","title":"2.1 Public Registry \u8207 Private Registry","text":""},{"location":"lab05_private_registry/#registry","title":"\u4ec0\u9ebc\u662f Registry\uff1f","text":"<p>Registry\uff08\u5009\u5eab\uff09\u662f\u7528\u4f86\u5132\u5b58\u548c\u5206\u767c Docker Image \u7684\u670d\u52d9\u3002\u5c31\u50cf GitHub \u5132\u5b58\u7a0b\u5f0f\u78bc\u4e00\u6a23\uff0cRegistry \u5132\u5b58\u5bb9\u5668\u6620\u50cf\u6a94\u3002</p> <pre><code>graph LR\n    Dev[\u958b\u767c\u8005] --&gt;|push| Registry[(Registry)]\n    Registry --&gt;|pull| Server1[\u4f3a\u670d\u5668 1]\n    Registry --&gt;|pull| Server2[\u4f3a\u670d\u5668 2]\n    Registry --&gt;|pull| Server3[\u4f3a\u670d\u5668 3]</code></pre>"},{"location":"lab05_private_registry/#public-registry","title":"Public Registry","text":"<p>\u516c\u958b\u7684 Registry \u670d\u52d9\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5b58\u53d6\u516c\u958b\u7684 Image\u3002</p> Registry \u8aaa\u660e \u7db2\u5740 Docker Hub \u5b98\u65b9\u9810\u8a2d Registry\uff0c\u6700\u5927\u7684\u516c\u958b Image \u5009\u5eab hub.docker.com Quay.io Red Hat \u63d0\u4f9b\u7684 Registry quay.io GitHub Container Registry GitHub \u63d0\u4f9b\u7684\u5bb9\u5668 Registry ghcr.io Google Container Registry Google Cloud \u63d0\u4f9b gcr.io Amazon ECR Public AWS \u63d0\u4f9b\u7684\u516c\u958b Registry public.ecr.aws <p>Docker Hub \u4f7f\u7528\u6280\u5de7</p> <ul> <li>\u5b98\u65b9 Image\uff1a\u6c92\u6709\u524d\u7db4\uff0c\u5982 <code>nginx</code>\u3001<code>mysql</code>\u3001<code>redis</code></li> <li>\u793e\u7fa4 Image\uff1a\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff0c\u5982 <code>bitnami/nginx</code></li> <li>\u6a19\u7c64\uff1a\u6307\u5b9a\u7248\u672c\uff0c\u5982 <code>nginx:1.25</code>\u3001<code>nginx:alpine</code></li> </ul>"},{"location":"lab05_private_registry/#private-registry","title":"Private Registry","text":"<p>\u79c1\u6709 Registry \u7528\u65bc\u5132\u5b58\u4f01\u696d\u5167\u90e8\u7684 Image\uff0c\u4e0d\u5c0d\u5916\u516c\u958b\u3002</p>"},{"location":"lab05_private_registry/#registry_1","title":"\u5e38\u898b\u79c1\u6709 Registry \u65b9\u6848","text":"\u65b9\u6848 \u8aaa\u660e \u9069\u7528\u5834\u666f Docker Registry Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u8f15\u91cf\u7d1a Registry \u5c0f\u578b\u5718\u968a\u3001\u6e2c\u8a66\u74b0\u5883 Harbor VMware \u958b\u6e90\u7684\u4f01\u696d\u7d1a Registry \u5927\u578b\u4f01\u696d\u3001\u9700\u8981 RBAC Nexus Repository Sonatype \u7684\u591a\u529f\u80fd\u5009\u5eab \u5df2\u4f7f\u7528 Nexus \u7ba1\u7406\u5957\u4ef6 JFrog Artifactory \u4f01\u696d\u7d1a\u88fd\u54c1\u7ba1\u7406 \u5927\u578b\u4f01\u696d AWS ECR AWS \u79c1\u6709 Registry AWS \u96f2\u7aef\u74b0\u5883 Azure ACR Azure \u79c1\u6709 Registry Azure \u96f2\u7aef\u74b0\u5883 GCP GCR Google \u79c1\u6709 Registry GCP \u96f2\u7aef\u74b0\u5883"},{"location":"lab05_private_registry/#private-registry_1","title":"\u5efa\u7acb\u7c21\u6613 Private Registry","text":"\u4f7f\u7528 Docker \u5efa\u7acb\u79c1\u6709 Registry<pre><code># \u555f\u52d5 Registry Container\ndocker run -d \\\n  --name my-registry \\\n  -p 5000:5000 \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n\n# \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag nginx:latest localhost:5000/my-nginx:v1\n\n# \u63a8\u9001\u5230\u79c1\u6709 Registry\ndocker push localhost:5000/my-nginx:v1\n\n# \u5f9e\u79c1\u6709 Registry \u62c9\u53d6\ndocker pull localhost:5000/my-nginx:v1\n</code></pre> <p>\u751f\u7522\u74b0\u5883\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u79c1\u6709 Registry \u61c9\u914d\u7f6e TLS \u6191\u8b49</li> <li>\u8a2d\u5b9a\u9069\u7576\u7684\u5b58\u53d6\u63a7\u5236</li> <li>\u5b9a\u671f\u5099\u4efd Registry \u8cc7\u6599</li> <li>\u8003\u616e\u4f7f\u7528\u4f01\u696d\u7d1a\u65b9\u6848\u5982 Harbor</li> </ul>"},{"location":"lab05_private_registry/#22-docker","title":"2.2 Docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab05_private_registry/#container","title":"Container \u751f\u547d\u9031\u671f\u7ba1\u7406","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: docker create\n    Created --&gt; Running: docker start\n    Running --&gt; Paused: docker pause\n    Paused --&gt; Running: docker unpause\n    Running --&gt; Stopped: docker stop\n    Stopped --&gt; Running: docker start\n    Stopped --&gt; Removed: docker rm\n    Running --&gt; Removed: docker rm -f\n    Removed --&gt; [*]</code></pre>"},{"location":"lab05_private_registry/#_3","title":"\u6838\u5fc3\u6307\u4ee4\u8a73\u89e3","text":""},{"location":"lab05_private_registry/#docker-run-","title":"docker run - \u57f7\u884c\u5bb9\u5668","text":"docker run \u5e38\u7528\u9078\u9805<pre><code># \u57fa\u672c\u57f7\u884c\ndocker run nginx\n\n# \u80cc\u666f\u57f7\u884c (detached)\ndocker run -d nginx\n\n# \u6307\u5b9a\u540d\u7a31\ndocker run -d --name my-nginx nginx\n\n# Port \u5c0d\u61c9 (\u4e3b\u6a5f:\u5bb9\u5668)\ndocker run -d -p 8080:80 nginx\n\n# \u74b0\u5883\u8b8a\u6578\ndocker run -d -e MYSQL_ROOT_PASSWORD=secret mysql\n\n# \u81ea\u52d5\u522a\u9664\uff08\u7d50\u675f\u5f8c\u81ea\u52d5\u79fb\u9664\uff09\ndocker run --rm nginx echo \"Hello\"\n\n# \u4e92\u52d5\u6a21\u5f0f\ndocker run -it ubuntu /bin/bash\n\n# \u8cc7\u6e90\u9650\u5236\ndocker run -d --memory=\"512m\" --cpus=\"1.0\" nginx\n\n# \u91cd\u555f\u7b56\u7565\ndocker run -d --restart=always nginx\n</code></pre> <p>docker run \u9078\u9805\u8aaa\u660e</p> \u9078\u9805 \u8aaa\u660e <code>-d</code> Detached mode\uff0c\u80cc\u666f\u57f7\u884c <code>-it</code> \u4e92\u52d5\u6a21\u5f0f + TTY <code>-p</code> Port mapping <code>-v</code> Volume mapping <code>-e</code> \u74b0\u5883\u8b8a\u6578 <code>--name</code> \u6307\u5b9a\u5bb9\u5668\u540d\u7a31 <code>--rm</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>--restart</code> \u91cd\u555f\u7b56\u7565"},{"location":"lab05_private_registry/#docker-exec-","title":"docker exec - \u57f7\u884c\u6307\u4ee4","text":"\u5728\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u57f7\u884c\u6307\u4ee4<pre><code># \u57f7\u884c\u55ae\u4e00\u6307\u4ee4\ndocker exec my-nginx cat /etc/nginx/nginx.conf\n\n# \u9032\u5165\u4e92\u52d5\u5f0f Shell\ndocker exec -it my-nginx /bin/bash\n\n# \u4ee5\u7279\u5b9a\u4f7f\u7528\u8005\u57f7\u884c\ndocker exec -u root my-nginx whoami\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\ndocker exec -e VAR=value my-nginx printenv VAR\n</code></pre>"},{"location":"lab05_private_registry/#docker-logs-","title":"docker logs - \u6aa2\u8996\u65e5\u8a8c","text":"Container \u65e5\u8a8c\u64cd\u4f5c<pre><code># \u6aa2\u8996\u5168\u90e8\u65e5\u8a8c\ndocker logs my-nginx\n\n# \u6301\u7e8c\u8ffd\u8e64\u65e5\u8a8c\ndocker logs -f my-nginx\n\n# \u986f\u793a\u6700\u5f8c N \u884c\ndocker logs --tail 100 my-nginx\n\n# \u986f\u793a\u6642\u9593\u6233\u8a18\ndocker logs -t my-nginx\n\n# \u6307\u5b9a\u6642\u9593\u7bc4\u570d\ndocker logs --since 2024-01-01 my-nginx\ndocker logs --since 10m my-nginx  # \u6700\u8fd1 10 \u5206\u9418\n</code></pre>"},{"location":"lab05_private_registry/#docker-inspect-","title":"docker inspect - \u6aa2\u8996\u8a73\u7d30\u8cc7\u8a0a","text":"\u6aa2\u8996\u5bb9\u5668/\u6620\u50cf\u6a94\u8a73\u7d30\u8cc7\u8a0a<pre><code># \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\uff08JSON \u683c\u5f0f\uff09\ndocker inspect my-nginx\n\n# \u53d6\u5f97\u7279\u5b9a\u8cc7\u8a0a\uff08\u4f7f\u7528 Go \u6a21\u677f\uff09\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' my-nginx\n\n# \u53d6\u5f97 Port \u5c0d\u61c9\ndocker inspect --format='{{range $p, $conf := .NetworkSettings.Ports}}{{$p}} -&gt; {{(index $conf 0).HostPort}}{{end}}' my-nginx\n\n# \u53d6\u5f97\u639b\u8f09\u8cc7\u8a0a\ndocker inspect --format='{{json .Mounts}}' my-nginx | jq .\n</code></pre>"},{"location":"lab05_private_registry/#_4","title":"\u5176\u4ed6\u5e38\u7528\u6307\u4ee4","text":"\u5bb9\u5668\u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker ps\n\n# \u5217\u51fa\u6240\u6709\u5bb9\u5668\uff08\u5305\u542b\u5df2\u505c\u6b62\uff09\ndocker ps -a\n\n# \u505c\u6b62\u5bb9\u5668\ndocker stop my-nginx\n\n# \u555f\u52d5\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker start my-nginx\n\n# \u91cd\u555f\u5bb9\u5668\ndocker restart my-nginx\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm my-nginx\n\n# \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker rm -f my-nginx\n\n# \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n\n# \u6aa2\u8996\u5bb9\u5668\u8cc7\u6e90\u4f7f\u7528\ndocker stats\n\n# \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668\ndocker cp ./index.html my-nginx:/usr/share/nginx/html/\n\n# \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848\ndocker cp my-nginx:/etc/nginx/nginx.conf ./nginx.conf\n</code></pre>"},{"location":"lab05_private_registry/#23-persistent-storage","title":"2.3 Persistent Storage","text":""},{"location":"lab05_private_registry/#_5","title":"\u70ba\u4ec0\u9ebc\u9700\u8981\u6301\u4e45\u5316\u5132\u5b58\uff1f","text":"<p>Container \u9810\u8a2d\u7684\u8cc7\u6599\u662f\u77ed\u66ab\u7684\uff08ephemeral\uff09\uff0c\u7576 Container \u88ab\u522a\u9664\u6642\uff0c\u6240\u6709\u8cc7\u6599\u90fd\u6703\u6d88\u5931\u3002</p> <pre><code>graph LR\n    subgraph \"\u6c92\u6709\u6301\u4e45\u5316\"\n        C1[Container] --&gt; RW1[\u8b80\u5beb\u5c64]\n        RW1 -.-&gt;|\u522a\u9664\u5bb9\u5668| X[\u8cc7\u6599\u6d88\u5931]\n    end\n\n    subgraph \"\u4f7f\u7528\u6301\u4e45\u5316\"\n        C2[Container] --&gt; RW2[\u8b80\u5beb\u5c64]\n        C2 --&gt; V[Volume/Bind Mount]\n        V --&gt;|\u5bb9\u5668\u522a\u9664| V\n    end</code></pre>"},{"location":"lab05_private_registry/#_6","title":"\u4e09\u7a2e\u5132\u5b58\u65b9\u5f0f","text":"\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f Volume \u7531 Docker \u7ba1\u7406\u7684\u5132\u5b58\u5340\u57df \u751f\u7522\u74b0\u5883\u3001\u8cc7\u6599\u6301\u4e45\u5316 Bind Mount \u5c07\u4e3b\u6a5f\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668 \u958b\u767c\u74b0\u5883\u3001\u7a0b\u5f0f\u78bc\u540c\u6b65 tmpfs Mount \u5132\u5b58\u5728\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e2d \u66ab\u5b58\u654f\u611f\u8cc7\u6599"},{"location":"lab05_private_registry/#volumes","title":"Volumes","text":"Volume \u57fa\u672c\u64cd\u4f5c<pre><code># \u5efa\u7acb Volume\ndocker volume create my-data\n\n# \u5217\u51fa\u6240\u6709 Volume\ndocker volume ls\n\n# \u6aa2\u8996 Volume \u8a73\u7d30\u8cc7\u8a0a\ndocker volume inspect my-data\n\n# \u4f7f\u7528 Volume \u57f7\u884c\u5bb9\u5668\ndocker run -d \\\n  --name my-nginx \\\n  -v my-data:/usr/share/nginx/html \\\n  nginx\n\n# \u522a\u9664 Volume\ndocker volume rm my-data\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n</code></pre> <p>Volume \u4f4d\u7f6e</p> <p>Docker Volume \u9810\u8a2d\u5132\u5b58\u5728\uff1a</p> <ul> <li>Linux: <code>/var/lib/docker/volumes/</code></li> <li>macOS/Windows: Docker Desktop \u7ba1\u7406\u7684\u865b\u64ec\u78c1\u789f\u5167</li> </ul>"},{"location":"lab05_private_registry/#bind-mounts","title":"Bind Mounts","text":"Bind Mount \u4f7f\u7528\u65b9\u5f0f<pre><code># \u4f7f\u7528 -v \u8a9e\u6cd5\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u4f7f\u7528 --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run -d \\\n  --name my-nginx \\\n  --mount type=bind,source=/path/on/host,target=/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html:ro \\\n  nginx\n</code></pre> <p>\u958b\u767c\u74b0\u5883\u7bc4\u4f8b</p> \u524d\u7aef\u958b\u767c\u5373\u6642\u540c\u6b65<pre><code># \u5c07\u672c\u5730\u5c08\u6848\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668\ndocker run -d \\\n  --name frontend-dev \\\n  -v $(pwd)/src:/app/src \\\n  -p 3000:3000 \\\n  node:18\n</code></pre> <p>\u4fee\u6539\u672c\u5730 <code>src</code> \u76ee\u9304\u7684\u6a94\u6848\u6703\u7acb\u5373\u53cd\u6620\u5230\u5bb9\u5668\u4e2d\u3002</p>"},{"location":"lab05_private_registry/#volume-vs-bind-mount","title":"Volume vs Bind Mount \u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee Volume Bind Mount \u5132\u5b58\u4f4d\u7f6e Docker \u7ba1\u7406 \u6307\u5b9a\u4e3b\u6a5f\u8def\u5f91 \u53ef\u79fb\u690d\u6027 \u9ad8 \u4f9d\u8cf4\u4e3b\u6a5f\u8def\u5f91 \u6548\u80fd \u8f03\u4f73 \u53d6\u6c7a\u65bc\u4e3b\u6a5f\u6a94\u6848\u7cfb\u7d71 \u5099\u4efd \u5bb9\u6613 \u9700\u624b\u52d5\u8655\u7406 \u9069\u7528\u5834\u666f \u751f\u7522\u74b0\u5883 \u958b\u767c\u74b0\u5883"},{"location":"lab05_private_registry/#24-docker-network","title":"2.4 Docker Network","text":""},{"location":"lab05_private_registry/#_7","title":"\u9810\u8a2d\u7db2\u8def\u985e\u578b","text":"<p>Docker \u63d0\u4f9b\u591a\u7a2e\u7db2\u8def\u9a45\u52d5\uff0c\u6eff\u8db3\u4e0d\u540c\u7684\u4f7f\u7528\u5834\u666f\u3002</p> <pre><code>graph TB\n    subgraph \"Bridge Network\uff08\u9810\u8a2d\uff09\"\n        B_C1[Container 1] --- B_NET[docker0 bridge]\n        B_C2[Container 2] --- B_NET\n        B_NET --- B_HOST[Host Network Stack]\n    end\n\n    subgraph \"Host Network\"\n        H_C[Container] --- H_HOST[Host Network Stack]\n    end\n\n    subgraph \"None Network\"\n        N_C[Container - \u7121\u7db2\u8def]\n    end</code></pre> \u7db2\u8def\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f bridge \u9810\u8a2d\u7db2\u8def\uff0cContainer \u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 \u55ae\u6a5f\u591a\u5bb9\u5668\u901a\u8a0a host Container \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def \u9700\u8981\u6700\u9ad8\u7db2\u8def\u6548\u80fd none \u7121\u7db2\u8def\u9023\u63a5 \u5b89\u5168\u9694\u96e2\u9700\u6c42 overlay \u8de8\u4e3b\u6a5f\u5bb9\u5668\u901a\u8a0a Docker Swarm \u53e2\u96c6 macvlan \u5206\u914d\u771f\u5be6 MAC \u5730\u5740 \u9700\u8981\u76f4\u63a5\u9023\u63a5\u5be6\u9ad4\u7db2\u8def"},{"location":"lab05_private_registry/#_8","title":"\u7db2\u8def\u57fa\u672c\u64cd\u4f5c","text":"Docker \u7db2\u8def\u7ba1\u7406<pre><code># \u5217\u51fa\u6240\u6709\u7db2\u8def\ndocker network ls\n\n# \u6aa2\u8996\u7db2\u8def\u8a73\u7d30\u8cc7\u8a0a\ndocker network inspect bridge\n\n# \u5efa\u7acb\u81ea\u8a02\u7db2\u8def\ndocker network create my-network\n\n# \u5efa\u7acb\u6307\u5b9a\u5b50\u7db2\u8def\u7684\u7db2\u8def\ndocker network create \\\n  --driver bridge \\\n  --subnet 172.20.0.0/16 \\\n  --gateway 172.20.0.1 \\\n  my-custom-network\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm my-network\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u7db2\u8def\ndocker network prune\n</code></pre>"},{"location":"lab05_private_registry/#_9","title":"\u5bb9\u5668\u9023\u63a5\u7db2\u8def","text":"\u5bb9\u5668\u7db2\u8def\u9023\u63a5<pre><code># \u57f7\u884c\u5bb9\u5668\u6642\u6307\u5b9a\u7db2\u8def\ndocker run -d --name app1 --network my-network nginx\n\n# \u5c07\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u9023\u63a5\u5230\u7db2\u8def\ndocker network connect my-network container-name\n\n# \u5c07\u5bb9\u5668\u5f9e\u7db2\u8def\u65b7\u958b\ndocker network disconnect my-network container-name\n</code></pre>"},{"location":"lab05_private_registry/#_10","title":"\u5bb9\u5668\u9593\u901a\u8a0a","text":"<p>\u4f7f\u7528\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</p> <p>\u5728\u540c\u4e00\u500b\u81ea\u8a02\u7db2\u8def\u4e2d\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528**\u5bb9\u5668\u540d\u7a31**\u4f5c\u70ba hostname \u4e92\u76f8\u5b58\u53d6\u3002</p> \u5bb9\u5668\u9593\u901a\u8a0a\u7bc4\u4f8b<pre><code># \u5efa\u7acb\u7db2\u8def\ndocker network create app-network\n\n# \u555f\u52d5 MySQL Container\ndocker run -d \\\n  --name mysql-db \\\n  --network app-network \\\n  -e MYSQL_ROOT_PASSWORD=secret \\\n  mysql:8\n\n# \u555f\u52d5\u61c9\u7528\u7a0b\u5f0f Container\uff0c\u4f7f\u7528 mysql-db \u4f5c\u70ba\u8cc7\u6599\u5eab\u4e3b\u6a5f\ndocker run -d \\\n  --name my-app \\\n  --network app-network \\\n  -e DB_HOST=mysql-db \\\n  -e DB_PASSWORD=secret \\\n  my-application\n\n# \u6e2c\u8a66\u9023\u7dda\ndocker exec my-app ping mysql-db\n</code></pre>"},{"location":"lab05_private_registry/#port","title":"Port \u5c0d\u61c9","text":"Port Mapping<pre><code># \u5c0d\u61c9\u55ae\u4e00 Port\ndocker run -d -p 8080:80 nginx\n\n# \u5c0d\u61c9\u591a\u500b Port\ndocker run -d -p 8080:80 -p 8443:443 nginx\n\n# \u5c0d\u61c9\u5230\u6240\u6709\u4ecb\u9762\u7684\u96a8\u6a5f Port\ndocker run -d -P nginx\n\n# \u53ea\u5c0d\u61c9\u5230 localhost\ndocker run -d -p 127.0.0.1:8080:80 nginx\n\n# \u5c0d\u61c9 UDP Port\ndocker run -d -p 53:53/udp dns-server\n</code></pre>"},{"location":"lab05_private_registry/#25-docker-search","title":"2.5 Docker Search","text":""},{"location":"lab05_private_registry/#image","title":"\u641c\u5c0b Image","text":"\u641c\u5c0b Docker Hub<pre><code># \u57fa\u672c\u641c\u5c0b\ndocker search nginx\n\n# \u9650\u5236\u7d50\u679c\u6578\u91cf\ndocker search --limit 5 nginx\n\n# \u53ea\u986f\u793a\u5b98\u65b9 Image\ndocker search --filter is-official=true nginx\n\n# \u53ea\u986f\u793a\u81ea\u52d5\u5efa\u7f6e\u7684 Image\ndocker search --filter is-automated=true nginx\n\n# \u6839\u64da\u661f\u661f\u6578\u904e\u6ffe\ndocker search --filter stars=100 nginx\n</code></pre> <p>\u641c\u5c0b\u7d50\u679c\u8aaa\u660e\uff1a</p> \u6b04\u4f4d \u8aaa\u660e NAME Image \u540d\u7a31 DESCRIPTION \u63cf\u8ff0 STARS \u661f\u661f\u6578\uff08\u4eba\u6c23\u6307\u6a19\uff09 OFFICIAL \u662f\u5426\u70ba\u5b98\u65b9 Image AUTOMATED \u662f\u5426\u81ea\u52d5\u5efa\u7f6e <p>\u9078\u64c7 Image \u7684\u5efa\u8b70</p> <ol> <li>\u512a\u5148\u9078\u64c7**\u5b98\u65b9 Image**\uff08OFFICIAL = [OK]\uff09</li> <li>\u67e5\u770b**\u661f\u661f\u6578**\u548c**\u4e0b\u8f09\u6b21\u6578**</li> <li>\u5230 Docker Hub \u7db2\u7ad9\u67e5\u770b**\u6587\u4ef6**\u548c**\u66f4\u65b0\u983b\u7387**</li> <li>\u6aa2\u67e5 Image \u7684**\u5b89\u5168\u6383\u63cf\u7d50\u679c**</li> </ol>"},{"location":"lab05_private_registry/#26-docker-pull","title":"2.6 Docker Pull","text":""},{"location":"lab05_private_registry/#image_1","title":"\u62c9\u53d6 Image","text":"\u62c9\u53d6 Image<pre><code># \u62c9\u53d6\u6700\u65b0\u7248\u672c\uff08\u9810\u8a2d latest tag\uff09\ndocker pull nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\ndocker pull nginx:1.25\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\uff08alpine \u8f15\u91cf\u7248\uff09\ndocker pull nginx:alpine\n\n# \u5f9e\u5176\u4ed6 Registry \u62c9\u53d6\ndocker pull quay.io/bitnami/nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u5e73\u53f0\u7684 Image\ndocker pull --platform linux/amd64 nginx\n</code></pre>"},{"location":"lab05_private_registry/#image-tag","title":"Image \u6a19\u7c64\uff08Tag\uff09","text":"<pre><code>graph LR\n    N[nginx] --&gt; L[latest]\n    N --&gt; V1[1.25]\n    N --&gt; V2[1.25.3]\n    N --&gt; A[alpine]\n    N --&gt; VA[1.25-alpine]</code></pre> <p>\u907f\u514d\u4f7f\u7528 latest</p> <ul> <li><code>latest</code> \u6a19\u7c64\u6703\u96a8\u6642\u9593\u8b8a\u5316</li> <li>\u751f\u7522\u74b0\u5883\u61c9\u4f7f\u7528**\u660e\u78ba\u7248\u672c\u865f**</li> <li>\u4f8b\u5982\uff1a<code>nginx:1.25.3</code> \u800c\u975e <code>nginx:latest</code></li> </ul>"},{"location":"lab05_private_registry/#image_2","title":"\u7ba1\u7406\u672c\u5730 Image","text":"Image \u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u672c\u5730 Image\ndocker images\n\n# \u5217\u51fa\u6240\u6709 Image\uff08\u5305\u542b\u4e2d\u9593\u5c64\uff09\ndocker images -a\n\n# \u6aa2\u8996 Image \u8a73\u7d30\u8cc7\u8a0a\ndocker image inspect nginx\n\n# \u6aa2\u8996 Image \u6b77\u53f2\uff08\u5206\u5c64\uff09\ndocker history nginx\n\n# \u522a\u9664 Image\ndocker rmi nginx\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Image\ndocker image prune\n\n# \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image\uff08\u5305\u542b\u672a\u6a19\u8a18\u7684\uff09\ndocker image prune -a\n</code></pre>"},{"location":"lab05_private_registry/#27-docker-push","title":"2.7 Docker Push","text":""},{"location":"lab05_private_registry/#image-registry","title":"\u63a8\u9001 Image \u5230 Registry","text":""},{"location":"lab05_private_registry/#docker-hub","title":"\u63a8\u9001\u5230 Docker Hub","text":"\u63a8\u9001\u5230 Docker Hub<pre><code># 1. \u767b\u5165 Docker Hub\ndocker login\n\n# 2. \u70ba Image \u52a0\u4e0a\u6a19\u7c64\uff08\u5fc5\u9808\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff09\ndocker tag my-app:v1 username/my-app:v1\n\n# 3. \u63a8\u9001 Image\ndocker push username/my-app:v1\n\n# 4. \u767b\u51fa\uff08\u9078\u7528\uff09\ndocker logout\n</code></pre>"},{"location":"lab05_private_registry/#registry_2","title":"\u63a8\u9001\u5230\u79c1\u6709 Registry","text":"\u63a8\u9001\u5230\u79c1\u6709 Registry<pre><code># 1. \u767b\u5165\u79c1\u6709 Registry\ndocker login my-registry.example.com\n\n# 2. \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag my-app:v1 my-registry.example.com/my-app:v1\n\n# 3. \u63a8\u9001\ndocker push my-registry.example.com/my-app:v1\n</code></pre> <p>Image \u547d\u540d\u898f\u5247</p> <pre><code>[registry/][username/]repository[:tag]\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <ul> <li><code>nginx</code> = <code>docker.io/library/nginx:latest</code></li> <li><code>bitnami/nginx</code> = <code>docker.io/bitnami/nginx:latest</code></li> <li><code>gcr.io/project/app:v1</code></li> </ul>"},{"location":"lab05_private_registry/#_11","title":"\u6a19\u7c64\u7ba1\u7406","text":"Image \u6a19\u7c64\u64cd\u4f5c<pre><code># \u52a0\u4e0a\u65b0\u6a19\u7c64\ndocker tag my-app:v1 my-app:latest\ndocker tag my-app:v1 my-app:stable\n\n# \u63a8\u9001\u591a\u500b\u6a19\u7c64\ndocker push my-app:v1\ndocker push my-app:latest\ndocker push my-app:stable\n</code></pre>"},{"location":"lab05_private_registry/#28-docker-wordpress-mysql","title":"2.8 \u4f7f\u7528 Docker \u67b6\u8a2d WordPress + MySQL","text":""},{"location":"lab05_private_registry/#lab","title":"Lab \u5be6\u4f5c\u76ee\u6a19","text":"<p>\u90e8\u7f72\u4e00\u500b\u5b8c\u6574\u7684 WordPress \u7db2\u7ad9\uff0c\u5305\u542b\uff1a</p> <ul> <li>MySQL \u8cc7\u6599\u5eab\u5bb9\u5668</li> <li>WordPress \u61c9\u7528\u7a0b\u5f0f\u5bb9\u5668</li> <li>\u4f7f\u7528 Docker Network \u9023\u63a5</li> <li>\u4f7f\u7528 Volume \u6301\u4e45\u5316\u8cc7\u6599</li> </ul>"},{"location":"lab05_private_registry/#_12","title":"\u67b6\u69cb\u5716","text":"<pre><code>graph TB\n    subgraph \"Docker \u74b0\u5883\"\n        subgraph \"wp-network\"\n            WP[WordPress&lt;br/&gt;Port: 8080] --&gt;|\u9023\u63a5| DB[(MySQL&lt;br/&gt;Port: 3306)]\n        end\n        WP_VOL[wordpress-data&lt;br/&gt;Volume] --&gt; WP\n        DB_VOL[mysql-data&lt;br/&gt;Volume] --&gt; DB\n    end\n\n    User[\u4f7f\u7528\u8005] --&gt;|http://localhost:8080| WP</code></pre>"},{"location":"lab05_private_registry/#_13","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab05_private_registry/#1","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb\u7db2\u8def","text":"\u5efa\u7acb\u5c08\u7528\u7db2\u8def<pre><code>docker network create wp-network\n</code></pre>"},{"location":"lab05_private_registry/#2-mysql","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 MySQL \u5bb9\u5668","text":"\u555f\u52d5 MySQL<pre><code>docker run -d \\\n  --name wp-mysql \\\n  --network wp-network \\\n  -v mysql-data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=rootpassword \\\n  -e MYSQL_DATABASE=wordpress \\\n  -e MYSQL_USER=wpuser \\\n  -e MYSQL_PASSWORD=wppassword \\\n  mysql:8.0\n</code></pre> <p>MySQL \u74b0\u5883\u8b8a\u6578\u8aaa\u660e</p> \u74b0\u5883\u8b8a\u6578 \u8aaa\u660e <code>MYSQL_ROOT_PASSWORD</code> root \u5bc6\u78bc\uff08\u5fc5\u586b\uff09 <code>MYSQL_DATABASE</code> \u81ea\u52d5\u5efa\u7acb\u7684\u8cc7\u6599\u5eab <code>MYSQL_USER</code> \u81ea\u52d5\u5efa\u7acb\u7684\u4f7f\u7528\u8005 <code>MYSQL_PASSWORD</code> \u4f7f\u7528\u8005\u5bc6\u78bc"},{"location":"lab05_private_registry/#3-wordpress","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 WordPress \u5bb9\u5668","text":"\u555f\u52d5 WordPress<pre><code>docker run -d \\\n  --name wp-app \\\n  --network wp-network \\\n  -p 8080:80 \\\n  -v wordpress-data:/var/www/html \\\n  -e WORDPRESS_DB_HOST=wp-mysql:3306 \\\n  -e WORDPRESS_DB_NAME=wordpress \\\n  -e WORDPRESS_DB_USER=wpuser \\\n  -e WORDPRESS_DB_PASSWORD=wppassword \\\n  wordpress:latest\n</code></pre>"},{"location":"lab05_private_registry/#4","title":"\u6b65\u9a5f 4\uff1a\u9a57\u8b49\u90e8\u7f72","text":"\u9a57\u8b49\u5bb9\u5668\u72c0\u614b<pre><code># \u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u904b\u884c\ndocker ps\n\n# \u6aa2\u67e5\u5bb9\u5668\u65e5\u8a8c\ndocker logs wp-mysql\ndocker logs wp-app\n\n# \u6e2c\u8a66 MySQL \u9023\u7dda\ndocker exec wp-mysql mysql -uwpuser -pwppassword -e \"SHOW DATABASES;\"\n</code></pre>"},{"location":"lab05_private_registry/#5-wordpress","title":"\u6b65\u9a5f 5\uff1a\u5b58\u53d6 WordPress","text":"<p>\u958b\u555f\u700f\u89bd\u5668\uff0c\u524d\u5f80 <code>http://localhost:8080</code>\uff0c\u5b8c\u6210 WordPress \u5b89\u88dd\u7cbe\u9748\u3002</p>"},{"location":"lab05_private_registry/#docker-compose","title":"\u4f7f\u7528 Docker Compose\uff08\u984d\u5916\u8aaa\u660e\uff09","text":"<p>\u66f4\u7c21\u6f54\u7684\u65b9\u5f0f</p> <p>\u4f7f\u7528 Docker Compose \u53ef\u4ee5\u5c07\u4ee5\u4e0a\u6240\u6709\u8a2d\u5b9a\u96c6\u4e2d\u5728\u4e00\u500b\u6a94\u6848\u4e2d\u3002</p> docker-compose.yml<pre><code>version: '3.8'\n\nservices:\n  db:\n    image: mysql:8.0\n    container_name: wp-mysql\n    volumes:\n      - mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpassword\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wpuser\n      MYSQL_PASSWORD: wppassword\n    networks:\n      - wp-network\n\n  wordpress:\n    image: wordpress:latest\n    container_name: wp-app\n    depends_on:\n      - db\n    ports:\n      - \"8080:80\"\n    volumes:\n      - wordpress-data:/var/www/html\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_NAME: wordpress\n      WORDPRESS_DB_USER: wpuser\n      WORDPRESS_DB_PASSWORD: wppassword\n    networks:\n      - wp-network\n\nnetworks:\n  wp-network:\n    driver: bridge\n\nvolumes:\n  mysql-data:\n  wordpress-data:\n</code></pre> \u4f7f\u7528 Docker Compose \u555f\u52d5<pre><code># \u555f\u52d5\u6240\u6709\u670d\u52d9\ndocker compose up -d\n\n# \u6aa2\u8996\u72c0\u614b\ndocker compose ps\n\n# \u6aa2\u8996\u65e5\u8a8c\ndocker compose logs -f\n\n# \u505c\u6b62\u4e26\u79fb\u9664\ndocker compose down\n\n# \u505c\u6b62\u4e26\u79fb\u9664\uff08\u5305\u542b Volume\uff09\ndocker compose down -v\n</code></pre>"},{"location":"lab05_private_registry/#_14","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u6e05\u7406\u5be6\u4f5c\u74b0\u5883<pre><code># \u505c\u6b62\u5bb9\u5668\ndocker stop wp-app wp-mysql\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm wp-app wp-mysql\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm wp-network\n\n# \u522a\u9664 Volume\uff08\u8b66\u544a\uff1a\u6703\u522a\u9664\u6240\u6709\u8cc7\u6599\uff09\ndocker volume rm mysql-data wordpress-data\n</code></pre>"},{"location":"lab05_private_registry/#_15","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aContainer \u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># \u6aa2\u8996\u5bb9\u5668\u65e5\u8a8c\ndocker logs container-name\n\n# \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\ndocker inspect container-name\n\n# \u6aa2\u8996\u6700\u5f8c\u9000\u51fa\u72c0\u614b\ndocker ps -a --filter \"name=container-name\"\n</code></pre><p></p> <p>\u5e38\u898b\u539f\u56e0\uff1a</p> <ul> <li>\u555f\u52d5\u6307\u4ee4\u932f\u8aa4</li> <li>\u74b0\u5883\u8b8a\u6578\u7f3a\u5931</li> <li>\u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2</li> <li>\u8a2d\u5b9a\u6a94\u932f\u8aa4</li> </ul> Q2\uff1a\u5982\u4f55\u8b93\u5bb9\u5668\u5728\u4e3b\u6a5f\u91cd\u555f\u5f8c\u81ea\u52d5\u555f\u52d5\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a\u4f7f\u7528 <code>--restart</code> \u9078\u9805 </p><pre><code># always: \u7e3d\u662f\u91cd\u555f\ndocker run -d --restart=always nginx\n\n# unless-stopped: \u9664\u975e\u624b\u52d5\u505c\u6b62\ndocker run -d --restart=unless-stopped nginx\n\n# on-failure: \u53ea\u5728\u7570\u5e38\u9000\u51fa\u6642\u91cd\u555f\ndocker run -d --restart=on-failure:3 nginx\n</code></pre><p></p> Q3\uff1aVolume \u8cc7\u6599\u5982\u4f55\u5099\u4efd\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u65b9\u6cd5 1\uff1a\u4f7f\u7528\u81e8\u6642\u5bb9\u5668\u5099\u4efd\ndocker run --rm \\\n  -v mysql-data:/source:ro \\\n  -v $(pwd):/backup \\\n  alpine tar cvf /backup/mysql-backup.tar /source\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 docker cp\uff08\u9700\u8981\u5148\u639b\u8f09\u5230\u5bb9\u5668\uff09\ndocker cp container-name:/var/lib/mysql ./mysql-backup\n</code></pre><p></p> Q4\uff1a\u5982\u4f55\u67e5\u770b Docker \u4f54\u7528\u7684\u78c1\u789f\u7a7a\u9593\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996\u6574\u9ad4\u4f7f\u7528\u60c5\u6cc1\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u6e05\u7406\u6240\u6709\u672a\u4f7f\u7528\u8cc7\u6e90\uff08\u5305\u542b Volume\uff09\ndocker system prune -a --volumes\n</code></pre><p></p> Q5\uff1a\u5bb9\u5668\u9593\u7121\u6cd5\u901a\u8a0a\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># 1. \u78ba\u8a8d\u5bb9\u5668\u5728\u540c\u4e00\u500b\u7db2\u8def\ndocker network inspect my-network\n\n# 2. \u78ba\u8a8d\u5bb9\u5668 IP\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' container-name\n\n# 3. \u5728\u5bb9\u5668\u5167\u6e2c\u8a66\u9023\u7dda\ndocker exec container1 ping container2\n\n# 4. \u78ba\u8a8d Port \u662f\u5426\u958b\u653e\ndocker exec container1 nc -zv container2 port\n</code></pre><p></p>"},{"location":"lab05_private_registry/#_16","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Registry \u985e\u578b\uff1aPublic Registry\uff08\u5982 Docker Hub\uff09\u8207 Private Registry\uff08\u5982 Harbor\uff09</li> <li>\u2705 Container \u7ba1\u7406\uff1arun\u3001exec\u3001logs\u3001inspect \u7b49\u6838\u5fc3\u6307\u4ee4</li> <li>\u2705 \u6301\u4e45\u5316\u5132\u5b58\uff1aVolume\uff08Docker \u7ba1\u7406\uff09vs Bind Mount\uff08\u4e3b\u6a5f\u76ee\u9304\uff09</li> <li>\u2705 Docker \u7db2\u8def\uff1abridge\u3001host\u3001none \u7db2\u8def\u985e\u578b\uff0c\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</li> <li>\u2705 Image \u64cd\u4f5c\uff1asearch\u3001pull\u3001push\u3001tag \u5b8c\u6574\u6d41\u7a0b</li> <li>\u2705 \u5be6\u4f5c\u7d93\u9a57\uff1aWordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"lab05_private_registry/#_17","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Storage</li> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Networking</li> <li>Docker Hub \u5b98\u65b9\u7db2\u7ad9</li> <li>Harbor - \u4f01\u696d\u7d1a Registry</li> <li>Docker Compose \u5b98\u65b9\u6587\u4ef6</li> </ul>"},{"location":"lab06_docker_basics/","title":"LAB 06 docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#lab-06-docker","title":"LAB 06 docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab06_docker_basics/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab07_persistent_storage/","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#lab-07-persistent-storage","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab07_persistent_storage/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab08_wordpress/","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - wordpress","text":""},{"location":"lab08_wordpress/#lab-08-wordpress","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - wordpress","text":""},{"location":"lab08_wordpress/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab08_wordpress/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab09_commit/","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#lab-09-container-images-docker-commit","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 <code>docker commit</code> \u5f9e\u5bb9\u5668\u5efa\u7acb\u65b0\u7684 Image</li> <li> \u4f7f\u7528 <code>docker save</code> \u5c07 Image \u532f\u51fa\u70ba tar \u6a94</li> <li> \u4f7f\u7528 <code>docker load</code> \u5f9e tar \u6a94\u8f09\u5165 Image</li> <li> \u5efa\u7acb\u6e05\u7406 Docker \u74b0\u5883\u7684\u8173\u672c</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 06 \u7684\u5167\u5bb9</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u5df2\u8a2d\u5b9a Private Registry\uff08docker1.training.lab:5000\uff09</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#91","title":"9.1 \u74b0\u5883\u6e96\u5099","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker2","title":"\u5207\u63db\u5230 docker2 \u865b\u64ec\u6a5f","text":"<p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_3","title":"\u78ba\u8a8d\u73fe\u6709\u74b0\u5883","text":"\u6aa2\u8996\u73fe\u6709\u7684 Container Images<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\n192.168.66.51:5000/nginx:1.9.1          667cfe3b0942        289MB          139MB        \ndocker1.training.lab:5000/nginx:1.7.1   b1590b02702d       1.06GB          515MB        \n</code></pre> \u6aa2\u8996\u73fe\u6709\u7684 Container<pre><code>docker ps -a\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_4","title":"\u5efa\u7acb\u6e05\u7406\u8173\u672c","text":"<p>\u5efa\u7acb\u4e00\u500b\u8173\u672c\u4f86\u6e05\u7406\u6240\u6709 Container \u8207 Image\uff1a</p> \u5efa\u7acb docker_clean_all.sh<pre><code>vi docker_clean_all.sh\n</code></pre> <p>\u8173\u672c\u5167\u5bb9\uff1a</p> docker_clean_all.sh<pre><code>#!/bin/bash\n# \u505c\u6b62\u4e26\u522a\u9664\u6240\u6709 Container\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\n# \u522a\u9664\u6240\u6709 Image\ndocker rmi $(docker images -q)\n</code></pre> <p>\u8173\u672c\u8aaa\u660e</p> <ul> <li><code>docker ps -aq</code>\uff1a\u5217\u51fa\u6240\u6709 Container \u7684 ID\uff08<code>-a</code> \u5305\u542b\u5df2\u505c\u6b62\u7684\uff0c<code>-q</code> \u53ea\u986f\u793a ID\uff09</li> <li><code>docker images -q</code>\uff1a\u5217\u51fa\u6240\u6709 Image \u7684 ID</li> <li>\u5982\u679c\u6c92\u6709 Container \u6216 Image\uff0c\u6307\u4ee4\u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u4f46\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c</li> </ul> \u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 ./docker_clean_all.sh\n</code></pre> \u57f7\u884c\u6e05\u7406\u8173\u672c<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>docker: 'docker stop' requires at least 1 argument\ndocker: 'docker rm' requires at least 1 argument\nUntagged: 192.168.66.51:5000/nginx:1.9.1\nDeleted: sha256:667cfe3b094262dcd2323f28a800d8376221b017a9dd14b6fff78e4ec96a6177\nUntagged: docker1.training.lab:5000/nginx:1.7.1\nDeleted: sha256:b1590b02702d926755e02ca8f01baa42c9789758a3fb6d40aa87bdcfe871965d\n</code></pre> <p>\u932f\u8aa4\u8a0a\u606f\u8aaa\u660e</p> <p>\u7576\u6c92\u6709 Container \u6642\uff0c<code>docker stop</code> \u548c <code>docker rm</code> \u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u9019\u662f\u6b63\u5e38\u7684\uff0c\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#92-docker-image","title":"9.2 \u4e0b\u8f09 Docker Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#private-registry-alpine","title":"\u5f9e Private Registry \u4e0b\u8f09 Alpine","text":"\u4e0b\u8f09 Alpine Image<pre><code>docker pull docker1.training.lab:5000/alpine\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Using default tag: latest\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\ndocker1.training.lab:5000/alpine:latest\n</code></pre> <p>docker pull \u8aaa\u660e</p> <ul> <li>\u5982\u679c\u6c92\u6709\u6307\u5b9a tag\uff0c\u9810\u8a2d\u6703\u4f7f\u7528 <code>latest</code></li> <li>\u5f9e Private Registry \u4e0b\u8f09\u9700\u8981\u6307\u5b9a\u5b8c\u6574\u7684 Registry \u4f4d\u5740</li> </ul> \u78ba\u8a8d Image \u5df2\u4e0b\u8f09<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB        \n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#93-alpine-sh","title":"9.3 \u9032\u5165 Alpine \u57f7\u884c sh","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#container","title":"\u555f\u52d5\u4e92\u52d5\u5f0f Container","text":"\u555f\u52d5 Alpine Container<pre><code>docker run -it --name alpine-1 docker1.training.lab:5000/alpine:latest\n</code></pre> <p>docker run \u53c3\u6578\u8aaa\u660e</p> \u53c3\u6578 \u8aaa\u660e <code>-i</code> \u4fdd\u6301 STDIN \u958b\u555f\uff08interactive\uff09 <code>-t</code> \u5206\u914d\u865b\u64ec\u7d42\u7aef\u6a5f\uff08tty\uff09 <code>--name alpine-1</code> \u6307\u5b9a Container \u540d\u7a31 <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230\u63d0\u793a\u7b26\u865f <code>/ #</code>\uff0c\u8868\u793a\u5df2\u5728 Container \u5167\u90e8\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#94-alpine-bash","title":"9.4 \u5728 Alpine \u4e2d\u5b89\u88dd Bash","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#bash","title":"\u6e2c\u8a66 Bash \u662f\u5426\u5b58\u5728","text":"\u6e2c\u8a66 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>/bin/sh: bash: not found\n</code></pre> <p>\u70ba\u4ec0\u9ebc Alpine \u6c92\u6709 Bash\uff1f</p> <p>Alpine Linux \u662f\u4e00\u500b\u6975\u8f15\u91cf\u7684 Linux \u767c\u884c\u7248\uff0c\u4f7f\u7528 BusyBox \u4f5c\u70ba\u6838\u5fc3\u5de5\u5177\u96c6\uff0c\u9810\u8a2d\u53ea\u63d0\u4f9b <code>/bin/sh</code>\uff08ash shell\uff09\u4ee5\u7dad\u6301\u6975\u5c0f\u7684\u6620\u50cf\u5927\u5c0f\uff08\u7d04 5MB\uff09\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#apk-bash","title":"\u4f7f\u7528 apk \u5b89\u88dd Bash","text":"\u5b89\u88dd bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>apk add --no-cache --update-cache bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing ncurses-terminfo-base (6.1_p20190518-r2)\n(2/4) Installing ncurses-libs (6.1_p20190518-r2)\n(3/4) Installing readline (8.0.0-r0)\n(4/4) Installing bash (5.0.0-r0)\nExecuting bash-5.0.0-r0.post-install\nExecuting busybox-1.30.1-r2.trigger\nOK: 8 MiB in 18 packages\n</code></pre> <p>apk \u53c3\u6578\u8aaa\u660e</p> \u53c3\u6578 \u8aaa\u660e <code>add</code> \u5b89\u88dd\u5957\u4ef6 <code>--no-cache</code> \u4e0d\u4f7f\u7528\u672c\u5730\u5feb\u53d6\uff0c\u6e1b\u5c11 Image \u5927\u5c0f <code>--update-cache</code> \u66f4\u65b0\u5957\u4ef6\u7d22\u5f15","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_5","title":"\u9a57\u8b49\u5b89\u88dd\u6210\u529f","text":"\u5207\u63db\u5230 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <p>\u6210\u529f\u9032\u5165 bash\uff0c\u63d0\u793a\u7b26\u865f\u8b8a\u6210 <code>bash-5.0#</code></p> \u9000\u51fa Container<pre><code>exit  # \u9000\u51fa bash\nexit  # \u9000\u51fa Container\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#95-commit-container-image","title":"9.5 Commit \u65b0\u7684 Container Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-commit-image","title":"\u4f7f\u7528 docker commit \u5efa\u7acb\u65b0 Image","text":"\u5efa\u7acb\u65b0 Image<pre><code>docker commit -m \"alpine + bash\" alpine-1 alpine-bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n</code></pre> <p>docker commit \u8a9e\u6cd5</p> <pre><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-m</code> \u63d0\u4ea4\u8a0a\u606f\uff08\u63cf\u8ff0\u8b8a\u66f4\u5167\u5bb9\uff09 <code>-a</code> \u6307\u5b9a\u4f5c\u8005\uff08\u53ef\u9078\uff09 <code>alpine-1</code> \u4f86\u6e90 Container \u540d\u7a31 <code>alpine-bash</code> \u65b0 Image \u540d\u7a31\uff08\u9810\u8a2d tag \u70ba latest\uff09 \u78ba\u8a8d\u65b0 Image \u5df2\u5efa\u7acb<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest                        4326afd8916b       14.5MB          6.6MB        \ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB    U   \n</code></pre> <p>Image \u5927\u5c0f\u8b8a\u5316</p> <p>\u5b89\u88dd Bash \u5f8c\uff0cImage \u5f9e 5.82MB \u589e\u52a0\u5230 6.6MB\uff0c\u589e\u52a0\u7d04 0.78MB\uff08\u4e3b\u8981\u662f Bash \u53ca\u5176\u76f8\u4f9d\u5957\u4ef6\uff09\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#96-tar-ball","title":"9.6 \u532f\u51fa\u4e26\u58d3\u7e2e\u70ba Tar Ball \u6a94\u6848","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-save-image","title":"\u4f7f\u7528 docker save \u532f\u51fa Image","text":"\u532f\u51fa Image \u70ba tar \u6a94<pre><code>docker save --output=alpine-bash.tar alpine-bash\n</code></pre> <p>docker save \u8a9e\u6cd5</p> <pre><code>docker save [OPTIONS] IMAGE [IMAGE...]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>--output</code> \u6216 <code>-o</code> \u6307\u5b9a\u8f38\u51fa\u6a94\u6848\u540d\u7a31 \u53ef\u4e00\u6b21\u532f\u51fa\u591a\u500b Image \u78ba\u8a8d tar \u6a94\u6848\u5927\u5c0f<pre><code>ls -lh alpine-bash.tar\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rw------- 1 root root 6.3M Jan 27 11:05 alpine-bash.tar\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#gzip","title":"\u4f7f\u7528 gzip \u58d3\u7e2e","text":"\u58d3\u7e2e tar \u6a94\u6848<pre><code>gzip -9 alpine-bash.tar\n</code></pre> <p>gzip \u53c3\u6578\u8aaa\u660e</p> <ul> <li><code>-9</code>\uff1a\u6700\u9ad8\u58d3\u7e2e\u6bd4\uff081-9\uff0c9 \u70ba\u6700\u9ad8\uff09</li> <li>\u58d3\u7e2e\u5f8c\u6a94\u6848\u6703\u81ea\u52d5\u52a0\u4e0a <code>.gz</code> \u526f\u6a94\u540d</li> </ul> \u78ba\u8a8d\u58d3\u7e2e\u5f8c\u5927\u5c0f<pre><code>ls -lh alpine-bash.tar.gz\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rw------- 1 root root 3.4M Jan 27 11:05 alpine-bash.tar.gz\n</code></pre> <p>\u58d3\u7e2e\u6548\u679c</p> <p>\u6a94\u6848\u5f9e 6.3MB \u58d3\u7e2e\u5230 3.4MB\uff0c\u6e1b\u5c11\u7d04 46% \u7684\u7a7a\u9593\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#97-container-images","title":"9.7 \u6e2c\u8a66 - \u6e05\u9664\u5168\u90e8\u7684 Container \u53ca Images","text":"\u6e05\u9664\u6240\u6709 Container \u8207 Image<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>20fb31307e87\n20fb31307e87\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n</code></pre> \u78ba\u8a8d\u74b0\u5883\u5df2\u6e05\u7406<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#98-container-image","title":"9.8 \u8f09\u5165 Container Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-load","title":"\u4f7f\u7528 docker load \u8f09\u5165\u58d3\u7e2e\u6a94","text":"\u5f9e\u58d3\u7e2e\u6a94\u8f09\u5165 Image<pre><code>docker load -i alpine-bash.tar.gz\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Loaded image: alpine-bash:latest\n</code></pre> <p>docker load \u8a9e\u6cd5</p> <pre><code>docker load [OPTIONS]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-i</code> \u6216 <code>--input</code> \u6307\u5b9a\u8f38\u5165\u6a94\u6848 \u652f\u63f4 <code>.tar</code> \u548c <code>.tar.gz</code> \u683c\u5f0f \u78ba\u8a8d Image \u5df2\u8f09\u5165<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest   4326afd8916b       14.5MB          6.6MB        \n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#99-bash","title":"9.9 \u78ba\u8a8d\u662f\u5426\u6709 Bash","text":"\u4f7f\u7528\u8f09\u5165\u7684 Image \u555f\u52d5 Container<pre><code>docker run -it --name alpine-2 alpine-bash /bin/bash\n</code></pre> <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230\u63d0\u793a\u7b26\u865f <code>bash-5.0#</code>\uff0c\u8868\u793a Bash \u5df2\u6210\u529f\u5b89\u88dd\u3002</p> \u78ba\u8a8d bash \u5df2\u5b89\u88dd\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>ls -l /bin/bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n</code></pre> \u9000\u51fa Container<pre><code>exit\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#910-container-images","title":"9.10 \u6e05\u9664\u5168\u90e8\u7684 Container \u53ca Images","text":"\u6700\u7d42\u6e05\u7406<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>db10817df336\ndb10817df336\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n</code></pre> <p>Lab \u5b8c\u6210</p> <p>\u606d\u559c\u4f60\u5df2\u6210\u529f\u5b8c\u6210\u672c Lab\uff01</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_6","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-commit","title":"docker commit","text":"\u9078\u9805 \u8aaa\u660e \u7bc4\u4f8b <code>-m</code> \u63d0\u4ea4\u8a0a\u606f <code>-m \"alpine + bash\"</code> <code>-a</code> \u6307\u5b9a\u4f5c\u8005 <code>-a \"John Doe\"</code> <code>-c</code> \u5957\u7528 Dockerfile \u6307\u4ee4 <code>-c 'CMD [\"bash\"]'</code> <code>-p</code> \u63d0\u4ea4\u524d\u66ab\u505c\u5bb9\u5668 <code>-p</code>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-save-docker-load","title":"docker save \u8207 docker load","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>docker save</code> \u5c07 Image \u532f\u51fa\u70ba tar \u6a94 <code>docker save -o image.tar my-image</code> <code>docker load</code> \u5f9e tar \u6a94\u8f09\u5165 Image <code>docker load -i image.tar</code> <p>docker save vs docker export</p> \u6bd4\u8f03 docker save docker export \u5c0d\u8c61 Image Container \u4fdd\u7559 \u5b8c\u6574 Layer \u8207 metadata \u55ae\u4e00\u6a94\u6848\u7cfb\u7d71 \u8f09\u5165\u6307\u4ee4 docker load docker import \u7528\u9014 Image \u5099\u4efd/\u50b3\u8f38 Container \u6a94\u6848\u7cfb\u7d71\u5099\u4efd","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 docker commit\uff1a\u5c07\u57f7\u884c\u4e2d\u7684 Container \u72c0\u614b\u5132\u5b58\u70ba\u65b0 Image</li> <li>\u2705 docker save\uff1a\u5c07 Image \u532f\u51fa\u70ba tar \u6a94\u6848</li> <li>\u2705 docker load\uff1a\u5f9e tar \u6a94\u8f09\u5165 Image</li> <li>\u2705 gzip \u58d3\u7e2e\uff1a\u6e1b\u5c11\u532f\u51fa\u6a94\u6848\u7684\u5927\u5c0f</li> <li>\u2705 \u6e05\u7406\u8173\u672c\uff1a\u4f7f\u7528\u8173\u672c\u6279\u6b21\u6e05\u7406 Container \u8207 Image</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab10_dockerfile/","title":"LAB 10 \u5ba2\u88fd\u5316 Container images - dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#lab-10-container-images-dockerfile","title":"LAB 10 \u5ba2\u88fd\u5316 Container Images - Dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u64b0\u5beb Dockerfile \u5efa\u7acb\u5ba2\u88fd\u5316 Image</li> <li> \u4f7f\u7528 <code>docker build</code> \u5efa\u7f6e Image</li> <li> \u4f7f\u7528 <code>docker login</code> \u767b\u5165 Docker Hub</li> <li> \u4f7f\u7528 <code>docker tag</code> \u6a19\u8a18 Image</li> <li> \u4f7f\u7528 <code>docker push</code> \u4e0a\u50b3 Image \u5230 Docker Hub</li> <li> \u5f9e Docker Hub \u4e0b\u8f09\u81ea\u5df1\u4e0a\u50b3\u7684 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 09 \u7684\u5167\u5bb9</li> <li>\u4e86\u89e3 Docker Image \u7684\u57fa\u672c\u6982\u5ff5</li> <li>\u5df2\u8a3b\u518a Docker Hub \u5e33\u865f\uff08https://hub.docker.com\uff09</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#101","title":"10.1 \u74b0\u5883\u6e96\u5099","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker2","title":"\u5207\u63db\u5230 docker2 \u865b\u64ec\u6a5f","text":"<p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_3","title":"\u78ba\u8a8d\u74b0\u5883\u5df2\u6e05\u7406","text":"\u6aa2\u8996\u73fe\u6709\u7684 Container Images<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre> \u6aa2\u8996\u73fe\u6709\u7684 Container<pre><code>docker ps -a\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_4","title":"\u57f7\u884c\u6e05\u7406\u8173\u672c\uff08\u5982\u6709\u9700\u8981\uff09","text":"\u57f7\u884c\u6e05\u7406\u8173\u672c<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u8173\u672c\u8aaa\u660e</p> <p>\u5982\u679c\u6c92\u6709 Container \u6216 Image\uff0c\u6307\u4ee4\u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u9019\u662f\u6b63\u5e38\u7684\uff0c\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#102-dockerfile","title":"10.2 \u5efa\u7acb\u5c08\u7528\u76ee\u9304\u8207 Dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_5","title":"\u5efa\u7acb\u5de5\u4f5c\u76ee\u9304","text":"\u5efa\u7acb Dockerfile \u5c08\u7528\u76ee\u9304<pre><code>mkdir /root/dockerfile-1\ncd /root/dockerfile-1\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#dockerfile","title":"\u5efa\u7acb Dockerfile","text":"\u7de8\u8f2f Dockerfile<pre><code>vi dockerfile\n</code></pre> <p>Dockerfile \u5167\u5bb9\uff1a</p> dockerfile<pre><code>FROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n</code></pre> <p>Dockerfile \u6307\u4ee4\u8aaa\u660e</p> \u6307\u4ee4 \u8aaa\u660e <code>FROM</code> \u6307\u5b9a\u57fa\u790e\u6620\u50cf\uff0c\u9019\u88e1\u4f7f\u7528 Private Registry \u7684 Alpine <code>RUN</code> \u5728\u5efa\u7f6e\u904e\u7a0b\u4e2d\u57f7\u884c\u6307\u4ee4\uff0c\u9019\u88e1\u5b89\u88dd bash <code>CMD</code> \u6307\u5b9a\u5bb9\u5668\u555f\u52d5\u6642\u9810\u8a2d\u57f7\u884c\u7684\u6307\u4ee4 \u78ba\u8a8d Dockerfile \u5167\u5bb9<pre><code>cat dockerfile\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>FROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#103-alpine-image","title":"10.3 \u6e2c\u8a66\u57fa\u790e Alpine Image","text":"<p>\u5728\u5efa\u7f6e\u81ea\u8a02 Image \u4e4b\u524d\uff0c\u5148\u78ba\u8a8d\u57fa\u790e Alpine \u6c92\u6709 Bash\uff1a</p> \u555f\u52d5 Alpine Container \u6e2c\u8a66<pre><code>docker run -it --name alpine-1 docker1.training.lab:5000/alpine /bin/sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Unable to find image 'docker1.training.lab:5000/alpine:latest' locally\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\n</code></pre> <p>\u5728\u5bb9\u5668\u5167\u6e2c\u8a66 Bash\uff1a</p> \u6e2c\u8a66 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>/bin/sh: bash: not found\n</code></pre> \u9000\u51fa\u5bb9\u5668<pre><code>exit\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#104-dockerfile-docker-image","title":"10.4 \u4f7f\u7528 Dockerfile \u5efa\u7f6e\u65b0\u7684 Docker Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-build","title":"\u57f7\u884c docker build","text":"\u5efa\u7f6e Docker Image<pre><code>docker build -t alpine-bash-2 .\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>[+] Building 2.9s (6/6) FINISHED                                                docker:default\n =&gt; [internal] load build definition from dockerfile                                      0.0s\n =&gt; =&gt; transferring dockerfile: 171B                                                      0.0s\n =&gt; [internal] load metadata for docker1.training.lab:5000/alpine:latest                  0.0s\n =&gt; [internal] load .dockerignore                                                         0.0s\n =&gt; =&gt; transferring context: 2B                                                           0.0s\n =&gt; [1/2] FROM docker1.training.lab:5000/alpine:latest                                    0.0s\n =&gt; [2/2] RUN apk add --no-cache --update-cache bash                                      2.7s\n =&gt; exporting to image                                                                    0.2s\n =&gt; =&gt; exporting layers                                                                   0.1s\n =&gt; =&gt; naming to docker.io/library/alpine-bash-2:latest                                   0.0s\n =&gt; =&gt; unpacking to docker.io/library/alpine-bash-2:latest                                0.0s\n</code></pre> <p>docker build \u8a9e\u6cd5</p> <pre><code>docker build -t &lt;image_name&gt;:&lt;tag&gt; &lt;path&gt;\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-t</code> \u6307\u5b9a Image \u540d\u7a31\u548c\u6a19\u7c64 <code>.</code> \u6307\u5b9a Dockerfile \u6240\u5728\u76ee\u9304\uff08\u7576\u524d\u76ee\u9304\uff09 <p>\u5efa\u7f6e\u904e\u7a0b\u8aaa\u660e</p> <ul> <li><code>[1/2] FROM</code>\uff1a\u8f09\u5165\u57fa\u790e\u6620\u50cf</li> <li><code>[2/2] RUN</code>\uff1a\u57f7\u884c Dockerfile \u4e2d\u7684 RUN \u6307\u4ee4\uff08\u5b89\u88dd bash\uff09</li> <li><code>exporting to image</code>\uff1a\u532f\u51fa\u70ba\u65b0\u7684 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#105-container-image","title":"10.5 \u6e2c\u8a66\u65b0\u7684 Container Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#image","title":"\u4f7f\u7528\u65b0 Image \u555f\u52d5\u5bb9\u5668","text":"\u4f7f\u7528\u65b0 Image \u555f\u52d5 Container<pre><code>docker run -it --name alpine-3 alpine-bash-2 /bin/bash\n</code></pre> <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230 <code>bash-5.0#</code> \u63d0\u793a\u7b26\u865f\uff0c\u8868\u793a Bash \u5df2\u6210\u529f\u5b89\u88dd\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#bash","title":"\u78ba\u8a8d Bash \u5df2\u5b89\u88dd","text":"\u78ba\u8a8d bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>ls -l /bin/bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n</code></pre> \u9000\u51fa\u5bb9\u5668<pre><code>exit\n</code></pre> <p>\u5efa\u7f6e\u6210\u529f</p> <p>\u4f7f\u7528 Dockerfile \u5efa\u7f6e\u7684 Image \u5df2\u5305\u542b Bash\uff0c\u8207 LAB 09 \u4f7f\u7528 <code>docker commit</code> \u7684\u7d50\u679c\u76f8\u540c\uff0c\u4f46 Dockerfile \u65b9\u5f0f\u66f4\u5177\u53ef\u91cd\u73fe\u6027\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#106","title":"10.6 \u6e05\u7406\u74b0\u5883","text":"\u5207\u63db\u5230\u5bb6\u76ee\u9304\u4e26\u6e05\u7406<pre><code>cd\n./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>254f09eaadac\n9ae97d52cd65\n254f09eaadac\n9ae97d52cd65\nUntagged: alpine-bash-2:latest\nDeleted: sha256:fe1c0340426860bdd7792a7e560d3dfbb1c6a4d0bf4caadd5e987a4b71fbd169\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#107-docker-image-docker-hub","title":"10.7 \u4e0a\u50b3 Docker Image \u5230 Docker Hub","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub","title":"\u8a3b\u518a Docker Hub \u5e33\u865f","text":"<p>\u4e8b\u524d\u6e96\u5099</p> <p>\u8acb\u5148\u5230 https://hub.docker.com \u8a3b\u518a\u5e33\u865f\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-login","title":"\u4f7f\u7528 docker login \u767b\u5165","text":"\u767b\u5165 Docker Hub<pre><code>docker login -u &lt;\u4f60\u7684\u5e33\u865f&gt;\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker login -u caocharles\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Password: \nWARNING! Your credentials are stored unencrypted in '/root/.docker/config.json'.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/go/credential-store/\n\nLogin Succeeded\n</code></pre> <p>\u5bc6\u78bc\u5132\u5b58\u8b66\u544a</p> <p>\u767b\u5165\u5f8c\uff0cDocker \u6703\u5c07\u8a8d\u8b49\u8cc7\u8a0a\u5132\u5b58\u5728 <code>/root/.docker/config.json</code>\uff0c\u9019\u662f Base64 \u7de8\u78bc\uff08\u975e\u52a0\u5bc6\uff09\uff0c\u8acb\u6ce8\u610f\u5b89\u5168\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-image","title":"\u91cd\u65b0\u5efa\u7f6e Docker Image","text":"\u5207\u63db\u5230 Dockerfile \u76ee\u9304<pre><code>cd /root/dockerfile-1\n</code></pre> \u5efa\u7f6e\u8981\u4e0a\u50b3\u7684 Image<pre><code>docker build -t alpine-bash-charles .\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>[+] Building 0.1s (6/6) FINISHED                                                docker:default\n =&gt; [internal] load build definition from dockerfile                                      0.0s\n =&gt; CACHED [2/2] RUN apk add --no-cache --update-cache bash                               0.0s\n =&gt; exporting to image                                                                    0.0s\n =&gt; =&gt; naming to docker.io/library/alpine-bash-charles:latest                             0.0s\n</code></pre> <p>CACHED \u8aaa\u660e</p> <p>\u5982\u679c\u4e4b\u524d\u5df2\u5efa\u7f6e\u904e\u76f8\u540c\u7684\u5c64\uff0cDocker \u6703\u4f7f\u7528\u5feb\u53d6\uff0c\u52a0\u5feb\u5efa\u7f6e\u901f\u5ea6\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#image-tag","title":"\u70ba Image \u52a0\u4e0a Tag","text":"<p>\u8981\u4e0a\u50b3\u5230 Docker Hub\uff0cImage \u540d\u7a31\u5fc5\u9808\u5305\u542b\u4f60\u7684 Docker Hub \u5e33\u865f\u540d\u7a31\uff1a</p> \u70ba Image \u52a0\u4e0a Tag<pre><code>docker tag alpine-bash-charles:latest &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles:latest\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker tag alpine-bash-charles:latest caocharles/alpine-bash-charles:latest\n</code></pre> <p>docker tag \u8a9e\u6cd5</p> <pre><code>docker tag &lt;source_image&gt;:&lt;tag&gt; &lt;target_image&gt;:&lt;tag&gt;\n</code></pre> <ul> <li>Target image \u683c\u5f0f\uff1a<code>&lt;Docker Hub \u5e33\u865f&gt;/&lt;Image \u540d\u7a31&gt;:&lt;tag&gt;</code></li> </ul> \u78ba\u8a8d Tag \u5df2\u5efa\u7acb<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash-charles:latest              28024b3ae76e       14.5MB          6.6MB        \ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB        \n</code></pre> <p>\u5169\u500b Image \u4f7f\u7528\u76f8\u540c ID</p> <p><code>docker tag</code> \u53ea\u662f\u5efa\u7acb\u4e00\u500b\u65b0\u7684\u6a19\u7c64\u6307\u5411\u540c\u4e00\u500b Image\uff0c\u4e0d\u6703\u4f54\u7528\u984d\u5916\u7a7a\u9593\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#108-docker-image","title":"10.8 \u4e0a\u50b3 Docker Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-push","title":"\u57f7\u884c docker push","text":"\u4e0a\u50b3 Image \u5230 Docker Hub<pre><code>docker push &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles:latest\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker push caocharles/alpine-bash-charles:latest\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>The push refers to repository [docker.io/caocharles/alpine-bash-charles]\n77cae8ab23bf: Pushed \n34b2f2a4fe94: Pushed \n01bc7f934740: Pushed \nlatest: digest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f size: 855\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4\uff1apush access denied</p> <p>\u5982\u679c\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a </p><pre><code>push access denied, repository does not exist or may require authorization\n</code></pre><p></p> <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>Image \u6a19\u7c64\u7684\u5e33\u865f\u540d\u7a31\u8207\u767b\u5165\u5e33\u865f\u4e0d\u7b26</li> <li>\u5c1a\u672a\u767b\u5165\u6216\u767b\u5165\u6191\u8b49\u904e\u671f</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u78ba\u8a8d\u4f7f\u7528\u6b63\u78ba\u7684\u5e33\u865f\u540d\u7a31\ndocker tag alpine-bash-charles:latest &lt;\u6b63\u78ba\u5e33\u865f&gt;/alpine-bash-charles:latest\n\n# \u91cd\u65b0\u767b\u5165\ndocker logout\ndocker login -u &lt;\u4f60\u7684\u5e33\u865f&gt;\n</code></pre><p></p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#109","title":"10.9 \u9a57\u8b49\u4e0a\u50b3\u7d50\u679c","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_1","title":"\u5728 Docker Hub \u7db2\u7ad9\u78ba\u8a8d","text":"<ol> <li>\u958b\u555f https://hub.docker.com</li> <li>\u767b\u5165\u4f60\u7684\u5e33\u865f</li> <li>\u9032\u5165 Repositories</li> <li>\u78ba\u8a8d\u53ef\u4ee5\u770b\u5230\u525b\u4e0a\u50b3\u7684 Image</li> </ol>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_2","title":"\u6e05\u7406\u672c\u5730\u74b0\u5883\u4e26\u5f9e Docker Hub \u4e0b\u8f09","text":"\u6e05\u7406\u672c\u5730\u74b0\u5883<pre><code>cd\n./docker_clean_all.sh\n</code></pre> \u78ba\u8a8d\u5df2\u6e05\u7406<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre> \u5f9e Docker Hub \u4e0b\u8f09 Image<pre><code>docker pull &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker pull caocharles/alpine-bash-charles\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Using default tag: latest\nlatest: Pulling from caocharles/alpine-bash-charles\n01bc7f934740: Pull complete \n34b2f2a4fe94: Download complete \nDigest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f\nStatus: Downloaded newer image for caocharles/alpine-bash-charles:latest\ndocker.io/caocharles/alpine-bash-charles:latest\n</code></pre> \u78ba\u8a8d\u4e0b\u8f09\u6210\u529f<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB    \n</code></pre> <p>\u5b8c\u6210\u78ba\u8a8d</p> <p>\u6210\u529f\u5f9e Docker Hub \u4e0b\u8f09\u525b\u624d\u4e0a\u50b3\u7684 Image\uff01</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_6","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#dockerfile_1","title":"Dockerfile \u57fa\u672c\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>FROM</code> \u6307\u5b9a\u57fa\u790e\u6620\u50cf <code>FROM alpine:latest</code> <code>RUN</code> \u5efa\u7f6e\u6642\u57f7\u884c\u6307\u4ee4 <code>RUN apk add bash</code> <code>CMD</code> \u5bb9\u5668\u555f\u52d5\u6642\u9810\u8a2d\u6307\u4ee4 <code>CMD [\"/bin/bash\"]</code> <code>COPY</code> \u8907\u88fd\u6a94\u6848\u5230 Image <code>COPY ./src /app</code> <code>WORKDIR</code> \u8a2d\u5b9a\u5de5\u4f5c\u76ee\u9304 <code>WORKDIR /app</code> <code>EXPOSE</code> \u5ba3\u544a\u958b\u653e\u7684 Port <code>EXPOSE 80</code> <code>ENV</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <code>ENV APP_HOME=/app</code>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_3","title":"Docker Hub \u76f8\u95dc\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>docker login</code> \u767b\u5165 Docker Registry <code>docker login -u username</code> <code>docker logout</code> \u767b\u51fa Docker Registry <code>docker logout</code> <code>docker tag</code> \u70ba Image \u52a0\u4e0a\u6a19\u7c64 <code>docker tag image:tag user/image:tag</code> <code>docker push</code> \u4e0a\u50b3 Image <code>docker push user/image:tag</code> <code>docker pull</code> \u4e0b\u8f09 Image <code>docker pull user/image:tag</code>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1adocker build \u6642\u51fa\u73fe 'no such file or directory' \u932f\u8aa4\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>Dockerfile \u6a94\u540d\u4e0d\u6b63\u78ba\uff08\u6ce8\u610f\u5927\u5c0f\u5beb\uff09</li> <li>\u4e0d\u5728\u6b63\u78ba\u7684\u76ee\u9304</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u78ba\u8a8d\u6a94\u6848\u5b58\u5728\nls -la dockerfile\n\n# \u4f7f\u7528 -f \u6307\u5b9a Dockerfile \u8def\u5f91\ndocker build -f ./dockerfile -t my-image .\n</code></pre><p></p> Q2\uff1adocker push \u5931\u6557\uff0c\u986f\u793a 'access denied'\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <ol> <li>\u78ba\u8a8d\u5df2\u767b\u5165\uff1a<code>docker login</code></li> <li>\u78ba\u8a8d Image \u6a19\u7c64\u5305\u542b\u6b63\u78ba\u7684\u5e33\u865f\u540d\u7a31</li> <li>\u6a19\u7c64\u683c\u5f0f\u5fc5\u9808\u662f\uff1a<code>&lt;\u5e33\u865f&gt;/&lt;image\u540d\u7a31&gt;:&lt;tag&gt;</code></li> </ol> Q3\uff1aDockerfile \u8207 docker commit \u6709\u4ec0\u9ebc\u5dee\u5225\uff1f \u6bd4\u8f03 docker commit Dockerfile \u53ef\u8ffd\u8e64\u6027 \u7121\u6cd5\u8ffd\u8e64\u8b8a\u66f4 \u53ef\u7248\u672c\u63a7\u5236 \u53ef\u91cd\u73fe\u6027 \u96e3\u4ee5\u91cd\u73fe \u53ef\u91cd\u8907\u5efa\u7f6e \u81ea\u52d5\u5316 \u624b\u52d5\u64cd\u4f5c \u53ef\u81ea\u52d5\u5316 \u5efa\u8b70\u7528\u9014 \u6e2c\u8a66/\u9664\u932f \u751f\u7522\u74b0\u5883","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Dockerfile\uff1a\u4f7f\u7528 FROM\u3001RUN\u3001CMD \u6307\u4ee4\u5efa\u7acb\u5ba2\u88fd\u5316 Image</li> <li>\u2705 docker build\uff1a\u6839\u64da Dockerfile \u5efa\u7f6e Image</li> <li>\u2705 docker login\uff1a\u767b\u5165 Docker Hub</li> <li>\u2705 docker tag\uff1a\u70ba Image \u52a0\u4e0a\u7b26\u5408 Docker Hub \u683c\u5f0f\u7684\u6a19\u7c64</li> <li>\u2705 docker push\uff1a\u4e0a\u50b3 Image \u5230 Docker Hub</li> <li>\u2705 docker pull\uff1a\u5f9e Docker Hub \u4e0b\u8f09 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab11_standalone_k8s/","title":"LAB 11 standalone kubernetes \u5b89\u88dd","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#lab-11-standalone-kubernetes","title":"LAB 11 Standalone Kubernetes \u5b89\u88dd","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes</li> <li> \u4e86\u89e3 Standalone Kubernetes \u7684\u67b6\u69cb</li> <li> \u76e3\u63a7 Kubernetes \u53e2\u96c6\u72c0\u614b</li> <li> \u5728 Standalone Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod</li> <li> \u5efa\u7acb\u865b\u64ec\u6a5f\u5feb\u7167\u4fdd\u7559\u72c0\u614b</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 Docker \u76f8\u95dc\u7ae0\u7bc0</li> <li>\u4e86\u89e3\u57fa\u672c\u7684 Linux \u6307\u4ee4\u64cd\u4f5c</li> <li>\u4e86\u89e3\u5bb9\u5668\u5316\u7684\u57fa\u672c\u6982\u5ff5</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#111","title":"11.1 \u74b0\u5883\u8aaa\u660e","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#standalone-kubernetes","title":"\u4ec0\u9ebc\u662f Standalone Kubernetes\uff1f","text":"<p>Standalone Kubernetes \u662f\u4e00\u500b\u55ae\u7bc0\u9ede\u7684 Kubernetes \u53e2\u96c6\uff0cMaster \u7bc0\u9ede\u540c\u6642\u4e5f\u4f5c\u70ba Worker \u7bc0\u9ede\u4f7f\u7528\u3002\u9019\u7a2e\u67b6\u69cb\u9069\u5408\uff1a</p> <ul> <li>\u5b78\u7fd2\u8207\u6e2c\u8a66\u74b0\u5883</li> <li>\u958b\u767c\u74b0\u5883</li> <li>\u5c0f\u578b\u5c08\u6848</li> </ul> <pre><code>graph TB\n    subgraph \"Standalone Kubernetes\"\n        M[k8s-standalone&lt;br/&gt;Master + Worker&lt;br/&gt;192.168.66.61]\n        subgraph \"Control Plane\"\n            API[API Server]\n            ETCD[etcd]\n            SCHED[Scheduler]\n            CM[Controller Manager]\n        end\n        subgraph \"Node Components\"\n            KL[Kubelet]\n            KP[Kube-Proxy]\n            CR[CRI-O]\n        end\n        subgraph \"Pods\"\n            P1[Pod 1]\n            P2[Pod 2]\n        end\n    end</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_3","title":"\u865b\u64ec\u6a5f\u8cc7\u8a0a","text":"\u9805\u76ee \u503c \u4e3b\u6a5f\u540d\u7a31 k8s-standalone.training.lab IP \u4f4d\u5740 192.168.66.61 \u4f5c\u696d\u7cfb\u7d71 Rocky Linux 9 Kubernetes \u7248\u672c 1.32","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#112-k8s-standalone","title":"11.2 \u5207\u63db\u5230 k8s-standalone \u865b\u64ec\u6a5f","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_4","title":"\u78ba\u8a8d\u7db2\u8def\u8a2d\u5b9a","text":"\u6aa2\u8996\u7db2\u8def\u4ecb\u9762<pre><code>ifconfig ens160\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.66.61  netmask 255.255.255.0  broadcast 192.168.66.255\n        inet6 fe80::20c:29ff:fe91:c3  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:91:00:c3  txqueuelen 1000  (Ethernet)\n        RX packets 41897  bytes 25015527 (23.8 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 672  bytes 55461 (54.1 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_5","title":"\u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31","text":"\u6aa2\u8996\u4e3b\u6a5f\u540d\u7a31<pre><code>hostname\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-standalone.training.lab\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#hosts","title":"\u78ba\u8a8d hosts \u6a94\u6848","text":"\u6aa2\u8996 /etc/hosts<pre><code>cat /etc/hosts\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.10   master.training.lab master\n192.168.66.11   node1.training.lab  node1\n192.168.66.12   node2.training.lab  node2\n192.168.66.21   docker.training.lab docker\n192.168.66.22   minikube.training.lab   minikube\n\n192.168.66.51       docker1.training.lab        docker1\n192.168.66.52       docker2.training.lab        docker2\n192.168.66.61       k8s-standalone.training.lab k8s-standalone\n192.168.66.71       k8s-master1.training.lab    k8s-master1\n192.168.66.81       k8s-node1.training.lab      k8s-node1\n192.168.66.82       k8s-node2.training.lab      k8s-node2\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#113-script","title":"11.3 \u4e0b\u8f09\u5b89\u88dd Script","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#wget","title":"\u4f7f\u7528 wget \u4e0b\u8f09","text":"\u4e0b\u8f09\u5b89\u88dd\u8173\u672c<pre><code>wget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>--2026-01-27 11:21:14--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh       100%[========================================&gt;]  21.99K  --.-KB/s    in 0s      \n\n2026-01-27 11:21:14 (61.0 MB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_6","title":"\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650","text":"\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 install_k8s-latest.sh\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#114-shell-script-kubernetes","title":"11.4 \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_7","title":"\u67e5\u770b\u5b89\u88dd\u9078\u9805","text":"\u57f7\u884c\u8173\u672c\u67e5\u770b\u4f7f\u7528\u8aaa\u660e<pre><code>./install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\u8acb\u8f38\u5165 \u5b8c\u6574\u5b89\u88dd(full) \u6216\u662f standalone\n./install_k8s-latest.sh -full\n\u6216 \n./install_k8s-latest.sh -standalone\n</code></pre> <p>\u5b89\u88dd\u6a21\u5f0f\u8aaa\u660e</p> \u6a21\u5f0f \u8aaa\u660e <code>-full</code> \u5b8c\u6574\u5b89\u88dd\uff0c\u5305\u542b Master \u8207 Worker \u7bc0\u9ede\u8a2d\u5b9a <code>-standalone</code> \u55ae\u6a5f\u5b89\u88dd\uff0cMaster \u7bc0\u9ede\u540c\u6642\u4f5c\u70ba Worker \u7bc0\u9ede","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#standalone","title":"\u57f7\u884c Standalone \u5b89\u88dd","text":"\u57f7\u884c Standalone \u5b89\u88dd<pre><code>./install_k8s-latest.sh -standalone\n</code></pre> <p>\u5b89\u88dd\u904e\u7a0b\u8aaa\u660e</p> <p>\u8173\u672c\u6703\u81ea\u52d5\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <ol> <li>\u5b89\u88dd\u5fc5\u8981\u5957\u4ef6\uff1asshpass\u3001bash-completion</li> <li>\u5b89\u88dd Docker CE\uff1a\u5305\u542b containerd.io\u3001docker-ce-cli</li> <li>\u95dc\u9589 Swap\uff1aKubernetes \u8981\u6c42\u95dc\u9589 Swap</li> <li>\u8a2d\u5b9a\u6838\u5fc3\u53c3\u6578\uff1a\u555f\u7528 IP \u8f49\u767c\u3001\u8a2d\u5b9a\u7db2\u8def\u53c3\u6578</li> <li>\u5b89\u88dd Kubernetes \u5957\u4ef6\uff1akubelet\u3001kubeadm\u3001kubectl</li> <li>\u5b89\u88dd CRI-O\uff1aContainer Runtime Interface</li> <li>\u95dc\u9589\u9632\u706b\u7246\uff1a\u505c\u7528 firewalld</li> <li>\u57f7\u884c kubeadm init\uff1a\u521d\u59cb\u5316 Kubernetes \u53e2\u96c6</li> <li>\u5b89\u88dd CNI\uff1a\u5b89\u88dd Antrea \u7db2\u8def\u5957\u4ef6</li> <li>\u79fb\u9664 Taint\uff1a\u5141\u8a31\u5728 Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod</li> </ol>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_8","title":"\u5b89\u88dd\u904e\u7a0b\u8f38\u51fa\uff08\u90e8\u5206\uff09","text":"<p>\u5b89\u88dd Docker CE\uff1a</p> <pre><code>Installing:\n docker-ce                    x86_64    3:29.2.0-1.el9    docker-ce-stable     24 M\n containerd.io                x86_64    2.2.1-1.el9       docker-ce-stable     35 M\n docker-ce-cli                x86_64    1:29.2.0-1.el9    docker-ce-stable    8.4 M\n docker-buildx-plugin         x86_64    0.30.1-1.el9      docker-ce-stable     17 M\n docker-compose-plugin        x86_64    5.0.2-1.el9       docker-ce-stable    8.1 M\n\nComplete!\n</code></pre> <p>\u5b89\u88dd Kubernetes \u5957\u4ef6\uff1a</p> <pre><code>Installing:\n kubeadm       x86_64    1.32.11-150500.1.1    kubernetes    12 M\n kubectl       x86_64    1.32.11-150500.1.1    kubernetes    11 M\n kubelet       x86_64    1.32.11-150500.1.1    kubernetes    15 M\n cri-tools     x86_64    1.32.0-150500.1.1     kubernetes   7.1 M\n kubernetes-cni x86_64   1.6.0-150500.1.1      kubernetes   8.0 M\n\nComplete!\n</code></pre> <p>\u5b89\u88dd CRI-O\uff1a</p> <pre><code>Installing:\n cri-o         x86_64    1.32.1-150500.1.1     cri-o         20 M\n\nComplete!\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#kubeadm-init","title":"kubeadm init \u8f38\u51fa","text":"<pre><code>[init] Using Kubernetes version: v1.32.11\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s-standalone.training.lab kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [172.30.0.1 192.168.66.61]\n...\n[kubelet-start] Starting the kubelet\n[kubelet-check] The kubelet is healthy after 515.21134ms\n[api-check] The API server is healthy after 3.001460102s\n...\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n</code></pre> <p>\u521d\u59cb\u5316\u6210\u529f</p> <p>\u770b\u5230 <code>Your Kubernetes control-plane has initialized successfully!</code> \u8868\u793a Kubernetes \u63a7\u5236\u5e73\u9762\u5df2\u6210\u529f\u521d\u59cb\u5316\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#antrea-cni","title":"\u5b89\u88dd Antrea CNI","text":"<p>\u8173\u672c\u6703\u81ea\u52d5\u5b89\u88dd Antrea \u4f5c\u70ba CNI\uff08Container Network Interface\uff09\uff1a</p> <pre><code>customresourcedefinition.apiextensions.k8s.io/antreaagentinfos.crd.antrea.io created\nserviceaccount/antrea-agent created\nserviceaccount/antrea-controller created\nclusterrole.rbac.authorization.k8s.io/antrea-agent created\nclusterrole.rbac.authorization.k8s.io/antrea-controller created\n...\ndeployment.apps/antrea-controller created\ndaemonset.apps/antrea-agent created\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#master-taint","title":"\u79fb\u9664 Master \u7bc0\u9ede\u7684 Taint","text":"<p>\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cKubernetes \u4e0d\u5141\u8a31\u5728 Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod\u3002\u8173\u672c\u6703\u81ea\u52d5\u79fb\u9664\u9019\u500b\u9650\u5236\uff1a</p> <pre><code>node/k8s-standalone.training.lab untainted\n</code></pre> <p>Taint \u8aaa\u660e</p> <p>Taint\uff08\u6c59\u9ede\uff09\u662f Kubernetes \u7528\u4f86\u9650\u5236 Pod \u8abf\u5ea6\u7684\u6a5f\u5236\u3002Master \u7bc0\u9ede\u9810\u8a2d\u6709 <code>node-role.kubernetes.io/control-plane:NoSchedule</code> \u7684 Taint\uff0c\u8868\u793a\u4e0d\u63a5\u53d7\u4e00\u822c Pod \u7684\u8abf\u5ea6\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#115-kubernetes","title":"11.5 \u76e3\u63a7 Kubernetes \u72c0\u614b","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_9","title":"\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b","text":"\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u521d\u59cb\u72c0\u614b\uff09\uff1a</p> <pre><code>NAME                          STATUS     ROLES           AGE   VERSION\nk8s-standalone.training.lab   NotReady   control-plane   35s   v1.32.11\n</code></pre> <p>NotReady \u72c0\u614b</p> <p>\u7bc0\u9ede\u525b\u521d\u59cb\u5316\u6642\u6703\u986f\u793a <code>NotReady</code>\uff0c\u7b49\u5f85 CNI \u5957\u4ef6\u5b8c\u5168\u555f\u52d5\u5f8c\u6703\u8b8a\u6210 <code>Ready</code>\u3002</p> <p>\u7b49\u5f85\u7d04 30 \u79d2\u5f8c\u518d\u6b21\u6aa2\u67e5\uff1a</p> \u518d\u6b21\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                          STATUS   ROLES           AGE   VERSION\nk8s-standalone.training.lab   Ready    control-plane   2m    v1.32.11\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod","title":"\u6aa2\u8996\u7cfb\u7d71 Pod \u72c0\u614b","text":"\u6aa2\u8996 kube-system namespace \u7684 Pod<pre><code>kubectl get pods -n kube-system\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                                                  READY   STATUS    RESTARTS   AGE\nantrea-agent-xxxxx                                    2/2     Running   0          2m\nantrea-controller-xxxxx                               1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\netcd-k8s-standalone.training.lab                      1/1     Running   0          2m\nkube-apiserver-k8s-standalone.training.lab            1/1     Running   0          2m\nkube-controller-manager-k8s-standalone.training.lab   1/1     Running   0          2m\nkube-proxy-xxxxx                                      1/1     Running   0          2m\nkube-scheduler-k8s-standalone.training.lab            1/1     Running   0          2m\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_10","title":"\u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b","text":"\u4f7f\u7528 watch \u6301\u7e8c\u76e3\u63a7<pre><code>watch kubectl get nodes\n</code></pre> <p>watch \u6307\u4ee4</p> <p><code>watch</code> \u6307\u4ee4\u6703\u6bcf 2 \u79d2\u91cd\u65b0\u57f7\u884c\u4e00\u6b21\u6307\u4ee4\uff0c\u6309 <code>Ctrl+C</code> \u53ef\u4ee5\u9000\u51fa\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#116","title":"11.6 \u90e8\u7f72\u6e2c\u8a66","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment","title":"\u5efa\u7acb\u6e2c\u8a66 Deployment","text":"\u5efa\u7acb nginx Deployment<pre><code>kubectl create deployment test1 --image=nginx\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre> <p>kubectl create deployment \u8a9e\u6cd5</p> <pre><code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>&lt;name&gt;</code> Deployment \u540d\u7a31 <code>--image</code> \u4f7f\u7528\u7684\u5bb9\u5668\u6620\u50cf","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment_1","title":"\u6aa2\u8996 Deployment \u72c0\u614b","text":"\u6aa2\u8996 Deployment<pre><code>kubectl get deployments.apps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   0/1     1            0           15s\n</code></pre> <p>Deployment \u6b04\u4f4d\u8aaa\u660e</p> \u6b04\u4f4d \u8aaa\u660e <code>READY</code> \u5c31\u7dd2\u7684 Pod \u6578\u91cf / \u9810\u671f\u6578\u91cf <code>UP-TO-DATE</code> \u5df2\u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c\u7684 Pod \u6578\u91cf <code>AVAILABLE</code> \u53ef\u7528\u7684 Pod \u6578\u91cf","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod_1","title":"\u6aa2\u8996 Pod \u72c0\u614b","text":"\u6aa2\u8996 Pod \u72c0\u614b<pre><code>kubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          27s\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod_2","title":"\u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a","text":"\u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a\uff08\u542b\u7bc0\u9ede\u8cc7\u8a0a\uff09<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          33s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>Pod \u8655\u65bc Pending \u72c0\u614b</p> <p>\u5982\u679c Pod \u6301\u7e8c\u8655\u65bc <code>Pending</code> \u72c0\u614b\u4e14 <code>NODE</code> \u986f\u793a <code>&lt;none&gt;</code>\uff0c\u53ef\u80fd\u662f\u56e0\u70ba\uff1a</p> <ol> <li>\u7bc0\u9ede\u5c1a\u672a\u5c31\u7dd2\uff08NotReady\uff09</li> <li>\u7bc0\u9ede\u4ecd\u6709 Taint \u9650\u5236</li> </ol> <p>\u9700\u8981\u7b49\u5f85\u7bc0\u9ede\u8b8a\u6210 Ready \u72c0\u614b\uff0c\u6216\u78ba\u8a8d Taint \u5df2\u79fb\u9664\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_11","title":"\u7b49\u5f85\u7bc0\u9ede\u5c31\u7dd2\u5f8c\u78ba\u8a8d","text":"<p>\u7b49\u5f85\u7bc0\u9ede\u8b8a\u6210 Ready \u5f8c\uff0cPod \u6703\u81ea\u52d5\u8abf\u5ea6\u4e26\u555f\u52d5\uff1a</p> \u78ba\u8a8d\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u7576\u7bc0\u9ede\u986f\u793a <code>Ready</code> \u5f8c\uff1a</p> \u518d\u6b21\u6aa2\u8996 Pod \u72c0\u614b<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u7bc0\u9ede\u5c31\u7dd2\u5f8c\uff09\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP            NODE                          NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   1/1     Running   0          2m    10.244.0.5    k8s-standalone.training.lab   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>\u90e8\u7f72\u6210\u529f</p> <p>\u7576 Pod \u72c0\u614b\u8b8a\u6210 <code>Running</code> \u4e14 <code>NODE</code> \u986f\u793a <code>k8s-standalone.training.lab</code>\uff0c\u8868\u793a\u5df2\u6210\u529f\u5728 Standalone Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment_2","title":"\u6e05\u7406\u6e2c\u8a66 Deployment","text":"\u522a\u9664\u6e2c\u8a66 Deployment<pre><code>kubectl delete deployment test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps \"test1\" deleted\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#117-snapshot","title":"11.7 \u5efa\u7acb\u5feb\u7167 Snapshot","text":"<p>\u5efa\u8b70</p> <p>\u5b8c\u6210\u5b89\u88dd\u5f8c\uff0c\u5efa\u8b70\u5728 VMware \u4e2d\u5efa\u7acb\u865b\u64ec\u6a5f\u5feb\u7167\uff0c\u4ee5\u4fbf\u65e5\u5f8c\u9700\u8981\u6642\u53ef\u4ee5\u5feb\u901f\u9084\u539f\u5230\u4e7e\u6de8\u7684 Kubernetes \u74b0\u5883\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_12","title":"\u5efa\u7acb\u5feb\u7167\u6b65\u9a5f","text":"<ol> <li>\u5728 VMware vSphere Client \u6216 VMware Workstation \u4e2d</li> <li>\u9078\u64c7 k8s-standalone \u865b\u64ec\u6a5f</li> <li>\u53f3\u9375\u9078\u64c7 \u5feb\u7167 &gt; \u62cd\u651d\u5feb\u7167</li> <li>\u8f38\u5165\u5feb\u7167\u540d\u7a31\uff0c\u4f8b\u5982\uff1a<code>K8s 1.32 \u5b89\u88dd\u5b8c\u6210</code></li> <li>\u9ede\u64ca\u78ba\u5b9a</li> </ol>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_13","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#kubectl","title":"kubectl \u57fa\u672c\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get nodes</code> \u6aa2\u8996\u7bc0\u9ede\u72c0\u614b <code>kubectl get pods</code> \u6aa2\u8996 Pod \u5217\u8868 <code>kubectl get pods -n kube-system</code> \u6aa2\u8996\u7cfb\u7d71 Pod <code>kubectl describe node &lt;name&gt;</code> \u6aa2\u8996\u7bc0\u9ede\u8a73\u7d30\u8cc7\u8a0a <code>kubectl describe pod &lt;name&gt;</code> \u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a <code>kubectl run &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Pod <code>kubectl delete pod &lt;name&gt;</code> \u522a\u9664 Pod <code>kubectl exec -it &lt;name&gt; -- &lt;cmd&gt;</code> \u5728 Pod \u4e2d\u57f7\u884c\u6307\u4ee4","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_14","title":"\u5b89\u88dd\u76f8\u95dc\u5143\u4ef6\u7248\u672c","text":"\u5143\u4ef6 \u7248\u672c Kubernetes 1.32.11 Docker CE 29.2.0 containerd.io 2.2.1 CRI-O 1.32.1 Antrea CNI \u6700\u65b0\u7248","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_15","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u7bc0\u9ede\u4e00\u76f4\u986f\u793a NotReady\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>CNI \u5957\u4ef6\u5c1a\u672a\u5b8c\u5168\u555f\u52d5</li> <li>kubelet \u670d\u52d9\u7570\u5e38</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996 kubelet \u72c0\u614b\nsystemctl status kubelet\n\n# \u6aa2\u8996 kubelet \u65e5\u8a8c\njournalctl -u kubelet -f\n\n# \u6aa2\u8996\u7cfb\u7d71 Pod \u72c0\u614b\nkubectl get pods -n kube-system\n</code></pre><p></p> Q2\uff1aPod \u7121\u6cd5\u5728 Master \u7bc0\u9ede\u4e0a\u57f7\u884c\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1aMaster \u7bc0\u9ede\u6709 Taint \u9650\u5236</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996\u7bc0\u9ede Taint\nkubectl describe node k8s-standalone.training.lab | grep Taint\n\n# \u79fb\u9664 control-plane Taint\nkubectl taint nodes k8s-standalone.training.lab node-role.kubernetes.io/control-plane:NoSchedule-\n</code></pre><p></p> Q3\uff1a\u5982\u4f55\u91cd\u65b0\u5b89\u88dd Kubernetes\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u91cd\u7f6e kubeadm\nkubeadm reset -f\n\n# \u6e05\u7406 iptables\niptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X\n\n# \u91cd\u65b0\u57f7\u884c\u5b89\u88dd\u8173\u672c\n./install_k8s-latest.sh -standalone\n</code></pre><p></p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_16","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u74b0\u5883\u6e96\u5099\uff1a\u5207\u63db\u5230 k8s-standalone \u865b\u64ec\u6a5f\uff0c\u78ba\u8a8d\u7db2\u8def\u8a2d\u5b9a</li> <li>\u2705 \u4e0b\u8f09\u5b89\u88dd\u8173\u672c\uff1a\u4f7f\u7528 wget \u4e0b\u8f09\u81ea\u52d5\u5316\u5b89\u88dd\u8173\u672c</li> <li>\u2705 \u81ea\u52d5\u5316\u5b89\u88dd\uff1a\u4f7f\u7528 <code>-standalone</code> \u53c3\u6578\u57f7\u884c\u55ae\u6a5f\u5b89\u88dd</li> <li>\u2705 \u76e3\u63a7\u72c0\u614b\uff1a\u4f7f\u7528 <code>kubectl get nodes</code> \u78ba\u8a8d\u7bc0\u9ede Ready</li> <li>\u2705 \u90e8\u7f72\u6e2c\u8a66\uff1a\u6210\u529f\u5728 Standalone Master \u4e0a\u90e8\u7f72 Pod</li> <li>\u2705 \u5efa\u7acb\u5feb\u7167\uff1a\u4fdd\u7559\u4e7e\u6de8\u7684 Kubernetes \u74b0\u5883</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab12_k8s_install/","title":"LAB 12 kubernetes \u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#lab-12-kubernetes","title":"LAB 12 Kubernetes \u53e2\u96c6\u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes \u53e2\u96c6</li> <li> \u914d\u7f6e\u591a\u7bc0\u9ede\uff08Master + Worker\uff09Kubernetes \u74b0\u5883</li> <li> \u7406\u89e3 kubeadm\u3001kubelet\u3001kubectl \u7684\u89d2\u8272</li> <li> \u5b89\u88dd\u4e26\u914d\u7f6e CRI-O \u5bb9\u5668\u57f7\u884c\u74b0\u5883</li> <li> \u90e8\u7f72 Antrea CNI \u7db2\u8def\u63d2\u4ef6</li> <li> \u5c07 Worker Node \u52a0\u5165\u53e2\u96c6</li> <li> \u76e3\u63a7\u53e2\u96c6\u72c0\u614b\u8207\u9a57\u8b49\u90e8\u7f72</li> </ul>"},{"location":"lab12_k8s_install/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 11 \u7368\u7acb Kubernetes \u74b0\u5883</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u7406\u89e3\u5bb9\u5668\u5316\u7684\u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d\u4e09\u53f0\u865b\u64ec\u6a5f\uff08K8S-MASTER1\u3001K8S-NODE1\u3001K8S-NODE2\uff09</li> </ul>"},{"location":"lab12_k8s_install/#lab-shell-script-kubernetes","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1a\u4f7f\u7528 Shell Script \u5b89\u88dd Kubernetes \u53e2\u96c6","text":""},{"location":"lab12_k8s_install/#_3","title":"\u74b0\u5883\u67b6\u69cb","text":"<pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        Master[k8s-master1&lt;br/&gt;192.168.66.71&lt;br/&gt;Control Plane]\n        Node1[k8s-node1&lt;br/&gt;192.168.66.81&lt;br/&gt;Worker Node]\n        Node2[k8s-node2&lt;br/&gt;192.168.66.82&lt;br/&gt;Worker Node]\n        Master --&gt; Node1\n        Master --&gt; Node2\n    end\n\n    subgraph \"\u5b89\u88dd\u5143\u4ef6\"\n        CRI[CRI-O 1.32]\n        K8S[Kubernetes 1.32]\n        CNI[Antrea CNI]\n    end</code></pre> \u4e3b\u6a5f\u540d\u7a31 IP \u4f4d\u5740 \u89d2\u8272 k8s-master1.training.lab 192.168.66.71 Control Plane (Master) k8s-node1.training.lab 192.168.66.81 Worker Node k8s-node2.training.lab 192.168.66.82 Worker Node <p>\u5b89\u88dd\u7279\u9ede</p> <ul> <li>\u5168\u7a0b\u5728 Master \u7bc0\u9ede\u64cd\u4f5c\uff1a\u900f\u904e SSH \u81ea\u52d5\u5316\u5b89\u88dd Worker \u7bc0\u9ede</li> <li>\u4f7f\u7528 CRI-O\uff1aKubernetes \u539f\u751f\u7684\u5bb9\u5668\u57f7\u884c\u74b0\u5883</li> <li>Antrea CNI\uff1aVMware \u958b\u767c\u7684\u9ad8\u6548\u80fd\u7db2\u8def\u63d2\u4ef6</li> </ul>"},{"location":"lab12_k8s_install/#1","title":"\u6b65\u9a5f 1\uff1a\u555f\u52d5\u865b\u64ec\u6a5f\u4e26\u78ba\u8a8d\u74b0\u5883","text":"<p>\u9996\u5148\uff0c\u5728 VMware Workstation \u4e2d\u555f\u52d5\u4e09\u53f0\u865b\u64ec\u6a5f\uff1a</p> <ul> <li>K8S-MASTER1</li> <li>K8S-NODE1  </li> <li>K8S-NODE2</li> </ul> <p>\u767b\u5165 <code>k8s-master1</code>\uff0c\u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31\u8207\u7db2\u8def\u8a2d\u5b9a\uff1a</p> \u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31<pre><code>hostname\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-master1.training.lab\n</code></pre> \u78ba\u8a8d IP \u4f4d\u5740<pre><code>ifconfig ens160\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.66.71  netmask 255.255.255.0  broadcast 192.168.66.255\n</code></pre> \u78ba\u8a8d /etc/hosts \u8a2d\u5b9a<pre><code>cat /etc/hosts\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.71       k8s-master1.training.lab    k8s-master1\n192.168.66.81       k8s-node1.training.lab      k8s-node1\n192.168.66.82       k8s-node2.training.lab      k8s-node2\n</code></pre>"},{"location":"lab12_k8s_install/#2","title":"\u6b65\u9a5f 2\uff1a\u78ba\u8a8d\u7db2\u8def\u9023\u7dda","text":"<p>\u6e2c\u8a66\u8207\u5176\u4ed6\u7bc0\u9ede\u7684\u9023\u7dda\uff1a</p> Ping Worker Node 1<pre><code>ping k8s-node1 -c3\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>PING k8s-node1.training.lab (192.168.66.81) 56(84) bytes of data.\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=1 ttl=64 time=0.430 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=2 ttl=64 time=0.345 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=3 ttl=64 time=0.243 ms\n\n--- k8s-node1.training.lab ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss\n</code></pre> Ping Worker Node 2<pre><code>ping k8s-node2 -c3\n</code></pre> \u6e2c\u8a66\u7db2\u969b\u7db2\u8def\u9023\u7dda<pre><code>ping google.com -c3\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>PING google.com (142.250.66.78) 56(84) bytes of data.\n64 bytes from lctsaa-aa-in-f14.1e100.net (142.250.66.78): icmp_seq=1 ttl=128 time=66.8 ms\n...\n3 packets transmitted, 3 received, 0% packet loss\n</code></pre> <p>\u9023\u7dda\u78ba\u8a8d</p> <p>\u78ba\u4fdd\u4e09\u53f0\u865b\u64ec\u6a5f\u4e4b\u9593\u53ef\u4ee5\u4e92\u76f8 ping \u901a\uff0c\u4e14\u53ef\u4ee5\u9023\u63a5\u7db2\u969b\u7db2\u8def\u4e0b\u8f09\u5957\u4ef6\u3002</p>"},{"location":"lab12_k8s_install/#3-script","title":"\u6b65\u9a5f 3\uff1a\u4e0b\u8f09\u5b89\u88dd Script","text":"<p>\u5f9e\u8ab2\u7a0b\u4f3a\u670d\u5668\u4e0b\u8f09 Kubernetes \u5b89\u88dd\u8173\u672c\uff1a</p> \u4e0b\u8f09\u5b89\u88dd\u8173\u672c<pre><code>wget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>--2026-01-27 15:55:16--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh    100%[==&gt;]  21.99K  51.0KB/s    in 0.4s    \n\n2026-01-27 15:55:17 (51.0 KB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n</code></pre> <p>\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650\uff1a</p> \u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 install_k8s-latest.sh\n</code></pre> <p>\u67e5\u770b\u4f7f\u7528\u8aaa\u660e\uff1a</p> \u67e5\u770b\u8173\u672c\u4f7f\u7528\u65b9\u5f0f<pre><code>./install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\u8acb\u8f38\u5165 \u5b8c\u6574\u5b89\u88dd(full) \u6216\u662f standalone\n./install_k8s-latest.sh -full\n\u6216 \n./install_k8s-latest.sh -standalone\n</code></pre>"},{"location":"lab12_k8s_install/#4","title":"\u6b65\u9a5f 4\uff1a\u57f7\u884c\u5b8c\u6574\u5b89\u88dd","text":"<p>\u57f7\u884c\u8173\u672c\u9032\u884c\u5b8c\u6574\u53e2\u96c6\u5b89\u88dd\uff08\u5305\u542b Master \u548c Worker \u7bc0\u9ede\uff09\uff1a</p> \u57f7\u884c\u5b8c\u6574\u5b89\u88dd<pre><code>./install_k8s-latest.sh -full\n</code></pre> <p>\u5b89\u88dd\u6642\u9593</p> <p>\u5b8c\u6574\u5b89\u88dd\u904e\u7a0b\u7d04\u9700 5-10 \u5206\u9418\uff0c\u53d6\u6c7a\u65bc\u7db2\u8def\u901f\u5ea6\u3002\u8acb\u8010\u5fc3\u7b49\u5f85\u3002</p>"},{"location":"lab12_k8s_install/#_4","title":"\u5b89\u88dd\u904e\u7a0b\u8aaa\u660e","text":"<p>\u8173\u672c\u6703\u81ea\u52d5\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <pre><code>graph LR\n    A[\u5b89\u88dd sshpass] --&gt; B[\u5b89\u88dd Docker CE]\n    B --&gt; C[\u8a2d\u5b9a bash-completion]\n    C --&gt; D[\u95dc\u9589 Swap]\n    D --&gt; E[\u8a2d\u5b9a Kernel \u53c3\u6578]\n    E --&gt; F[\u5b89\u88dd kubeadm/kubectl/kubelet]\n    F --&gt; G[\u5b89\u88dd CRI-O]\n    G --&gt; H[kubeadm init]\n    H --&gt; I[Worker \u52a0\u5165\u53e2\u96c6]\n    I --&gt; J[\u5b89\u88dd Antrea CNI]</code></pre> <p>\u4e3b\u8981\u5b89\u88dd\u9805\u76ee\uff1a</p> \u968e\u6bb5 \u8aaa\u660e sshpass \u7528\u65bc\u81ea\u52d5\u5316 SSH \u767b\u5165 Worker \u7bc0\u9ede Docker CE \u5b89\u88dd Docker 29.2.0\uff08\u6240\u6709\u7bc0\u9ede\uff09 bash-completion kubectl \u6307\u4ee4\u81ea\u52d5\u88dc\u9f4a Swap \u95dc\u9589 Kubernetes \u8981\u6c42\u95dc\u9589 Swap Kernel \u53c3\u6578 \u8a2d\u5b9a ip_forward\u3001bridge-nf-call \u7b49 kubeadm/kubectl/kubelet Kubernetes 1.32.11 \u6838\u5fc3\u5143\u4ef6 CRI-O \u5bb9\u5668\u57f7\u884c\u74b0\u5883 1.32.1 Antrea CNI \u7db2\u8def\u63d2\u4ef6"},{"location":"lab12_k8s_install/#5","title":"\u6b65\u9a5f 5\uff1a\u9a57\u8b49\u5b89\u88dd\u7d50\u679c","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u8173\u672c\u6703\u986f\u793a\u985e\u4f3c\u4ee5\u4e0b\u8a0a\u606f\uff1a</p> <pre><code>Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.66.71:6443 --token hv80nh.sji1vjeju8b5l10n \\\n    --discovery-token-ca-cert-hash sha256:f2af63e6d5dafedcc62702dcb939b51bfa98b96ab996af3556665a05a7cf0a6c\n</code></pre> <p>\u5b89\u88dd\u6210\u529f</p> <p>\u770b\u5230 \"Your Kubernetes control-plane has initialized successfully!\" \u8868\u793a Master \u7bc0\u9ede\u5b89\u88dd\u6210\u529f\u3002</p>"},{"location":"lab12_k8s_install/#6","title":"\u6b65\u9a5f 6\uff1a\u76e3\u63a7\u53e2\u96c6\u72c0\u614b","text":"<p>\u4f7f\u7528 <code>while</code> \u8ff4\u5708\u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b\uff1a</p> \u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b<pre><code>while true\ndo\n  date\n  kubectl get nodes\n  sleep 5\ndone\n</code></pre> <p>\u521d\u59cb\u72c0\u614b\uff08NotReady\uff09\uff1a</p> <pre><code>Tue Jan 27 04:05:22 PM CST 2026\nNAME                       STATUS     ROLES           AGE   VERSION\nk8s-master1.training.lab   NotReady   control-plane   84s   v1.32.11\nk8s-node1.training.lab     NotReady   &lt;none&gt;          76s   v1.32.11\nk8s-node2.training.lab     NotReady   &lt;none&gt;          75s   v1.32.11\n</code></pre> <p>NotReady \u72c0\u614b</p> <p>\u525b\u5b89\u88dd\u5b8c\u6210\u6642\uff0c\u7bc0\u9ede\u6703\u986f\u793a <code>NotReady</code>\uff0c\u7b49\u5f85 CNI \u7db2\u8def\u63d2\u4ef6\u5b8c\u6210\u521d\u59cb\u5316\u5f8c\u6703\u8b8a\u6210 <code>Ready</code>\u3002</p> <p>\u6700\u7d42\u72c0\u614b\uff08Ready\uff09\uff1a</p> <pre><code>NAME                       STATUS   ROLES           AGE    VERSION\nk8s-master1.training.lab   Ready    control-plane   5m     v1.32.11\nk8s-node1.training.lab     Ready    &lt;none&gt;          4m52s  v1.32.11\nk8s-node2.training.lab     Ready    &lt;none&gt;          4m51s  v1.32.11\n</code></pre> <p>\u6309 <code>Ctrl+C</code> \u505c\u6b62\u76e3\u63a7\u3002</p>"},{"location":"lab12_k8s_install/#7","title":"\u6b65\u9a5f 7\uff1a\u9a57\u8b49\u90e8\u7f72\u529f\u80fd","text":"<p>\u5efa\u7acb\u4e00\u500b\u6e2c\u8a66 Deployment \u4f86\u9a57\u8b49\u53e2\u96c6\u529f\u80fd\uff1a</p> \u5efa\u7acb\u6e2c\u8a66 Deployment<pre><code>kubectl create deployment test1 --image=httpd\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre> <p>\u67e5\u770b Deployment \u72c0\u614b\uff1a</p> \u67e5\u770b Deployment<pre><code>kubectl get deployments\n</code></pre> \u67e5\u770b Pod \u8a73\u7d30\u8cc7\u8a0a<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08Pod Running\uff09\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP            NODE\ntest1-5b88789dbb-h99dh   1/1     Running   0          30s   10.244.1.2    k8s-node1.training.lab\n</code></pre> <p>\u6e05\u7406\u6e2c\u8a66\u8cc7\u6e90</p> <p>\u6e2c\u8a66\u5b8c\u6210\u5f8c\uff0c\u53ef\u4ee5\u522a\u9664\u6e2c\u8a66 Deployment\uff1a </p><pre><code>kubectl delete deployment test1\n</code></pre><p></p>"},{"location":"lab12_k8s_install/#_5","title":"\u5e38\u7528\u6aa2\u67e5\u6307\u4ee4","text":"\u6aa2\u67e5\u6240\u6709 Pod\uff08\u5305\u542b\u7cfb\u7d71 Pod\uff09<pre><code>kubectl get pods -A\n</code></pre> \u6aa2\u67e5\u53e2\u96c6\u8cc7\u8a0a<pre><code>kubectl cluster-info\n</code></pre> \u67e5\u770b\u7bc0\u9ede\u8a73\u7d30\u8cc7\u8a0a<pre><code>kubectl describe node k8s-master1.training.lab\n</code></pre> \u6aa2\u67e5 CRI-O \u72c0\u614b<pre><code>systemctl status crio\n</code></pre> \u6aa2\u67e5 kubelet \u72c0\u614b<pre><code>systemctl status kubelet\n</code></pre>"},{"location":"lab12_k8s_install/#_6","title":"\u5b89\u88dd\u6458\u8981","text":"\u9805\u76ee \u7248\u672c/\u503c Kubernetes 1.32.11 CRI-O 1.32.1 Docker CE 29.2.0 CNI Antrea Pod Network CIDR 10.244.0.0/16 Service CIDR 172.30.0.0/16 <p>\u5b8c\u6210\u78ba\u8a8d</p> <p>\u7576\u6240\u6709\u7bc0\u9ede\u986f\u793a <code>Ready</code> \u72c0\u614b\uff0c\u4e14\u6e2c\u8a66 Pod \u53ef\u4ee5\u6b63\u5e38\u904b\u884c\uff0c\u8868\u793a Kubernetes \u53e2\u96c6\u5b89\u88dd\u6210\u529f\uff01</p>"},{"location":"lab12_k8s_install/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u74b0\u5883\u6e96\u5099\uff1a\u555f\u52d5\u4e09\u53f0\u865b\u64ec\u6a5f\uff08k8s-master1\u3001k8s-node1\u3001k8s-node2\uff09</li> <li>\u2705 \u7db2\u8def\u78ba\u8a8d\uff1a\u78ba\u4fdd\u7bc0\u9ede\u9593\u53ef\u4ee5\u4e92\u76f8\u901a\u8a0a\uff0c\u4e14\u53ef\u9023\u63a5\u7db2\u969b\u7db2\u8def</li> <li>\u2705 \u8173\u672c\u5b89\u88dd\uff1a\u4f7f\u7528 <code>install_k8s-latest.sh -full</code> \u81ea\u52d5\u5316\u5b89\u88dd</li> <li>\u2705 \u6838\u5fc3\u5143\u4ef6\uff1a\u5b89\u88dd kubeadm\u3001kubectl\u3001kubelet v1.32.11</li> <li>\u2705 \u5bb9\u5668\u57f7\u884c\u74b0\u5883\uff1a\u5b89\u88dd CRI-O v1.32.1</li> <li>\u2705 CNI \u7db2\u8def\uff1a\u90e8\u7f72 Antrea \u7db2\u8def\u63d2\u4ef6</li> <li>\u2705 \u53e2\u96c6\u9a57\u8b49\uff1a\u78ba\u8a8d\u6240\u6709\u7bc0\u9ede Ready \u4e26\u6e2c\u8a66 Deployment</li> </ul>"},{"location":"lab12_k8s_install/#_8","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li>kubeadm \u5b89\u88dd\u6307\u5357</li> <li>CRI-O \u5b98\u65b9\u6587\u4ef6</li> <li>Antrea CNI</li> </ul>"},{"location":"lab13_k8s_commands/","title":"LAB 13 kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#lab-13-kubernetes","title":"LAB 13 kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab13_k8s_commands/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab14_namespace_rolling/","title":"LAB 14 namespaces \u8207 rolling update","text":""},{"location":"lab14_namespace_rolling/#lab-14-namespaces-rolling-update","title":"LAB 14 namespaces \u8207 rolling update","text":""},{"location":"lab14_namespace_rolling/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab14_namespace_rolling/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab15_service/","title":"LAB 15 service","text":""},{"location":"lab15_service/#lab-15-service","title":"LAB 15 service","text":""},{"location":"lab15_service/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab15_service/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab16_pv_pvc/","title":"LAB 16 PV/PVC","text":""},{"location":"lab16_pv_pvc/#lab-16-pvpvc","title":"LAB 16 PV/PVC","text":""},{"location":"lab16_pv_pvc/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab16_pv_pvc/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab17_secret/","title":"LAB 17 secret","text":""},{"location":"lab17_secret/#lab-17-secret","title":"LAB 17 secret","text":""},{"location":"lab17_secret/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab17_secret/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab18_rbac_event_log/","title":"LAB 18 RBAC \u8207 event/log","text":""},{"location":"lab18_rbac_event_log/#lab-18-rbac-eventlog","title":"LAB 18 RBAC \u8207 event/log","text":""},{"location":"lab18_rbac_event_log/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab18_rbac_event_log/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab19_k8s_wordpress_mysql/","title":"LAB 19 Kubernetes + wordpress + mysql","text":""},{"location":"lab19_k8s_wordpress_mysql/#lab-19-kubernetes-wordpress-mysql","title":"LAB 19 Kubernetes + wordpress + mysql","text":""},{"location":"lab19_k8s_wordpress_mysql/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab20_dashboard/","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#lab-20-kubernetes-dashboard","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab20_dashboard/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"appendix/docker_cheatsheet/","title":"Docker \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/docker_cheatsheet/#docker","title":"Docker \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 Docker \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/docker_cheatsheet/#_1","title":"\u5bb9\u5668\u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_2","title":"\u57f7\u884c\u5bb9\u5668","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker run &lt;image&gt;</code> \u57f7\u884c\u5bb9\u5668 <code>docker run -d &lt;image&gt;</code> \u80cc\u666f\u57f7\u884c <code>docker run -it &lt;image&gt; /bin/bash</code> \u4e92\u52d5\u6a21\u5f0f <code>docker run --name &lt;name&gt; &lt;image&gt;</code> \u6307\u5b9a\u540d\u7a31 <code>docker run -p 8080:80 &lt;image&gt;</code> Port \u5c0d\u61c9 <code>docker run -v /host:/container &lt;image&gt;</code> \u639b\u8f09\u76ee\u9304 <code>docker run -e VAR=value &lt;image&gt;</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <code>docker run --rm &lt;image&gt;</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>docker run --restart=always &lt;image&gt;</code> \u81ea\u52d5\u91cd\u555f <code>docker run --network &lt;network&gt; &lt;image&gt;</code> \u6307\u5b9a\u7db2\u8def"},{"location":"appendix/docker_cheatsheet/#_3","title":"\u5bb9\u5668\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker ps</code> \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker ps -a</code> \u5217\u51fa\u6240\u6709\u5bb9\u5668 <code>docker start &lt;container&gt;</code> \u555f\u52d5\u5bb9\u5668 <code>docker stop &lt;container&gt;</code> \u505c\u6b62\u5bb9\u5668 <code>docker restart &lt;container&gt;</code> \u91cd\u555f\u5bb9\u5668 <code>docker pause &lt;container&gt;</code> \u66ab\u505c\u5bb9\u5668 <code>docker unpause &lt;container&gt;</code> \u7e7c\u7e8c\u5bb9\u5668 <code>docker rm &lt;container&gt;</code> \u522a\u9664\u5bb9\u5668 <code>docker rm -f &lt;container&gt;</code> \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker container prune</code> \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668"},{"location":"appendix/docker_cheatsheet/#_4","title":"\u5bb9\u5668\u64cd\u4f5c\u8207\u9664\u932f","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker exec -it &lt;container&gt; /bin/bash</code> \u9032\u5165\u5bb9\u5668 <code>docker exec &lt;container&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker logs &lt;container&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>docker logs -f &lt;container&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker logs --tail 100 &lt;container&gt;</code> \u6700\u5f8c 100 \u884c <code>docker inspect &lt;container&gt;</code> \u8a73\u7d30\u8cc7\u8a0a <code>docker stats</code> \u8cc7\u6e90\u4f7f\u7528\u7d71\u8a08 <code>docker top &lt;container&gt;</code> \u5bb9\u5668\u5167\u7a0b\u5e8f <code>docker cp &lt;src&gt; &lt;container&gt;:&lt;dest&gt;</code> \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668 <code>docker cp &lt;container&gt;:&lt;src&gt; &lt;dest&gt;</code> \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848"},{"location":"appendix/docker_cheatsheet/#image","title":"Image \u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_5","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker images</code> \u5217\u51fa\u672c\u5730 Image <code>docker pull &lt;image&gt;</code> \u62c9\u53d6 Image <code>docker push &lt;image&gt;</code> \u63a8\u9001 Image <code>docker rmi &lt;image&gt;</code> \u522a\u9664 Image <code>docker image prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Image <code>docker image prune -a</code> \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image"},{"location":"appendix/docker_cheatsheet/#_6","title":"\u5efa\u7f6e\u8207\u6a19\u7c64","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker build -t &lt;name&gt;:&lt;tag&gt; .</code> \u5efa\u7f6e Image <code>docker build -f Dockerfile.prod .</code> \u6307\u5b9a Dockerfile <code>docker build --no-cache .</code> \u4e0d\u4f7f\u7528\u5feb\u53d6 <code>docker tag &lt;image&gt; &lt;new-tag&gt;</code> \u52a0\u4e0a\u6a19\u7c64 <code>docker history &lt;image&gt;</code> \u67e5\u770b Image \u6b77\u53f2 <code>docker save -o image.tar &lt;image&gt;</code> \u532f\u51fa Image <code>docker load -i image.tar</code> \u532f\u5165 Image"},{"location":"appendix/docker_cheatsheet/#_7","title":"\u641c\u5c0b","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker search &lt;keyword&gt;</code> \u641c\u5c0b Docker Hub <code>docker search --filter is-official=true &lt;keyword&gt;</code> \u53ea\u641c\u5c0b\u5b98\u65b9 Image <code>docker search --limit 5 &lt;keyword&gt;</code> \u9650\u5236\u7d50\u679c\u6578\u91cf"},{"location":"appendix/docker_cheatsheet/#volume","title":"Volume \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker volume ls</code> \u5217\u51fa\u6240\u6709 Volume <code>docker volume create &lt;name&gt;</code> \u5efa\u7acb Volume <code>docker volume inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a <code>docker volume rm &lt;name&gt;</code> \u522a\u9664 Volume <code>docker volume prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume"},{"location":"appendix/docker_cheatsheet/#_8","title":"\u639b\u8f09\u65b9\u5f0f","text":"<pre><code># Volume \u639b\u8f09\ndocker run -v my-volume:/app/data nginx\n\n# Bind Mount\ndocker run -v /host/path:/container/path nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -v /host/path:/container/path:ro nginx\n\n# --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run --mount type=volume,source=my-volume,target=/app/data nginx\ndocker run --mount type=bind,source=/host/path,target=/container/path nginx\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#_9","title":"\u7db2\u8def\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker network ls</code> \u5217\u51fa\u6240\u6709\u7db2\u8def <code>docker network create &lt;name&gt;</code> \u5efa\u7acb\u7db2\u8def <code>docker network connect &lt;network&gt; &lt;container&gt;</code> \u9023\u63a5\u7db2\u8def <code>docker network disconnect &lt;network&gt; &lt;container&gt;</code> \u65b7\u958b\u7db2\u8def <code>docker network rm &lt;name&gt;</code> \u522a\u9664\u7db2\u8def <code>docker network prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684\u7db2\u8def <code>docker network inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a"},{"location":"appendix/docker_cheatsheet/#_10","title":"\u7db2\u8def\u985e\u578b","text":"\u985e\u578b \u8aaa\u660e <code>bridge</code> \u9810\u8a2d\uff0c\u5bb9\u5668\u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 <code>host</code> \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def <code>none</code> \u7121\u7db2\u8def <code>overlay</code> \u8de8\u4e3b\u6a5f\u901a\u8a0a\uff08Swarm\uff09"},{"location":"appendix/docker_cheatsheet/#_11","title":"\u7cfb\u7d71\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker info</code> \u7cfb\u7d71\u8cc7\u8a0a <code>docker version</code> \u7248\u672c\u8cc7\u8a0a <code>docker system df</code> \u78c1\u789f\u4f7f\u7528\u91cf <code>docker system prune</code> \u6e05\u7406\u672a\u4f7f\u7528\u8cc7\u6e90 <code>docker system prune -a --volumes</code> \u5b8c\u6574\u6e05\u7406 <code>docker events</code> \u5373\u6642\u4e8b\u4ef6"},{"location":"appendix/docker_cheatsheet/#docker-compose","title":"Docker Compose","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker compose up</code> \u555f\u52d5\u670d\u52d9 <code>docker compose up -d</code> \u80cc\u666f\u555f\u52d5 <code>docker compose down</code> \u505c\u6b62\u4e26\u79fb\u9664 <code>docker compose down -v</code> \u540c\u6642\u79fb\u9664 Volume <code>docker compose ps</code> \u5217\u51fa\u670d\u52d9 <code>docker compose logs</code> \u67e5\u770b\u65e5\u8a8c <code>docker compose logs -f</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker compose exec &lt;service&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker compose build</code> \u5efa\u7f6e\u670d\u52d9 <code>docker compose pull</code> \u62c9\u53d6 Image"},{"location":"appendix/docker_cheatsheet/#registry","title":"Registry \u767b\u5165","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker login</code> \u767b\u5165 Docker Hub <code>docker login &lt;registry&gt;</code> \u767b\u5165\u79c1\u6709 Registry <code>docker logout</code> \u767b\u51fa"},{"location":"appendix/docker_cheatsheet/#_12","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5e38\u7528\u64cd\u4f5c<pre><code># \u505c\u6b62\u6240\u6709\u5bb9\u5668\ndocker stop $(docker ps -q)\n\n# \u522a\u9664\u6240\u6709\u5bb9\u5668\ndocker rm $(docker ps -aq)\n\n# \u522a\u9664\u6240\u6709 Image\ndocker rmi $(docker images -q)\n\n# \u522a\u9664 dangling Image\ndocker rmi $(docker images -f \"dangling=true\" -q)\n\n# \u53d6\u5f97\u5bb9\u5668 IP\ndocker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container&gt;\n\n# \u9032\u5165\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker exec -it $(docker ps -q -f name=nginx) /bin/sh\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#dockerfile","title":"Dockerfile \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>FROM</code> \u57fa\u790e Image <code>RUN</code> \u57f7\u884c\u6307\u4ee4 <code>COPY</code> \u8907\u88fd\u6a94\u6848 <code>ADD</code> \u8907\u88fd\u6a94\u6848\uff08\u652f\u63f4 URL\u3001\u89e3\u58d3\u7e2e\uff09 <code>WORKDIR</code> \u5de5\u4f5c\u76ee\u9304 <code>ENV</code> \u74b0\u5883\u8b8a\u6578 <code>EXPOSE</code> \u66b4\u9732 Port <code>CMD</code> \u9810\u8a2d\u57f7\u884c\u6307\u4ee4 <code>ENTRYPOINT</code> \u5165\u53e3\u9ede <code>VOLUME</code> \u639b\u8f09\u9ede <code>USER</code> \u57f7\u884c\u8eab\u4efd <code>ARG</code> \u5efa\u7f6e\u53c3\u6578 <code>LABEL</code> \u6a19\u7c64 <code>HEALTHCHECK</code> \u5065\u5eb7\u6aa2\u67e5"},{"location":"appendix/docker_cheatsheet/#_13","title":"\u74b0\u5883\u8b8a\u6578","text":"\u8b8a\u6578 \u8aaa\u660e <code>DOCKER_HOST</code> Docker \u4e3b\u6a5f\u4f4d\u5740 <code>DOCKER_TLS_VERIFY</code> \u555f\u7528 TLS \u9a57\u8b49 <code>DOCKER_CERT_PATH</code> TLS \u6191\u8b49\u8def\u5f91 <code>DOCKER_CONFIG</code> \u8a2d\u5b9a\u6a94\u76ee\u9304"},{"location":"appendix/k8s_cheatsheet/","title":"Kubernetes \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/k8s_cheatsheet/#kubernetes","title":"Kubernetes \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 kubectl \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/k8s_cheatsheet/#_1","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_2","title":"\u53e2\u96c6\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl cluster-info</code> \u53e2\u96c6\u8cc7\u8a0a <code>kubectl version</code> \u7248\u672c\u8cc7\u8a0a <code>kubectl config view</code> \u67e5\u770b\u8a2d\u5b9a <code>kubectl config get-contexts</code> \u5217\u51fa Context <code>kubectl config use-context &lt;name&gt;</code> \u5207\u63db Context <code>kubectl api-resources</code> \u5217\u51fa API \u8cc7\u6e90 <code>kubectl api-versions</code> \u5217\u51fa API \u7248\u672c"},{"location":"appendix/k8s_cheatsheet/#_3","title":"\u8cc7\u6e90\u67e5\u8a62","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get &lt;resource&gt;</code> \u5217\u51fa\u8cc7\u6e90 <code>kubectl get pods</code> \u5217\u51fa Pod <code>kubectl get pods -o wide</code> \u8a73\u7d30\u8cc7\u8a0a\uff08\u542b IP\u3001Node\uff09 <code>kubectl get pods -o yaml</code> YAML \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -o json</code> JSON \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -w</code> \u6301\u7e8c\u76e3\u770b <code>kubectl get pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u904e\u6ffe <code>kubectl get pods -n &lt;namespace&gt;</code> \u6307\u5b9a Namespace <code>kubectl get pods --all-namespaces</code> \u6240\u6709 Namespace <code>kubectl get all</code> \u5217\u51fa\u5e38\u898b\u8cc7\u6e90"},{"location":"appendix/k8s_cheatsheet/#_4","title":"\u8cc7\u6e90\u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_5","title":"\u5efa\u7acb\u8207\u5957\u7528","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl apply -f &lt;file.yaml&gt;</code> \u5957\u7528\u8a2d\u5b9a <code>kubectl apply -f &lt;directory&gt;/</code> \u5957\u7528\u76ee\u9304\u4e0b\u6240\u6709\u8a2d\u5b9a <code>kubectl create -f &lt;file.yaml&gt;</code> \u5efa\u7acb\u8cc7\u6e90 <code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Deployment <code>kubectl create service clusterip &lt;name&gt; --tcp=80:80</code> \u5efa\u7acb Service <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb ConfigMap <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret"},{"location":"appendix/k8s_cheatsheet/#_6","title":"\u7de8\u8f2f\u8207\u522a\u9664","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl edit &lt;resource&gt; &lt;name&gt;</code> \u7de8\u8f2f\u8cc7\u6e90 <code>kubectl delete &lt;resource&gt; &lt;name&gt;</code> \u522a\u9664\u8cc7\u6e90 <code>kubectl delete -f &lt;file.yaml&gt;</code> \u4f9d\u8a2d\u5b9a\u6a94\u522a\u9664 <code>kubectl delete pods --all</code> \u522a\u9664\u6240\u6709 Pod <code>kubectl delete pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u522a\u9664"},{"location":"appendix/k8s_cheatsheet/#_7","title":"\u8a73\u7d30\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl describe &lt;resource&gt; &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl describe pod &lt;pod-name&gt;</code> \u63cf\u8ff0 Pod <code>kubectl describe node &lt;node-name&gt;</code> \u63cf\u8ff0 Node"},{"location":"appendix/k8s_cheatsheet/#pod","title":"Pod \u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_8","title":"\u57f7\u884c\u8207\u5b58\u53d6","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl run &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Pod <code>kubectl exec -it &lt;pod&gt; -- /bin/sh</code> \u9032\u5165 Pod <code>kubectl exec &lt;pod&gt; -- &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>kubectl logs &lt;pod&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>kubectl logs -f &lt;pod&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; -c &lt;container&gt;</code> \u591a\u5bb9\u5668\u6307\u5b9a <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; --tail=100</code> \u6700\u5f8c 100 \u884c <code>kubectl port-forward &lt;pod&gt; 8080:80</code> Port \u8f49\u767c <code>kubectl cp &lt;pod&gt;:&lt;path&gt; &lt;local-path&gt;</code> \u8907\u88fd\u6a94\u6848"},{"location":"appendix/k8s_cheatsheet/#deployment","title":"Deployment \u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_9","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get deployments</code> \u5217\u51fa Deployment <code>kubectl describe deployment &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl scale deployment &lt;name&gt; --replicas=3</code> \u8abf\u6574\u526f\u672c <code>kubectl set image deployment/&lt;name&gt; &lt;container&gt;=&lt;image&gt;</code> \u66f4\u65b0 Image"},{"location":"appendix/k8s_cheatsheet/#_10","title":"\u6efe\u52d5\u66f4\u65b0","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl rollout status deployment/&lt;name&gt;</code> \u67e5\u770b\u66f4\u65b0\u72c0\u614b <code>kubectl rollout history deployment/&lt;name&gt;</code> \u67e5\u770b\u6b77\u53f2 <code>kubectl rollout undo deployment/&lt;name&gt;</code> \u56de\u6efe <code>kubectl rollout undo deployment/&lt;name&gt; --to-revision=2</code> \u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c <code>kubectl rollout restart deployment/&lt;name&gt;</code> \u91cd\u555f <code>kubectl rollout pause deployment/&lt;name&gt;</code> \u66ab\u505c\u66f4\u65b0 <code>kubectl rollout resume deployment/&lt;name&gt;</code> \u7e7c\u7e8c\u66f4\u65b0"},{"location":"appendix/k8s_cheatsheet/#service","title":"Service \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get services</code> \u5217\u51fa Service <code>kubectl get endpoints</code> \u5217\u51fa Endpoints <code>kubectl expose deployment &lt;name&gt; --port=80</code> \u5efa\u7acb Service <code>kubectl expose deployment &lt;name&gt; --type=NodePort --port=80</code> NodePort <code>kubectl expose deployment &lt;name&gt; --type=LoadBalancer --port=80</code> LoadBalancer"},{"location":"appendix/k8s_cheatsheet/#namespace","title":"Namespace \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get namespaces</code> \u5217\u51fa Namespace <code>kubectl create namespace &lt;name&gt;</code> \u5efa\u7acb Namespace <code>kubectl delete namespace &lt;name&gt;</code> \u522a\u9664 Namespace <code>kubectl config set-context --current --namespace=&lt;name&gt;</code> \u5207\u63db\u9810\u8a2d Namespace"},{"location":"appendix/k8s_cheatsheet/#configmap-secret","title":"ConfigMap &amp; Secret","text":""},{"location":"appendix/k8s_cheatsheet/#configmap","title":"ConfigMap","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get configmaps</code> \u5217\u51fa ConfigMap <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5f9e\u5b57\u9762\u503c\u5efa\u7acb <code>kubectl create configmap &lt;name&gt; --from-file=&lt;file&gt;</code> \u5f9e\u6a94\u6848\u5efa\u7acb <code>kubectl describe configmap &lt;name&gt;</code> \u6aa2\u8996\u5167\u5bb9"},{"location":"appendix/k8s_cheatsheet/#secret","title":"Secret","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get secrets</code> \u5217\u51fa Secret <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret <code>kubectl get secret &lt;name&gt; -o jsonpath='{.data.key}' \\| base64 -d</code> \u89e3\u78bc Secret"},{"location":"appendix/k8s_cheatsheet/#pv-pvc","title":"PV &amp; PVC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get pv</code> \u5217\u51fa PersistentVolume <code>kubectl get pvc</code> \u5217\u51fa PersistentVolumeClaim <code>kubectl describe pv &lt;name&gt;</code> \u63cf\u8ff0 PV <code>kubectl describe pvc &lt;name&gt;</code> \u63cf\u8ff0 PVC"},{"location":"appendix/k8s_cheatsheet/#node","title":"Node \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get nodes</code> \u5217\u51fa\u7bc0\u9ede <code>kubectl describe node &lt;name&gt;</code> \u63cf\u8ff0\u7bc0\u9ede <code>kubectl top nodes</code> \u7bc0\u9ede\u8cc7\u6e90\u4f7f\u7528 <code>kubectl cordon &lt;node&gt;</code> \u6a19\u8a18\u7bc0\u9ede\u4e0d\u53ef\u8abf\u5ea6 <code>kubectl uncordon &lt;node&gt;</code> \u53d6\u6d88\u6a19\u8a18 <code>kubectl drain &lt;node&gt;</code> \u6392\u7a7a\u7bc0\u9ede <code>kubectl taint nodes &lt;node&gt; key=value:NoSchedule</code> \u52a0\u4e0a Taint"},{"location":"appendix/k8s_cheatsheet/#rbac","title":"RBAC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get roles</code> \u5217\u51fa Role <code>kubectl get clusterroles</code> \u5217\u51fa ClusterRole <code>kubectl get rolebindings</code> \u5217\u51fa RoleBinding <code>kubectl get clusterrolebindings</code> \u5217\u51fa ClusterRoleBinding <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt;</code> \u6aa2\u67e5\u6b0a\u9650 <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt; --as=&lt;user&gt;</code> \u6a21\u64ec\u4f7f\u7528\u8005\u6aa2\u67e5"},{"location":"appendix/k8s_cheatsheet/#_11","title":"\u7591\u96e3\u6392\u89e3","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get events</code> \u67e5\u770b\u4e8b\u4ef6 <code>kubectl get events --sort-by='.lastTimestamp'</code> \u4f9d\u6642\u9593\u6392\u5e8f <code>kubectl top pods</code> Pod \u8cc7\u6e90\u4f7f\u7528 <code>kubectl top nodes</code> Node \u8cc7\u6e90\u4f7f\u7528 <code>kubectl describe pod &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u65e5\u8a8c"},{"location":"appendix/k8s_cheatsheet/#_12","title":"\u8f38\u51fa\u683c\u5f0f","text":"\u683c\u5f0f \u8aaa\u660e <code>-o wide</code> \u984d\u5916\u6b04\u4f4d <code>-o yaml</code> YAML \u683c\u5f0f <code>-o json</code> JSON \u683c\u5f0f <code>-o name</code> \u53ea\u986f\u793a\u540d\u7a31 <code>-o jsonpath='{...}'</code> JSONPath \u67e5\u8a62 <code>-o custom-columns=...</code> \u81ea\u8a02\u6b04\u4f4d"},{"location":"appendix/k8s_cheatsheet/#jsonpath","title":"JSONPath \u7bc4\u4f8b","text":"<pre><code># \u53d6\u5f97 Pod IP\nkubectl get pod &lt;name&gt; -o jsonpath='{.status.podIP}'\n\n# \u53d6\u5f97\u6240\u6709 Pod \u540d\u7a31\nkubectl get pods -o jsonpath='{.items[*].metadata.name}'\n\n# \u53d6\u5f97\u6240\u6709 Container Image\nkubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#_13","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5be6\u7528\u6307\u4ee4<pre><code># \u522a\u9664\u6240\u6709 Evicted Pod\nkubectl delete pods --field-selector=status.phase=Failed --all-namespaces\n\n# \u53d6\u5f97\u6240\u6709 Pod \u7684 Image\nkubectl get pods -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq\n\n# \u4f9d\u8a18\u61b6\u9ad4\u4f7f\u7528\u91cf\u6392\u5e8f Pod\nkubectl top pods --sort-by=memory\n\n# \u5feb\u901f\u5efa\u7acb\u6e2c\u8a66 Pod\nkubectl run test --image=busybox --rm -it -- /bin/sh\n\n# \u7522\u751f YAML \u4f46\u4e0d\u57f7\u884c\nkubectl create deployment nginx --image=nginx --dry-run=client -o yaml\n\n# \u532f\u51fa\u73fe\u6709\u8cc7\u6e90\nkubectl get deployment nginx -o yaml &gt; nginx-deployment.yaml\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#minikube","title":"minikube \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>minikube start</code> \u555f\u52d5 <code>minikube stop</code> \u505c\u6b62 <code>minikube delete</code> \u522a\u9664 <code>minikube status</code> \u72c0\u614b <code>minikube dashboard</code> \u958b\u555f Dashboard <code>minikube ip</code> \u53d6\u5f97 IP <code>minikube ssh</code> SSH \u9023\u7dda <code>minikube service &lt;name&gt;</code> \u958b\u555f Service <code>minikube addons list</code> \u5217\u51fa\u63d2\u4ef6 <code>minikube addons enable &lt;name&gt;</code> \u555f\u7528\u63d2\u4ef6"},{"location":"appendix/k8s_cheatsheet/#_14","title":"\u5feb\u6377\u5225\u540d","text":"\u5efa\u8b70\u52a0\u5165 ~/.bashrc \u6216 ~/.zshrc<pre><code>alias k='kubectl'\nalias kgp='kubectl get pods'\nalias kgs='kubectl get services'\nalias kgd='kubectl get deployments'\nalias kgn='kubectl get nodes'\nalias kd='kubectl describe'\nalias kl='kubectl logs'\nalias ke='kubectl exec -it'\nalias ka='kubectl apply -f'\nalias kd='kubectl delete -f'\n\n# \u81ea\u52d5\u88dc\u5168\nsource &lt;(kubectl completion bash)\nsource &lt;(kubectl completion zsh)\n</code></pre>"},{"location":"appendix/troubleshooting/","title":"\u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#_1","title":"\u7591\u96e3\u6392\u89e3\u6307\u5357","text":"<p>\u672c\u7ae0\u7bc0\u6574\u7406 Docker \u8207 Kubernetes \u5e38\u898b\u554f\u984c\u7684\u8a3a\u65b7\u8207\u89e3\u6c7a\u65b9\u6cd5\u3002</p>"},{"location":"appendix/troubleshooting/#docker","title":"Docker \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-docker","title":"1. Docker \u670d\u52d9\u7121\u6cd5\u555f\u52d5","text":"<p>\u75c7\u72c0</p> <pre><code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5 Docker \u670d\u52d9<pre><code># \u6aa2\u67e5\u670d\u52d9\u72c0\u614b\nsudo systemctl status docker\n\n# \u67e5\u770b\u670d\u52d9\u65e5\u8a8c\nsudo journalctl -u docker -f\n\n# \u6aa2\u67e5 socket \u6a94\u6848\nls -la /var/run/docker.sock\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u555f\u52d5 Docker \u670d\u52d9\nsudo systemctl start docker\n\n# \u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5\nsudo systemctl enable docker\n\n# \u5982\u679c socket \u554f\u984c\uff0c\u91cd\u65b0\u5efa\u7acb\nsudo rm /var/run/docker.sock\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#2-permission-denied","title":"2. Permission Denied","text":"<p>\u75c7\u72c0</p> <pre><code>permission denied while trying to connect to the Docker daemon socket\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5c07\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n\n# \u91cd\u65b0\u767b\u5165\u6216\u57f7\u884c\nnewgrp docker\n\n# \u9a57\u8b49\u7fa4\u7d44\ngroups\n</code></pre>"},{"location":"appendix/troubleshooting/#3","title":"3. \u5bb9\u5668\u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7\u5bb9\u5668\u9000\u51fa<pre><code># \u6aa2\u8996\u5bb9\u5668\u72c0\u614b\ndocker ps -a\n\n# \u67e5\u770b\u9000\u51fa\u78bc\ndocker inspect &lt;container&gt; --format='{{.State.ExitCode}}'\n\n# \u67e5\u770b\u65e5\u8a8c\ndocker logs &lt;container&gt;\n\n# \u67e5\u770b\u6700\u5f8c\u8f38\u51fa\ndocker logs --tail 50 &lt;container&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u9000\u51fa\u78bc \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 0 \u6b63\u5e38\u7d50\u675f \u78ba\u8a8d CMD \u6307\u4ee4\u662f\u5426\u70ba\u524d\u666f\u7a0b\u5e8f 1 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\u627e\u51fa\u932f\u8aa4 137 OOM Killed \u589e\u52a0\u8a18\u61b6\u9ad4\u9650\u5236 139 Segmentation Fault \u6aa2\u67e5\u61c9\u7528\u7a0b\u5f0f\u76f8\u5bb9\u6027 143 SIGTERM \u6b63\u5e38\u7d42\u6b62\u4fe1\u865f \u4fdd\u6301\u5bb9\u5668\u904b\u884c\uff08\u6e2c\u8a66\u7528\uff09<pre><code># \u4f7f\u7528 sleep \u4fdd\u6301\u904b\u884c\ndocker run -d --name test ubuntu sleep infinity\n\n# \u6216\u4f7f\u7528 tail\ndocker run -d --name test ubuntu tail -f /dev/null\n</code></pre>"},{"location":"appendix/troubleshooting/#4-image","title":"4. Image \u62c9\u53d6\u5931\u6557","text":"<p>\u75c7\u72c0</p> <pre><code>Error response from daemon: pull access denied\nError response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\ndocker search &lt;image-name&gt;\n\n# \u78ba\u8a8d\u7db2\u8def\u9023\u7dda\nping registry-1.docker.io\n\n# \u78ba\u8a8d DNS\nnslookup registry-1.docker.io\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5982\u9700\u767b\u5165\ndocker login\n\n# \u8a2d\u5b9a Registry Mirror\uff08\u570b\u5167\u52a0\u901f\uff09\n# \u7de8\u8f2f /etc/docker/daemon.json\n{\n  \"registry-mirrors\": [\"https://mirror.example.com\"]\n}\n\n# \u91cd\u555f Docker\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#5","title":"5. \u78c1\u789f\u7a7a\u9593\u4e0d\u8db3","text":"<p>\u75c7\u72c0</p> <pre><code>no space left on device\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5\u78c1\u789f\u4f7f\u7528<pre><code># \u6aa2\u8996 Docker \u78c1\u789f\u4f7f\u7528\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6aa2\u67e5\u7cfb\u7d71\u78c1\u789f\ndf -h\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> \u6e05\u7406\u8cc7\u6e90<pre><code># \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u5b8c\u6574\u6e05\u7406\uff08\u5305\u542b\u672a\u4f7f\u7528\u7684 Image \u548c Volume\uff09\ndocker system prune -a --volumes\n\n# \u522a\u9664 dangling Image\ndocker image prune\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n\n# \u522a\u9664\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n</code></pre>"},{"location":"appendix/troubleshooting/#6-port","title":"6. Port \u5df2\u88ab\u4f54\u7528","text":"<p>\u75c7\u72c0</p> <pre><code>Bind for 0.0.0.0:8080 failed: port is already allocated\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b Port \u4f7f\u7528\u60c5\u6cc1\nsudo lsof -i :8080\n\n# \u6216\u4f7f\u7528 netstat\nsudo netstat -tlnp | grep 8080\n\n# \u67e5\u770b Docker \u5bb9\u5668\u4f7f\u7528\u7684 Port\ndocker ps --format \"table {{.Names}}\\t{{.Ports}}\"\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u505c\u6b62\u4f54\u7528 Port \u7684\u7a0b\u5e8f\nsudo kill &lt;PID&gt;\n\n# \u6216\u4f7f\u7528\u5176\u4ed6 Port\ndocker run -d -p 8081:80 nginx\n</code></pre>"},{"location":"appendix/troubleshooting/#7-volume","title":"7. Volume \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <p>\u5bb9\u5668\u5167\u7121\u6cd5\u5beb\u5165\u639b\u8f09\u7684\u76ee\u9304</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u8abf\u6574\u4e3b\u6a5f\u76ee\u9304\u6b0a\u9650\nsudo chown -R 1000:1000 /path/to/host/dir\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u7279\u5b9a UID \u57f7\u884c\u5bb9\u5668\ndocker run -u $(id -u):$(id -g) -v /host:/container image\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 SELinux \u6a19\u7c64\uff08RHEL/CentOS\uff09\ndocker run -v /host:/container:Z image\n</code></pre>"},{"location":"appendix/troubleshooting/#kubernetes","title":"Kubernetes \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-pod-pending","title":"1. Pod \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Pending Pod<pre><code># \u67e5\u770b Pod \u4e8b\u4ef6\nkubectl describe pod &lt;pod-name&gt;\n\n# \u67e5\u770b Events\nkubectl get events --field-selector involvedObject.name=&lt;pod-name&gt;\n\n# \u6aa2\u67e5\u7bc0\u9ede\u8cc7\u6e90\nkubectl describe nodes | grep -A 5 \"Allocated resources\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u8aaa\u660e \u89e3\u6c7a\u65b9\u6848 \u8cc7\u6e90\u4e0d\u8db3 CPU/Memory \u4e0d\u5920 \u589e\u52a0\u7bc0\u9ede\u6216\u6e1b\u5c11 requests nodeSelector \u4e0d\u7b26 \u6c92\u6709\u7b26\u5408\u7684\u7bc0\u9ede \u8abf\u6574 selector \u6216\u52a0 label PVC \u672a\u7d81\u5b9a PV \u4e0d\u5b58\u5728\u6216\u4e0d\u7b26\u5408 \u5efa\u7acb\u7b26\u5408\u7684 PV Taint/Toleration \u7bc0\u9ede\u6709 Taint \u52a0\u4e0a Toleration"},{"location":"appendix/troubleshooting/#2-pod-crashloopbackoff","title":"2. Pod \u8655\u65bc CrashLoopBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 CrashLoopBackOff<pre><code># \u67e5\u770b\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt;\n\n# \u67e5\u770b\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt; --previous\n\n# \u67e5\u770b\u8a73\u7d30\u72c0\u614b\nkubectl describe pod &lt;pod-name&gt;\n\n# \u6aa2\u67e5\u9000\u51fa\u78bc\nkubectl get pod &lt;pod-name&gt; -o jsonpath='{.status.containerStatuses[0].lastState.terminated.exitCode}'\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\uff0c\u4fee\u5fa9\u7a0b\u5f0f \u8a2d\u5b9a\u932f\u8aa4 \u6aa2\u67e5 ConfigMap/Secret \u8cc7\u6e90\u4e0d\u8db3 \u589e\u52a0 memory/cpu limits \u5065\u5eb7\u6aa2\u67e5\u5931\u6557 \u8abf\u6574 probe \u53c3\u6578 \u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2 \u4f7f\u7528 initContainer"},{"location":"appendix/troubleshooting/#3-pod-imagepullbackoff","title":"3. Pod \u8655\u65bc ImagePullBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u932f\u8aa4\u8a0a\u606f\nkubectl describe pod &lt;pod-name&gt; | grep -A 10 Events\n\n# \u9a57\u8b49 Image \u5b58\u5728\ndocker pull &lt;image-name&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\u6b63\u78ba\n# \u78ba\u8a8d Registry \u5b58\u53d6\u6b0a\u9650\n\n# \u5982\u679c\u662f\u79c1\u6709 Registry\uff0c\u5efa\u7acb Secret\nkubectl create secret docker-registry regcred \\\n  --docker-server=&lt;registry&gt; \\\n  --docker-username=&lt;username&gt; \\\n  --docker-password=&lt;password&gt;\n\n# \u5728 Pod spec \u52a0\u5165 imagePullSecrets\nspec:\n  imagePullSecrets:\n    - name: regcred\n</code></pre>"},{"location":"appendix/troubleshooting/#4-service","title":"4. Service \u7121\u6cd5\u9023\u63a5","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Service \u9023\u7dda<pre><code># \u78ba\u8a8d Service \u5b58\u5728\nkubectl get svc &lt;service-name&gt;\n\n# \u78ba\u8a8d Endpoints\nkubectl get endpoints &lt;service-name&gt;\n\n# \u78ba\u8a8d Pod \u904b\u884c\u4e2d\nkubectl get pods -l &lt;selector&gt;\n\n# \u5f9e Pod \u5167\u6e2c\u8a66\u9023\u7dda\nkubectl exec -it &lt;pod&gt; -- curl &lt;service-name&gt;:&lt;port&gt;\n\n# \u6aa2\u67e5 DNS\nkubectl exec -it &lt;pod&gt; -- nslookup &lt;service-name&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 Selector \u4e0d\u7b26 \u78ba\u8a8d Service selector \u8207 Pod label \u4e00\u81f4 Pod \u672a\u5c31\u7dd2 \u7b49\u5f85 Pod Ready \u6216\u6aa2\u67e5 readinessProbe Port \u932f\u8aa4 \u78ba\u8a8d port \u548c targetPort NetworkPolicy \u963b\u64cb \u6aa2\u67e5 NetworkPolicy \u898f\u5247"},{"location":"appendix/troubleshooting/#5-configmapsecret-pod","title":"5. ConfigMap/Secret \u66f4\u65b0\u5f8c Pod \u6c92\u6709\u8b8a\u5316","text":"<p>\u539f\u56e0\uff1aPod \u4e0d\u6703\u81ea\u52d5\u91cd\u65b0\u8f09\u5165 ConfigMap/Secret</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u91cd\u555f Deployment\nkubectl rollout restart deployment/&lt;name&gt;\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 annotation \u89f8\u767c\u66f4\u65b0\nkubectl patch deployment &lt;name&gt; -p \\\n  '{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"'$(date +%s)'\"}}}}}'\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 Reloader \u5de5\u5177\n# https://github.com/stakater/Reloader\n</code></pre>"},{"location":"appendix/troubleshooting/#6-pvc-pending","title":"6. PVC \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b PVC \u72c0\u614b\nkubectl get pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\nkubectl describe pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u53ef\u7528\u7684 PV\nkubectl get pv\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u7121\u7b26\u5408\u7684 PV \u5efa\u7acb\u7b26\u5408\u898f\u683c\u7684 PV StorageClass \u4e0d\u5b58\u5728 \u5efa\u7acb StorageClass \u6216\u6307\u5b9a\u6b63\u78ba\u540d\u7a31 \u5bb9\u91cf\u4e0d\u8db3 \u6e1b\u5c11 PVC \u8acb\u6c42\u6216\u589e\u52a0 PV \u5bb9\u91cf accessModes \u4e0d\u7b26 \u78ba\u8a8d PV/PVC accessModes \u4e00\u81f4"},{"location":"appendix/troubleshooting/#7-node-notready","title":"7. Node \u8655\u65bc NotReady","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u7bc0\u9ede\u72c0\u614b\nkubectl describe node &lt;node-name&gt;\n\n# \u6aa2\u67e5 kubelet \u72c0\u614b\nssh &lt;node&gt; \"sudo systemctl status kubelet\"\n\n# \u67e5\u770b kubelet \u65e5\u8a8c\nssh &lt;node&gt; \"sudo journalctl -u kubelet -f\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 kubelet \u505c\u6b62 \u91cd\u555f kubelet \u7db2\u8def\u554f\u984c \u6aa2\u67e5\u7bc0\u9ede\u7db2\u8def\u9023\u7dda \u78c1\u789f\u58d3\u529b \u6e05\u7406\u78c1\u789f\u7a7a\u9593 \u8a18\u61b6\u9ad4\u58d3\u529b \u589e\u52a0\u8a18\u61b6\u9ad4\u6216\u6e1b\u5c11 Pod"},{"location":"appendix/troubleshooting/#8-rbac","title":"8. RBAC \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <pre><code>Error from server (Forbidden): pods is forbidden: User \"xxx\" cannot list resource \"pods\"\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u6aa2\u67e5\u6b0a\u9650\nkubectl auth can-i list pods --as=&lt;user&gt;\n\n# \u6aa2\u67e5\u89d2\u8272\u7d81\u5b9a\nkubectl get rolebindings,clusterrolebindings -A | grep &lt;user&gt;\n\n# \u8a73\u7d30\u6aa2\u67e5\nkubectl describe rolebinding &lt;name&gt; -n &lt;namespace&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5efa\u7acb\u9069\u7576\u7684 Role \u548c RoleBinding\nkubectl create role pod-reader --verb=get,list,watch --resource=pods\nkubectl create rolebinding pod-reader-binding --role=pod-reader --user=&lt;user&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_2","title":"\u8a3a\u65b7\u5de5\u5177","text":""},{"location":"appendix/troubleshooting/#kubectl-debug","title":"kubectl debug","text":"<pre><code># \u5efa\u7acb\u9664\u932f Pod\nkubectl debug node/&lt;node-name&gt; -it --image=busybox\n\n# \u70ba Pod \u5efa\u7acb\u9664\u932f\u5bb9\u5668\nkubectl debug &lt;pod-name&gt; -it --image=busybox --target=&lt;container&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_3","title":"\u5e38\u7528\u8a3a\u65b7\u6307\u4ee4","text":"\u7d9c\u5408\u8a3a\u65b7<pre><code># \u5feb\u901f\u6aa2\u67e5\u53e2\u96c6\u72c0\u614b\nkubectl get nodes\nkubectl get pods --all-namespaces | grep -v Running\n\n# \u6aa2\u67e5\u7cfb\u7d71 Pod\nkubectl get pods -n kube-system\n\n# \u6aa2\u67e5\u6700\u8fd1\u4e8b\u4ef6\nkubectl get events --sort-by='.lastTimestamp' | tail -20\n\n# \u6aa2\u67e5\u8cc7\u6e90\u4f7f\u7528\nkubectl top nodes\nkubectl top pods --all-namespaces\n</code></pre>"},{"location":"appendix/troubleshooting/#_4","title":"\u65e5\u8a8c\u6536\u96c6","text":""},{"location":"appendix/troubleshooting/#_5","title":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a","text":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a\u8173\u672c<pre><code>#!/bin/bash\nOUTPUT_DIR=\"k8s-debug-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p $OUTPUT_DIR\n\n# \u7bc0\u9ede\u8cc7\u8a0a\nkubectl get nodes -o wide &gt; $OUTPUT_DIR/nodes.txt\nkubectl describe nodes &gt; $OUTPUT_DIR/nodes-describe.txt\n\n# Pod \u8cc7\u8a0a\nkubectl get pods --all-namespaces -o wide &gt; $OUTPUT_DIR/pods.txt\n\n# Service \u8cc7\u8a0a\nkubectl get svc --all-namespaces &gt; $OUTPUT_DIR/services.txt\n\n# Events\nkubectl get events --all-namespaces --sort-by='.lastTimestamp' &gt; $OUTPUT_DIR/events.txt\n\n# \u58d3\u7e2e\ntar -czvf $OUTPUT_DIR.tar.gz $OUTPUT_DIR\necho \"\u8a3a\u65b7\u8cc7\u8a0a\u5df2\u5132\u5b58\u81f3 $OUTPUT_DIR.tar.gz\"\n</code></pre>"}]}