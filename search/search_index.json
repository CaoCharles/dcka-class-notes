{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u9996\u9801","text":""},{"location":"#docker-containers-kubernetes","title":"Docker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406","text":"<p>\u6b61\u8fce\u4f86\u5230\u7531 Charles \u88fd\u4f5c\u7684 \u6046\u9038\u6559\u80b2\u8a13\u7df4\u4e2d\u5fc3 DCKA \u8ab2\u7a0b \u5b78\u7fd2\u7b46\u8a18\uff01</p> <p>\u8ab2\u7a0b\u8cc7\u8a0a</p> <ul> <li>\u8ab2\u7a0b\u540d\u7a31\uff1aDocker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406</li> <li>\u8ab2\u7a0b\u4ee3\u865f\uff1aDCKA</li> <li>\u7e3d\u6642\u6578\uff1a21 \u5c0f\u6642\uff083 \u5929\uff09</li> <li>\u9069\u5408\u5c0d\u8c61\uff1a\u7db2\u8def\u5de5\u7a0b\u5e2b\u3001\u96f2\u7aef\u904b\u7b97\u5de5\u7a0b\u5e2b</li> <li>\u7b46\u8a18\u88fd\u4f5c\uff1a Charles</li> </ul>"},{"location":"#_1","title":"\u8ab2\u7a0b\u7c21\u4ecb","text":"<p>\u672c\u8ab2\u7a0b\u65e8\u5728\u5e6b\u52a9\u5b78\u54e1\u638c\u63e1 Docker Container\uff08\u5bb9\u5668\uff09\u6280\u8853\u8207 Kubernetes\uff08\u7c21\u7a31 K8S\uff09\u5bb9\u5668\u7de8\u6392\u5e73\u53f0\u7684\u6838\u5fc3\u6982\u5ff5\u8207\u5be6\u52d9\u64cd\u4f5c\u3002\u900f\u904e\u7406\u8ad6\u8b1b\u89e3\u8207\u52d5\u624b\u5be6\u4f5c\uff0c\u4f60\u5c07\u5b78\u6703\u5982\u4f55\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u90e8\u7f72\u5bb9\u5668\u5316\u61c9\u7528\u7a0b\u5f0f\u3002</p> <pre><code>graph LR\n    A[\u50b3\u7d71\u90e8\u7f72] --&gt; B[\u865b\u64ec\u5316\u90e8\u7f72]\n    B --&gt; C[\u5bb9\u5668\u5316\u90e8\u7f72]\n    C --&gt; D[\u5bb9\u5668\u7de8\u6392 K8S]\n\n    style A fill:#f9f,stroke:#333\n    style B fill:#bbf,stroke:#333\n    style C fill:#bfb,stroke:#333\n    style D fill:#ff9,stroke:#333</code></pre>"},{"location":"#_2","title":"\ud83d\udcda \u5b78\u7fd2\u8cc7\u6e90","text":"<p>\u591a\u5143\u5b78\u7fd2\u7ba1\u9053</p> <p>\u6211\u5011\u63d0\u4f9b\u591a\u7a2e\u5b78\u7fd2\u8cc7\u6e90\uff0c\u8b93\u60a8\u53ef\u4ee5\u9078\u64c7\u6700\u9069\u5408\u7684\u65b9\u5f0f\u6df1\u5165\u4e86\u89e3\u8ab2\u7a0b\u5167\u5bb9\uff01</p> <ul> <li> <p> \u8ab2\u7a0b\u4ecb\u7d39\u97f3\u6a94</p> <p>\u900f\u904e\u97f3\u6a94\u5feb\u901f\u4e86\u89e3\u8ab2\u7a0b\u91cd\u9ede\u8207\u5b78\u7fd2\u76ee\u6a19</p> <p>    \u60a8\u7684\u700f\u89bd\u5668\u4e0d\u652f\u63f4\u97f3\u8a0a\u64ad\u653e </p> </li> <li> <p> AI \u4e92\u52d5\u554f\u7b54</p> <p>\u4f7f\u7528 Google NotebookLM \u8207 AI \u9032\u884c\u8ab2\u7a0b\u5167\u5bb9\u554f\u7b54</p> <p> \u958b\u555f NotebookLM</p> </li> </ul>"},{"location":"#_3","title":"\u5b8c\u6574\u8ab2\u7a0b\u7c21\u5831\u9810\u89bd","text":"<p>\u53ef\u76f4\u63a5\u5728\u4e0b\u65b9\u6ed1\u52d5\u67e5\u770b\u7c21\u5831\uff0c\u6216  \u9ede\u6b64\u4e0b\u8f09 PDF (15MB)</p> <p></p>"},{"location":"#_4","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u8ab2\u7a0b\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3\u5bb9\u5668\u5316\u6280\u8853\u7684\u512a\u52e2\u8207\u61c9\u7528\u5834\u666f</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u5bb9\u5668\u7684\u5efa\u7acb\u3001\u555f\u52d5\u3001\u505c\u6b62\u8207\u522a\u9664</li> <li> \u5ba2\u88fd\u5316 Docker Image\uff08\u6620\u50cf\u6a94\uff09</li> <li> \u4f7f\u7528 Kubernetes \u90e8\u7f72\u8207\u7ba1\u7406\u5bb9\u5668\u5316\u61c9\u7528</li> <li> \u5be6\u4f5c WordPress + MySQL \u7684\u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"#_5","title":"\u8ab2\u7a0b\u5927\u7db1","text":""},{"location":"#1-docker-lab-01-08","title":"1. Docker \u57fa\u790e\u8207\u7ba1\u7406 (LAB 01-08)","text":"<ul> <li>\u74b0\u5883\u521d\u59cb\u5316\u8207\u57fa\u672c\u64cd\u4f5c</li> <li>Docker \u5b89\u88dd (Docker/Podman)</li> <li>Private Registry \u5efa\u7f6e</li> <li>Persistent Storage \u8207 WordPress \u5be6\u4f5c</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#2-docker-lab-09-10","title":"2. Docker \u9032\u968e\u61c9\u7528 (LAB 09-10)","text":"<ul> <li>\u5ba2\u88fd\u5316 Docker Images (commit &amp; Dockerfile)</li> <li>Dockerfile \u6307\u4ee4\u8207\u6700\u4f73\u5be6\u8e10</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#3-kubernetes-lab-11-15","title":"3. Kubernetes \u57fa\u790e (LAB 11-15)","text":"<ul> <li>Kubernetes \u5b89\u88dd (Standalone &amp; Cluster)</li> <li>\u5e38\u7528\u6307\u4ee4\u8207 Namespaces</li> <li>Rolling Update \u8207 Service \u8ca0\u8f09\u5747\u8861</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#4-kubernetes-lab-16-21","title":"4. Kubernetes \u9032\u968e\u7ba1\u7406 (LAB 16-21)","text":"<ul> <li>\u5132\u5b58\u7ba1\u7406 (PV/PVC)</li> <li>\u8a2d\u5b9a\u7ba1\u7406 (Secret/ConfigMap)</li> <li>\u6b0a\u9650\u63a7\u5236 (RBAC)</li> <li>\u5be6\u4f5c\uff1aWordPress + MySQL \u5b8c\u6574\u90e8\u7f72</li> <li>Kubernetes Dashboard</li> <li>Private Registry \u5716\u5f62\u7ba1\u7406 (docker-registry-web)</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#_6","title":"\u9810\u5099\u77e5\u8b58","text":"<p>\u958b\u59cb\u672c\u8ab2\u7a0b\u4e4b\u524d\uff0c\u5efa\u8b70\u4f60\u5177\u5099\uff1a</p> <p>\u5fc5\u5099\u77e5\u8b58</p> <ul> <li>Linux \u57fa\u790e\u6307\u4ee4\u64cd\u4f5c\uff08cd\u3001ls\u3001cat\u3001vim \u7b49\uff09</li> <li>Linux \u57fa\u672c\u7cfb\u7d71\u7ba1\u7406\u6982\u5ff5</li> <li>\u5efa\u8b70\u5177\u5099 RHCE \u8a8d\u8b49\u80fd\u529b\u6216\u540c\u7b49\u7d93\u9a57</li> </ul>"},{"location":"#_7","title":"\u9644\u9304\u8cc7\u6e90","text":"\u8cc7\u6e90 \u8aaa\u660e Docker \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 Docker \u6307\u4ee4\u5feb\u901f\u53c3\u8003 Kubernetes \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 kubectl \u6307\u4ee4\u5feb\u901f\u53c3\u8003 \u7591\u96e3\u6392\u89e3\u6307\u5357 \u5e38\u898b\u554f\u984c\u8207\u89e3\u6c7a\u65b9\u6848"},{"location":"#_8","title":"\u76f8\u95dc\u8cc7\u6e90","text":"<ul> <li> Docker \u5b98\u65b9\u6587\u4ef6</li> <li> Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li> Docker Hub</li> <li>:material-podman: Podman \u5b98\u65b9\u6587\u4ef6</li> <li> \u6046\u9038 DCKA \u8ab2\u7a0b\u9801\u9762</li> </ul> <p>\u5b78\u7fd2\u5efa\u8b70</p> <ol> <li>\u5efa\u8b70\u6309\u7ae0\u7bc0\u9806\u5e8f\u5b78\u7fd2</li> <li>\u6bcf\u500b\u7ae0\u7bc0\u7684 Lab \u5be6\u4f5c\u52d9\u5fc5\u89aa\u81ea\u52d5\u624b\u64cd\u4f5c</li> <li>\u9047\u5230\u554f\u984c\u5148\u67e5\u95b1 FAQ\uff0c\u518d\u53c3\u8003\u7591\u96e3\u6392\u89e3\u6307\u5357</li> <li>\u5584\u7528\u6307\u4ee4\u901f\u67e5\u8868\u52a0\u901f\u5b78\u7fd2</li> </ol>"},{"location":"lab01_environment_setup/","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#lab-01-lab","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5b89\u88dd\u4e26\u8a2d\u5b9a VMware Workstation</li> <li> \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def\uff08Virtual Network Editor\uff09</li> <li> \u555f\u52d5\u4e26\u9a57\u8b49\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u6e96\u5099\u597d Windows \u4e3b\u6a5f\uff08\u5efa\u8b70 16GB+ RAM\uff09</li> <li>\u4e0b\u8f09 DCKA \u8ab2\u7a0b\u865b\u64ec\u6a5f\u6620\u50cf\u6a94</li> <li>\u4e0b\u8f09 VMware Workstation \u5b89\u88dd\u7a0b\u5f0f</li> </ul>"},{"location":"lab01_environment_setup/#01-vmware-workstation","title":"0.1 \u5b89\u88dd VMware Workstation","text":""},{"location":"lab01_environment_setup/#_3","title":"\u53d6\u5f97\u5b89\u88dd\u7a0b\u5f0f","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u7684 VMware Workstation 17.6.4 \u5b89\u88dd\u6a94\u6848\u4f4d\u65bc\uff1a</p> <pre><code>C:\\DCKA-v8 (C:)\\VMware\\VMwareWorkstation_17.6.4\\\n</code></pre> <p></p> <p>\u8cc7\u6599\u593e\u5167\u5305\u542b\uff1a</p> \u6a94\u6848 \u8aaa\u660e <code>VMware-workstation-full-17.6.4-2483....exe</code> VMware Workstation \u5b89\u88dd\u7a0b\u5f0f <code>md5sum.txt</code> MD5 \u6821\u9a57\u78bc <code>md5sum.png</code> \u6821\u9a57\u78bc\u622a\u5716"},{"location":"lab01_environment_setup/#_4","title":"\u5b89\u88dd\u6b65\u9a5f","text":"<ol> <li>\u57f7\u884c <code>VMware-workstation-full-17.6.4-2483....exe</code></li> <li>\u4f9d\u7167\u5b89\u88dd\u7cbe\u9748\u5b8c\u6210\u5b89\u88dd</li> <li>\u5b89\u88dd\u5b8c\u6210\u5f8c\u91cd\u65b0\u555f\u52d5\u96fb\u8166</li> </ol> <p>\u5b89\u88dd\u63d0\u793a</p> <p>\u5b89\u88dd\u904e\u7a0b\u4e2d\u5efa\u8b70\u9078\u64c7\u300c\u5178\u578b\u5b89\u88dd\u300d\uff0c\u4f7f\u7528\u9810\u8a2d\u8a2d\u5b9a\u5373\u53ef\u3002</p>"},{"location":"lab01_environment_setup/#02","title":"0.2 \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def","text":""},{"location":"lab01_environment_setup/#virtual-network-editor","title":"\u958b\u555f Virtual Network Editor","text":"<ol> <li>\u958b\u555f VMware Workstation</li> <li>\u9078\u64c7 Edit \u2192 Virtual Network Editor</li> <li>\u9ede\u9078 Change Settings \u53d6\u5f97\u7ba1\u7406\u54e1\u6b0a\u9650</li> </ol>"},{"location":"lab01_environment_setup/#vmnet8-nat","title":"\u8a2d\u5b9a VMnet8 (NAT)","text":"<p>\u9078\u64c7 VMnet8\uff08NAT \u6a21\u5f0f\uff09\uff0c\u9032\u884c\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p>"},{"location":"lab01_environment_setup/#1-subnet-ip","title":"\u6b65\u9a5f 1\uff1a\u8a2d\u5b9a Subnet IP","text":"<p>\u5c07 Subnet IP \u4fee\u6539\u70ba\uff1a</p> <pre><code>192.168.66.0\n</code></pre>"},{"location":"lab01_environment_setup/#2-nat-settings","title":"\u6b65\u9a5f 2\uff1a\u8a2d\u5b9a NAT Settings","text":"<p>\u9ede\u9078 NAT Settings...\uff0c\u5c07 Gateway IP \u8a2d\u5b9a\u70ba\uff1a</p> <pre><code>192.168.66.2\n</code></pre>"},{"location":"lab01_environment_setup/#3-dhcp-settings","title":"\u6b65\u9a5f 3\uff1a\u8a2d\u5b9a DHCP Settings","text":"<p>\u9ede\u9078 DHCP Settings...\uff0c\u78ba\u8a8d\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p> \u8a2d\u5b9a\u9805\u76ee \u503c Starting IP address <code>192.168.66.128</code> Ending IP address <code>192.168.66.254</code> <p>\u91cd\u8981</p> <p>\u8acb\u78ba\u4fdd Subnet IP \u70ba <code>192.168.66.0</code>\uff0cGateway \u70ba <code>192.168.66.2</code>\uff0c\u5426\u5247\u5f8c\u7e8c\u5be6\u4f5c\u53ef\u80fd\u7121\u6cd5\u6b63\u5e38\u9023\u7dda\u3002</p> <p>\u9ede\u9078 OK \u5132\u5b58\u8a2d\u5b9a\u3002</p>"},{"location":"lab01_environment_setup/#03","title":"0.3 \u7db2\u8def\u62d3\u6a38\u8207\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#_5","title":"\u7db2\u8def\u67b6\u69cb","text":"<p>\u8ab2\u7a0b\u74b0\u5883\u4f7f\u7528 VMware Workstation \u7684 NAT \u7db2\u8def\uff08VMnet8\uff09\uff0c\u7db2\u6bb5\u70ba <code>192.168.66.0/24</code>\uff1a</p> <p></p> <pre><code>graph TB\n    subgraph \"\u5916\u90e8\u7db2\u8def\"\n        Internet((Internet))\n        ExtNet[10.0.1.0/24]\n    end\n\n    subgraph \"VMware NAT Gateway\"\n        NAT[\".254\"]\n    end\n\n    subgraph \"VMnet8 - 192.168.66.0/24\"\n        Host[\".xxx&lt;br/&gt;VMware Workstation\"]\n        D1[\"docker1&lt;br/&gt;.51\"]\n        D2[\"docker2&lt;br/&gt;.52\"]\n        KS[\"k8s-standalone&lt;br/&gt;.61\"]\n        KM[\"k8s-master1&lt;br/&gt;.71\"]\n        KN1[\"k8s-node1&lt;br/&gt;.81\"]\n        KN2[\"k8s-node2&lt;br/&gt;.82\"]\n    end\n\n    Internet --&gt; ExtNet --&gt; NAT\n    NAT --&gt; Host\n    Host --&gt; D1\n    Host --&gt; D2\n    Host --&gt; KS\n    Host --&gt; KM\n    Host --&gt; KN1\n    Host --&gt; KN2</code></pre>"},{"location":"lab01_environment_setup/#ip","title":"\u865b\u64ec\u6a5f\u6e05\u55ae\u8207 IP \u914d\u7f6e","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u516d\u53f0\u5df2\u9810\u5148\u8a2d\u5b9a\u597d\u7684 Rocky Linux 9 \u865b\u64ec\u6a5f\uff1a</p> <p></p> \u865b\u64ec\u6a5f\u540d\u7a31 IP \u4f4d\u5740 \u7528\u9014 <code>docker1</code> 192.168.66.51 Docker \u5be6\u4f5c\u4e3b\u6a5f 1 <code>docker2</code> 192.168.66.52 Docker \u5be6\u4f5c\u4e3b\u6a5f 2 <code>k8s-standalone</code> 192.168.66.61 \u7368\u7acb Kubernetes \u74b0\u5883\uff08\u55ae\u7bc0\u9ede\uff09 <code>k8s-master1</code> 192.168.66.71 Kubernetes Master\uff08\u63a7\u5236\u5e73\u9762\uff09\u7bc0\u9ede <code>k8s-node1</code> 192.168.66.81 Kubernetes Worker \u7bc0\u9ede 1 <code>k8s-node2</code> 192.168.66.82 Kubernetes Worker \u7bc0\u9ede 2 <code>mirror</code> - \u672c\u5730 Mirror \u4f3a\u670d\u5668\uff08\u5957\u4ef6\u5eab\u6620\u5c04\uff09 <p>IP \u914d\u7f6e\u898f\u5247</p> <ul> <li>Docker \u74b0\u5883\uff1a192.168.66.5x</li> <li>K8s Standalone\uff1a192.168.66.6x</li> <li>K8s Master\uff1a192.168.66.7x</li> <li>K8s Worker\uff1a192.168.66.8x</li> <li>NAT Gateway\uff1a192.168.66.254</li> </ul>"},{"location":"lab01_environment_setup/#_6","title":"\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#1","title":"\u65b9\u6cd5 1\uff1a\u4f7f\u7528\u6279\u6b21\u6a94\uff08\u63a8\u85a6\uff09","text":"<p>\u57f7\u884c <code>PowerON-allVM.bat</code> \u4e00\u6b21\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f\uff1a</p> PowerON-allVM.bat<pre><code>\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n</code></pre> <p>\u6279\u6b21\u6a94\u4f7f\u7528\u8aaa\u660e</p> <ul> <li>\u6b64\u6279\u6b21\u6a94\u4f7f\u7528 VMware \u7684 <code>vmrun</code> \u547d\u4ee4\u5217\u5de5\u5177</li> <li><code>-T ws</code> \u6307\u5b9a\u4f7f\u7528 VMware Workstation</li> <li><code>start</code> \u53c3\u6578\u8868\u793a\u555f\u52d5\u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#2","title":"\u65b9\u6cd5 2\uff1a\u624b\u52d5\u555f\u52d5","text":"<ol> <li>\u5728 VMware Workstation \u4e2d\u4f9d\u5e8f\u958b\u555f\u6bcf\u53f0\u865b\u64ec\u6a5f\u7684 <code>.vmx</code> \u6a94\u6848</li> <li>\u9ede\u9078 Power on this virtual machine</li> </ol>"},{"location":"lab01_environment_setup/#_7","title":"\u95dc\u9589\u6240\u6709\u865b\u64ec\u6a5f","text":"<p>\u8ab2\u7a0b\u7d50\u675f\u5f8c\uff0c\u53ef\u4f7f\u7528 <code>Shutdown-allVM.bat</code> \u4e00\u6b21\u95dc\u9589\u6240\u6709\u865b\u64ec\u6a5f\uff1a</p> Shutdown-allVM.bat<pre><code>\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n</code></pre> <p>\u6b63\u78ba\u95dc\u6a5f</p> <p>\u4f7f\u7528 <code>stop</code> \u547d\u4ee4\u6703\u57f7\u884c\u6b63\u5e38\u95dc\u6a5f\u7a0b\u5e8f\uff08\u76f8\u7576\u65bc\u6309\u4e0b\u96fb\u6e90\u6309\u9215\uff09\u3002\u5982\u9700\u5f37\u5236\u95dc\u6a5f\uff0c\u53ef\u6539\u7528 <code>stop hard</code> \u53c3\u6578\uff0c\u4f46\u4e0d\u5efa\u8b70\u7d93\u5e38\u4f7f\u7528\u3002</p>"},{"location":"lab01_environment_setup/#_8","title":"\u9a57\u8b49\u865b\u64ec\u6a5f\u72c0\u614b","text":"<p>\u555f\u52d5\u5b8c\u6210\u5f8c\uff0c\u61c9\u8a72\u53ef\u4ee5\u770b\u5230\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u5728\u904b\u884c\u4e2d\uff0c\u4e26\u986f\u793a Rocky Linux \u767b\u5165\u756b\u9762\uff1a</p> <p></p>"},{"location":"lab01_environment_setup/#_9","title":"\u767b\u5165\u8cc7\u8a0a","text":"\u5e33\u865f \u5bc6\u78bc <code>root</code> <code>container</code> <p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210</p> <p>\u7576\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u6210\u529f\u555f\u52d5\u4e26\u53ef\u4ee5\u767b\u5165\u5f8c\uff0c\u5373\u53ef\u958b\u59cb\u9032\u884c Docker \u8207 Kubernetes \u5be6\u4f5c\u7df4\u7fd2\u3002</p>"},{"location":"lab01_environment_setup/#04-mirror","title":"0.4 Mirror \u4f3a\u670d\u5668","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u672c\u5730 Mirror \u4f3a\u670d\u5668\uff0c\u52a0\u901f\u5957\u4ef6\u4e0b\u8f09\u4e26\u652f\u63f4\u96e2\u7dda\u74b0\u5883\u3002</p>"},{"location":"lab01_environment_setup/#mirror","title":"Mirror \u7db2\u5740","text":"\u7db2\u8def\u74b0\u5883 \u7db2\u5740 \u5167\u90e8\u7db2\u8def\uff08VMnet8\uff09 <code>http://192.168.66.248/k8s/</code> \u5916\u90e8\u7db2\u8def\uff08\u6559\u5ba4\u7db2\u8def\uff09 <code>http://10.0.1.249/k8s/</code>"},{"location":"lab01_environment_setup/#mirror_1","title":"Mirror \u8cc7\u6e90\u5167\u5bb9","text":"\u8cc7\u6599\u593e/\u6a94\u6848 \u7528\u9014 <code>248.repo</code> YUM/DNF \u5957\u4ef6\u5eab\u8a2d\u5b9a\u6a94 <code>ContainerImages/</code> Docker/Container \u6620\u50cf\u6a94 <code>Packages/</code> RPM \u5957\u4ef6 <code>command.txt</code> \u6307\u4ee4\u53c3\u8003 <code>docs/</code> \u8ab2\u7a0b\u6587\u4ef6 <code>scripts/</code> \u81ea\u52d5\u5316\u8173\u672c <code>yaml/</code> Kubernetes YAML \u8a2d\u5b9a\u6a94 <code>VMwareWorkstation_17.6.4/</code> VMware \u5b89\u88dd\u7a0b\u5f0f\uff08\u5916\u90e8\u7db2\u8def\uff09 <p>\u70ba\u4ec0\u9ebc\u9700\u8981 Mirror\uff1f</p> <ul> <li>\u52a0\u901f\u4e0b\u8f09\uff1a\u5f9e\u672c\u5730\u4f3a\u670d\u5668\u4e0b\u8f09\u6bd4\u7db2\u969b\u7db2\u8def\u5feb\u5f88\u591a</li> <li>\u96e2\u7dda\u74b0\u5883\uff1a\u6559\u5ba4\u53ef\u80fd\u6c92\u6709\u5c0d\u5916\u7db2\u8def</li> <li>\u7248\u672c\u4e00\u81f4\uff1a\u78ba\u4fdd\u6240\u6709\u5b78\u54e1\u4f7f\u7528\u76f8\u540c\u7248\u672c\u7684\u5957\u4ef6\u3002</li> </ul>"},{"location":"lab01_environment_setup/#_10","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u865b\u64ec\u6a5f\u7121\u6cd5\u958b\u6a5f\uff0c\u986f\u793a VT-x \u932f\u8aa4 <p>\u539f\u56e0\uff1aBIOS \u672a\u555f\u7528\u865b\u64ec\u5316\u6280\u8853</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u91cd\u65b0\u555f\u52d5\u96fb\u8166\uff0c\u9032\u5165 BIOS \u8a2d\u5b9a 2. \u627e\u5230 Intel VT-x \u6216 AMD-V \u9078\u9805 3. \u5c07\u5176\u8a2d\u5b9a\u70ba Enabled 4. \u5132\u5b58\u4e26\u91cd\u65b0\u555f\u52d5</p> Q2\uff1a\u7db2\u8def\u7121\u6cd5\u9023\u7dda <p>\u539f\u56e0\uff1aVirtual Network Editor \u8a2d\u5b9a\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d VMnet8 \u7684 Subnet IP \u70ba <code>192.168.66.0</code> 2. \u78ba\u8a8d Gateway IP \u70ba <code>192.168.66.2</code> 3. \u78ba\u8a8d\u865b\u64ec\u6a5f\u7db2\u8def\u4ecb\u9762\u8a2d\u5b9a\u70ba NAT \u6a21\u5f0f</p> Q3\uff1a\u8a18\u61b6\u9ad4\u4e0d\u8db3 <p>\u539f\u56e0\uff1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e0d\u8db3\u4ee5\u904b\u884c\u6240\u6709\u865b\u64ec\u6a5f</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a - \u4f9d\u5e8f\u555f\u52d5\u9700\u8981\u7684\u865b\u64ec\u6a5f\uff0c\u4e0d\u8981\u4e00\u6b21\u5168\u90e8\u555f\u52d5 - \u6216\u5347\u7d1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u81f3 16GB \u4ee5\u4e0a</p>"},{"location":"lab01_environment_setup/#_11","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 VMware \u5b89\u88dd\uff1a\u5b89\u88dd VMware Workstation 17.6.4</li> <li>\u2705 \u7db2\u8def\u8a2d\u5b9a\uff1aVMnet8 \u8a2d\u5b9a\u70ba 192.168.66.0/24 \u7db2\u6bb5</li> <li>\u2705 \u865b\u64ec\u6a5f\u555f\u52d5\uff1a\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f\u5168\u90e8\u555f\u52d5</li> <li>\u2705 \u74b0\u5883\u9a57\u8b49\uff1a\u78ba\u8a8d\u53ef\u4ee5\u6b63\u5e38\u767b\u5165\u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_12","title":"\u4e0b\u4e00\u6b65","text":"<p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210\u5f8c\uff0c\u8acb\u7e7c\u7e8c\u524d\u5f80 LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE</p>"},{"location":"lab02_docker_install/","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#lab-02-dockerdocker-ce","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 RHEL/Rocky Linux \u9810\u8a2d <code>docker</code> \u6307\u4ee4\u7684\u884c\u70ba (Podman Emulation)</li> <li> \u79fb\u9664\u9810\u8a2d\u7684 <code>podman-docker</code> \u5957\u4ef6</li> <li> \u8a2d\u5b9a Docker CE \u5b98\u65b9 Repository</li> <li> \u5b89\u88dd\u4e26\u555f\u52d5 Docker CE (Community Edition)</li> <li> \u4f7f\u7528 <code>docker pull</code> \u4e0b\u8f09 Image \u4e26\u5099\u4efd</li> </ul>"},{"location":"lab02_docker_install/#11","title":"1.1 \u6838\u5fc3\u6982\u5ff5\u8207\u6bd4\u8f03","text":"<p>\u5728 RHEL/CentOS 9 \u74b0\u5883\u4e2d\uff0c\u5957\u4ef6\u540d\u7a31\u8207\u80cc\u5f8c\u7684\u6280\u8853\u53ef\u80fd\u6703\u8b93\u4eba\u6df7\u6dc6\u3002\u4ee5\u4e0b\u662f\u4e09\u8005\u7684\u4e3b\u8981\u5dee\u7570\uff1a</p> \u9805\u76ee docker (Red Hat \u5957\u4ef6) docker-ce (Docker Inc. \u5957\u4ef6) podman \u4f86\u6e90 Red Hat \u5b98\u65b9 Repository Docker \u5b98\u65b9 Repository Red Hat \u5b98\u65b9 Repository \u672c\u8cea \u5176\u5be6\u662f podman-docker \u539f\u751f Docker Engine \u4e0b\u4e00\u4ee3\u5bb9\u5668\u5de5\u5177 \u5b88\u8b77\u884c\u7a0b (Daemon) \u7121 (Daemonless) dockerd (\u5fc5\u9808\u555f\u52d5\u670d\u52d9) \u7121 (Daemonless) \u67b6\u69cb \u6a21\u64ec Docker CLI \u6307\u4ee4 Client-Server \u67b6\u69cb Fork/Exec \u6a21\u578b Root \u6b0a\u9650 \u652f\u63f4 Rootless \u9810\u8a2d\u9700\u8981 Root (Rootless \u9700\u8a2d\u5b9a) \u539f\u751f\u652f\u63f4 Rootless \u6307\u4ee4\u76f8\u5bb9\u6027 \u9ad8\u5ea6\u76f8\u5bb9 \u539f\u751f\u6307\u4ee4 \u9ad8\u5ea6\u76f8\u5bb9 Docker <p>\u70ba\u4ec0\u9ebc <code>dnf install docker</code> \u88dd\u7684\u662f Podman\uff1f</p> <p>Red Hat \u70ba\u4e86\u63a8\u5ee3\u81ea\u5df1\u7684\u5bb9\u5668\u6280\u8853 (Podman/Buildah/Skopeo)\uff0c\u5728 RHEL 8/9 \u7684\u5957\u4ef6\u5eab\u4e2d\uff0c\u5c07 <code>docker</code> \u5957\u4ef6\u6307\u5411\u4e86 <code>podman-docker</code>\u3002\u9019\u500b\u5957\u4ef6\u4e3b\u8981\u63d0\u4f9b\u4e00\u500b shell script\uff0c\u5c07 <code>docker</code> \u6307\u4ee4\u8f49\u5c0e\u7d66 <code>podman</code> \u57f7\u884c\u3002</p> <p>\u82e5\u4f60\u7fd2\u6163\u4f7f\u7528\u539f\u672c\u7684 Docker Daemon (\u4f8b\u5982\u9700\u8981\u8207\u820a\u6709\u7684 Docker Compose \u6d41\u7a0b\u6574\u5408)\uff0c\u5247\u5fc5\u9808\u79fb\u9664\u6b64\u5957\u4ef6\uff0c\u4e26\u5b89\u88dd <code>docker-ce</code>\u3002</p>"},{"location":"lab02_docker_install/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab02_docker_install/#1-docker-podman","title":"\u6b65\u9a5f 1\uff1a\u89c0\u5bdf\u9810\u8a2d\u7684 Docker \u5957\u4ef6 (Podman)","text":"<p>\u5728 RHEL 9 / Rocky Linux 9 \u4e2d\uff0c\u5b98\u65b9\u9810\u8a2d\u7684 <code>docker</code> \u6307\u4ee4\u5176\u5be6\u662f <code>podman</code> \u7684\u6a21\u64ec\u5668\u3002</p> <ol> <li> <p>\u5b89\u88dd\u9810\u8a2d docker \u5957\u4ef6 </p><pre><code>dnf install docker -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>dnf</code>: (Dandified YUM) \u662f RHEL 8/9 \u8207 Rocky Linux \u7684\u9810\u8a2d\u5957\u4ef6\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4f86\u53d6\u4ee3\u820a\u7684 <code>yum</code>\u3002     &gt; - <code>install</code>: \u5b89\u88dd\u5957\u4ef6\u3002     &gt; - <code>-y</code>: \u81ea\u52d5\u56de\u7b54 \"Yes\" \u78ba\u8a8d\u5b89\u88dd\uff0c\u4e0d\u9700\u4eba\u5de5\u4ecb\u5165\u3002<p></p> <p></p> </li> <li> <p>\u6aa2\u67e5 docker \u6307\u4ee4\u4f86\u6e90 </p><pre><code>ls -l /usr/bin/docker\nfile /usr/bin/docker\ncat /usr/bin/docker\n</code></pre>     &gt; \u4f60\u6703\u767c\u73fe <code>/usr/bin/docker</code> \u5176\u5be6\u662f\u4e00\u500b Shell Script\uff0c\u5167\u5bb9\u662f\u57f7\u884c <code>/usr/bin/podman</code>\u3002     &gt; <pre><code>exec /usr/bin/podman \"$@\"\n</code></pre><p></p> </li> <li> <p>\u5617\u8a66\u555f\u52d5 Docker \u670d\u52d9 </p><pre><code>systemctl start docker\n</code></pre>     &gt; \u274c \u5931\u6557\uff1a\u56e0\u70ba\u6839\u672c\u6c92\u6709\u5b89\u88dd\u771f\u6b63\u7684 Docker Daemon\uff0c\u986f\u793a <code>Unit docker.service not found</code>\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c </p><pre><code>docker version\n</code></pre>     &gt; \u8f38\u51fa\u986f\u793a <code>Client: Podman Engine</code>\uff0c\u4e26\u63d0\u793a <code>Emulate Docker CLI using podman</code>\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#2-podman-docker-docker-ce","title":"\u6b65\u9a5f 2\uff1a\u79fb\u9664 Podman-Docker \u4e26\u5b89\u88dd Docker CE","text":"<p>\u70ba\u4e86\u4f7f\u7528\u539f\u751f\u7684 Docker Engine\uff0c\u6211\u5011\u9700\u8981\u79fb\u9664\u6a21\u64ec\u5957\u4ef6\u4e26\u5b89\u88dd\u5b98\u65b9\u7248\u672c\u3002</p> <ol> <li> <p>\u79fb\u9664\u9810\u8a2d\u5957\u4ef6 </p><pre><code>dnf remove docker -y\n</code></pre>     &gt; \u9019\u6703\u79fb\u9664 <code>podman-docker</code> \u5957\u4ef6\u3002<p></p> </li> <li> <p>\u65b0\u589e Docker CE Repository </p><pre><code>dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>config-manager</code>: <code>dnf</code> \u7684\u5916\u639b\u6a21\u7d44\uff0c\u7528\u65bc\u7ba1\u7406\u8a2d\u5b9a\u3002     &gt; - <code>--add-repo</code>: \u65b0\u589e\u4e00\u500b\u5916\u90e8\u7684\u5957\u4ef6\u4f86\u6e90 (Repository)\u3002\u9019\u88e1\u6211\u5011\u6307\u5411 Docker \u5b98\u65b9\u70ba CentOS \u7dad\u8b77\u7684 Repo\u3002<p></p> <p>\u9a57\u8b49 Repo \u662f\u5426\u52a0\u5165\u6210\u529f\uff1a </p><pre><code>cat /etc/yum.repos.d/docker-ce.repo\n</code></pre><p></p> </li> <li> <p>\u5b89\u88dd Docker CE </p><pre><code>dnf install docker-ce -y\n</code></pre>     &gt; \u5b89\u88dd\u904e\u7a0b\u4e2d\u6703\u4e0b\u8f09 <code>docker-ce</code> (Daemon), <code>docker-ce-cli</code> (\u6307\u4ee4\u5de5\u5177), <code>containerd.io</code> (Runtime) \u7b49\u5957\u4ef6\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#3-docker","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 Docker \u670d\u52d9","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u771f\u6b63\u7684 Docker Daemon (<code>dockerd</code>) \u5c31\u5df2\u7d93\u5c31\u7dd2\u4e86\u3002</p> <ol> <li> <p>\u555f\u52d5\u4e26\u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5 </p><pre><code>systemctl start docker\nsystemctl enable docker\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - <code>systemctl</code>: \u7528\u65bc\u7ba1\u7406\u7cfb\u7d71\u670d\u52d9 (Systemd)\u3002     &gt; - <code>start</code>: \u7acb\u5373\u555f\u52d5\u670d\u52d9\u3002     &gt; - <code>enable</code>: \u8a2d\u5b9a\u670d\u52d9\u5728\u958b\u6a5f\u6642\u81ea\u52d5\u555f\u52d5\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u670d\u52d9\u72c0\u614b </p><pre><code>systemctl status docker\n</code></pre>     &gt; \u2705 \u61c9\u986f\u793a <code>Active: active (running)</code>\u3002<p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c </p><pre><code>docker version\n</code></pre>     &gt; \u73fe\u5728\u61c9\u8a72\u986f\u793a <code>Client: Docker Engine - Community</code> \u548c <code>Server: Docker Engine - Community</code>\u3002<p></p> </li> </ol>"},{"location":"lab02_docker_install/#4-container-image","title":"\u6b65\u9a5f 4\uff1a\u4e0b\u8f09\u8207\u7ba1\u7406 Container Image","text":"<ol> <li> <p>\u4e0b\u8f09\u6620\u50cf\u6a94 </p><pre><code>docker pull rockylinux:9\n</code></pre><p></p> </li> <li> <p>\u67e5\u770b\u6620\u50cf\u6a94\u5217\u8868 </p><pre><code>docker images\n</code></pre><p></p> </li> <li> <p>\u67e5\u770b\u6620\u50cf\u6a94\u6b77\u53f2 </p><pre><code>docker history rockylinux:9\n</code></pre><p></p> </li> <li> <p>\u5099\u4efd\u6620\u50cf\u6a94 (Docker Save)     \u5c07\u6620\u50cf\u6a94\u532f\u51fa\u70ba tar \u6a94\u6848\u3002     </p><pre><code>docker save --output=/root/rockylinux-9.tar rockylinux:9\nls -lh /root/rockylinux-9.tar\n</code></pre><p></p> </li> </ol>"},{"location":"lab02_docker_install/#_3","title":"\u5c0f\u7d50","text":"<p>\u5728\u672c Lab \u4e2d\uff0c\u6211\u5011\u767c\u73fe Linux \u767c\u884c\u7248\u53ef\u80fd\u6703\u7528 Podman \u4f86\u6a21\u64ec Docker\u3002\u82e5\u8981\u4f7f\u7528\u6a19\u6e96 Docker Engine\uff0c\u5fc5\u9808\u624b\u52d5\u8a2d\u5b9a Docker \u5b98\u65b9 Repository \u4e26\u5b89\u88dd <code>docker-ce</code>\u3002</p>"},{"location":"lab03_podman/","title":"LAB 03 \u5b89\u88dd podman","text":""},{"location":"lab03_podman/#lab-03-podman","title":"LAB 03 \u5b89\u88dd Podman","text":""},{"location":"lab03_podman/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Podman \u7684\u6838\u5fc3\u67b6\u69cb (Daemonless &amp; Rootless)</li> <li> \u5728 Linux \u4e0a\u5b89\u88dd Podman</li> <li> \u9a57\u8b49 Podman \u7121\u9700\u5b88\u8b77\u884c\u7a0b (Daemon) \u5373\u53ef\u904b\u4f5c</li> <li> \u8655\u7406 Image Registry \u641c\u5c0b\u9806\u5e8f\u8207\u9a57\u8b49\u554f\u984c</li> </ul>"},{"location":"lab03_podman/#11-podman","title":"1.1 Podman \u7c21\u4ecb","text":"<p>Podman (Pod Manager) \u662f\u4e00\u500b\u7531 Red Hat \u958b\u767c\u7684\u958b\u6e90\u5bb9\u5668\u5f15\u64ce\uff0c\u7528\u65bc\u5728 Linux \u7cfb\u7d71\u4e0a\u958b\u767c\u3001\u7ba1\u7406\u548c\u57f7\u884c OCI (Open Container Initiative) \u5bb9\u5668\u3002</p> <ul> <li>\u5b98\u65b9\u7db2\u7ad9\uff1ahttps://podman.io/</li> <li>\u6700\u65b0\u6587\u4ef6\uff1aPodman Documentation</li> </ul>"},{"location":"lab03_podman/#podman-docker","title":"Podman \u8207 Docker \u7684\u95dc\u9375\u5dee\u7570","text":"\u7279\u6027 Docker Podman \u67b6\u69cb Client-Server (\u4f9d\u8cf4 dockerd \u5b88\u8b77\u884c\u7a0b) Daemonless (\u76f4\u63a5 Fork/Exec \u7a0b\u5e8f) \u57f7\u884c\u6b0a\u9650 \u9810\u8a2d\u9700\u8981 Root \u539f\u751f\u652f\u63f4 Rootless (\u4e00\u822c\u4f7f\u7528\u8005\u53ef\u57f7\u884c) Pod \u652f\u63f4 \u9700\u900f\u904e Docker Compose \u6216 K8S \u539f\u751f\u652f\u63f4 Pod (\u53ef\u5728\u4e00\u500b Pod \u8dd1\u591a\u500b\u5bb9\u5668) \u670d\u52d9\u76f8\u4f9d \u82e5 Daemon \u639b\u6389\uff0c\u6240\u6709\u5bb9\u5668\u90fd\u53d7\u5f71\u97ff \u5bb9\u5668\u662f\u7368\u7acb\u7a0b\u5e8f\uff0c\u4e92\u4e0d\u5f71\u97ff Systemd \u6574\u5408\u8f03\u5f31 \u539f\u751f\u6574\u5408\uff0c\u5bb9\u6613\u5c07\u5bb9\u5668\u4f5c\u6210\u7cfb\u7d71\u670d\u52d9 <p>Podman \u7684\u8a2d\u8a08\u7406\u5ff5</p> <p>\"Alias docker=podman\" \u2014\u2014 Podman \u7684 CLI \u6307\u4ee4\u8207 Docker \u9ad8\u5ea6\u76f8\u5bb9\uff0c\u7d55\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u628a <code>docker</code> \u6307\u4ee4\u63db\u6210 <code>podman</code> \u57f7\u884c\u3002</p>"},{"location":"lab03_podman/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab03_podman/#1-podman","title":"\u6b65\u9a5f 1\uff1a\u5b89\u88dd Podman \u5957\u4ef6","text":"<p>\u5728 RHEL 9 / Rocky Linux 9 \u4e2d\uff0cPodman \u901a\u5e38\u5df2\u7d93\u9810\u88dd\u3002\u5982\u679c\u6c92\u6709\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>dnf</code> \u5b89\u88dd\u3002</p> <ol> <li> <p>\u5b89\u88dd Podman </p><pre><code>dnf install podman -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a     &gt; - \u5957\u4ef6\u540d\u7a31\u5c31\u662f <code>podman</code>\uff0c\u4e0d\u9700\u8981\u50cf Docker \u9084\u8981\u53bb\u627e <code>docker-ce</code>\u3002     &gt; - \u5982\u679c\u7cfb\u7d71\u986f\u793a <code>Nothing to do</code>\uff0c\u8868\u793a\u5df2\u7d93\u5b89\u88dd\u904e\u4e86\u3002<p></p> <p></p> </li> <li> <p>\u6aa2\u67e5\u7248\u672c\u8207\u74b0\u5883\u8cc7\u8a0a </p><pre><code>podman version\npodman info\n</code></pre>     &gt; - <code>podman version</code>: \u986f\u793a Client/Server \u7248\u672c\uff08\u6ce8\u610f\uff1aPodman \u7684 Client \u548c Server \u901a\u5e38\u662f\u540c\u4e00\u500b binary\uff0c\u9664\u975e\u662f\u9060\u7aef\u64cd\u4f5c\uff09\u3002     &gt; - <code>podman info</code>: \u986f\u793a\u8a73\u7d30\u7684\u7cfb\u7d71\u8a2d\u5b9a\uff0c\u5305\u62ec Storage Driver (\u901a\u5e38\u662f overlay)\u3001cgroup version (v2) \u4ee5\u53ca\u9810\u8a2d\u7684 Registry\u3002<p></p> </li> </ol>"},{"location":"lab03_podman/#2-daemonless","title":"\u6b65\u9a5f 2\uff1a\u9a57\u8b49 Daemonless \u67b6\u69cb\uff08\u7121\u9700\u555f\u52d5\u670d\u52d9\uff09","text":"<p>\u9019\u662f Podman \u6700\u7279\u5225\u7684\u5730\u65b9\uff1a\u4f60\u4e0d\u9700\u8981\u555f\u52d5\u4efb\u4f55\u670d\u52d9\u3002</p> <ol> <li> <p>\u5617\u8a66\u5c0b\u627e podman \u670d\u52d9     \u5728\u4f60\u5b89\u88dd\u5b8c Docker \u6642\uff0c\u901a\u5e38\u4e0b\u4e00\u6b65\u662f <code>systemctl start docker</code>\u3002\u4f46\u5728 Podman\uff1a</p> <p>\u4f60**\u4e0d\u9700\u8981**\u57f7\u884c <code>systemctl start podman</code>\u3002</p> <p>Podman \u662f\u4e00\u500b\u55ae\u7d14\u7684 binary\u57f7\u884c\u6a94\u3002\u7576\u4f60\u57f7\u884c <code>podman run</code> \u6642\uff0c\u5b83\u6703\u76f4\u63a5\u5728\u7576\u524d\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u4e0b\u7522\u751f\u5bb9\u5668\u7a0b\u5e8f\u3002</p> </li> <li> <p>\u70ba\u4ec0\u9ebc\u6703\u6709 <code>podman.socket</code>\uff1f     \u5982\u679c\u4f60\u6aa2\u67e5 systemd\uff0c\u53ef\u80fd\u6703\u770b\u5230 <code>podman.socket</code> \u6216 <code>podman.service</code>\u3002\u9019\u4e3b\u8981\u662f\u70ba\u4e86\u63d0\u4f9b API \u7d66\u9060\u7aef\u5de5\u5177\uff08\u5982 Docker Compose \u6216 IDE\uff09\u9023\u7dda\u4f7f\u7528\uff0c\u5c0d\u65bc\u672c\u5730 CLI \u64cd\u4f5c\u4e26\u975e\u5fc5\u8981\u3002</p> </li> </ol>"},{"location":"lab03_podman/#3-podman-container-image","title":"\u6b65\u9a5f 3\uff1a\u4f7f\u7528 Podman \u4e0b\u8f09 Container Image","text":"<p>Podman \u9810\u8a2d\u6703\u641c\u5c0b\u591a\u500b Registry\u3002</p> <ol> <li> <p>\u67e5\u770b\u76ee\u524d\u7684 Image </p><pre><code>podman images\n</code></pre><p></p> </li> <li> <p>\u5617\u8a66\u4e0b\u8f09 MySQL Image     \u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a     </p><pre><code>podman pull mysql\n</code></pre><p></p> <p>\u89c0\u5bdf\u8f38\u51fa\u7d50\u679c\uff1a</p> <p>Podman \u6703\u4f9d\u5e8f\u5617\u8a66\u8a2d\u5b9a\u6a94 (<code>/etc/containers/registries.conf</code>) \u4e2d\u5b9a\u7fa9\u7684 Registry\uff1a</p> <ol> <li> <p>\u274c <code>registry.access.redhat.com/mysql:latest</code>     &gt; <code>name unknown: Repo not found</code> (Red Hat \u5b98\u65b9\u5eab\u6c92\u6709\u9019\u500b Image)</p> </li> <li> <p>\u274c <code>registry.redhat.io/mysql:latest</code>     &gt; <code>unauthorized: Please login</code> (\u9700\u8981 Red Hat \u8a02\u95b1\u5e33\u865f\u624d\u80fd\u5b58\u53d6)</p> </li> <li> <p>\u2705 <code>docker.io/library/mysql:latest</code>     &gt; \u6210\u529f\u5f9e Docker Hub \u4e0b\u8f09\u3002</p> </li> </ol> </li> <li> <p>\u9a57\u8b49\u4e0b\u8f09\u7d50\u679c </p><pre><code>podman images\n</code></pre>     &gt; \u61c9\u8a72\u6703\u770b\u5230\u4f86\u81ea <code>docker.io/library/mysql</code> \u7684 Image\u3002<p></p> </li> </ol> <p>Registry \u641c\u5c0b\u9806\u5e8f\u4e26\u975e\u96a8\u6a5f</p> <p>RHEL/CentOS \u9810\u8a2d\u7684 <code>/etc/containers/registries.conf</code> \u6a94\u6848\u5b9a\u7fa9\u4e86\u641c\u5c0b\u9806\u5e8f (Search Registries)\u3002\u9019\u5c31\u662f\u70ba\u4ec0\u9ebc Podman \u6703\u5148\u53bb\u554f Red Hat\uff0c\u6700\u5f8c\u624d\u554f Docker Hub\u3002 \u800c Docker CE \u9810\u8a2d\u53ea\u6703\u627e Docker Hub (<code>docker.io</code>)\u3002</p>"},{"location":"lab04_docker_hub_rate_limit/","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#lab-04-docker-hub-rate-limiting","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c Lab \u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Docker Hub \u7684\u4e0b\u8f09\u9650\u5236 (Rate Limiting)</li> <li> \u4f7f\u7528 <code>curl</code> \u8207 <code>jq</code> \u6307\u4ee4\u6aa2\u67e5\u7576\u524d\u7684 Rate Limit \u72c0\u614b</li> <li> \u6bd4\u8f03\u533f\u540d\u4f7f\u7528\u8005\u8207\u514d\u8cbb\u5e33\u865f (Free Account) \u7684\u9650\u5236\u5dee\u7570</li> </ul>"},{"location":"lab04_docker_hub_rate_limit/#11-docker-hub-rate-limiting","title":"1.1 \u4ec0\u9ebc\u662f Docker Hub Rate Limiting\uff1f","text":"<p>Docker Hub \u70ba\u4e86\u9632\u6b62\u8cc7\u6e90\u6feb\u7528\uff0c\u5c0d Container Image \u7684 <code>pull</code> (\u4e0b\u8f09) \u6b21\u6578\u9032\u884c\u4e86\u9650\u5236\uff1a</p> \u5e33\u865f\u985e\u578b \u9650\u5236\u5167\u5bb9 \u533f\u540d\u4f7f\u7528\u8005 (Anonymous) \u6bcf 6 \u5c0f\u6642 100 \u6b21 pull (\u4ee5 IP \u70ba\u6e96) \u514d\u8cbb\u5e33\u865f (Free Account) \u6bcf 6 \u5c0f\u6642 200 \u6b21 pull (\u4ee5\u5e33\u865f\u70ba\u6e96) Pro / Team / Business 5000 \u6b21 (\u6bcf\u65e5) \u6216 \u7121\u9650\u5236 <p>\u7576\u4f60\u9047\u5230 <code>Before you can look around... 429 Too Many Requests</code> \u932f\u8aa4\u6642\uff0c\u901a\u5e38\u5c31\u662f\u88ab\u9650\u6d41\u4e86\u3002</p>"},{"location":"lab04_docker_hub_rate_limit/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab04_docker_hub_rate_limit/#1-jq","title":"\u6b65\u9a5f 1\uff1a\u5b89\u88dd\u5fc5\u8981\u5de5\u5177 jq","text":"<p>\u70ba\u4e86\u65b9\u4fbf\u89e3\u6790 Docker Hub API \u56de\u50b3\u7684 JSON \u683c\u5f0f Token\uff0c\u6211\u5011\u9700\u8981\u5b89\u88dd <code>jq</code> \u5de5\u5177\u3002</p> <ol> <li> <p>\u5b89\u88dd jq </p><pre><code>yum install jq -y\n</code></pre>     &gt; \u6307\u4ee4\u8aaa\u660e\uff1a<code>jq</code> \u662f\u4e00\u500b\u8f15\u91cf\u7d1a\u4e14\u9748\u6d3b\u7684 command-line JSON \u8655\u7406\u5668\u3002<p></p> <p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#2","title":"\u6b65\u9a5f 2\uff1a\u4e0b\u8f09\u6aa2\u67e5\u8173\u672c","text":"<p>\u6211\u5011\u4f7f\u7528\u4e00\u6bb5 Shell Script \u4f86\u7c21\u5316\u6aa2\u67e5\u6d41\u7a0b\u3002\u9019\u500b Script \u6703\u5411 Docker Hub \u7533\u8acb Token \u4e26\u67e5\u8a62 Header \u8cc7\u8a0a\u3002</p> <ol> <li> <p>\u4e0b\u8f09 Script (\u5047\u8a2d\u8ab2\u5802\u74b0\u5883\u63d0\u4f9b)     </p><pre><code># \u4f7f\u7528 wget \u4e0b\u8f09\u8173\u672c\nwget http://10.0.1.248/k8s/scripts/check_docker_pull_rate_limit.sh\n\n# \u82e5\u4e0a\u8ff0\u9023\u7d50\u7121\u6cd5\u9023\u7dda (Connection refused)\uff0c\u8acb\u5617\u8a66\u5099\u7528\u4f4d\u7f6e\nwget http://10.0.1.249/k8s/scripts/check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u8ce6\u4e88\u57f7\u884c\u6b0a\u9650 </p><pre><code>chmod 755 check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#3-anonymous","title":"\u6b65\u9a5f 3\uff1a\u6aa2\u67e5\u533f\u540d\u4f7f\u7528\u8005\u9650\u5236 (Anonymous)","text":"<ol> <li> <p>\u57f7\u884c Script </p><pre><code>./check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u89c0\u5bdf\u8f38\u51fa\u7d50\u679c </p><pre><code>ratelimit-limit: 100;w=21600\nratelimit-remaining: 58;w=21600\ndocker-ratelimit-source: 118.163.116.129\n</code></pre>     &gt; \u8f38\u51fa\u89e3\u6790\uff1a     &gt; - <code>ratelimit-limit: 100;w=21600</code>: \u9650\u5236\u70ba\u6bcf 21600 \u79d2 (6\u5c0f\u6642) 100 \u6b21\u3002     &gt; - <code>ratelimit-remaining: 58</code>: \u76ee\u524d\u5269\u9918 58 \u6b21\u984d\u5ea6\u3002     &gt; - <code>docker-ratelimit-source</code>: \u8b58\u5225\u4f86\u6e90 IP\u3002<p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#4-free-account","title":"\u6b65\u9a5f 4\uff1a\u6aa2\u67e5\u514d\u8cbb\u5e33\u865f\u9650\u5236 (Free Account)","text":"<p>\u82e5\u8981\u7372\u5f97\u66f4\u9ad8\u7684\u984d\u5ea6\uff0c\u53ef\u4ee5\u767b\u5165 Docker Hub \u5e33\u865f\u3002</p> <ol> <li> <p>\u4fee\u6539 Script \u52a0\u5165\u8a8d\u8b49\u8cc7\u8a0a     \u7de8\u8f2f <code>check_docker_pull_rate_limit.sh</code>\uff0c\u5c07\u4f60\u7684 Docker Hub \u5e33\u865f\u5bc6\u78bc\u586b\u5165\u8b8a\u6578 (\u6216\u662f\u900f\u904e <code>docker login</code> \u5f8c\u4fee\u6539 Script \u4ee5\u4f7f\u7528 Token)\u3002</p> <p>\u5047\u8a2d Script \u652f\u63f4\u4ee5\u8b8a\u6578\u65b9\u5f0f\u5e36\u5165\u5e33\u5bc6\uff1a </p><pre><code># \u7de8\u8f2f\u8173\u672c\u586b\u5165 USER=\"\u4f60\u7684\u5e33\u865f\" PASSWORD=\"\u4f60\u7684\u5bc6\u78bc\"\nvi check_docker_pull_rate_limit.sh\n</code></pre><p></p> <p>\u624b\u52d5\u6aa2\u67e5\u6307\u4ee4 (\u53c3\u8003)</p> <p>\u5982\u679c\u6c92\u6709 Script\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528\u4ee5\u4e0b\u6307\u4ee4\u624b\u52d5\u6aa2\u67e5 (\u8a18\u5f97\u66ff\u63db\u5e33\u5bc6)\uff1a </p><pre><code># 1. \u53d6\u5f97 Token\nTOKEN=$(curl -s -u \"\u4f60\u7684\u5e33\u865f:\u4f60\u7684\u5bc6\u78bc\" \"https://auth.docker.io/token?service=registry.docker.io&amp;scope=repository:ratelimitpreview/test:pull\" | jq -r .token)\n\n# 2. \u67e5\u8a62 Header\ncurl --head -H \"Authorization: Bearer $TOKEN\" https://registry-1.docker.io/v2/ratelimitpreview/test/manifests/latest\n</code></pre><p></p> </li> <li> <p>\u518d\u6b21\u57f7\u884c Script </p><pre><code>./check_docker_pull_rate_limit.sh\n</code></pre><p></p> </li> <li> <p>\u9810\u671f\u7d50\u679c </p><pre><code>ratelimit-limit: 200;w=21600   &lt;-- \u984d\u5ea6\u8b8a\u70ba 200\nratelimit-remaining: 198;w=21600\ndocker-ratelimit-source: [\u4f60\u7684\u5e33\u865fUUID]\n</code></pre>     &gt; \u767b\u5165\u5f8c\uff0c<code>ratelimit-source</code> \u901a\u5e38\u6703\u8b8a\u6210\u4f60\u7684 User ID\uff0c\u4e14\u984d\u5ea6\u6703\u63d0\u5347\u81f3 200 \u6b21\u3002<p></p> </li> </ol>"},{"location":"lab04_docker_hub_rate_limit/#_3","title":"\u5c0f\u7d50","text":"<ul> <li>\u533f\u540d\u4e0b\u8f09\uff1a\u65b9\u4fbf\u4f46\u9650\u5236\u56b4\u683c (100\u6b21/6hr)\uff0c\u591a\u53f0\u6a5f\u5668\u5171\u7528 Public IP \u6642\u5bb9\u6613\u88ab\u9396\u3002</li> <li>\u767b\u5165\u4e0b\u8f09\uff1a\u5efa\u8b70\u5728 Server \u4e0a\u900f\u904e <code>docker login</code> \u767b\u5165\uff0c\u53ef\u5c07\u984d\u5ea6\u63d0\u5347\u81f3 (200\u6b21/6hr)\uff0c\u6216\u8cfc\u8cb7 Pro \u65b9\u6848\u89e3\u9664\u9650\u5236\u3002</li> </ul>"},{"location":"lab05_private_registry/","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#lab-05-private-registry","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5340\u5206 Public Registry \u8207 Private Registry \u7684\u7528\u9014</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u57fa\u672c\u6307\u4ee4\uff08run\u3001exec\u3001logs\u3001inspect \u7b49\uff09</li> <li> \u8a2d\u5b9a Docker \u6301\u4e45\u5316\u5132\u5b58\uff08Volumes \u8207 Bind Mounts\uff09</li> <li> \u7406\u89e3\u4e26\u8a2d\u5b9a Docker \u7db2\u8def</li> <li> \u5f9e Docker Hub \u641c\u5c0b\u3001\u62c9\u53d6\u3001\u63a8\u9001 Image</li> <li> \u5b8c\u6210 WordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72\u5be6\u4f5c</li> </ul>"},{"location":"lab05_private_registry/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210\u7b2c 1 \u7ae0\u7684\u5167\u5bb9</li> <li>Docker \u5df2\u6b63\u78ba\u5b89\u88dd\u4e26\u53ef\u57f7\u884c</li> <li>\u7406\u89e3 Image \u8207 Container \u7684\u95dc\u4fc2</li> </ul>"},{"location":"lab05_private_registry/#21-public-registry-private-registry","title":"2.1 Public Registry \u8207 Private Registry","text":""},{"location":"lab05_private_registry/#registry","title":"\u4ec0\u9ebc\u662f Registry\uff1f","text":"<p>Registry\uff08\u5009\u5eab\uff09\u662f\u7528\u4f86\u5132\u5b58\u548c\u5206\u767c Docker Image \u7684\u670d\u52d9\u3002\u5c31\u50cf GitHub \u5132\u5b58\u7a0b\u5f0f\u78bc\u4e00\u6a23\uff0cRegistry \u5132\u5b58\u5bb9\u5668\u6620\u50cf\u6a94\u3002</p> <pre><code>graph LR\n    Dev[\u958b\u767c\u8005] --&gt;|push| Registry[(Registry)]\n    Registry --&gt;|pull| Server1[\u4f3a\u670d\u5668 1]\n    Registry --&gt;|pull| Server2[\u4f3a\u670d\u5668 2]\n    Registry --&gt;|pull| Server3[\u4f3a\u670d\u5668 3]</code></pre>"},{"location":"lab05_private_registry/#public-registry","title":"Public Registry","text":"<p>\u516c\u958b\u7684 Registry \u670d\u52d9\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5b58\u53d6\u516c\u958b\u7684 Image\u3002</p> Registry \u8aaa\u660e \u7db2\u5740 Docker Hub \u5b98\u65b9\u9810\u8a2d Registry\uff0c\u6700\u5927\u7684\u516c\u958b Image \u5009\u5eab hub.docker.com Quay.io Red Hat \u63d0\u4f9b\u7684 Registry quay.io GitHub Container Registry GitHub \u63d0\u4f9b\u7684\u5bb9\u5668 Registry ghcr.io Google Container Registry Google Cloud \u63d0\u4f9b gcr.io Amazon ECR Public AWS \u63d0\u4f9b\u7684\u516c\u958b Registry public.ecr.aws <p>Docker Hub \u4f7f\u7528\u6280\u5de7</p> <ul> <li>\u5b98\u65b9 Image\uff1a\u6c92\u6709\u524d\u7db4\uff0c\u5982 <code>nginx</code>\u3001<code>mysql</code>\u3001<code>redis</code></li> <li>\u793e\u7fa4 Image\uff1a\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff0c\u5982 <code>bitnami/nginx</code></li> <li>\u6a19\u7c64\uff1a\u6307\u5b9a\u7248\u672c\uff0c\u5982 <code>nginx:1.25</code>\u3001<code>nginx:alpine</code></li> </ul>"},{"location":"lab05_private_registry/#private-registry","title":"Private Registry","text":"<p>\u79c1\u6709 Registry \u7528\u65bc\u5132\u5b58\u4f01\u696d\u5167\u90e8\u7684 Image\uff0c\u4e0d\u5c0d\u5916\u516c\u958b\u3002</p>"},{"location":"lab05_private_registry/#registry_1","title":"\u5e38\u898b\u79c1\u6709 Registry \u65b9\u6848","text":"\u65b9\u6848 \u8aaa\u660e \u9069\u7528\u5834\u666f Docker Registry Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u8f15\u91cf\u7d1a Registry \u5c0f\u578b\u5718\u968a\u3001\u6e2c\u8a66\u74b0\u5883 Harbor VMware \u958b\u6e90\u7684\u4f01\u696d\u7d1a Registry \u5927\u578b\u4f01\u696d\u3001\u9700\u8981 RBAC Nexus Repository Sonatype \u7684\u591a\u529f\u80fd\u5009\u5eab \u5df2\u4f7f\u7528 Nexus \u7ba1\u7406\u5957\u4ef6 JFrog Artifactory \u4f01\u696d\u7d1a\u88fd\u54c1\u7ba1\u7406 \u5927\u578b\u4f01\u696d AWS ECR AWS \u79c1\u6709 Registry AWS \u96f2\u7aef\u74b0\u5883 Azure ACR Azure \u79c1\u6709 Registry Azure \u96f2\u7aef\u74b0\u5883 GCP GCR Google \u79c1\u6709 Registry GCP \u96f2\u7aef\u74b0\u5883"},{"location":"lab05_private_registry/#private-registry_1","title":"\u5efa\u7acb\u7c21\u6613 Private Registry","text":"\u4f7f\u7528 Docker \u5efa\u7acb\u79c1\u6709 Registry<pre><code># \u555f\u52d5 Registry Container\ndocker run -d \\\n  --name my-registry \\\n  -p 5000:5000 \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n\n# \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag nginx:latest localhost:5000/my-nginx:v1\n\n# \u63a8\u9001\u5230\u79c1\u6709 Registry\ndocker push localhost:5000/my-nginx:v1\n\n# \u5f9e\u79c1\u6709 Registry \u62c9\u53d6\ndocker pull localhost:5000/my-nginx:v1\n</code></pre> <p>\u751f\u7522\u74b0\u5883\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u79c1\u6709 Registry \u61c9\u914d\u7f6e TLS \u6191\u8b49</li> <li>\u8a2d\u5b9a\u9069\u7576\u7684\u5b58\u53d6\u63a7\u5236</li> <li>\u5b9a\u671f\u5099\u4efd Registry \u8cc7\u6599</li> <li>\u8003\u616e\u4f7f\u7528\u4f01\u696d\u7d1a\u65b9\u6848\u5982 Harbor</li> </ul>"},{"location":"lab05_private_registry/#22-docker","title":"2.2 Docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab05_private_registry/#container","title":"Container \u751f\u547d\u9031\u671f\u7ba1\u7406","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: docker create\n    Created --&gt; Running: docker start\n    Running --&gt; Paused: docker pause\n    Paused --&gt; Running: docker unpause\n    Running --&gt; Stopped: docker stop\n    Stopped --&gt; Running: docker start\n    Stopped --&gt; Removed: docker rm\n    Running --&gt; Removed: docker rm -f\n    Removed --&gt; [*]</code></pre>"},{"location":"lab05_private_registry/#_3","title":"\u6838\u5fc3\u6307\u4ee4\u8a73\u89e3","text":""},{"location":"lab05_private_registry/#docker-run-","title":"docker run - \u57f7\u884c\u5bb9\u5668","text":"docker run \u5e38\u7528\u9078\u9805<pre><code># \u57fa\u672c\u57f7\u884c\ndocker run nginx\n\n# \u80cc\u666f\u57f7\u884c (detached)\ndocker run -d nginx\n\n# \u6307\u5b9a\u540d\u7a31\ndocker run -d --name my-nginx nginx\n\n# Port \u5c0d\u61c9 (\u4e3b\u6a5f:\u5bb9\u5668)\ndocker run -d -p 8080:80 nginx\n\n# \u74b0\u5883\u8b8a\u6578\ndocker run -d -e MYSQL_ROOT_PASSWORD=secret mysql\n\n# \u81ea\u52d5\u522a\u9664\uff08\u7d50\u675f\u5f8c\u81ea\u52d5\u79fb\u9664\uff09\ndocker run --rm nginx echo \"Hello\"\n\n# \u4e92\u52d5\u6a21\u5f0f\ndocker run -it ubuntu /bin/bash\n\n# \u8cc7\u6e90\u9650\u5236\ndocker run -d --memory=\"512m\" --cpus=\"1.0\" nginx\n\n# \u91cd\u555f\u7b56\u7565\ndocker run -d --restart=always nginx\n</code></pre> <p>docker run \u9078\u9805\u8aaa\u660e</p> \u9078\u9805 \u8aaa\u660e <code>-d</code> Detached mode\uff0c\u80cc\u666f\u57f7\u884c <code>-it</code> \u4e92\u52d5\u6a21\u5f0f + TTY <code>-p</code> Port mapping <code>-v</code> Volume mapping <code>-e</code> \u74b0\u5883\u8b8a\u6578 <code>--name</code> \u6307\u5b9a\u5bb9\u5668\u540d\u7a31 <code>--rm</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>--restart</code> \u91cd\u555f\u7b56\u7565"},{"location":"lab05_private_registry/#docker-exec-","title":"docker exec - \u57f7\u884c\u6307\u4ee4","text":"\u5728\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u57f7\u884c\u6307\u4ee4<pre><code># \u57f7\u884c\u55ae\u4e00\u6307\u4ee4\ndocker exec my-nginx cat /etc/nginx/nginx.conf\n\n# \u9032\u5165\u4e92\u52d5\u5f0f Shell\ndocker exec -it my-nginx /bin/bash\n\n# \u4ee5\u7279\u5b9a\u4f7f\u7528\u8005\u57f7\u884c\ndocker exec -u root my-nginx whoami\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\ndocker exec -e VAR=value my-nginx printenv VAR\n</code></pre>"},{"location":"lab05_private_registry/#docker-logs-","title":"docker logs - \u6aa2\u8996\u65e5\u8a8c","text":"Container \u65e5\u8a8c\u64cd\u4f5c<pre><code># \u6aa2\u8996\u5168\u90e8\u65e5\u8a8c\ndocker logs my-nginx\n\n# \u6301\u7e8c\u8ffd\u8e64\u65e5\u8a8c\ndocker logs -f my-nginx\n\n# \u986f\u793a\u6700\u5f8c N \u884c\ndocker logs --tail 100 my-nginx\n\n# \u986f\u793a\u6642\u9593\u6233\u8a18\ndocker logs -t my-nginx\n\n# \u6307\u5b9a\u6642\u9593\u7bc4\u570d\ndocker logs --since 2024-01-01 my-nginx\ndocker logs --since 10m my-nginx  # \u6700\u8fd1 10 \u5206\u9418\n</code></pre>"},{"location":"lab05_private_registry/#docker-inspect-","title":"docker inspect - \u6aa2\u8996\u8a73\u7d30\u8cc7\u8a0a","text":"\u6aa2\u8996\u5bb9\u5668/\u6620\u50cf\u6a94\u8a73\u7d30\u8cc7\u8a0a<pre><code># \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\uff08JSON \u683c\u5f0f\uff09\ndocker inspect my-nginx\n\n# \u53d6\u5f97\u7279\u5b9a\u8cc7\u8a0a\uff08\u4f7f\u7528 Go \u6a21\u677f\uff09\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' my-nginx\n\n# \u53d6\u5f97 Port \u5c0d\u61c9\ndocker inspect --format='{{range $p, $conf := .NetworkSettings.Ports}}{{$p}} -&gt; {{(index $conf 0).HostPort}}{{end}}' my-nginx\n\n# \u53d6\u5f97\u639b\u8f09\u8cc7\u8a0a\ndocker inspect --format='{{json .Mounts}}' my-nginx | jq .\n</code></pre>"},{"location":"lab05_private_registry/#_4","title":"\u5176\u4ed6\u5e38\u7528\u6307\u4ee4","text":"\u5bb9\u5668\u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker ps\n\n# \u5217\u51fa\u6240\u6709\u5bb9\u5668\uff08\u5305\u542b\u5df2\u505c\u6b62\uff09\ndocker ps -a\n\n# \u505c\u6b62\u5bb9\u5668\ndocker stop my-nginx\n\n# \u555f\u52d5\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker start my-nginx\n\n# \u91cd\u555f\u5bb9\u5668\ndocker restart my-nginx\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm my-nginx\n\n# \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker rm -f my-nginx\n\n# \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n\n# \u6aa2\u8996\u5bb9\u5668\u8cc7\u6e90\u4f7f\u7528\ndocker stats\n\n# \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668\ndocker cp ./index.html my-nginx:/usr/share/nginx/html/\n\n# \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848\ndocker cp my-nginx:/etc/nginx/nginx.conf ./nginx.conf\n</code></pre>"},{"location":"lab05_private_registry/#23-persistent-storage","title":"2.3 Persistent Storage","text":""},{"location":"lab05_private_registry/#_5","title":"\u70ba\u4ec0\u9ebc\u9700\u8981\u6301\u4e45\u5316\u5132\u5b58\uff1f","text":"<p>Container \u9810\u8a2d\u7684\u8cc7\u6599\u662f\u77ed\u66ab\u7684\uff08ephemeral\uff09\uff0c\u7576 Container \u88ab\u522a\u9664\u6642\uff0c\u6240\u6709\u8cc7\u6599\u90fd\u6703\u6d88\u5931\u3002</p> <pre><code>graph LR\n    subgraph \"\u6c92\u6709\u6301\u4e45\u5316\"\n        C1[Container] --&gt; RW1[\u8b80\u5beb\u5c64]\n        RW1 -.-&gt;|\u522a\u9664\u5bb9\u5668| X[\u8cc7\u6599\u6d88\u5931]\n    end\n\n    subgraph \"\u4f7f\u7528\u6301\u4e45\u5316\"\n        C2[Container] --&gt; RW2[\u8b80\u5beb\u5c64]\n        C2 --&gt; V[Volume/Bind Mount]\n        V --&gt;|\u5bb9\u5668\u522a\u9664| V\n    end</code></pre>"},{"location":"lab05_private_registry/#_6","title":"\u4e09\u7a2e\u5132\u5b58\u65b9\u5f0f","text":"\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f Volume \u7531 Docker \u7ba1\u7406\u7684\u5132\u5b58\u5340\u57df \u751f\u7522\u74b0\u5883\u3001\u8cc7\u6599\u6301\u4e45\u5316 Bind Mount \u5c07\u4e3b\u6a5f\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668 \u958b\u767c\u74b0\u5883\u3001\u7a0b\u5f0f\u78bc\u540c\u6b65 tmpfs Mount \u5132\u5b58\u5728\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e2d \u66ab\u5b58\u654f\u611f\u8cc7\u6599"},{"location":"lab05_private_registry/#volumes","title":"Volumes","text":"Volume \u57fa\u672c\u64cd\u4f5c<pre><code># \u5efa\u7acb Volume\ndocker volume create my-data\n\n# \u5217\u51fa\u6240\u6709 Volume\ndocker volume ls\n\n# \u6aa2\u8996 Volume \u8a73\u7d30\u8cc7\u8a0a\ndocker volume inspect my-data\n\n# \u4f7f\u7528 Volume \u57f7\u884c\u5bb9\u5668\ndocker run -d \\\n  --name my-nginx \\\n  -v my-data:/usr/share/nginx/html \\\n  nginx\n\n# \u522a\u9664 Volume\ndocker volume rm my-data\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n</code></pre> <p>Volume \u4f4d\u7f6e</p> <p>Docker Volume \u9810\u8a2d\u5132\u5b58\u5728\uff1a</p> <ul> <li>Linux: <code>/var/lib/docker/volumes/</code></li> <li>macOS/Windows: Docker Desktop \u7ba1\u7406\u7684\u865b\u64ec\u78c1\u789f\u5167</li> </ul>"},{"location":"lab05_private_registry/#bind-mounts","title":"Bind Mounts","text":"Bind Mount \u4f7f\u7528\u65b9\u5f0f<pre><code># \u4f7f\u7528 -v \u8a9e\u6cd5\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u4f7f\u7528 --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run -d \\\n  --name my-nginx \\\n  --mount type=bind,source=/path/on/host,target=/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html:ro \\\n  nginx\n</code></pre> <p>\u958b\u767c\u74b0\u5883\u7bc4\u4f8b</p> \u524d\u7aef\u958b\u767c\u5373\u6642\u540c\u6b65<pre><code># \u5c07\u672c\u5730\u5c08\u6848\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668\ndocker run -d \\\n  --name frontend-dev \\\n  -v $(pwd)/src:/app/src \\\n  -p 3000:3000 \\\n  node:18\n</code></pre> <p>\u4fee\u6539\u672c\u5730 <code>src</code> \u76ee\u9304\u7684\u6a94\u6848\u6703\u7acb\u5373\u53cd\u6620\u5230\u5bb9\u5668\u4e2d\u3002</p>"},{"location":"lab05_private_registry/#volume-vs-bind-mount","title":"Volume vs Bind Mount \u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee Volume Bind Mount \u5132\u5b58\u4f4d\u7f6e Docker \u7ba1\u7406 \u6307\u5b9a\u4e3b\u6a5f\u8def\u5f91 \u53ef\u79fb\u690d\u6027 \u9ad8 \u4f9d\u8cf4\u4e3b\u6a5f\u8def\u5f91 \u6548\u80fd \u8f03\u4f73 \u53d6\u6c7a\u65bc\u4e3b\u6a5f\u6a94\u6848\u7cfb\u7d71 \u5099\u4efd \u5bb9\u6613 \u9700\u624b\u52d5\u8655\u7406 \u9069\u7528\u5834\u666f \u751f\u7522\u74b0\u5883 \u958b\u767c\u74b0\u5883"},{"location":"lab05_private_registry/#24-docker-network","title":"2.4 Docker Network","text":""},{"location":"lab05_private_registry/#_7","title":"\u9810\u8a2d\u7db2\u8def\u985e\u578b","text":"<p>Docker \u63d0\u4f9b\u591a\u7a2e\u7db2\u8def\u9a45\u52d5\uff0c\u6eff\u8db3\u4e0d\u540c\u7684\u4f7f\u7528\u5834\u666f\u3002</p> <pre><code>graph TB\n    subgraph \"Bridge Network\uff08\u9810\u8a2d\uff09\"\n        B_C1[Container 1] --- B_NET[docker0 bridge]\n        B_C2[Container 2] --- B_NET\n        B_NET --- B_HOST[Host Network Stack]\n    end\n\n    subgraph \"Host Network\"\n        H_C[Container] --- H_HOST[Host Network Stack]\n    end\n\n    subgraph \"None Network\"\n        N_C[Container - \u7121\u7db2\u8def]\n    end</code></pre> \u7db2\u8def\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f bridge \u9810\u8a2d\u7db2\u8def\uff0cContainer \u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 \u55ae\u6a5f\u591a\u5bb9\u5668\u901a\u8a0a host Container \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def \u9700\u8981\u6700\u9ad8\u7db2\u8def\u6548\u80fd none \u7121\u7db2\u8def\u9023\u63a5 \u5b89\u5168\u9694\u96e2\u9700\u6c42 overlay \u8de8\u4e3b\u6a5f\u5bb9\u5668\u901a\u8a0a Docker Swarm \u53e2\u96c6 macvlan \u5206\u914d\u771f\u5be6 MAC \u5730\u5740 \u9700\u8981\u76f4\u63a5\u9023\u63a5\u5be6\u9ad4\u7db2\u8def"},{"location":"lab05_private_registry/#_8","title":"\u7db2\u8def\u57fa\u672c\u64cd\u4f5c","text":"Docker \u7db2\u8def\u7ba1\u7406<pre><code># \u5217\u51fa\u6240\u6709\u7db2\u8def\ndocker network ls\n\n# \u6aa2\u8996\u7db2\u8def\u8a73\u7d30\u8cc7\u8a0a\ndocker network inspect bridge\n\n# \u5efa\u7acb\u81ea\u8a02\u7db2\u8def\ndocker network create my-network\n\n# \u5efa\u7acb\u6307\u5b9a\u5b50\u7db2\u8def\u7684\u7db2\u8def\ndocker network create \\\n  --driver bridge \\\n  --subnet 172.20.0.0/16 \\\n  --gateway 172.20.0.1 \\\n  my-custom-network\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm my-network\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u7db2\u8def\ndocker network prune\n</code></pre>"},{"location":"lab05_private_registry/#_9","title":"\u5bb9\u5668\u9023\u63a5\u7db2\u8def","text":"\u5bb9\u5668\u7db2\u8def\u9023\u63a5<pre><code># \u57f7\u884c\u5bb9\u5668\u6642\u6307\u5b9a\u7db2\u8def\ndocker run -d --name app1 --network my-network nginx\n\n# \u5c07\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u9023\u63a5\u5230\u7db2\u8def\ndocker network connect my-network container-name\n\n# \u5c07\u5bb9\u5668\u5f9e\u7db2\u8def\u65b7\u958b\ndocker network disconnect my-network container-name\n</code></pre>"},{"location":"lab05_private_registry/#_10","title":"\u5bb9\u5668\u9593\u901a\u8a0a","text":"<p>\u4f7f\u7528\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</p> <p>\u5728\u540c\u4e00\u500b\u81ea\u8a02\u7db2\u8def\u4e2d\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528**\u5bb9\u5668\u540d\u7a31**\u4f5c\u70ba hostname \u4e92\u76f8\u5b58\u53d6\u3002</p> \u5bb9\u5668\u9593\u901a\u8a0a\u7bc4\u4f8b<pre><code># \u5efa\u7acb\u7db2\u8def\ndocker network create app-network\n\n# \u555f\u52d5 MySQL Container\ndocker run -d \\\n  --name mysql-db \\\n  --network app-network \\\n  -e MYSQL_ROOT_PASSWORD=secret \\\n  mysql:8\n\n# \u555f\u52d5\u61c9\u7528\u7a0b\u5f0f Container\uff0c\u4f7f\u7528 mysql-db \u4f5c\u70ba\u8cc7\u6599\u5eab\u4e3b\u6a5f\ndocker run -d \\\n  --name my-app \\\n  --network app-network \\\n  -e DB_HOST=mysql-db \\\n  -e DB_PASSWORD=secret \\\n  my-application\n\n# \u6e2c\u8a66\u9023\u7dda\ndocker exec my-app ping mysql-db\n</code></pre>"},{"location":"lab05_private_registry/#port","title":"Port \u5c0d\u61c9","text":"Port Mapping<pre><code># \u5c0d\u61c9\u55ae\u4e00 Port\ndocker run -d -p 8080:80 nginx\n\n# \u5c0d\u61c9\u591a\u500b Port\ndocker run -d -p 8080:80 -p 8443:443 nginx\n\n# \u5c0d\u61c9\u5230\u6240\u6709\u4ecb\u9762\u7684\u96a8\u6a5f Port\ndocker run -d -P nginx\n\n# \u53ea\u5c0d\u61c9\u5230 localhost\ndocker run -d -p 127.0.0.1:8080:80 nginx\n\n# \u5c0d\u61c9 UDP Port\ndocker run -d -p 53:53/udp dns-server\n</code></pre>"},{"location":"lab05_private_registry/#25-docker-search","title":"2.5 Docker Search","text":""},{"location":"lab05_private_registry/#image","title":"\u641c\u5c0b Image","text":"\u641c\u5c0b Docker Hub<pre><code># \u57fa\u672c\u641c\u5c0b\ndocker search nginx\n\n# \u9650\u5236\u7d50\u679c\u6578\u91cf\ndocker search --limit 5 nginx\n\n# \u53ea\u986f\u793a\u5b98\u65b9 Image\ndocker search --filter is-official=true nginx\n\n# \u53ea\u986f\u793a\u81ea\u52d5\u5efa\u7f6e\u7684 Image\ndocker search --filter is-automated=true nginx\n\n# \u6839\u64da\u661f\u661f\u6578\u904e\u6ffe\ndocker search --filter stars=100 nginx\n</code></pre> <p>\u641c\u5c0b\u7d50\u679c\u8aaa\u660e\uff1a</p> \u6b04\u4f4d \u8aaa\u660e NAME Image \u540d\u7a31 DESCRIPTION \u63cf\u8ff0 STARS \u661f\u661f\u6578\uff08\u4eba\u6c23\u6307\u6a19\uff09 OFFICIAL \u662f\u5426\u70ba\u5b98\u65b9 Image AUTOMATED \u662f\u5426\u81ea\u52d5\u5efa\u7f6e <p>\u9078\u64c7 Image \u7684\u5efa\u8b70</p> <ol> <li>\u512a\u5148\u9078\u64c7**\u5b98\u65b9 Image**\uff08OFFICIAL = [OK]\uff09</li> <li>\u67e5\u770b**\u661f\u661f\u6578**\u548c**\u4e0b\u8f09\u6b21\u6578**</li> <li>\u5230 Docker Hub \u7db2\u7ad9\u67e5\u770b**\u6587\u4ef6**\u548c**\u66f4\u65b0\u983b\u7387**</li> <li>\u6aa2\u67e5 Image \u7684**\u5b89\u5168\u6383\u63cf\u7d50\u679c**</li> </ol>"},{"location":"lab05_private_registry/#26-docker-pull","title":"2.6 Docker Pull","text":""},{"location":"lab05_private_registry/#image_1","title":"\u62c9\u53d6 Image","text":"\u62c9\u53d6 Image<pre><code># \u62c9\u53d6\u6700\u65b0\u7248\u672c\uff08\u9810\u8a2d latest tag\uff09\ndocker pull nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\ndocker pull nginx:1.25\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\uff08alpine \u8f15\u91cf\u7248\uff09\ndocker pull nginx:alpine\n\n# \u5f9e\u5176\u4ed6 Registry \u62c9\u53d6\ndocker pull quay.io/bitnami/nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u5e73\u53f0\u7684 Image\ndocker pull --platform linux/amd64 nginx\n</code></pre>"},{"location":"lab05_private_registry/#image-tag","title":"Image \u6a19\u7c64\uff08Tag\uff09","text":"<pre><code>graph LR\n    N[nginx] --&gt; L[latest]\n    N --&gt; V1[1.25]\n    N --&gt; V2[1.25.3]\n    N --&gt; A[alpine]\n    N --&gt; VA[1.25-alpine]</code></pre> <p>\u907f\u514d\u4f7f\u7528 latest</p> <ul> <li><code>latest</code> \u6a19\u7c64\u6703\u96a8\u6642\u9593\u8b8a\u5316</li> <li>\u751f\u7522\u74b0\u5883\u61c9\u4f7f\u7528**\u660e\u78ba\u7248\u672c\u865f**</li> <li>\u4f8b\u5982\uff1a<code>nginx:1.25.3</code> \u800c\u975e <code>nginx:latest</code></li> </ul>"},{"location":"lab05_private_registry/#image_2","title":"\u7ba1\u7406\u672c\u5730 Image","text":"Image \u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u672c\u5730 Image\ndocker images\n\n# \u5217\u51fa\u6240\u6709 Image\uff08\u5305\u542b\u4e2d\u9593\u5c64\uff09\ndocker images -a\n\n# \u6aa2\u8996 Image \u8a73\u7d30\u8cc7\u8a0a\ndocker image inspect nginx\n\n# \u6aa2\u8996 Image \u6b77\u53f2\uff08\u5206\u5c64\uff09\ndocker history nginx\n\n# \u522a\u9664 Image\ndocker rmi nginx\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Image\ndocker image prune\n\n# \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image\uff08\u5305\u542b\u672a\u6a19\u8a18\u7684\uff09\ndocker image prune -a\n</code></pre>"},{"location":"lab05_private_registry/#27-docker-push","title":"2.7 Docker Push","text":""},{"location":"lab05_private_registry/#image-registry","title":"\u63a8\u9001 Image \u5230 Registry","text":""},{"location":"lab05_private_registry/#docker-hub","title":"\u63a8\u9001\u5230 Docker Hub","text":"\u63a8\u9001\u5230 Docker Hub<pre><code># 1. \u767b\u5165 Docker Hub\ndocker login\n\n# 2. \u70ba Image \u52a0\u4e0a\u6a19\u7c64\uff08\u5fc5\u9808\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff09\ndocker tag my-app:v1 username/my-app:v1\n\n# 3. \u63a8\u9001 Image\ndocker push username/my-app:v1\n\n# 4. \u767b\u51fa\uff08\u9078\u7528\uff09\ndocker logout\n</code></pre>"},{"location":"lab05_private_registry/#registry_2","title":"\u63a8\u9001\u5230\u79c1\u6709 Registry","text":"\u63a8\u9001\u5230\u79c1\u6709 Registry<pre><code># 1. \u767b\u5165\u79c1\u6709 Registry\ndocker login my-registry.example.com\n\n# 2. \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag my-app:v1 my-registry.example.com/my-app:v1\n\n# 3. \u63a8\u9001\ndocker push my-registry.example.com/my-app:v1\n</code></pre> <p>Image \u547d\u540d\u898f\u5247</p> <pre><code>[registry/][username/]repository[:tag]\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <ul> <li><code>nginx</code> = <code>docker.io/library/nginx:latest</code></li> <li><code>bitnami/nginx</code> = <code>docker.io/bitnami/nginx:latest</code></li> <li><code>gcr.io/project/app:v1</code></li> </ul>"},{"location":"lab05_private_registry/#_11","title":"\u6a19\u7c64\u7ba1\u7406","text":"Image \u6a19\u7c64\u64cd\u4f5c<pre><code># \u52a0\u4e0a\u65b0\u6a19\u7c64\ndocker tag my-app:v1 my-app:latest\ndocker tag my-app:v1 my-app:stable\n\n# \u63a8\u9001\u591a\u500b\u6a19\u7c64\ndocker push my-app:v1\ndocker push my-app:latest\ndocker push my-app:stable\n</code></pre>"},{"location":"lab05_private_registry/#28-docker-wordpress-mysql","title":"2.8 \u4f7f\u7528 Docker \u67b6\u8a2d WordPress + MySQL","text":""},{"location":"lab05_private_registry/#lab","title":"Lab \u5be6\u4f5c\u76ee\u6a19","text":"<p>\u90e8\u7f72\u4e00\u500b\u5b8c\u6574\u7684 WordPress \u7db2\u7ad9\uff0c\u5305\u542b\uff1a</p> <ul> <li>MySQL \u8cc7\u6599\u5eab\u5bb9\u5668</li> <li>WordPress \u61c9\u7528\u7a0b\u5f0f\u5bb9\u5668</li> <li>\u4f7f\u7528 Docker Network \u9023\u63a5</li> <li>\u4f7f\u7528 Volume \u6301\u4e45\u5316\u8cc7\u6599</li> </ul>"},{"location":"lab05_private_registry/#_12","title":"\u67b6\u69cb\u5716","text":"<pre><code>graph TB\n    subgraph \"Docker \u74b0\u5883\"\n        subgraph \"wp-network\"\n            WP[WordPress&lt;br/&gt;Port: 8080] --&gt;|\u9023\u63a5| DB[(MySQL&lt;br/&gt;Port: 3306)]\n        end\n        WP_VOL[wordpress-data&lt;br/&gt;Volume] --&gt; WP\n        DB_VOL[mysql-data&lt;br/&gt;Volume] --&gt; DB\n    end\n\n    User[\u4f7f\u7528\u8005] --&gt;|http://localhost:8080| WP</code></pre>"},{"location":"lab05_private_registry/#_13","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab05_private_registry/#1","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb\u7db2\u8def","text":"\u5efa\u7acb\u5c08\u7528\u7db2\u8def<pre><code>docker network create wp-network\n</code></pre>"},{"location":"lab05_private_registry/#2-mysql","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 MySQL \u5bb9\u5668","text":"\u555f\u52d5 MySQL<pre><code>docker run -d \\\n  --name wp-mysql \\\n  --network wp-network \\\n  -v mysql-data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=rootpassword \\\n  -e MYSQL_DATABASE=wordpress \\\n  -e MYSQL_USER=wpuser \\\n  -e MYSQL_PASSWORD=wppassword \\\n  mysql:8.0\n</code></pre> <p>MySQL \u74b0\u5883\u8b8a\u6578\u8aaa\u660e</p> \u74b0\u5883\u8b8a\u6578 \u8aaa\u660e <code>MYSQL_ROOT_PASSWORD</code> root \u5bc6\u78bc\uff08\u5fc5\u586b\uff09 <code>MYSQL_DATABASE</code> \u81ea\u52d5\u5efa\u7acb\u7684\u8cc7\u6599\u5eab <code>MYSQL_USER</code> \u81ea\u52d5\u5efa\u7acb\u7684\u4f7f\u7528\u8005 <code>MYSQL_PASSWORD</code> \u4f7f\u7528\u8005\u5bc6\u78bc"},{"location":"lab05_private_registry/#3-wordpress","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 WordPress \u5bb9\u5668","text":"\u555f\u52d5 WordPress<pre><code>docker run -d \\\n  --name wp-app \\\n  --network wp-network \\\n  -p 8080:80 \\\n  -v wordpress-data:/var/www/html \\\n  -e WORDPRESS_DB_HOST=wp-mysql:3306 \\\n  -e WORDPRESS_DB_NAME=wordpress \\\n  -e WORDPRESS_DB_USER=wpuser \\\n  -e WORDPRESS_DB_PASSWORD=wppassword \\\n  wordpress:latest\n</code></pre>"},{"location":"lab05_private_registry/#4","title":"\u6b65\u9a5f 4\uff1a\u9a57\u8b49\u90e8\u7f72","text":"\u9a57\u8b49\u5bb9\u5668\u72c0\u614b<pre><code># \u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u904b\u884c\ndocker ps\n\n# \u6aa2\u67e5\u5bb9\u5668\u65e5\u8a8c\ndocker logs wp-mysql\ndocker logs wp-app\n\n# \u6e2c\u8a66 MySQL \u9023\u7dda\ndocker exec wp-mysql mysql -uwpuser -pwppassword -e \"SHOW DATABASES;\"\n</code></pre>"},{"location":"lab05_private_registry/#5-wordpress","title":"\u6b65\u9a5f 5\uff1a\u5b58\u53d6 WordPress","text":"<p>\u958b\u555f\u700f\u89bd\u5668\uff0c\u524d\u5f80 <code>http://localhost:8080</code>\uff0c\u5b8c\u6210 WordPress \u5b89\u88dd\u7cbe\u9748\u3002</p>"},{"location":"lab05_private_registry/#docker-compose","title":"\u4f7f\u7528 Docker Compose\uff08\u984d\u5916\u8aaa\u660e\uff09","text":"<p>\u66f4\u7c21\u6f54\u7684\u65b9\u5f0f</p> <p>\u4f7f\u7528 Docker Compose \u53ef\u4ee5\u5c07\u4ee5\u4e0a\u6240\u6709\u8a2d\u5b9a\u96c6\u4e2d\u5728\u4e00\u500b\u6a94\u6848\u4e2d\u3002</p> docker-compose.yml<pre><code>version: '3.8'\n\nservices:\n  db:\n    image: mysql:8.0\n    container_name: wp-mysql\n    volumes:\n      - mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpassword\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wpuser\n      MYSQL_PASSWORD: wppassword\n    networks:\n      - wp-network\n\n  wordpress:\n    image: wordpress:latest\n    container_name: wp-app\n    depends_on:\n      - db\n    ports:\n      - \"8080:80\"\n    volumes:\n      - wordpress-data:/var/www/html\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_NAME: wordpress\n      WORDPRESS_DB_USER: wpuser\n      WORDPRESS_DB_PASSWORD: wppassword\n    networks:\n      - wp-network\n\nnetworks:\n  wp-network:\n    driver: bridge\n\nvolumes:\n  mysql-data:\n  wordpress-data:\n</code></pre> \u4f7f\u7528 Docker Compose \u555f\u52d5<pre><code># \u555f\u52d5\u6240\u6709\u670d\u52d9\ndocker compose up -d\n\n# \u6aa2\u8996\u72c0\u614b\ndocker compose ps\n\n# \u6aa2\u8996\u65e5\u8a8c\ndocker compose logs -f\n\n# \u505c\u6b62\u4e26\u79fb\u9664\ndocker compose down\n\n# \u505c\u6b62\u4e26\u79fb\u9664\uff08\u5305\u542b Volume\uff09\ndocker compose down -v\n</code></pre>"},{"location":"lab05_private_registry/#_14","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u6e05\u7406\u5be6\u4f5c\u74b0\u5883<pre><code># \u505c\u6b62\u5bb9\u5668\ndocker stop wp-app wp-mysql\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm wp-app wp-mysql\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm wp-network\n\n# \u522a\u9664 Volume\uff08\u8b66\u544a\uff1a\u6703\u522a\u9664\u6240\u6709\u8cc7\u6599\uff09\ndocker volume rm mysql-data wordpress-data\n</code></pre>"},{"location":"lab05_private_registry/#_15","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aContainer \u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># \u6aa2\u8996\u5bb9\u5668\u65e5\u8a8c\ndocker logs container-name\n\n# \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\ndocker inspect container-name\n\n# \u6aa2\u8996\u6700\u5f8c\u9000\u51fa\u72c0\u614b\ndocker ps -a --filter \"name=container-name\"\n</code></pre><p></p> <p>\u5e38\u898b\u539f\u56e0\uff1a</p> <ul> <li>\u555f\u52d5\u6307\u4ee4\u932f\u8aa4</li> <li>\u74b0\u5883\u8b8a\u6578\u7f3a\u5931</li> <li>\u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2</li> <li>\u8a2d\u5b9a\u6a94\u932f\u8aa4</li> </ul> Q2\uff1a\u5982\u4f55\u8b93\u5bb9\u5668\u5728\u4e3b\u6a5f\u91cd\u555f\u5f8c\u81ea\u52d5\u555f\u52d5\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a\u4f7f\u7528 <code>--restart</code> \u9078\u9805 </p><pre><code># always: \u7e3d\u662f\u91cd\u555f\ndocker run -d --restart=always nginx\n\n# unless-stopped: \u9664\u975e\u624b\u52d5\u505c\u6b62\ndocker run -d --restart=unless-stopped nginx\n\n# on-failure: \u53ea\u5728\u7570\u5e38\u9000\u51fa\u6642\u91cd\u555f\ndocker run -d --restart=on-failure:3 nginx\n</code></pre><p></p> Q3\uff1aVolume \u8cc7\u6599\u5982\u4f55\u5099\u4efd\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u65b9\u6cd5 1\uff1a\u4f7f\u7528\u81e8\u6642\u5bb9\u5668\u5099\u4efd\ndocker run --rm \\\n  -v mysql-data:/source:ro \\\n  -v $(pwd):/backup \\\n  alpine tar cvf /backup/mysql-backup.tar /source\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 docker cp\uff08\u9700\u8981\u5148\u639b\u8f09\u5230\u5bb9\u5668\uff09\ndocker cp container-name:/var/lib/mysql ./mysql-backup\n</code></pre><p></p> Q4\uff1a\u5982\u4f55\u67e5\u770b Docker \u4f54\u7528\u7684\u78c1\u789f\u7a7a\u9593\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996\u6574\u9ad4\u4f7f\u7528\u60c5\u6cc1\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u6e05\u7406\u6240\u6709\u672a\u4f7f\u7528\u8cc7\u6e90\uff08\u5305\u542b Volume\uff09\ndocker system prune -a --volumes\n</code></pre><p></p> Q5\uff1a\u5bb9\u5668\u9593\u7121\u6cd5\u901a\u8a0a\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># 1. \u78ba\u8a8d\u5bb9\u5668\u5728\u540c\u4e00\u500b\u7db2\u8def\ndocker network inspect my-network\n\n# 2. \u78ba\u8a8d\u5bb9\u5668 IP\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' container-name\n\n# 3. \u5728\u5bb9\u5668\u5167\u6e2c\u8a66\u9023\u7dda\ndocker exec container1 ping container2\n\n# 4. \u78ba\u8a8d Port \u662f\u5426\u958b\u653e\ndocker exec container1 nc -zv container2 port\n</code></pre><p></p>"},{"location":"lab05_private_registry/#_16","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Registry \u985e\u578b\uff1aPublic Registry\uff08\u5982 Docker Hub\uff09\u8207 Private Registry\uff08\u5982 Harbor\uff09</li> <li>\u2705 Container \u7ba1\u7406\uff1arun\u3001exec\u3001logs\u3001inspect \u7b49\u6838\u5fc3\u6307\u4ee4</li> <li>\u2705 \u6301\u4e45\u5316\u5132\u5b58\uff1aVolume\uff08Docker \u7ba1\u7406\uff09vs Bind Mount\uff08\u4e3b\u6a5f\u76ee\u9304\uff09</li> <li>\u2705 Docker \u7db2\u8def\uff1abridge\u3001host\u3001none \u7db2\u8def\u985e\u578b\uff0c\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</li> <li>\u2705 Image \u64cd\u4f5c\uff1asearch\u3001pull\u3001push\u3001tag \u5b8c\u6574\u6d41\u7a0b</li> <li>\u2705 \u5be6\u4f5c\u7d93\u9a57\uff1aWordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"lab05_private_registry/#_17","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Storage</li> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Networking</li> <li>Docker Hub \u5b98\u65b9\u7db2\u7ad9</li> <li>Harbor - \u4f01\u696d\u7d1a Registry</li> <li>Docker Compose \u5b98\u65b9\u6587\u4ef6</li> </ul>"},{"location":"lab06_docker_basics/","title":"LAB 06 docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#lab-06-docker","title":"LAB 06 Docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 <code>docker run</code> \u555f\u52d5\u5bb9\u5668</li> <li> \u4f7f\u7528 <code>docker ps</code> \u67e5\u770b\u5bb9\u5668\u72c0\u614b</li> <li> \u4f7f\u7528 <code>docker logs</code> \u67e5\u770b\u5bb9\u5668\u65e5\u8a8c</li> <li> \u4f7f\u7528 <code>docker inspect</code> \u67e5\u770b\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a</li> <li> \u4f7f\u7528 <code>docker exec</code> \u9032\u5165\u904b\u884c\u4e2d\u7684\u5bb9\u5668</li> <li> \u7406\u89e3\u74b0\u5883\u8b8a\u6578 <code>-e</code> \u7684\u4f7f\u7528</li> </ul>"},{"location":"lab06_docker_basics/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 05 Private Registry \u5efa\u7f6e</li> <li>Docker \u5df2\u5b89\u88dd\u4e26\u6b63\u5e38\u904b\u884c</li> <li>\u5df2\u8a2d\u5b9a Private Registry\uff08insecure-registries\uff09</li> </ul>"},{"location":"lab06_docker_basics/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab06_docker_basics/#docker","title":"Docker \u5bb9\u5668\u751f\u547d\u9031\u671f","text":"<pre><code>graph LR\n    Image[\"\u6620\u50cf\u6a94\"] --&gt; Create[\"\u5efa\u7acb\"]\n    Create --&gt; Running[\"\u904b\u884c\u4e2d\"]\n    Running --&gt; Stopped[\"\u505c\u6b62\"]\n    Stopped --&gt; Running\n    Stopped --&gt; Removed[\"\u522a\u9664\"]\n    Running --&gt; Removed</code></pre>"},{"location":"lab06_docker_basics/#docker_1","title":"\u5e38\u7528 Docker \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker run</code> \u5efa\u7acb\u4e26\u555f\u52d5\u5bb9\u5668 <code>docker ps</code> \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker ps -a</code> \u5217\u51fa\u6240\u6709\u5bb9\u5668\uff08\u5305\u542b\u505c\u6b62\u7684\uff09 <code>docker logs</code> \u67e5\u770b\u5bb9\u5668\u65e5\u8a8c <code>docker inspect</code> \u67e5\u770b\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a <code>docker exec</code> \u5728\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u57f7\u884c\u6307\u4ee4 <code>docker stop</code> \u505c\u6b62\u5bb9\u5668 <code>docker rm</code> \u522a\u9664\u5bb9\u5668"},{"location":"lab06_docker_basics/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>"},{"location":"lab06_docker_basics/#1-mysql","title":"\u6b65\u9a5f 1\uff1a\u555f\u52d5 MySQL \u5bb9\u5668\uff08\u80cc\u666f\u57f7\u884c\uff09","text":"<p>\u4f7f\u7528 <code>-itd</code> \u53c3\u6578\u5728\u80cc\u666f\u555f\u52d5 MySQL \u5bb9\u5668\uff1a</p> \u555f\u52d5 MySQL \u5bb9\u5668<pre><code>docker run -itd -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.6\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e <code>-i</code> \u4fdd\u6301\u6a19\u6e96\u8f38\u5165\u958b\u555f\uff08interactive\uff09 <code>-t</code> \u5206\u914d\u507d\u7d42\u7aef\uff08tty\uff09 <code>-d</code> \u80cc\u666f\u57f7\u884c\uff08detached\uff09 <code>-e</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <p>MYSQL_ROOT_PASSWORD</p> <p>MySQL \u5bb9\u5668**\u5fc5\u9808**\u6307\u5b9a <code>MYSQL_ROOT_PASSWORD</code> \u74b0\u5883\u8b8a\u6578\uff0c\u5426\u5247\u5bb9\u5668\u6703\u555f\u52d5\u5931\u6557\u3002</p> <p>\u9a57\u8b49\uff1a</p> \u6aa2\u67e5\u904b\u884c\u4e2d\u7684\u5bb9\u5668<pre><code>docker ps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE                                    COMMAND                  STATUS         PORTS      NAMES\na28f39cbe620   docker1.training.lab:5000/mysql:5.6     \"docker-entrypoint.s\u2026\"   Up 10 seconds  3306/tcp   pensive_einstein\n</code></pre>"},{"location":"lab06_docker_basics/#2-name","title":"\u6b65\u9a5f 2\uff1a\u4f7f\u7528 --name \u6307\u5b9a\u5bb9\u5668\u540d\u7a31","text":"<p>\u555f\u52d5\u7b2c\u4e8c\u500b MySQL \u5bb9\u5668\uff0c\u4e26\u6307\u5b9a\u540d\u7a31\uff1a</p> \u555f\u52d5\u4e26\u547d\u540d\u5bb9\u5668<pre><code>docker run -itd --name mysql-2 -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.5\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u6aa2\u67e5\u5bb9\u5668<pre><code>docker ps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE                                    COMMAND                  STATUS         NAMES\n4ba163c72270   docker1.training.lab:5000/mysql:5.5     \"docker-entrypoint.s\u2026\"   Up 5 seconds   mysql-2\na28f39cbe620   docker1.training.lab:5000/mysql:5.6     \"docker-entrypoint.s\u2026\"   Up 2 minutes   pensive_einstein\n</code></pre>"},{"location":"lab06_docker_basics/#3","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b\u5bb9\u5668\u65e5\u8a8c","text":"<p>\u4f7f\u7528 <code>docker logs</code> \u67e5\u770b\u5bb9\u5668\u7684\u8f38\u51fa\u65e5\u8a8c\uff1a</p> \u67e5\u770b mysql-2 \u65e5\u8a8c<pre><code>docker logs mysql-2\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u90e8\u5206\uff09\uff1a</p> <pre><code>Initializing database\n...\nMySQL init process done. Ready for start up.\n...\nmysqld: ready for connections.\nVersion: '5.5.62'  socket: '/tmp/mysql.sock'  port: 3306  MySQL Community Server (GPL)\n</code></pre> <p>\u5373\u6642\u8ffd\u8e64\u65e5\u8a8c</p> <p>\u4f7f\u7528 <code>-f</code> \u53c3\u6578\u53ef\u4ee5\u5373\u6642\u8ffd\u8e64\u65e5\u8a8c\u8f38\u51fa\uff1a </p><pre><code>docker logs -f mysql-2\n</code></pre> \u6309 <code>Ctrl+C</code> \u505c\u6b62\u8ffd\u8e64\u3002<p></p>"},{"location":"lab06_docker_basics/#4-docker-inspect","title":"\u6b65\u9a5f 4\uff1a\u4f7f\u7528 docker inspect \u67e5\u770b\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a","text":"<p><code>docker inspect</code> \u6703\u8f38\u51fa\u5bb9\u5668\u7684\u5b8c\u6574 JSON \u8cc7\u8a0a\uff1a</p> \u67e5\u770b\u5b8c\u6574\u8cc7\u8a0a<pre><code>docker inspect mysql-2\n</code></pre> <p>\u8f38\u51fa\u5167\u5bb9\u975e\u5e38\u9577\uff0c\u5305\u542b\uff1a</p> <ul> <li>State\uff1a\u5bb9\u5668\u72c0\u614b\uff08\u904b\u884c\u4e2d\u3001\u505c\u6b62\u7b49\uff09</li> <li>Config\uff1a\u5bb9\u5668\u8a2d\u5b9a\uff08\u74b0\u5883\u8b8a\u6578\u3001\u6307\u4ee4\u7b49\uff09</li> <li>NetworkSettings\uff1a\u7db2\u8def\u8a2d\u5b9a\uff08IP \u4f4d\u5740\u7b49\uff09</li> <li>Mounts\uff1a\u639b\u8f09\u7684 Volume</li> </ul>"},{"location":"lab06_docker_basics/#5-f","title":"\u6b65\u9a5f 5\uff1a\u4f7f\u7528 -f \u683c\u5f0f\u5316\u8f38\u51fa","text":"<p>\u4f7f\u7528 <code>-f</code> \u53c3\u6578\u642d\u914d Go Template \u8a9e\u6cd5\uff0c\u53ef\u4ee5\u53ea\u53d6\u51fa\u9700\u8981\u7684\u8cc7\u8a0a\uff1a</p> \u53d6\u5f97\u5bb9\u5668 IP \u4f4d\u5740<pre><code>docker inspect -f '{{ .NetworkSettings.IPAddress }}' mysql-2\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>172.17.0.3\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>grep</code> \u904e\u6ffe\uff1a</p> \u4f7f\u7528 grep \u904e\u6ffe<pre><code>docker inspect mysql-2 | grep -i ipadd\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>            \"SecondaryIPAddresses\": null,\n            \"IPAddress\": \"172.17.0.3\",\n                    \"IPAddress\": \"172.17.0.3\",\n</code></pre>"},{"location":"lab06_docker_basics/#6-docker-exec","title":"\u6b65\u9a5f 6\uff1a\u4f7f\u7528 docker exec \u9032\u5165\u5bb9\u5668","text":"<p>\u4f7f\u7528 <code>docker exec</code> \u53ef\u4ee5\u5728\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u5167\u57f7\u884c\u6307\u4ee4\uff1a</p> \u9032\u5165\u5bb9\u5668\u57f7\u884c bash<pre><code>docker exec -it mysql-2 /bin/bash\n</code></pre> <p>\u9032\u5165\u5bb9\u5668\u5f8c\uff0c\u53ef\u4ee5\u57f7\u884c\u5404\u7a2e\u6307\u4ee4\uff1a</p> \u5728\u5bb9\u5668\u5167\u64cd\u4f5c<pre><code># \u67e5\u770b\u4e3b\u6a5f\u540d\u7a31\nhostname\n\n# \u67e5\u770b MySQL \u7248\u672c\nmysql --version\n\n# \u9023\u7dda\u5230 MySQL\nmysql -u root -pcontainer\n\n# \u9000\u51fa MySQL\nexit\n\n# \u9000\u51fa\u5bb9\u5668\nexit\n</code></pre> <p>exec vs run</p> <ul> <li><code>docker run</code>\uff1a\u5efa\u7acb**\u65b0\u5bb9\u5668**\u4e26\u57f7\u884c\u6307\u4ee4</li> <li><code>docker exec</code>\uff1a\u5728**\u5df2\u904b\u884c**\u7684\u5bb9\u5668\u4e2d\u57f7\u884c\u6307\u4ee4</li> </ul>"},{"location":"lab06_docker_basics/#7","title":"\u6b65\u9a5f 7\uff1a\u555f\u52d5\u5bb9\u5668\u6642\u57f7\u884c\u81ea\u8a02\u6307\u4ee4","text":"<p>\u53ef\u4ee5\u5728 <code>docker run</code> \u5f8c\u9762\u6307\u5b9a\u8981\u57f7\u884c\u7684\u6307\u4ee4\uff08\u8986\u84cb\u9810\u8a2d CMD\uff09\uff1a</p> \u555f\u52d5\u5bb9\u5668\u4e26\u9032\u5165 bash<pre><code>docker run -it --name mysql-3 -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.5 /bin/bash\n</code></pre> <p>\u9019\u6a23\u5bb9\u5668\u555f\u52d5\u5f8c\u6703\u76f4\u63a5\u9032\u5165 bash\uff0c\u800c\u4e0d\u662f\u555f\u52d5 MySQL \u670d\u52d9\uff1a</p> <pre><code>root@6502526623f3:/# hostname\n6502526623f3\nroot@6502526623f3:/# exit\n</code></pre> <p>\u6ce8\u610f</p> <p>\u4f7f\u7528\u81ea\u8a02\u6307\u4ee4\u555f\u52d5\u6642\uff0cMySQL \u670d\u52d9\u4e0d\u6703\u81ea\u52d5\u555f\u52d5\uff01</p>"},{"location":"lab06_docker_basics/#8","title":"\u6b65\u9a5f 8\uff1a\u505c\u6b62\u8207\u522a\u9664\u5bb9\u5668","text":"\u505c\u6b62\u5bb9\u5668<pre><code>docker stop mysql-2 mysql-3\n</code></pre> \u522a\u9664\u5bb9\u5668<pre><code>docker rm mysql-2 mysql-3\n</code></pre> <p>\u4e00\u6b21\u522a\u9664\u6240\u6709\u505c\u6b62\u7684\u5bb9\u5668\uff1a</p> \u522a\u9664\u6240\u6709\u505c\u6b62\u7684\u5bb9\u5668<pre><code>docker rm $(docker ps -aq -f status=exited)\n</code></pre>"},{"location":"lab06_docker_basics/#_4","title":"\u6e05\u7406\u8173\u672c","text":"<p>\u5efa\u7acb\u4e00\u500b\u6e05\u7406\u6240\u6709\u5bb9\u5668\u548c\u6620\u50cf\u6a94\u7684\u8173\u672c\uff1a</p> docker_clean_all.sh<pre><code>#!/bin/bash\n# \u505c\u6b62\u6240\u6709\u5bb9\u5668\ndocker stop $(docker ps -aq)\n# \u522a\u9664\u6240\u6709\u5bb9\u5668\ndocker rm $(docker ps -aq)\n# \u522a\u9664\u6240\u6709\u6620\u50cf\u6a94\ndocker rmi -f $(docker images -aq)\n</code></pre> \u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod +x docker_clean_all.sh\n</code></pre>"},{"location":"lab06_docker_basics/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u555f\u52d5 MySQL \u5bb9\u5668\u5931\u6557 <p>\u539f\u56e0\uff1a\u6c92\u6709\u8a2d\u5b9a <code>MYSQL_ROOT_PASSWORD</code> \u74b0\u5883\u8b8a\u6578</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code>docker run -itd -e MYSQL_ROOT_PASSWORD=yourpassword mysql:5.6\n</code></pre><p></p> Q2\uff1adocker exec \u7121\u6cd5\u9032\u5165\u5bb9\u5668 <p>\u539f\u56e0\uff1a\u5bb9\u5668\u5df2\u505c\u6b62\u6216 bash \u4e0d\u5b58\u5728</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d\u5bb9\u5668\u904b\u884c\u4e2d\uff1a<code>docker ps</code> 2. \u5982\u679c\u6c92\u6709 bash\uff0c\u5617\u8a66 <code>/bin/sh</code></p> Q3\uff1a\u5bb9\u5668\u540d\u7a31\u885d\u7a81 <p>\u932f\u8aa4\u8a0a\u606f\uff1a<code>Conflict. The container name \"xxx\" is already in use</code></p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u522a\u9664\u820a\u5bb9\u5668\ndocker rm xxx\n# \u6216\u4f7f\u7528\u4e0d\u540c\u540d\u7a31\ndocker run --name xxx-new ...\n</code></pre><p></p>"},{"location":"lab06_docker_basics/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 docker run\uff1a\u4f7f\u7528 <code>-itd</code> \u80cc\u666f\u57f7\u884c\uff0c<code>--name</code> \u547d\u540d\uff0c<code>-e</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578</li> <li>\u2705 docker logs\uff1a\u67e5\u770b\u5bb9\u5668\u65e5\u8a8c\uff0c<code>-f</code> \u5373\u6642\u8ffd\u8e64</li> <li>\u2705 docker inspect\uff1a\u67e5\u770b\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\uff0c<code>-f</code> \u683c\u5f0f\u5316\u8f38\u51fa</li> <li>\u2705 docker exec\uff1a\u9032\u5165\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u57f7\u884c\u6307\u4ee4</li> </ul>"},{"location":"lab06_docker_basics/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker run \u5b98\u65b9\u6587\u4ef6</li> <li>Docker exec \u5b98\u65b9\u6587\u4ef6</li> <li>Docker logs \u5b98\u65b9\u6587\u4ef6</li> </ul>"},{"location":"lab07_persistent_storage/","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#lab-07-persistent-storage","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Docker Volume \u7684\u7528\u9014</li> <li> \u4f7f\u7528 <code>-v</code> \u53c3\u6578\u639b\u8f09\u76ee\u9304</li> <li> \u4f7f\u7528 Docker Volume \u7ba1\u7406\u8cc7\u6599\u6301\u4e45\u5316</li> <li> \u5be6\u4f5c MariaDB \u8cc7\u6599\u6301\u4e45\u5316</li> </ul>"},{"location":"lab07_persistent_storage/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 06 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u719f\u6089 <code>docker run</code> \u6307\u4ee4</li> <li>\u6e96\u5099\u597d docker2 \u865b\u64ec\u6a5f\u74b0\u5883</li> </ul>"},{"location":"lab07_persistent_storage/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab07_persistent_storage/#persistent-storage","title":"\u70ba\u4ec0\u9ebc\u9700\u8981 Persistent Storage\uff1f","text":"<p>Docker \u5bb9\u5668\u662f\u300c\u7121\u72c0\u614b\u300d\u7684\uff0c\u7576\u5bb9\u5668\u88ab\u522a\u9664\u6642\uff0c\u5bb9\u5668\u5167\u7684\u6240\u6709\u8cc7\u6599\u4e5f\u6703\u4e00\u4f75\u6d88\u5931\u3002\u5c0d\u65bc\u8cc7\u6599\u5eab\u9019\u985e\u9700\u8981\u6301\u4e45\u5316\u8cc7\u6599\u7684\u61c9\u7528\uff0c\u6211\u5011\u9700\u8981\u4f7f\u7528 Volume \u4f86\u4fdd\u5b58\u8cc7\u6599\u3002</p> <pre><code>graph TB\n    subgraph problem[\"\u554f\u984c\uff1a\u8cc7\u6599\u96a8\u5bb9\u5668\u6d88\u5931\"]\n        C1[\"\u5bb9\u5668 1\"] --&gt; Data1[\"\u8cc7\u6599\"]\n        C1 --&gt; |\u522a\u9664| Gone[\"\u8cc7\u6599\u6d88\u5931 \u274c\"]\n    end\n\n    subgraph solution[\"\u89e3\u6c7a\uff1a\u4f7f\u7528 Volume\"]\n        C2[\"\u5bb9\u5668 2\"] --&gt; Volume[\"Volume\"]\n        Volume --&gt; Host[\"/docker_data\"]\n        C2 --&gt; |\u522a\u9664| Keep[\"\u8cc7\u6599\u4fdd\u7559 \u2705\"]\n    end</code></pre>"},{"location":"lab07_persistent_storage/#volume","title":"Volume \u985e\u578b","text":"\u985e\u578b \u8aaa\u660e \u7bc4\u4f8b Bind Mount \u639b\u8f09\u4e3b\u6a5f\u76ee\u9304 <code>-v /host/path:/container/path</code> Named Volume Docker \u7ba1\u7406\u7684 Volume <code>-v myvolume:/container/path</code> Anonymous Volume \u81ea\u52d5\u5efa\u7acb\u7684 Volume \u6620\u50cf\u6a94\u4e2d VOLUME \u6307\u4ee4\u5b9a\u7fa9"},{"location":"lab07_persistent_storage/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>"},{"location":"lab07_persistent_storage/#1","title":"\u6b65\u9a5f 1\uff1a\u6e96\u5099\u4e3b\u6a5f\u76ee\u9304","text":"<p>\u5728\u4e3b\u6a5f\u4e0a\u5efa\u7acb\u7528\u65bc\u5b58\u653e\u8cc7\u6599\u5eab\u8cc7\u6599\u7684\u76ee\u9304\uff1a</p> \u5efa\u7acb\u8cc7\u6599\u76ee\u9304<pre><code>mkdir -p /docker_data/db1\n</code></pre> \u78ba\u8a8d\u76ee\u9304<pre><code>ls -l /docker_data/\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>total 0\ndrwxr-xr-x 2 root root 6 Feb  4 12:22 db1\n</code></pre>"},{"location":"lab07_persistent_storage/#2-mariadb-volume","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 MariaDB \u4e26\u639b\u8f09 Volume","text":"<p>\u4f7f\u7528 <code>-v</code> \u53c3\u6578\u5c07\u4e3b\u6a5f\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668\u5167\uff1a</p> \u4e0b\u8f09 MariaDB \u6620\u50cf\u6a94<pre><code>docker pull docker1.training.lab:5000/mariadb\n</code></pre> \u555f\u52d5 MariaDB \u4e26\u639b\u8f09 Volume<pre><code>docker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e <code>-p 3306:3306</code> \u5c07\u4e3b\u6a5f 3306 \u57e0\u5c0d\u61c9\u5230\u5bb9\u5668 3306 \u57e0 <code>-v /docker_data/db1:/var/lib/mysql</code> \u639b\u8f09\u4e3b\u6a5f\u76ee\u9304\u5230\u5bb9\u5668\u7684 MySQL \u8cc7\u6599\u76ee\u9304 <code>-e MYSQL_ROOT_PASSWORD=container</code> \u8a2d\u5b9a root \u5bc6\u78bc"},{"location":"lab07_persistent_storage/#3","title":"\u6b65\u9a5f 3\uff1a\u78ba\u8a8d\u8cc7\u6599\u5df2\u5beb\u5165\u4e3b\u6a5f\u76ee\u9304","text":"<p>\u7b49\u5f85\u5bb9\u5668\u555f\u52d5\u5b8c\u6210\u5f8c\uff0c\u6aa2\u67e5\u4e3b\u6a5f\u76ee\u9304\uff1a</p> \u6aa2\u67e5\u8cc7\u6599\u76ee\u9304<pre><code>ls -l /docker_data/db1/\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>total 122928\n-rw-rw---- 1 systemd-coredump root    417792 Feb  4 12:24 aria_log.00000001\n-rw-rw---- 1 systemd-coredump root        52 Feb  4 12:24 aria_log_control\n-rw-rw---- 1 systemd-coredump root         0 Feb  4 12:24 multi-master.info\ndrwx------ 2 systemd-coredump root      4096 Feb  4 12:24 mysql\ndrwx------ 2 systemd-coredump root        20 Feb  4 12:24 performance_schema\n...\n</code></pre> <p>\u8cc7\u6599\u6301\u4e45\u5316\u6210\u529f</p> <p>\u770b\u5230\u9019\u4e9b\u6a94\u6848\u8868\u793a MariaDB \u7684\u8cc7\u6599\u5df2\u7d93\u5beb\u5165\u5230\u4e3b\u6a5f\u7684 <code>/docker_data/db1</code> \u76ee\u9304\u4e2d\uff01</p>"},{"location":"lab07_persistent_storage/#4","title":"\u6b65\u9a5f 4\uff1a\u9a57\u8b49\u8cc7\u6599\u6301\u4e45\u5316","text":"<p>\u5efa\u7acb\u6e2c\u8a66\u8cc7\u6599\u5eab\uff1a</p> \u9023\u7dda\u5230 MariaDB<pre><code>docker exec -it db1 mysql -u root -pcontainer\n</code></pre> \u5efa\u7acb\u6e2c\u8a66\u8cc7\u6599\u5eab<pre><code>CREATE DATABASE testdb;\nSHOW DATABASES;\nEXIT;\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| testdb             |\n+--------------------+\n</code></pre>"},{"location":"lab07_persistent_storage/#5","title":"\u6b65\u9a5f 5\uff1a\u522a\u9664\u5bb9\u5668\u4e26\u91cd\u65b0\u5efa\u7acb","text":"<p>\u522a\u9664\u5bb9\u5668\uff1a</p> \u505c\u6b62\u4e26\u522a\u9664\u5bb9\u5668<pre><code>docker stop db1\ndocker rm db1\n</code></pre> <p>\u91cd\u65b0\u5efa\u7acb\u5bb9\u5668\uff08\u4f7f\u7528\u76f8\u540c\u7684 Volume\uff09\uff1a</p> \u91cd\u65b0\u5efa\u7acb\u5bb9\u5668<pre><code>docker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n</code></pre> <p>\u9a57\u8b49\u8cc7\u6599\u662f\u5426\u4fdd\u7559\uff1a</p> \u78ba\u8a8d\u8cc7\u6599\u5eab\u4ecd\u7136\u5b58\u5728<pre><code>docker exec -it db1 mysql -u root -pcontainer -e \"SHOW DATABASES;\"\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| testdb             |   &lt;-- \u8cc7\u6599\u4fdd\u7559\uff01\n+--------------------+\n</code></pre> <p>\u8cc7\u6599\u6301\u4e45\u5316\u9a57\u8b49\u6210\u529f</p> <p>\u5373\u4f7f\u5bb9\u5668\u88ab\u522a\u9664\u91cd\u5efa\uff0c\u8cc7\u6599\u4ecd\u7136\u4fdd\u7559\uff01</p>"},{"location":"lab07_persistent_storage/#6-docker-volume","title":"\u6b65\u9a5f 6\uff1a\u67e5\u770b Docker Volume","text":"<p>\u4f7f\u7528 <code>docker volume</code> \u6307\u4ee4\u7ba1\u7406 Volume\uff1a</p> \u5217\u51fa\u6240\u6709 Volume<pre><code>docker volume ls\n</code></pre> \u6aa2\u67e5\u5bb9\u5668\u7684 Volume \u639b\u8f09<pre><code>docker inspect db1 | grep -A 10 Mounts\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\"Mounts\": [\n    {\n        \"Type\": \"bind\",\n        \"Source\": \"/docker_data/db1\",\n        \"Destination\": \"/var/lib/mysql\",\n        \"Mode\": \"\",\n        \"RW\": true,\n        \"Propagation\": \"rprivate\"\n    }\n],\n</code></pre>"},{"location":"lab07_persistent_storage/#7-named-volume","title":"\u6b65\u9a5f 7\uff1a\u4f7f\u7528 Named Volume","text":"<p>\u9664\u4e86 Bind Mount\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Docker \u7ba1\u7406\u7684 Named Volume\uff1a</p> \u5efa\u7acb Named Volume<pre><code>docker volume create mydata\n</code></pre> \u4f7f\u7528 Named Volume<pre><code>docker run -itd \\\n  --name db2 \\\n  -v mydata:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n</code></pre> \u67e5\u770b Volume \u8a73\u7d30\u8cc7\u8a0a<pre><code>docker volume inspect mydata\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>[\n    {\n        \"CreatedAt\": \"2025-02-04T12:30:00+08:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {},\n        \"Mountpoint\": \"/var/lib/docker/volumes/mydata/_data\",\n        \"Name\": \"mydata\",\n        \"Options\": {},\n        \"Scope\": \"local\"\n    }\n]\n</code></pre>"},{"location":"lab07_persistent_storage/#bind-mount-vs-named-volume","title":"Bind Mount vs Named Volume","text":"\u7279\u6027 Bind Mount Named Volume \u8def\u5f91\u6307\u5b9a \u5fc5\u9808\u6307\u5b9a\u5b8c\u6574\u8def\u5f91 \u53ea\u9700\u6307\u5b9a\u540d\u7a31 \u8cc7\u6599\u4f4d\u7f6e \u81ea\u8a02\u8def\u5f91 <code>/var/lib/docker/volumes/</code> \u5099\u4efd\u65b9\u4fbf\u6027 \u8f03\u65b9\u4fbf \u9700\u900f\u904e Docker \u6307\u4ee4 \u9069\u7528\u5834\u666f \u958b\u767c\u74b0\u5883\u3001\u9700\u8981\u76f4\u63a5\u5b58\u53d6 \u751f\u7522\u74b0\u5883\u3001\u8cc7\u6599\u9694\u96e2"},{"location":"lab07_persistent_storage/#_4","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u6e05\u7406\u5bb9\u5668\u548c Volume<pre><code>docker stop db1 db2\ndocker rm db1 db2\ndocker volume rm mydata\n</code></pre>"},{"location":"lab07_persistent_storage/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u639b\u8f09\u76ee\u9304\u5f8c\u5bb9\u5668\u5167\u770b\u4e0d\u5230\u8cc7\u6599 <p>\u539f\u56e0\uff1a\u5bb9\u5668\u5167\u539f\u6709\u7684\u8cc7\u6599\u88ab\u4e3b\u6a5f\u7a7a\u76ee\u9304\u8986\u84cb</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a \u78ba\u4fdd\u4e3b\u6a5f\u76ee\u9304\u662f\u7a7a\u7684\uff0c\u8b93\u5bb9\u5668\u521d\u59cb\u5316\u8cc7\u6599</p> Q2\uff1a\u6b0a\u9650\u554f\u984c\u5c0e\u81f4\u7121\u6cd5\u5beb\u5165 <p>\u539f\u56e0\uff1a\u4e3b\u6a5f\u76ee\u9304\u6b0a\u9650\u4e0d\u8db3</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code>chmod 777 /docker_data/db1\n</code></pre><p></p> Q3\uff1aVolume \u4f54\u7528\u7a7a\u9593\u5982\u4f55\u6e05\u7406 <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n</code></pre><p></p>"},{"location":"lab07_persistent_storage/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Bind Mount\uff1a\u4f7f\u7528 <code>-v /host/path:/container/path</code> \u639b\u8f09\u4e3b\u6a5f\u76ee\u9304</li> <li>\u2705 Named Volume\uff1a\u4f7f\u7528 <code>docker volume create</code> \u5efa\u7acb\u7ba1\u7406\u578b Volume</li> <li>\u2705 \u8cc7\u6599\u6301\u4e45\u5316\uff1a\u5bb9\u5668\u522a\u9664\u5f8c\u8cc7\u6599\u4ecd\u4fdd\u7559\u5728 Volume \u4e2d</li> <li>\u2705 Volume \u7ba1\u7406\uff1a\u4f7f\u7528 <code>docker volume ls/inspect/rm/prune</code> \u7ba1\u7406</li> </ul>"},{"location":"lab07_persistent_storage/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker Volume \u5b98\u65b9\u6587\u4ef6</li> <li>Bind Mounts \u5b98\u65b9\u6587\u4ef6</li> </ul>"},{"location":"lab08_wordpress/","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - wordpress","text":""},{"location":"lab08_wordpress/#lab-08-wordpress","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - WordPress","text":""},{"location":"lab08_wordpress/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 <code>--link</code> \u9023\u63a5\u591a\u500b\u5bb9\u5668</li> <li> \u90e8\u7f72 WordPress + MariaDB \u67b6\u69cb</li> <li> \u8a2d\u5b9a WordPress \u74b0\u5883\u8b8a\u6578</li> <li> \u5b8c\u6210 WordPress \u521d\u59cb\u5316\u8a2d\u5b9a</li> </ul>"},{"location":"lab08_wordpress/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 07 Persistent Storage</li> <li>\u719f\u6089 Docker Volume \u639b\u8f09</li> <li>\u6e96\u5099\u597d docker2 \u865b\u64ec\u6a5f\u74b0\u5883</li> </ul>"},{"location":"lab08_wordpress/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab08_wordpress/#wordpress","title":"WordPress \u67b6\u69cb","text":"<p>WordPress \u662f\u4e00\u500b\u958b\u6e90\u7684\u90e8\u843d\u683c/CMS \u7cfb\u7d71\uff0c\u9700\u8981\u642d\u914d\u8cc7\u6599\u5eab\u4f7f\u7528\u3002\u672c Lab \u5c07\u90e8\u7f72\uff1a</p> <pre><code>graph LR\n    subgraph docker2[\"docker2 \u865b\u64ec\u6a5f\"]\n        Browser[\"\u700f\u89bd\u5668\"] --&gt; WP[\"WordPress\"]\n        WP --&gt; |\"--link\"| DB[\"MariaDB\"]\n        WP --&gt; WPData[\"/docker_data/wordpress\"]\n        DB --&gt; DBData[\"/docker_data/db1\"]\n    end</code></pre>"},{"location":"lab08_wordpress/#_4","title":"\u5bb9\u5668\u9593\u901a\u8a0a","text":"<p>\u4f7f\u7528 <code>--link</code> \u53ef\u4ee5\u8b93\u5bb9\u5668\u4e4b\u9593\u900f\u904e\u540d\u7a31\u4e92\u76f8\u5b58\u53d6\uff1a</p> \u53c3\u6578 \u8aaa\u660e <code>--link db1:mysql</code> \u9023\u63a5\u5230 db1 \u5bb9\u5668\uff0c\u4e26\u5efa\u7acb\u5225\u540d mysql <p>\u9023\u63a5\u5f8c\uff0cWordPress \u5bb9\u5668\u53ef\u4ee5\u900f\u904e <code>mysql</code> \u9019\u500b\u540d\u7a31\u5b58\u53d6 MariaDB\u3002</p>"},{"location":"lab08_wordpress/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>"},{"location":"lab08_wordpress/#1","title":"\u6b65\u9a5f 1\uff1a\u6e96\u5099\u8cc7\u6599\u76ee\u9304","text":"<p>\u5efa\u7acb WordPress \u548c\u8cc7\u6599\u5eab\u7684\u8cc7\u6599\u76ee\u9304\uff1a</p> \u5efa\u7acb\u8cc7\u6599\u76ee\u9304<pre><code>mkdir -p /docker_data/db1\nmkdir -p /docker_data/wordpress\n</code></pre> \u78ba\u8a8d\u76ee\u9304<pre><code>ls -l /docker_data/\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>total 4\ndrwxr-xr-x 4 systemd-coredump root 4096 Feb  4 12:24 db1\ndrwxr-xr-x 2 root             root    6 Feb  4 12:25 wordpress\n</code></pre>"},{"location":"lab08_wordpress/#2-mariadb","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 MariaDB \u8cc7\u6599\u5eab","text":"<p>\u9996\u5148\u555f\u52d5\u8cc7\u6599\u5eab\u5bb9\u5668\uff1a</p> \u4e0b\u8f09 MariaDB<pre><code>docker pull docker1.training.lab:5000/mariadb\n</code></pre> \u555f\u52d5 MariaDB<pre><code>docker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n</code></pre> <p>\u9a57\u8b49\u8cc7\u6599\u5eab\u555f\u52d5\uff1a</p> \u6aa2\u67e5\u5bb9\u5668\u72c0\u614b<pre><code>docker ps\n</code></pre> \u67e5\u770b\u65e5\u8a8c\u78ba\u8a8d\u555f\u52d5\u5b8c\u6210<pre><code>docker logs db1\n</code></pre> <p>\u7b49\u5f85\u8cc7\u6599\u5eab\u521d\u59cb\u5316</p> <p>\u9996\u6b21\u555f\u52d5 MariaDB \u9700\u8981\u4e00\u4e9b\u6642\u9593\u521d\u59cb\u5316\uff0c\u8acb\u7b49\u5f85\u770b\u5230 <code>ready for connections</code> \u8a0a\u606f\u5f8c\u518d\u7e7c\u7e8c\u3002</p>"},{"location":"lab08_wordpress/#3-wordpress","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 WordPress","text":"<p>\u4e0b\u8f09\u4e26\u555f\u52d5 WordPress \u5bb9\u5668\uff1a</p> \u4e0b\u8f09 WordPress<pre><code>docker pull docker1.training.lab:5000/wordpress\n</code></pre> \u555f\u52d5 WordPress<pre><code>docker run -itd \\\n  --name wordpress \\\n  -p 80:80 \\\n  --link db1:mysql \\\n  -v /docker_data/wordpress:/var/www/html \\\n  -e WORDPRESS_DB_NAME=wp \\\n  -e WORDPRESS_DB_USER=root \\\n  -e WORDPRESS_DB_PASSWORD=container \\\n  -e ServerName=localhost \\\n  docker1.training.lab:5000/wordpress\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e <code>-p 80:80</code> \u5c07\u4e3b\u6a5f 80 \u57e0\u5c0d\u61c9\u5230\u5bb9\u5668 80 \u57e0 <code>--link db1:mysql</code> \u9023\u63a5\u5230 db1 \u5bb9\u5668\uff0c\u5225\u540d\u70ba mysql <code>-v /docker_data/wordpress:/var/www/html</code> \u639b\u8f09 WordPress \u6a94\u6848\u76ee\u9304 <code>WORDPRESS_DB_NAME=wp</code> WordPress \u4f7f\u7528\u7684\u8cc7\u6599\u5eab\u540d\u7a31 <code>WORDPRESS_DB_USER=root</code> \u8cc7\u6599\u5eab\u4f7f\u7528\u8005 <code>WORDPRESS_DB_PASSWORD=container</code> \u8cc7\u6599\u5eab\u5bc6\u78bc"},{"location":"lab08_wordpress/#4","title":"\u6b65\u9a5f 4\uff1a\u9a57\u8b49\u90e8\u7f72","text":"<p>\u6aa2\u67e5\u5169\u500b\u5bb9\u5668\u90fd\u5728\u904b\u884c\uff1a</p> \u6aa2\u67e5\u5bb9\u5668\u72c0\u614b<pre><code>docker ps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE                                   COMMAND                  STATUS         PORTS                 NAMES\n36aa6bc3480c   docker1.training.lab:5000/wordpress    \"docker-entrypoint.s\u2026\"   Up 10 seconds  0.0.0.0:80-&gt;80/tcp    wordpress\n45f821b7df69   docker1.training.lab:5000/mariadb      \"docker-entrypoint.s\u2026\"   Up 2 minutes   0.0.0.0:3306-&gt;3306/tcp db1\n</code></pre> <p>\u6aa2\u67e5 WordPress \u6a94\u6848\u662f\u5426\u5df2\u5efa\u7acb\uff1a</p> \u6aa2\u67e5 WordPress \u76ee\u9304<pre><code>ls -l /docker_data/wordpress/\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>total 236\n-rw-r--r--  1 www-data www-data   405 Feb  6  2020 index.php\n-rw-r--r--  1 www-data www-data 19915 Jan  1  2020 license.txt\n-rw-r--r--  1 www-data www-data  7278 Jun 26  2020 readme.html\n-rw-r--r--  1 www-data www-data  7101 Jul 28  2020 wp-activate.php\ndrwxr-xr-x  9 www-data www-data  4096 Dec  8  2020 wp-admin\n...\n</code></pre>"},{"location":"lab08_wordpress/#5-wordpress","title":"\u6b65\u9a5f 5\uff1a\u958b\u555f WordPress \u7db2\u9801","text":"<p>\u5728\u5716\u5f62\u74b0\u5883\u4e2d\u958b\u555f\u700f\u89bd\u5668\uff0c\u9023\u7dda\u5230 docker2\uff1a</p> <pre><code>http://192.168.66.22\n</code></pre> <p>\u6216\u5728\u672c\u6a5f\uff1a</p> <pre><code>http://localhost\n</code></pre> <p>\u4f60\u6703\u770b\u5230 WordPress \u5b89\u88dd\u9801\u9762\uff01</p>"},{"location":"lab08_wordpress/#6-wordpress","title":"\u6b65\u9a5f 6\uff1a\u5b8c\u6210 WordPress \u5b89\u88dd","text":"<ol> <li>\u9078\u64c7\u8a9e\u8a00\uff08\u7e41\u9ad4\u4e2d\u6587\uff09</li> <li>\u586b\u5beb\u7db2\u7ad9\u8cc7\u8a0a\uff1a</li> <li>\u7db2\u7ad9\u6a19\u984c\uff1aMy Blog</li> <li>\u4f7f\u7528\u8005\u540d\u7a31\uff1aadmin</li> <li>\u5bc6\u78bc\uff1a\u8a2d\u5b9a\u4f60\u7684\u5bc6\u78bc</li> <li>\u96fb\u5b50\u90f5\u4ef6\uff1ayour@email.com</li> <li>\u9ede\u9078\u300c\u5b89\u88dd WordPress\u300d</li> </ol> <p>\u5b89\u88dd\u5b8c\u6210</p> <p>\u770b\u5230\u300c\u6210\u529f\uff01\u300d\u8a0a\u606f\u8868\u793a WordPress \u5df2\u5b89\u88dd\u5b8c\u6210\uff01</p>"},{"location":"lab08_wordpress/#7","title":"\u6b65\u9a5f 7\uff1a\u9a57\u8b49\u8cc7\u6599\u6301\u4e45\u5316","text":"<p>\u522a\u9664\u4e26\u91cd\u5efa WordPress \u5bb9\u5668\uff1a</p> \u522a\u9664 WordPress \u5bb9\u5668<pre><code>docker stop wordpress\ndocker rm wordpress\n</code></pre> <p>\u91cd\u65b0\u5efa\u7acb\uff08\u4f7f\u7528\u76f8\u540c\u7684 Volume\uff09\uff1a</p> \u91cd\u65b0\u5efa\u7acb WordPress<pre><code>docker run -itd \\\n  --name wordpress \\\n  -p 80:80 \\\n  --link db1:mysql \\\n  -v /docker_data/wordpress:/var/www/html \\\n  -e WORDPRESS_DB_NAME=wp \\\n  -e WORDPRESS_DB_USER=root \\\n  -e WORDPRESS_DB_PASSWORD=container \\\n  docker1.training.lab:5000/wordpress\n</code></pre> <p>\u91cd\u65b0\u958b\u555f\u700f\u89bd\u5668\uff0c\u4f60\u7684 WordPress \u7db2\u7ad9\u548c\u6240\u6709\u8a2d\u5b9a\u90fd\u9084\u5728\uff01</p>"},{"location":"lab08_wordpress/#_5","title":"\u67b6\u69cb\u7e3d\u89bd","text":"\u5bb9\u5668 \u6620\u50cf\u6a94 Port Volume \u8aaa\u660e db1 mariadb 3306 /docker_data/db1 \u8cc7\u6599\u5eab wordpress wordpress 80 /docker_data/wordpress \u7db2\u9801\u4f3a\u670d\u5668"},{"location":"lab08_wordpress/#_6","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u505c\u6b62\u4e26\u522a\u9664\u5bb9\u5668<pre><code>docker stop wordpress db1\ndocker rm wordpress db1\n</code></pre> <p>\u5982\u9700\u6e05\u9664\u8cc7\u6599\uff1a</p> \u6e05\u9664\u8cc7\u6599\u76ee\u9304<pre><code>rm -rf /docker_data/db1/*\nrm -rf /docker_data/wordpress/*\n</code></pre>"},{"location":"lab08_wordpress/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aWordPress \u986f\u793a\u7121\u6cd5\u9023\u63a5\u8cc7\u6599\u5eab <p>\u539f\u56e0\uff1aMariaDB \u5c1a\u672a\u555f\u52d5\u5b8c\u6210\uff0c\u6216 --link \u8a2d\u5b9a\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d db1 \u5bb9\u5668\u5df2\u555f\u52d5\uff1a<code>docker ps</code> 2. \u78ba\u8a8d --link \u53c3\u6578\u6b63\u78ba\uff1a<code>--link db1:mysql</code> 3. \u7b49\u5f85 MariaDB \u521d\u59cb\u5316\u5b8c\u6210\u5f8c\u518d\u555f\u52d5 WordPress</p> Q2\uff1a\u7121\u6cd5\u9023\u7dda\u5230 80 \u57e0 <p>\u539f\u56e0\uff1a\u9632\u706b\u7246\u963b\u64cb\u6216 WordPress \u5bb9\u5668\u672a\u555f\u52d5</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u78ba\u8a8d\u5bb9\u5668\u904b\u884c\u4e2d\ndocker ps\n\n# \u78ba\u8a8d\u57e0\u5c0d\u61c9\ndocker port wordpress\n</code></pre><p></p> Q3\uff1aWordPress \u5b89\u88dd\u5f8c\u8cc7\u6599\u6d88\u5931 <p>\u539f\u56e0\uff1a\u6c92\u6709\u4f7f\u7528 Volume \u639b\u8f09</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a \u78ba\u4fdd\u4f7f\u7528 <code>-v /docker_data/wordpress:/var/www/html</code> \u53c3\u6578</p>"},{"location":"lab08_wordpress/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 --link\uff1a\u9023\u63a5\u5bb9\u5668\uff0c\u8b93 WordPress \u53ef\u4ee5\u5b58\u53d6 MariaDB</li> <li>\u2705 \u591a\u5bb9\u5668\u67b6\u69cb\uff1a\u5206\u96e2\u61c9\u7528\u7a0b\u5f0f\u548c\u8cc7\u6599\u5eab</li> <li>\u2705 \u74b0\u5883\u8b8a\u6578\uff1a\u900f\u904e <code>-e</code> \u8a2d\u5b9a WordPress \u8cc7\u6599\u5eab\u9023\u7dda\u8cc7\u8a0a</li> <li>\u2705 \u8cc7\u6599\u6301\u4e45\u5316\uff1a\u4f7f\u7528 Volume \u4fdd\u5b58 WordPress \u6a94\u6848\u548c\u8cc7\u6599\u5eab</li> </ul>"},{"location":"lab08_wordpress/#_9","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>WordPress Docker Hub</li> <li>MariaDB Docker Hub</li> <li>Docker Compose \u7c21\u5316\u591a\u5bb9\u5668\u90e8\u7f72</li> </ul>"},{"location":"lab09_commit/","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#lab-09-container-images-docker-commit","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 <code>docker commit</code> \u5f9e\u5bb9\u5668\u5efa\u7acb\u65b0\u7684 Image</li> <li> \u4f7f\u7528 <code>docker save</code> \u5c07 Image \u532f\u51fa\u70ba tar \u6a94</li> <li> \u4f7f\u7528 <code>docker load</code> \u5f9e tar \u6a94\u8f09\u5165 Image</li> <li> \u5efa\u7acb\u6e05\u7406 Docker \u74b0\u5883\u7684\u8173\u672c</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 06 \u7684\u5167\u5bb9</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u5df2\u8a2d\u5b9a Private Registry\uff08docker1.training.lab:5000\uff09</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#91","title":"9.1 \u74b0\u5883\u6e96\u5099","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker2","title":"\u5207\u63db\u5230 docker2 \u865b\u64ec\u6a5f","text":"<p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_3","title":"\u78ba\u8a8d\u73fe\u6709\u74b0\u5883","text":"\u6aa2\u8996\u73fe\u6709\u7684 Container Images<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\n192.168.66.51:5000/nginx:1.9.1          667cfe3b0942        289MB          139MB        \ndocker1.training.lab:5000/nginx:1.7.1   b1590b02702d       1.06GB          515MB        \n</code></pre> \u6aa2\u8996\u73fe\u6709\u7684 Container<pre><code>docker ps -a\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_4","title":"\u5efa\u7acb\u6e05\u7406\u8173\u672c","text":"<p>\u5efa\u7acb\u4e00\u500b\u8173\u672c\u4f86\u6e05\u7406\u6240\u6709 Container \u8207 Image\uff1a</p> \u5efa\u7acb docker_clean_all.sh<pre><code>vi docker_clean_all.sh\n</code></pre> <p>\u8173\u672c\u5167\u5bb9\uff1a</p> docker_clean_all.sh<pre><code>#!/bin/bash\n# \u505c\u6b62\u4e26\u522a\u9664\u6240\u6709 Container\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\n# \u522a\u9664\u6240\u6709 Image\ndocker rmi $(docker images -q)\n</code></pre> <p>\u8173\u672c\u8aaa\u660e</p> <ul> <li><code>docker ps -aq</code>\uff1a\u5217\u51fa\u6240\u6709 Container \u7684 ID\uff08<code>-a</code> \u5305\u542b\u5df2\u505c\u6b62\u7684\uff0c<code>-q</code> \u53ea\u986f\u793a ID\uff09</li> <li><code>docker images -q</code>\uff1a\u5217\u51fa\u6240\u6709 Image \u7684 ID</li> <li>\u5982\u679c\u6c92\u6709 Container \u6216 Image\uff0c\u6307\u4ee4\u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u4f46\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c</li> </ul> \u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 ./docker_clean_all.sh\n</code></pre> \u57f7\u884c\u6e05\u7406\u8173\u672c<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>docker: 'docker stop' requires at least 1 argument\ndocker: 'docker rm' requires at least 1 argument\nUntagged: 192.168.66.51:5000/nginx:1.9.1\nDeleted: sha256:667cfe3b094262dcd2323f28a800d8376221b017a9dd14b6fff78e4ec96a6177\nUntagged: docker1.training.lab:5000/nginx:1.7.1\nDeleted: sha256:b1590b02702d926755e02ca8f01baa42c9789758a3fb6d40aa87bdcfe871965d\n</code></pre> <p>\u932f\u8aa4\u8a0a\u606f\u8aaa\u660e</p> <p>\u7576\u6c92\u6709 Container \u6642\uff0c<code>docker stop</code> \u548c <code>docker rm</code> \u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u9019\u662f\u6b63\u5e38\u7684\uff0c\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#92-docker-image","title":"9.2 \u4e0b\u8f09 Docker Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#private-registry-alpine","title":"\u5f9e Private Registry \u4e0b\u8f09 Alpine","text":"\u4e0b\u8f09 Alpine Image<pre><code>docker pull docker1.training.lab:5000/alpine\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Using default tag: latest\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\ndocker1.training.lab:5000/alpine:latest\n</code></pre> <p>docker pull \u8aaa\u660e</p> <ul> <li>\u5982\u679c\u6c92\u6709\u6307\u5b9a tag\uff0c\u9810\u8a2d\u6703\u4f7f\u7528 <code>latest</code></li> <li>\u5f9e Private Registry \u4e0b\u8f09\u9700\u8981\u6307\u5b9a\u5b8c\u6574\u7684 Registry \u4f4d\u5740</li> </ul> \u78ba\u8a8d Image \u5df2\u4e0b\u8f09<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB        \n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#93-alpine-sh","title":"9.3 \u9032\u5165 Alpine \u57f7\u884c sh","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#container","title":"\u555f\u52d5\u4e92\u52d5\u5f0f Container","text":"\u555f\u52d5 Alpine Container<pre><code>docker run -it --name alpine-1 docker1.training.lab:5000/alpine:latest\n</code></pre> <p>docker run \u53c3\u6578\u8aaa\u660e</p> \u53c3\u6578 \u8aaa\u660e <code>-i</code> \u4fdd\u6301 STDIN \u958b\u555f\uff08interactive\uff09 <code>-t</code> \u5206\u914d\u865b\u64ec\u7d42\u7aef\u6a5f\uff08tty\uff09 <code>--name alpine-1</code> \u6307\u5b9a Container \u540d\u7a31 <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230\u63d0\u793a\u7b26\u865f <code>/ #</code>\uff0c\u8868\u793a\u5df2\u5728 Container \u5167\u90e8\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#94-alpine-bash","title":"9.4 \u5728 Alpine \u4e2d\u5b89\u88dd Bash","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#bash","title":"\u6e2c\u8a66 Bash \u662f\u5426\u5b58\u5728","text":"\u6e2c\u8a66 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>/bin/sh: bash: not found\n</code></pre> <p>\u70ba\u4ec0\u9ebc Alpine \u6c92\u6709 Bash\uff1f</p> <p>Alpine Linux \u662f\u4e00\u500b\u6975\u8f15\u91cf\u7684 Linux \u767c\u884c\u7248\uff0c\u4f7f\u7528 BusyBox \u4f5c\u70ba\u6838\u5fc3\u5de5\u5177\u96c6\uff0c\u9810\u8a2d\u53ea\u63d0\u4f9b <code>/bin/sh</code>\uff08ash shell\uff09\u4ee5\u7dad\u6301\u6975\u5c0f\u7684\u6620\u50cf\u5927\u5c0f\uff08\u7d04 5MB\uff09\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#apk-bash","title":"\u4f7f\u7528 apk \u5b89\u88dd Bash","text":"\u5b89\u88dd bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>apk add --no-cache --update-cache bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>fetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing ncurses-terminfo-base (6.1_p20190518-r2)\n(2/4) Installing ncurses-libs (6.1_p20190518-r2)\n(3/4) Installing readline (8.0.0-r0)\n(4/4) Installing bash (5.0.0-r0)\nExecuting bash-5.0.0-r0.post-install\nExecuting busybox-1.30.1-r2.trigger\nOK: 8 MiB in 18 packages\n</code></pre> <p>apk \u53c3\u6578\u8aaa\u660e</p> \u53c3\u6578 \u8aaa\u660e <code>add</code> \u5b89\u88dd\u5957\u4ef6 <code>--no-cache</code> \u4e0d\u4f7f\u7528\u672c\u5730\u5feb\u53d6\uff0c\u6e1b\u5c11 Image \u5927\u5c0f <code>--update-cache</code> \u66f4\u65b0\u5957\u4ef6\u7d22\u5f15","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_5","title":"\u9a57\u8b49\u5b89\u88dd\u6210\u529f","text":"\u5207\u63db\u5230 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <p>\u6210\u529f\u9032\u5165 bash\uff0c\u63d0\u793a\u7b26\u865f\u8b8a\u6210 <code>bash-5.0#</code></p> \u9000\u51fa Container<pre><code>exit  # \u9000\u51fa bash\nexit  # \u9000\u51fa Container\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#95-commit-container-image","title":"9.5 Commit \u65b0\u7684 Container Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-commit-image","title":"\u4f7f\u7528 docker commit \u5efa\u7acb\u65b0 Image","text":"\u5efa\u7acb\u65b0 Image<pre><code>docker commit -m \"alpine + bash\" alpine-1 alpine-bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n</code></pre> <p>docker commit \u8a9e\u6cd5</p> <pre><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-m</code> \u63d0\u4ea4\u8a0a\u606f\uff08\u63cf\u8ff0\u8b8a\u66f4\u5167\u5bb9\uff09 <code>-a</code> \u6307\u5b9a\u4f5c\u8005\uff08\u53ef\u9078\uff09 <code>alpine-1</code> \u4f86\u6e90 Container \u540d\u7a31 <code>alpine-bash</code> \u65b0 Image \u540d\u7a31\uff08\u9810\u8a2d tag \u70ba latest\uff09 \u78ba\u8a8d\u65b0 Image \u5df2\u5efa\u7acb<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest                        4326afd8916b       14.5MB          6.6MB        \ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB    U   \n</code></pre> <p>Image \u5927\u5c0f\u8b8a\u5316</p> <p>\u5b89\u88dd Bash \u5f8c\uff0cImage \u5f9e 5.82MB \u589e\u52a0\u5230 6.6MB\uff0c\u589e\u52a0\u7d04 0.78MB\uff08\u4e3b\u8981\u662f Bash \u53ca\u5176\u76f8\u4f9d\u5957\u4ef6\uff09\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#96-tar-ball","title":"9.6 \u532f\u51fa\u4e26\u58d3\u7e2e\u70ba Tar Ball \u6a94\u6848","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-save-image","title":"\u4f7f\u7528 docker save \u532f\u51fa Image","text":"\u532f\u51fa Image \u70ba tar \u6a94<pre><code>docker save --output=alpine-bash.tar alpine-bash\n</code></pre> <p>docker save \u8a9e\u6cd5</p> <pre><code>docker save [OPTIONS] IMAGE [IMAGE...]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>--output</code> \u6216 <code>-o</code> \u6307\u5b9a\u8f38\u51fa\u6a94\u6848\u540d\u7a31 \u53ef\u4e00\u6b21\u532f\u51fa\u591a\u500b Image \u78ba\u8a8d tar \u6a94\u6848\u5927\u5c0f<pre><code>ls -lh alpine-bash.tar\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rw------- 1 root root 6.3M Jan 27 11:05 alpine-bash.tar\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#gzip","title":"\u4f7f\u7528 gzip \u58d3\u7e2e","text":"\u58d3\u7e2e tar \u6a94\u6848<pre><code>gzip -9 alpine-bash.tar\n</code></pre> <p>gzip \u53c3\u6578\u8aaa\u660e</p> <ul> <li><code>-9</code>\uff1a\u6700\u9ad8\u58d3\u7e2e\u6bd4\uff081-9\uff0c9 \u70ba\u6700\u9ad8\uff09</li> <li>\u58d3\u7e2e\u5f8c\u6a94\u6848\u6703\u81ea\u52d5\u52a0\u4e0a <code>.gz</code> \u526f\u6a94\u540d</li> </ul> \u78ba\u8a8d\u58d3\u7e2e\u5f8c\u5927\u5c0f<pre><code>ls -lh alpine-bash.tar.gz\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rw------- 1 root root 3.4M Jan 27 11:05 alpine-bash.tar.gz\n</code></pre> <p>\u58d3\u7e2e\u6548\u679c</p> <p>\u6a94\u6848\u5f9e 6.3MB \u58d3\u7e2e\u5230 3.4MB\uff0c\u6e1b\u5c11\u7d04 46% \u7684\u7a7a\u9593\u3002</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#97-container-images","title":"9.7 \u6e2c\u8a66 - \u6e05\u9664\u5168\u90e8\u7684 Container \u53ca Images","text":"\u6e05\u9664\u6240\u6709 Container \u8207 Image<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>20fb31307e87\n20fb31307e87\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n</code></pre> \u78ba\u8a8d\u74b0\u5883\u5df2\u6e05\u7406<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#98-container-image","title":"9.8 \u8f09\u5165 Container Image","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-load","title":"\u4f7f\u7528 docker load \u8f09\u5165\u58d3\u7e2e\u6a94","text":"\u5f9e\u58d3\u7e2e\u6a94\u8f09\u5165 Image<pre><code>docker load -i alpine-bash.tar.gz\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Loaded image: alpine-bash:latest\n</code></pre> <p>docker load \u8a9e\u6cd5</p> <pre><code>docker load [OPTIONS]\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-i</code> \u6216 <code>--input</code> \u6307\u5b9a\u8f38\u5165\u6a94\u6848 \u652f\u63f4 <code>.tar</code> \u548c <code>.tar.gz</code> \u683c\u5f0f \u78ba\u8a8d Image \u5df2\u8f09\u5165<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest   4326afd8916b       14.5MB          6.6MB        \n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#99-bash","title":"9.9 \u78ba\u8a8d\u662f\u5426\u6709 Bash","text":"\u4f7f\u7528\u8f09\u5165\u7684 Image \u555f\u52d5 Container<pre><code>docker run -it --name alpine-2 alpine-bash /bin/bash\n</code></pre> <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230\u63d0\u793a\u7b26\u865f <code>bash-5.0#</code>\uff0c\u8868\u793a Bash \u5df2\u6210\u529f\u5b89\u88dd\u3002</p> \u78ba\u8a8d bash \u5df2\u5b89\u88dd\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>ls -l /bin/bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n</code></pre> \u9000\u51fa Container<pre><code>exit\n</code></pre>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#910-container-images","title":"9.10 \u6e05\u9664\u5168\u90e8\u7684 Container \u53ca Images","text":"\u6700\u7d42\u6e05\u7406<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>db10817df336\ndb10817df336\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n</code></pre> <p>Lab \u5b8c\u6210</p> <p>\u606d\u559c\u4f60\u5df2\u6210\u529f\u5b8c\u6210\u672c Lab\uff01</p>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_6","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-commit","title":"docker commit","text":"\u9078\u9805 \u8aaa\u660e \u7bc4\u4f8b <code>-m</code> \u63d0\u4ea4\u8a0a\u606f <code>-m \"alpine + bash\"</code> <code>-a</code> \u6307\u5b9a\u4f5c\u8005 <code>-a \"John Doe\"</code> <code>-c</code> \u5957\u7528 Dockerfile \u6307\u4ee4 <code>-c 'CMD [\"bash\"]'</code> <code>-p</code> \u63d0\u4ea4\u524d\u66ab\u505c\u5bb9\u5668 <code>-p</code>","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#docker-save-docker-load","title":"docker save \u8207 docker load","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>docker save</code> \u5c07 Image \u532f\u51fa\u70ba tar \u6a94 <code>docker save -o image.tar my-image</code> <code>docker load</code> \u5f9e tar \u6a94\u8f09\u5165 Image <code>docker load -i image.tar</code> <p>docker save vs docker export</p> \u6bd4\u8f03 docker save docker export \u5c0d\u8c61 Image Container \u4fdd\u7559 \u5b8c\u6574 Layer \u8207 metadata \u55ae\u4e00\u6a94\u6848\u7cfb\u7d71 \u8f09\u5165\u6307\u4ee4 docker load docker import \u7528\u9014 Image \u5099\u4efd/\u50b3\u8f38 Container \u6a94\u6848\u7cfb\u7d71\u5099\u4efd","tags":["Docker","Container","Image"]},{"location":"lab09_commit/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 docker commit\uff1a\u5c07\u57f7\u884c\u4e2d\u7684 Container \u72c0\u614b\u5132\u5b58\u70ba\u65b0 Image</li> <li>\u2705 docker save\uff1a\u5c07 Image \u532f\u51fa\u70ba tar \u6a94\u6848</li> <li>\u2705 docker load\uff1a\u5f9e tar \u6a94\u8f09\u5165 Image</li> <li>\u2705 gzip \u58d3\u7e2e\uff1a\u6e1b\u5c11\u532f\u51fa\u6a94\u6848\u7684\u5927\u5c0f</li> <li>\u2705 \u6e05\u7406\u8173\u672c\uff1a\u4f7f\u7528\u8173\u672c\u6279\u6b21\u6e05\u7406 Container \u8207 Image</li> </ul>","tags":["Docker","Container","Image"]},{"location":"lab10_dockerfile/","title":"LAB 10 \u5ba2\u88fd\u5316 Container images - dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#lab-10-container-images-dockerfile","title":"LAB 10 \u5ba2\u88fd\u5316 Container Images - Dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u64b0\u5beb Dockerfile \u5efa\u7acb\u5ba2\u88fd\u5316 Image</li> <li> \u4f7f\u7528 <code>docker build</code> \u5efa\u7f6e Image</li> <li> \u4f7f\u7528 <code>docker login</code> \u767b\u5165 Docker Hub</li> <li> \u4f7f\u7528 <code>docker tag</code> \u6a19\u8a18 Image</li> <li> \u4f7f\u7528 <code>docker push</code> \u4e0a\u50b3 Image \u5230 Docker Hub</li> <li> \u5f9e Docker Hub \u4e0b\u8f09\u81ea\u5df1\u4e0a\u50b3\u7684 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 09 \u7684\u5167\u5bb9</li> <li>\u4e86\u89e3 Docker Image \u7684\u57fa\u672c\u6982\u5ff5</li> <li>\u5df2\u8a3b\u518a Docker Hub \u5e33\u865f\uff08https://hub.docker.com\uff09</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#101","title":"10.1 \u74b0\u5883\u6e96\u5099","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker2","title":"\u5207\u63db\u5230 docker2 \u865b\u64ec\u6a5f","text":"<p>\u672c Lab \u5728 docker2 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_3","title":"\u78ba\u8a8d\u74b0\u5883\u5df2\u6e05\u7406","text":"\u6aa2\u8996\u73fe\u6709\u7684 Container Images<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre> \u6aa2\u8996\u73fe\u6709\u7684 Container<pre><code>docker ps -a\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_4","title":"\u57f7\u884c\u6e05\u7406\u8173\u672c\uff08\u5982\u6709\u9700\u8981\uff09","text":"\u57f7\u884c\u6e05\u7406\u8173\u672c<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u8173\u672c\u8aaa\u660e</p> <p>\u5982\u679c\u6c92\u6709 Container \u6216 Image\uff0c\u6307\u4ee4\u6703\u986f\u793a\u932f\u8aa4\u8a0a\u606f\uff0c\u9019\u662f\u6b63\u5e38\u7684\uff0c\u4e0d\u5f71\u97ff\u5f8c\u7e8c\u64cd\u4f5c\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#102-dockerfile","title":"10.2 \u5efa\u7acb\u5c08\u7528\u76ee\u9304\u8207 Dockerfile","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_5","title":"\u5efa\u7acb\u5de5\u4f5c\u76ee\u9304","text":"\u5efa\u7acb Dockerfile \u5c08\u7528\u76ee\u9304<pre><code>mkdir /root/dockerfile-1\ncd /root/dockerfile-1\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#dockerfile","title":"\u5efa\u7acb Dockerfile","text":"\u7de8\u8f2f Dockerfile<pre><code>vi dockerfile\n</code></pre> <p>Dockerfile \u5167\u5bb9\uff1a</p> dockerfile<pre><code>FROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n</code></pre> <p>Dockerfile \u6307\u4ee4\u8aaa\u660e</p> \u6307\u4ee4 \u8aaa\u660e <code>FROM</code> \u6307\u5b9a\u57fa\u790e\u6620\u50cf\uff0c\u9019\u88e1\u4f7f\u7528 Private Registry \u7684 Alpine <code>RUN</code> \u5728\u5efa\u7f6e\u904e\u7a0b\u4e2d\u57f7\u884c\u6307\u4ee4\uff0c\u9019\u88e1\u5b89\u88dd bash <code>CMD</code> \u6307\u5b9a\u5bb9\u5668\u555f\u52d5\u6642\u9810\u8a2d\u57f7\u884c\u7684\u6307\u4ee4 \u78ba\u8a8d Dockerfile \u5167\u5bb9<pre><code>cat dockerfile\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>FROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#103-alpine-image","title":"10.3 \u6e2c\u8a66\u57fa\u790e Alpine Image","text":"<p>\u5728\u5efa\u7f6e\u81ea\u8a02 Image \u4e4b\u524d\uff0c\u5148\u78ba\u8a8d\u57fa\u790e Alpine \u6c92\u6709 Bash\uff1a</p> \u555f\u52d5 Alpine Container \u6e2c\u8a66<pre><code>docker run -it --name alpine-1 docker1.training.lab:5000/alpine /bin/sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Unable to find image 'docker1.training.lab:5000/alpine:latest' locally\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\n</code></pre> <p>\u5728\u5bb9\u5668\u5167\u6e2c\u8a66 Bash\uff1a</p> \u6e2c\u8a66 bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>/bin/sh: bash: not found\n</code></pre> \u9000\u51fa\u5bb9\u5668<pre><code>exit\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#104-dockerfile-docker-image","title":"10.4 \u4f7f\u7528 Dockerfile \u5efa\u7f6e\u65b0\u7684 Docker Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-build","title":"\u57f7\u884c docker build","text":"\u5efa\u7f6e Docker Image<pre><code>docker build -t alpine-bash-2 .\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>[+] Building 2.9s (6/6) FINISHED                                                docker:default\n =&gt; [internal] load build definition from dockerfile                                      0.0s\n =&gt; =&gt; transferring dockerfile: 171B                                                      0.0s\n =&gt; [internal] load metadata for docker1.training.lab:5000/alpine:latest                  0.0s\n =&gt; [internal] load .dockerignore                                                         0.0s\n =&gt; =&gt; transferring context: 2B                                                           0.0s\n =&gt; [1/2] FROM docker1.training.lab:5000/alpine:latest                                    0.0s\n =&gt; [2/2] RUN apk add --no-cache --update-cache bash                                      2.7s\n =&gt; exporting to image                                                                    0.2s\n =&gt; =&gt; exporting layers                                                                   0.1s\n =&gt; =&gt; naming to docker.io/library/alpine-bash-2:latest                                   0.0s\n =&gt; =&gt; unpacking to docker.io/library/alpine-bash-2:latest                                0.0s\n</code></pre> <p>docker build \u8a9e\u6cd5</p> <pre><code>docker build -t &lt;image_name&gt;:&lt;tag&gt; &lt;path&gt;\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-t</code> \u6307\u5b9a Image \u540d\u7a31\u548c\u6a19\u7c64 <code>.</code> \u6307\u5b9a Dockerfile \u6240\u5728\u76ee\u9304\uff08\u7576\u524d\u76ee\u9304\uff09 <p>\u5efa\u7f6e\u904e\u7a0b\u8aaa\u660e</p> <ul> <li><code>[1/2] FROM</code>\uff1a\u8f09\u5165\u57fa\u790e\u6620\u50cf</li> <li><code>[2/2] RUN</code>\uff1a\u57f7\u884c Dockerfile \u4e2d\u7684 RUN \u6307\u4ee4\uff08\u5b89\u88dd bash\uff09</li> <li><code>exporting to image</code>\uff1a\u532f\u51fa\u70ba\u65b0\u7684 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#105-container-image","title":"10.5 \u6e2c\u8a66\u65b0\u7684 Container Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#image","title":"\u4f7f\u7528\u65b0 Image \u555f\u52d5\u5bb9\u5668","text":"\u4f7f\u7528\u65b0 Image \u555f\u52d5 Container<pre><code>docker run -it --name alpine-3 alpine-bash-2 /bin/bash\n</code></pre> <p>\u9032\u5165\u5bb9\u5668\u5f8c\u6703\u770b\u5230 <code>bash-5.0#</code> \u63d0\u793a\u7b26\u865f\uff0c\u8868\u793a Bash \u5df2\u6210\u529f\u5b89\u88dd\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#bash","title":"\u78ba\u8a8d Bash \u5df2\u5b89\u88dd","text":"\u78ba\u8a8d bash\uff08\u5728 Container \u5167\u57f7\u884c\uff09<pre><code>ls -l /bin/bash\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n</code></pre> \u9000\u51fa\u5bb9\u5668<pre><code>exit\n</code></pre> <p>\u5efa\u7f6e\u6210\u529f</p> <p>\u4f7f\u7528 Dockerfile \u5efa\u7f6e\u7684 Image \u5df2\u5305\u542b Bash\uff0c\u8207 LAB 09 \u4f7f\u7528 <code>docker commit</code> \u7684\u7d50\u679c\u76f8\u540c\uff0c\u4f46 Dockerfile \u65b9\u5f0f\u66f4\u5177\u53ef\u91cd\u73fe\u6027\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#106","title":"10.6 \u6e05\u7406\u74b0\u5883","text":"\u5207\u63db\u5230\u5bb6\u76ee\u9304\u4e26\u6e05\u7406<pre><code>cd\n./docker_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>254f09eaadac\n9ae97d52cd65\n254f09eaadac\n9ae97d52cd65\nUntagged: alpine-bash-2:latest\nDeleted: sha256:fe1c0340426860bdd7792a7e560d3dfbb1c6a4d0bf4caadd5e987a4b71fbd169\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n</code></pre>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#107-docker-image-docker-hub","title":"10.7 \u4e0a\u50b3 Docker Image \u5230 Docker Hub","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub","title":"\u8a3b\u518a Docker Hub \u5e33\u865f","text":"<p>\u4e8b\u524d\u6e96\u5099</p> <p>\u8acb\u5148\u5230 https://hub.docker.com \u8a3b\u518a\u5e33\u865f\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-login","title":"\u4f7f\u7528 docker login \u767b\u5165","text":"\u767b\u5165 Docker Hub<pre><code>docker login -u &lt;\u4f60\u7684\u5e33\u865f&gt;\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker login -u caocharles\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Password: \nWARNING! Your credentials are stored unencrypted in '/root/.docker/config.json'.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/go/credential-store/\n\nLogin Succeeded\n</code></pre> <p>\u5bc6\u78bc\u5132\u5b58\u8b66\u544a</p> <p>\u767b\u5165\u5f8c\uff0cDocker \u6703\u5c07\u8a8d\u8b49\u8cc7\u8a0a\u5132\u5b58\u5728 <code>/root/.docker/config.json</code>\uff0c\u9019\u662f Base64 \u7de8\u78bc\uff08\u975e\u52a0\u5bc6\uff09\uff0c\u8acb\u6ce8\u610f\u5b89\u5168\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-image","title":"\u91cd\u65b0\u5efa\u7f6e Docker Image","text":"\u5207\u63db\u5230 Dockerfile \u76ee\u9304<pre><code>cd /root/dockerfile-1\n</code></pre> \u5efa\u7f6e\u8981\u4e0a\u50b3\u7684 Image<pre><code>docker build -t alpine-bash-charles .\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>[+] Building 0.1s (6/6) FINISHED                                                docker:default\n =&gt; [internal] load build definition from dockerfile                                      0.0s\n =&gt; CACHED [2/2] RUN apk add --no-cache --update-cache bash                               0.0s\n =&gt; exporting to image                                                                    0.0s\n =&gt; =&gt; naming to docker.io/library/alpine-bash-charles:latest                             0.0s\n</code></pre> <p>CACHED \u8aaa\u660e</p> <p>\u5982\u679c\u4e4b\u524d\u5df2\u5efa\u7f6e\u904e\u76f8\u540c\u7684\u5c64\uff0cDocker \u6703\u4f7f\u7528\u5feb\u53d6\uff0c\u52a0\u5feb\u5efa\u7f6e\u901f\u5ea6\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#image-tag","title":"\u70ba Image \u52a0\u4e0a Tag","text":"<p>\u8981\u4e0a\u50b3\u5230 Docker Hub\uff0cImage \u540d\u7a31\u5fc5\u9808\u5305\u542b\u4f60\u7684 Docker Hub \u5e33\u865f\u540d\u7a31\uff1a</p> \u70ba Image \u52a0\u4e0a Tag<pre><code>docker tag alpine-bash-charles:latest &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles:latest\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker tag alpine-bash-charles:latest caocharles/alpine-bash-charles:latest\n</code></pre> <p>docker tag \u8a9e\u6cd5</p> <pre><code>docker tag &lt;source_image&gt;:&lt;tag&gt; &lt;target_image&gt;:&lt;tag&gt;\n</code></pre> <ul> <li>Target image \u683c\u5f0f\uff1a<code>&lt;Docker Hub \u5e33\u865f&gt;/&lt;Image \u540d\u7a31&gt;:&lt;tag&gt;</code></li> </ul> \u78ba\u8a8d Tag \u5df2\u5efa\u7acb<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash-charles:latest              28024b3ae76e       14.5MB          6.6MB        \ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB        \n</code></pre> <p>\u5169\u500b Image \u4f7f\u7528\u76f8\u540c ID</p> <p><code>docker tag</code> \u53ea\u662f\u5efa\u7acb\u4e00\u500b\u65b0\u7684\u6a19\u7c64\u6307\u5411\u540c\u4e00\u500b Image\uff0c\u4e0d\u6703\u4f54\u7528\u984d\u5916\u7a7a\u9593\u3002</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#108-docker-image","title":"10.8 \u4e0a\u50b3 Docker Image","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-push","title":"\u57f7\u884c docker push","text":"\u4e0a\u50b3 Image \u5230 Docker Hub<pre><code>docker push &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles:latest\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker push caocharles/alpine-bash-charles:latest\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>The push refers to repository [docker.io/caocharles/alpine-bash-charles]\n77cae8ab23bf: Pushed \n34b2f2a4fe94: Pushed \n01bc7f934740: Pushed \nlatest: digest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f size: 855\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4\uff1apush access denied</p> <p>\u5982\u679c\u51fa\u73fe\u4ee5\u4e0b\u932f\u8aa4\uff1a </p><pre><code>push access denied, repository does not exist or may require authorization\n</code></pre><p></p> <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>Image \u6a19\u7c64\u7684\u5e33\u865f\u540d\u7a31\u8207\u767b\u5165\u5e33\u865f\u4e0d\u7b26</li> <li>\u5c1a\u672a\u767b\u5165\u6216\u767b\u5165\u6191\u8b49\u904e\u671f</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u78ba\u8a8d\u4f7f\u7528\u6b63\u78ba\u7684\u5e33\u865f\u540d\u7a31\ndocker tag alpine-bash-charles:latest &lt;\u6b63\u78ba\u5e33\u865f&gt;/alpine-bash-charles:latest\n\n# \u91cd\u65b0\u767b\u5165\ndocker logout\ndocker login -u &lt;\u4f60\u7684\u5e33\u865f&gt;\n</code></pre><p></p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#109","title":"10.9 \u9a57\u8b49\u4e0a\u50b3\u7d50\u679c","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_1","title":"\u5728 Docker Hub \u7db2\u7ad9\u78ba\u8a8d","text":"<ol> <li>\u958b\u555f https://hub.docker.com</li> <li>\u767b\u5165\u4f60\u7684\u5e33\u865f</li> <li>\u9032\u5165 Repositories</li> <li>\u78ba\u8a8d\u53ef\u4ee5\u770b\u5230\u525b\u4e0a\u50b3\u7684 Image</li> </ol>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_2","title":"\u6e05\u7406\u672c\u5730\u74b0\u5883\u4e26\u5f9e Docker Hub \u4e0b\u8f09","text":"\u6e05\u7406\u672c\u5730\u74b0\u5883<pre><code>cd\n./docker_clean_all.sh\n</code></pre> \u78ba\u8a8d\u5df2\u6e05\u7406<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n</code></pre> \u5f9e Docker Hub \u4e0b\u8f09 Image<pre><code>docker pull &lt;\u4f60\u7684\u5e33\u865f&gt;/alpine-bash-charles\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>docker pull caocharles/alpine-bash-charles\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Using default tag: latest\nlatest: Pulling from caocharles/alpine-bash-charles\n01bc7f934740: Pull complete \n34b2f2a4fe94: Download complete \nDigest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f\nStatus: Downloaded newer image for caocharles/alpine-bash-charles:latest\ndocker.io/caocharles/alpine-bash-charles:latest\n</code></pre> \u78ba\u8a8d\u4e0b\u8f09\u6210\u529f<pre><code>docker images\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>IMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB    \n</code></pre> <p>\u5b8c\u6210\u78ba\u8a8d</p> <p>\u6210\u529f\u5f9e Docker Hub \u4e0b\u8f09\u525b\u624d\u4e0a\u50b3\u7684 Image\uff01</p>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_6","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#dockerfile_1","title":"Dockerfile \u57fa\u672c\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>FROM</code> \u6307\u5b9a\u57fa\u790e\u6620\u50cf <code>FROM alpine:latest</code> <code>RUN</code> \u5efa\u7f6e\u6642\u57f7\u884c\u6307\u4ee4 <code>RUN apk add bash</code> <code>CMD</code> \u5bb9\u5668\u555f\u52d5\u6642\u9810\u8a2d\u6307\u4ee4 <code>CMD [\"/bin/bash\"]</code> <code>COPY</code> \u8907\u88fd\u6a94\u6848\u5230 Image <code>COPY ./src /app</code> <code>WORKDIR</code> \u8a2d\u5b9a\u5de5\u4f5c\u76ee\u9304 <code>WORKDIR /app</code> <code>EXPOSE</code> \u5ba3\u544a\u958b\u653e\u7684 Port <code>EXPOSE 80</code> <code>ENV</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <code>ENV APP_HOME=/app</code>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#docker-hub_3","title":"Docker Hub \u76f8\u95dc\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e \u7bc4\u4f8b <code>docker login</code> \u767b\u5165 Docker Registry <code>docker login -u username</code> <code>docker logout</code> \u767b\u51fa Docker Registry <code>docker logout</code> <code>docker tag</code> \u70ba Image \u52a0\u4e0a\u6a19\u7c64 <code>docker tag image:tag user/image:tag</code> <code>docker push</code> \u4e0a\u50b3 Image <code>docker push user/image:tag</code> <code>docker pull</code> \u4e0b\u8f09 Image <code>docker pull user/image:tag</code>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1adocker build \u6642\u51fa\u73fe 'no such file or directory' \u932f\u8aa4\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>Dockerfile \u6a94\u540d\u4e0d\u6b63\u78ba\uff08\u6ce8\u610f\u5927\u5c0f\u5beb\uff09</li> <li>\u4e0d\u5728\u6b63\u78ba\u7684\u76ee\u9304</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u78ba\u8a8d\u6a94\u6848\u5b58\u5728\nls -la dockerfile\n\n# \u4f7f\u7528 -f \u6307\u5b9a Dockerfile \u8def\u5f91\ndocker build -f ./dockerfile -t my-image .\n</code></pre><p></p> Q2\uff1adocker push \u5931\u6557\uff0c\u986f\u793a 'access denied'\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <ol> <li>\u78ba\u8a8d\u5df2\u767b\u5165\uff1a<code>docker login</code></li> <li>\u78ba\u8a8d Image \u6a19\u7c64\u5305\u542b\u6b63\u78ba\u7684\u5e33\u865f\u540d\u7a31</li> <li>\u6a19\u7c64\u683c\u5f0f\u5fc5\u9808\u662f\uff1a<code>&lt;\u5e33\u865f&gt;/&lt;image\u540d\u7a31&gt;:&lt;tag&gt;</code></li> </ol> Q3\uff1aDockerfile \u8207 docker commit \u6709\u4ec0\u9ebc\u5dee\u5225\uff1f \u6bd4\u8f03 docker commit Dockerfile \u53ef\u8ffd\u8e64\u6027 \u7121\u6cd5\u8ffd\u8e64\u8b8a\u66f4 \u53ef\u7248\u672c\u63a7\u5236 \u53ef\u91cd\u73fe\u6027 \u96e3\u4ee5\u91cd\u73fe \u53ef\u91cd\u8907\u5efa\u7f6e \u81ea\u52d5\u5316 \u624b\u52d5\u64cd\u4f5c \u53ef\u81ea\u52d5\u5316 \u5efa\u8b70\u7528\u9014 \u6e2c\u8a66/\u9664\u932f \u751f\u7522\u74b0\u5883","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab10_dockerfile/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Dockerfile\uff1a\u4f7f\u7528 FROM\u3001RUN\u3001CMD \u6307\u4ee4\u5efa\u7acb\u5ba2\u88fd\u5316 Image</li> <li>\u2705 docker build\uff1a\u6839\u64da Dockerfile \u5efa\u7f6e Image</li> <li>\u2705 docker login\uff1a\u767b\u5165 Docker Hub</li> <li>\u2705 docker tag\uff1a\u70ba Image \u52a0\u4e0a\u7b26\u5408 Docker Hub \u683c\u5f0f\u7684\u6a19\u7c64</li> <li>\u2705 docker push\uff1a\u4e0a\u50b3 Image \u5230 Docker Hub</li> <li>\u2705 docker pull\uff1a\u5f9e Docker Hub \u4e0b\u8f09 Image</li> </ul>","tags":["Docker","Dockerfile","Docker Hub"]},{"location":"lab11_standalone_k8s/","title":"LAB 11 standalone kubernetes \u5b89\u88dd","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#lab-11-standalone-kubernetes","title":"LAB 11 Standalone Kubernetes \u5b89\u88dd","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes</li> <li> \u4e86\u89e3 Standalone Kubernetes \u7684\u67b6\u69cb</li> <li> \u76e3\u63a7 Kubernetes \u53e2\u96c6\u72c0\u614b</li> <li> \u5728 Standalone Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod</li> <li> \u5efa\u7acb\u865b\u64ec\u6a5f\u5feb\u7167\u4fdd\u7559\u72c0\u614b</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 Docker \u76f8\u95dc\u7ae0\u7bc0</li> <li>\u4e86\u89e3\u57fa\u672c\u7684 Linux \u6307\u4ee4\u64cd\u4f5c</li> <li>\u4e86\u89e3\u5bb9\u5668\u5316\u7684\u57fa\u672c\u6982\u5ff5</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#111","title":"11.1 \u74b0\u5883\u8aaa\u660e","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#standalone-kubernetes","title":"\u4ec0\u9ebc\u662f Standalone Kubernetes\uff1f","text":"<p>Standalone Kubernetes \u662f\u4e00\u500b\u55ae\u7bc0\u9ede\u7684 Kubernetes \u53e2\u96c6\uff0cMaster \u7bc0\u9ede\u540c\u6642\u4e5f\u4f5c\u70ba Worker \u7bc0\u9ede\u4f7f\u7528\u3002\u9019\u7a2e\u67b6\u69cb\u9069\u5408\uff1a</p> <ul> <li>\u5b78\u7fd2\u8207\u6e2c\u8a66\u74b0\u5883</li> <li>\u958b\u767c\u74b0\u5883</li> <li>\u5c0f\u578b\u5c08\u6848</li> </ul> <pre><code>graph TB\n    subgraph \"Standalone Kubernetes\"\n        M[k8s-standalone&lt;br/&gt;Master + Worker&lt;br/&gt;192.168.66.61]\n        subgraph \"Control Plane\"\n            API[API Server]\n            ETCD[etcd]\n            SCHED[Scheduler]\n            CM[Controller Manager]\n        end\n        subgraph \"Node Components\"\n            KL[Kubelet]\n            KP[Kube-Proxy]\n            CR[CRI-O]\n        end\n        subgraph \"Pods\"\n            P1[Pod 1]\n            P2[Pod 2]\n        end\n    end</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_3","title":"\u865b\u64ec\u6a5f\u8cc7\u8a0a","text":"\u9805\u76ee \u503c \u4e3b\u6a5f\u540d\u7a31 k8s-standalone.training.lab IP \u4f4d\u5740 192.168.66.61 \u4f5c\u696d\u7cfb\u7d71 Rocky Linux 9 Kubernetes \u7248\u672c 1.32","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#112-k8s-standalone","title":"11.2 \u5207\u63db\u5230 k8s-standalone \u865b\u64ec\u6a5f","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_4","title":"\u78ba\u8a8d\u7db2\u8def\u8a2d\u5b9a","text":"\u6aa2\u8996\u7db2\u8def\u4ecb\u9762<pre><code>ifconfig ens160\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.66.61  netmask 255.255.255.0  broadcast 192.168.66.255\n        inet6 fe80::20c:29ff:fe91:c3  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:91:00:c3  txqueuelen 1000  (Ethernet)\n        RX packets 41897  bytes 25015527 (23.8 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 672  bytes 55461 (54.1 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_5","title":"\u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31","text":"\u6aa2\u8996\u4e3b\u6a5f\u540d\u7a31<pre><code>hostname\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-standalone.training.lab\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#hosts","title":"\u78ba\u8a8d hosts \u6a94\u6848","text":"\u6aa2\u8996 /etc/hosts<pre><code>cat /etc/hosts\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.10   master.training.lab master\n192.168.66.11   node1.training.lab  node1\n192.168.66.12   node2.training.lab  node2\n192.168.66.21   docker.training.lab docker\n192.168.66.22   minikube.training.lab   minikube\n\n192.168.66.51       docker1.training.lab        docker1\n192.168.66.52       docker2.training.lab        docker2\n192.168.66.61       k8s-standalone.training.lab k8s-standalone\n192.168.66.71       k8s-master1.training.lab    k8s-master1\n192.168.66.81       k8s-node1.training.lab      k8s-node1\n192.168.66.82       k8s-node2.training.lab      k8s-node2\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#113-script","title":"11.3 \u4e0b\u8f09\u5b89\u88dd Script","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#wget","title":"\u4f7f\u7528 wget \u4e0b\u8f09","text":"\u4e0b\u8f09\u5b89\u88dd\u8173\u672c<pre><code>wget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>--2026-01-27 11:21:14--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh       100%[========================================&gt;]  21.99K  --.-KB/s    in 0s      \n\n2026-01-27 11:21:14 (61.0 MB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_6","title":"\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650","text":"\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 install_k8s-latest.sh\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#114-shell-script-kubernetes","title":"11.4 \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_7","title":"\u67e5\u770b\u5b89\u88dd\u9078\u9805","text":"\u57f7\u884c\u8173\u672c\u67e5\u770b\u4f7f\u7528\u8aaa\u660e<pre><code>./install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\u8acb\u8f38\u5165 \u5b8c\u6574\u5b89\u88dd(full) \u6216\u662f standalone\n./install_k8s-latest.sh -full\n\u6216 \n./install_k8s-latest.sh -standalone\n</code></pre> <p>\u5b89\u88dd\u6a21\u5f0f\u8aaa\u660e</p> \u6a21\u5f0f \u8aaa\u660e <code>-full</code> \u5b8c\u6574\u5b89\u88dd\uff0c\u5305\u542b Master \u8207 Worker \u7bc0\u9ede\u8a2d\u5b9a <code>-standalone</code> \u55ae\u6a5f\u5b89\u88dd\uff0cMaster \u7bc0\u9ede\u540c\u6642\u4f5c\u70ba Worker \u7bc0\u9ede","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#standalone","title":"\u57f7\u884c Standalone \u5b89\u88dd","text":"\u57f7\u884c Standalone \u5b89\u88dd<pre><code>./install_k8s-latest.sh -standalone\n</code></pre> <p>\u5b89\u88dd\u904e\u7a0b\u8aaa\u660e</p> <p>\u8173\u672c\u6703\u81ea\u52d5\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <ol> <li>\u5b89\u88dd\u5fc5\u8981\u5957\u4ef6\uff1asshpass\u3001bash-completion</li> <li>\u5b89\u88dd Docker CE\uff1a\u5305\u542b containerd.io\u3001docker-ce-cli</li> <li>\u95dc\u9589 Swap\uff1aKubernetes \u8981\u6c42\u95dc\u9589 Swap</li> <li>\u8a2d\u5b9a\u6838\u5fc3\u53c3\u6578\uff1a\u555f\u7528 IP \u8f49\u767c\u3001\u8a2d\u5b9a\u7db2\u8def\u53c3\u6578</li> <li>\u5b89\u88dd Kubernetes \u5957\u4ef6\uff1akubelet\u3001kubeadm\u3001kubectl</li> <li>\u5b89\u88dd CRI-O\uff1aContainer Runtime Interface</li> <li>\u95dc\u9589\u9632\u706b\u7246\uff1a\u505c\u7528 firewalld</li> <li>\u57f7\u884c kubeadm init\uff1a\u521d\u59cb\u5316 Kubernetes \u53e2\u96c6</li> <li>\u5b89\u88dd CNI\uff1a\u5b89\u88dd Antrea \u7db2\u8def\u5957\u4ef6</li> <li>\u79fb\u9664 Taint\uff1a\u5141\u8a31\u5728 Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod</li> </ol>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_8","title":"\u5b89\u88dd\u904e\u7a0b\u8f38\u51fa\uff08\u90e8\u5206\uff09","text":"<p>\u5b89\u88dd Docker CE\uff1a</p> <pre><code>Installing:\n docker-ce                    x86_64    3:29.2.0-1.el9    docker-ce-stable     24 M\n containerd.io                x86_64    2.2.1-1.el9       docker-ce-stable     35 M\n docker-ce-cli                x86_64    1:29.2.0-1.el9    docker-ce-stable    8.4 M\n docker-buildx-plugin         x86_64    0.30.1-1.el9      docker-ce-stable     17 M\n docker-compose-plugin        x86_64    5.0.2-1.el9       docker-ce-stable    8.1 M\n\nComplete!\n</code></pre> <p>\u5b89\u88dd Kubernetes \u5957\u4ef6\uff1a</p> <pre><code>Installing:\n kubeadm       x86_64    1.32.11-150500.1.1    kubernetes    12 M\n kubectl       x86_64    1.32.11-150500.1.1    kubernetes    11 M\n kubelet       x86_64    1.32.11-150500.1.1    kubernetes    15 M\n cri-tools     x86_64    1.32.0-150500.1.1     kubernetes   7.1 M\n kubernetes-cni x86_64   1.6.0-150500.1.1      kubernetes   8.0 M\n\nComplete!\n</code></pre> <p>\u5b89\u88dd CRI-O\uff1a</p> <pre><code>Installing:\n cri-o         x86_64    1.32.1-150500.1.1     cri-o         20 M\n\nComplete!\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#kubeadm-init","title":"kubeadm init \u8f38\u51fa","text":"<pre><code>[init] Using Kubernetes version: v1.32.11\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s-standalone.training.lab kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [172.30.0.1 192.168.66.61]\n...\n[kubelet-start] Starting the kubelet\n[kubelet-check] The kubelet is healthy after 515.21134ms\n[api-check] The API server is healthy after 3.001460102s\n...\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n</code></pre> <p>\u521d\u59cb\u5316\u6210\u529f</p> <p>\u770b\u5230 <code>Your Kubernetes control-plane has initialized successfully!</code> \u8868\u793a Kubernetes \u63a7\u5236\u5e73\u9762\u5df2\u6210\u529f\u521d\u59cb\u5316\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#antrea-cni","title":"\u5b89\u88dd Antrea CNI","text":"<p>\u8173\u672c\u6703\u81ea\u52d5\u5b89\u88dd Antrea \u4f5c\u70ba CNI\uff08Container Network Interface\uff09\uff1a</p> <pre><code>customresourcedefinition.apiextensions.k8s.io/antreaagentinfos.crd.antrea.io created\nserviceaccount/antrea-agent created\nserviceaccount/antrea-controller created\nclusterrole.rbac.authorization.k8s.io/antrea-agent created\nclusterrole.rbac.authorization.k8s.io/antrea-controller created\n...\ndeployment.apps/antrea-controller created\ndaemonset.apps/antrea-agent created\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#master-taint","title":"\u79fb\u9664 Master \u7bc0\u9ede\u7684 Taint","text":"<p>\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cKubernetes \u4e0d\u5141\u8a31\u5728 Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod\u3002\u8173\u672c\u6703\u81ea\u52d5\u79fb\u9664\u9019\u500b\u9650\u5236\uff1a</p> <pre><code>node/k8s-standalone.training.lab untainted\n</code></pre> <p>Taint \u8aaa\u660e</p> <p>Taint\uff08\u6c59\u9ede\uff09\u662f Kubernetes \u7528\u4f86\u9650\u5236 Pod \u8abf\u5ea6\u7684\u6a5f\u5236\u3002Master \u7bc0\u9ede\u9810\u8a2d\u6709 <code>node-role.kubernetes.io/control-plane:NoSchedule</code> \u7684 Taint\uff0c\u8868\u793a\u4e0d\u63a5\u53d7\u4e00\u822c Pod \u7684\u8abf\u5ea6\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#115-kubernetes","title":"11.5 \u76e3\u63a7 Kubernetes \u72c0\u614b","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_9","title":"\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b","text":"\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u521d\u59cb\u72c0\u614b\uff09\uff1a</p> <pre><code>NAME                          STATUS     ROLES           AGE   VERSION\nk8s-standalone.training.lab   NotReady   control-plane   35s   v1.32.11\n</code></pre> <p>NotReady \u72c0\u614b</p> <p>\u7bc0\u9ede\u525b\u521d\u59cb\u5316\u6642\u6703\u986f\u793a <code>NotReady</code>\uff0c\u7b49\u5f85 CNI \u5957\u4ef6\u5b8c\u5168\u555f\u52d5\u5f8c\u6703\u8b8a\u6210 <code>Ready</code>\u3002</p> <p>\u7b49\u5f85\u7d04 30 \u79d2\u5f8c\u518d\u6b21\u6aa2\u67e5\uff1a</p> \u518d\u6b21\u6aa2\u8996\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                          STATUS   ROLES           AGE   VERSION\nk8s-standalone.training.lab   Ready    control-plane   2m    v1.32.11\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod","title":"\u6aa2\u8996\u7cfb\u7d71 Pod \u72c0\u614b","text":"\u6aa2\u8996 kube-system namespace \u7684 Pod<pre><code>kubectl get pods -n kube-system\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                                                  READY   STATUS    RESTARTS   AGE\nantrea-agent-xxxxx                                    2/2     Running   0          2m\nantrea-controller-xxxxx                               1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\netcd-k8s-standalone.training.lab                      1/1     Running   0          2m\nkube-apiserver-k8s-standalone.training.lab            1/1     Running   0          2m\nkube-controller-manager-k8s-standalone.training.lab   1/1     Running   0          2m\nkube-proxy-xxxxx                                      1/1     Running   0          2m\nkube-scheduler-k8s-standalone.training.lab            1/1     Running   0          2m\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_10","title":"\u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b","text":"\u4f7f\u7528 watch \u6301\u7e8c\u76e3\u63a7<pre><code>watch kubectl get nodes\n</code></pre> <p>watch \u6307\u4ee4</p> <p><code>watch</code> \u6307\u4ee4\u6703\u6bcf 2 \u79d2\u91cd\u65b0\u57f7\u884c\u4e00\u6b21\u6307\u4ee4\uff0c\u6309 <code>Ctrl+C</code> \u53ef\u4ee5\u9000\u51fa\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#116","title":"11.6 \u90e8\u7f72\u6e2c\u8a66","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment","title":"\u5efa\u7acb\u6e2c\u8a66 Deployment","text":"\u5efa\u7acb nginx Deployment<pre><code>kubectl create deployment test1 --image=nginx\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre> <p>kubectl create deployment \u8a9e\u6cd5</p> <pre><code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>&lt;name&gt;</code> Deployment \u540d\u7a31 <code>--image</code> \u4f7f\u7528\u7684\u5bb9\u5668\u6620\u50cf","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment_1","title":"\u6aa2\u8996 Deployment \u72c0\u614b","text":"\u6aa2\u8996 Deployment<pre><code>kubectl get deployments.apps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   0/1     1            0           15s\n</code></pre> <p>Deployment \u6b04\u4f4d\u8aaa\u660e</p> \u6b04\u4f4d \u8aaa\u660e <code>READY</code> \u5c31\u7dd2\u7684 Pod \u6578\u91cf / \u9810\u671f\u6578\u91cf <code>UP-TO-DATE</code> \u5df2\u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c\u7684 Pod \u6578\u91cf <code>AVAILABLE</code> \u53ef\u7528\u7684 Pod \u6578\u91cf","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod_1","title":"\u6aa2\u8996 Pod \u72c0\u614b","text":"\u6aa2\u8996 Pod \u72c0\u614b<pre><code>kubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          27s\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#pod_2","title":"\u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a","text":"\u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a\uff08\u542b\u7bc0\u9ede\u8cc7\u8a0a\uff09<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          33s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>Pod \u8655\u65bc Pending \u72c0\u614b</p> <p>\u5982\u679c Pod \u6301\u7e8c\u8655\u65bc <code>Pending</code> \u72c0\u614b\u4e14 <code>NODE</code> \u986f\u793a <code>&lt;none&gt;</code>\uff0c\u53ef\u80fd\u662f\u56e0\u70ba\uff1a</p> <ol> <li>\u7bc0\u9ede\u5c1a\u672a\u5c31\u7dd2\uff08NotReady\uff09</li> <li>\u7bc0\u9ede\u4ecd\u6709 Taint \u9650\u5236</li> </ol> <p>\u9700\u8981\u7b49\u5f85\u7bc0\u9ede\u8b8a\u6210 Ready \u72c0\u614b\uff0c\u6216\u78ba\u8a8d Taint \u5df2\u79fb\u9664\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_11","title":"\u7b49\u5f85\u7bc0\u9ede\u5c31\u7dd2\u5f8c\u78ba\u8a8d","text":"<p>\u7b49\u5f85\u7bc0\u9ede\u8b8a\u6210 Ready \u5f8c\uff0cPod \u6703\u81ea\u52d5\u8abf\u5ea6\u4e26\u555f\u52d5\uff1a</p> \u78ba\u8a8d\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u7576\u7bc0\u9ede\u986f\u793a <code>Ready</code> \u5f8c\uff1a</p> \u518d\u6b21\u6aa2\u8996 Pod \u72c0\u614b<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u7bc0\u9ede\u5c31\u7dd2\u5f8c\uff09\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP            NODE                          NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   1/1     Running   0          2m    10.244.0.5    k8s-standalone.training.lab   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>\u90e8\u7f72\u6210\u529f</p> <p>\u7576 Pod \u72c0\u614b\u8b8a\u6210 <code>Running</code> \u4e14 <code>NODE</code> \u986f\u793a <code>k8s-standalone.training.lab</code>\uff0c\u8868\u793a\u5df2\u6210\u529f\u5728 Standalone Master \u7bc0\u9ede\u4e0a\u90e8\u7f72 Pod\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#deployment_2","title":"\u6e05\u7406\u6e2c\u8a66 Deployment","text":"\u522a\u9664\u6e2c\u8a66 Deployment<pre><code>kubectl delete deployment test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps \"test1\" deleted\n</code></pre>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#117-snapshot","title":"11.7 \u5efa\u7acb\u5feb\u7167 Snapshot","text":"<p>\u5efa\u8b70</p> <p>\u5b8c\u6210\u5b89\u88dd\u5f8c\uff0c\u5efa\u8b70\u5728 VMware \u4e2d\u5efa\u7acb\u865b\u64ec\u6a5f\u5feb\u7167\uff0c\u4ee5\u4fbf\u65e5\u5f8c\u9700\u8981\u6642\u53ef\u4ee5\u5feb\u901f\u9084\u539f\u5230\u4e7e\u6de8\u7684 Kubernetes \u74b0\u5883\u3002</p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_12","title":"\u5efa\u7acb\u5feb\u7167\u6b65\u9a5f","text":"<ol> <li>\u5728 VMware vSphere Client \u6216 VMware Workstation \u4e2d</li> <li>\u9078\u64c7 k8s-standalone \u865b\u64ec\u6a5f</li> <li>\u53f3\u9375\u9078\u64c7 \u5feb\u7167 &gt; \u62cd\u651d\u5feb\u7167</li> <li>\u8f38\u5165\u5feb\u7167\u540d\u7a31\uff0c\u4f8b\u5982\uff1a<code>K8s 1.32 \u5b89\u88dd\u5b8c\u6210</code></li> <li>\u9ede\u64ca\u78ba\u5b9a</li> </ol>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_13","title":"\u6307\u4ee4\u53c3\u8003","text":"","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#kubectl","title":"kubectl \u57fa\u672c\u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get nodes</code> \u6aa2\u8996\u7bc0\u9ede\u72c0\u614b <code>kubectl get pods</code> \u6aa2\u8996 Pod \u5217\u8868 <code>kubectl get pods -n kube-system</code> \u6aa2\u8996\u7cfb\u7d71 Pod <code>kubectl describe node &lt;name&gt;</code> \u6aa2\u8996\u7bc0\u9ede\u8a73\u7d30\u8cc7\u8a0a <code>kubectl describe pod &lt;name&gt;</code> \u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a <code>kubectl run &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Pod <code>kubectl delete pod &lt;name&gt;</code> \u522a\u9664 Pod <code>kubectl exec -it &lt;name&gt; -- &lt;cmd&gt;</code> \u5728 Pod \u4e2d\u57f7\u884c\u6307\u4ee4","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_14","title":"\u5b89\u88dd\u76f8\u95dc\u5143\u4ef6\u7248\u672c","text":"\u5143\u4ef6 \u7248\u672c Kubernetes 1.32.11 Docker CE 29.2.0 containerd.io 2.2.1 CRI-O 1.32.1 Antrea CNI \u6700\u65b0\u7248","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_15","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u7bc0\u9ede\u4e00\u76f4\u986f\u793a NotReady\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>CNI \u5957\u4ef6\u5c1a\u672a\u5b8c\u5168\u555f\u52d5</li> <li>kubelet \u670d\u52d9\u7570\u5e38</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996 kubelet \u72c0\u614b\nsystemctl status kubelet\n\n# \u6aa2\u8996 kubelet \u65e5\u8a8c\njournalctl -u kubelet -f\n\n# \u6aa2\u8996\u7cfb\u7d71 Pod \u72c0\u614b\nkubectl get pods -n kube-system\n</code></pre><p></p> Q2\uff1aPod \u7121\u6cd5\u5728 Master \u7bc0\u9ede\u4e0a\u57f7\u884c\uff1f <p>\u53ef\u80fd\u539f\u56e0\uff1aMaster \u7bc0\u9ede\u6709 Taint \u9650\u5236</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996\u7bc0\u9ede Taint\nkubectl describe node k8s-standalone.training.lab | grep Taint\n\n# \u79fb\u9664 control-plane Taint\nkubectl taint nodes k8s-standalone.training.lab node-role.kubernetes.io/control-plane:NoSchedule-\n</code></pre><p></p> Q3\uff1a\u5982\u4f55\u91cd\u65b0\u5b89\u88dd Kubernetes\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u91cd\u7f6e kubeadm\nkubeadm reset -f\n\n# \u6e05\u7406 iptables\niptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X\n\n# \u91cd\u65b0\u57f7\u884c\u5b89\u88dd\u8173\u672c\n./install_k8s-latest.sh -standalone\n</code></pre><p></p>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab11_standalone_k8s/#_16","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u74b0\u5883\u6e96\u5099\uff1a\u5207\u63db\u5230 k8s-standalone \u865b\u64ec\u6a5f\uff0c\u78ba\u8a8d\u7db2\u8def\u8a2d\u5b9a</li> <li>\u2705 \u4e0b\u8f09\u5b89\u88dd\u8173\u672c\uff1a\u4f7f\u7528 wget \u4e0b\u8f09\u81ea\u52d5\u5316\u5b89\u88dd\u8173\u672c</li> <li>\u2705 \u81ea\u52d5\u5316\u5b89\u88dd\uff1a\u4f7f\u7528 <code>-standalone</code> \u53c3\u6578\u57f7\u884c\u55ae\u6a5f\u5b89\u88dd</li> <li>\u2705 \u76e3\u63a7\u72c0\u614b\uff1a\u4f7f\u7528 <code>kubectl get nodes</code> \u78ba\u8a8d\u7bc0\u9ede Ready</li> <li>\u2705 \u90e8\u7f72\u6e2c\u8a66\uff1a\u6210\u529f\u5728 Standalone Master \u4e0a\u90e8\u7f72 Pod</li> <li>\u2705 \u5efa\u7acb\u5feb\u7167\uff1a\u4fdd\u7559\u4e7e\u6de8\u7684 Kubernetes \u74b0\u5883</li> </ul>","tags":["Kubernetes","Installation","Standalone"]},{"location":"lab12_k8s_install/","title":"LAB 12 kubernetes \u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#lab-12-kubernetes","title":"LAB 12 Kubernetes \u53e2\u96c6\u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 Shell Script \u81ea\u52d5\u5316\u5b89\u88dd Kubernetes \u53e2\u96c6</li> <li> \u914d\u7f6e\u591a\u7bc0\u9ede\uff08Master + Worker\uff09Kubernetes \u74b0\u5883</li> <li> \u7406\u89e3 kubeadm\u3001kubelet\u3001kubectl \u7684\u89d2\u8272</li> <li> \u5b89\u88dd\u4e26\u914d\u7f6e CRI-O \u5bb9\u5668\u57f7\u884c\u74b0\u5883</li> <li> \u90e8\u7f72 Antrea CNI \u7db2\u8def\u63d2\u4ef6</li> <li> \u5c07 Worker Node \u52a0\u5165\u53e2\u96c6</li> <li> \u76e3\u63a7\u53e2\u96c6\u72c0\u614b\u8207\u9a57\u8b49\u90e8\u7f72</li> </ul>"},{"location":"lab12_k8s_install/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 11 \u7368\u7acb Kubernetes \u74b0\u5883</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u7406\u89e3\u5bb9\u5668\u5316\u7684\u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d\u4e09\u53f0\u865b\u64ec\u6a5f\uff08K8S-MASTER1\u3001K8S-NODE1\u3001K8S-NODE2\uff09</li> </ul>"},{"location":"lab12_k8s_install/#lab-shell-script-kubernetes","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1a\u4f7f\u7528 Shell Script \u5b89\u88dd Kubernetes \u53e2\u96c6","text":""},{"location":"lab12_k8s_install/#_3","title":"\u74b0\u5883\u67b6\u69cb","text":"<pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        Master[k8s-master1&lt;br/&gt;192.168.66.71&lt;br/&gt;Control Plane]\n        Node1[k8s-node1&lt;br/&gt;192.168.66.81&lt;br/&gt;Worker Node]\n        Node2[k8s-node2&lt;br/&gt;192.168.66.82&lt;br/&gt;Worker Node]\n        Master --&gt; Node1\n        Master --&gt; Node2\n    end\n\n    subgraph \"\u5b89\u88dd\u5143\u4ef6\"\n        CRI[CRI-O 1.32]\n        K8S[Kubernetes 1.32]\n        CNI[Antrea CNI]\n    end</code></pre> \u4e3b\u6a5f\u540d\u7a31 IP \u4f4d\u5740 \u89d2\u8272 k8s-master1.training.lab 192.168.66.71 Control Plane (Master) k8s-node1.training.lab 192.168.66.81 Worker Node k8s-node2.training.lab 192.168.66.82 Worker Node <p>\u5b89\u88dd\u7279\u9ede</p> <ul> <li>\u5168\u7a0b\u5728 Master \u7bc0\u9ede\u64cd\u4f5c\uff1a\u900f\u904e SSH \u81ea\u52d5\u5316\u5b89\u88dd Worker \u7bc0\u9ede</li> <li>\u4f7f\u7528 CRI-O\uff1aKubernetes \u539f\u751f\u7684\u5bb9\u5668\u57f7\u884c\u74b0\u5883</li> <li>Antrea CNI\uff1aVMware \u958b\u767c\u7684\u9ad8\u6548\u80fd\u7db2\u8def\u63d2\u4ef6</li> </ul>"},{"location":"lab12_k8s_install/#1","title":"\u6b65\u9a5f 1\uff1a\u555f\u52d5\u865b\u64ec\u6a5f\u4e26\u78ba\u8a8d\u74b0\u5883","text":"<p>\u9996\u5148\uff0c\u5728 VMware Workstation \u4e2d\u555f\u52d5\u4e09\u53f0\u865b\u64ec\u6a5f\uff1a</p> <ul> <li>K8S-MASTER1</li> <li>K8S-NODE1  </li> <li>K8S-NODE2</li> </ul> <p>\u767b\u5165 <code>k8s-master1</code>\uff0c\u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31\u8207\u7db2\u8def\u8a2d\u5b9a\uff1a</p> \u78ba\u8a8d\u4e3b\u6a5f\u540d\u7a31<pre><code>hostname\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-master1.training.lab\n</code></pre> \u78ba\u8a8d IP \u4f4d\u5740<pre><code>ifconfig ens160\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.66.71  netmask 255.255.255.0  broadcast 192.168.66.255\n</code></pre> \u78ba\u8a8d /etc/hosts \u8a2d\u5b9a<pre><code>cat /etc/hosts\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.71       k8s-master1.training.lab    k8s-master1\n192.168.66.81       k8s-node1.training.lab      k8s-node1\n192.168.66.82       k8s-node2.training.lab      k8s-node2\n</code></pre>"},{"location":"lab12_k8s_install/#2","title":"\u6b65\u9a5f 2\uff1a\u78ba\u8a8d\u7db2\u8def\u9023\u7dda","text":"<p>\u6e2c\u8a66\u8207\u5176\u4ed6\u7bc0\u9ede\u7684\u9023\u7dda\uff1a</p> Ping Worker Node 1<pre><code>ping k8s-node1 -c3\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>PING k8s-node1.training.lab (192.168.66.81) 56(84) bytes of data.\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=1 ttl=64 time=0.430 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=2 ttl=64 time=0.345 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=3 ttl=64 time=0.243 ms\n\n--- k8s-node1.training.lab ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss\n</code></pre> Ping Worker Node 2<pre><code>ping k8s-node2 -c3\n</code></pre> \u6e2c\u8a66\u7db2\u969b\u7db2\u8def\u9023\u7dda<pre><code>ping google.com -c3\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>PING google.com (142.250.66.78) 56(84) bytes of data.\n64 bytes from lctsaa-aa-in-f14.1e100.net (142.250.66.78): icmp_seq=1 ttl=128 time=66.8 ms\n...\n3 packets transmitted, 3 received, 0% packet loss\n</code></pre> <p>\u9023\u7dda\u78ba\u8a8d</p> <p>\u78ba\u4fdd\u4e09\u53f0\u865b\u64ec\u6a5f\u4e4b\u9593\u53ef\u4ee5\u4e92\u76f8 ping \u901a\uff0c\u4e14\u53ef\u4ee5\u9023\u63a5\u7db2\u969b\u7db2\u8def\u4e0b\u8f09\u5957\u4ef6\u3002</p>"},{"location":"lab12_k8s_install/#3-script","title":"\u6b65\u9a5f 3\uff1a\u4e0b\u8f09\u5b89\u88dd Script","text":"<p>\u5f9e\u8ab2\u7a0b\u4f3a\u670d\u5668\u4e0b\u8f09 Kubernetes \u5b89\u88dd\u8173\u672c\uff1a</p> \u4e0b\u8f09\u5b89\u88dd\u8173\u672c<pre><code>wget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>--2026-01-27 15:55:16--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh    100%[==&gt;]  21.99K  51.0KB/s    in 0.4s    \n\n2026-01-27 15:55:17 (51.0 KB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n</code></pre> <p>\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650\uff1a</p> \u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650<pre><code>chmod 755 install_k8s-latest.sh\n</code></pre> <p>\u67e5\u770b\u4f7f\u7528\u8aaa\u660e\uff1a</p> \u67e5\u770b\u8173\u672c\u4f7f\u7528\u65b9\u5f0f<pre><code>./install_k8s-latest.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\u8acb\u8f38\u5165 \u5b8c\u6574\u5b89\u88dd(full) \u6216\u662f standalone\n./install_k8s-latest.sh -full\n\u6216 \n./install_k8s-latest.sh -standalone\n</code></pre>"},{"location":"lab12_k8s_install/#4","title":"\u6b65\u9a5f 4\uff1a\u57f7\u884c\u5b8c\u6574\u5b89\u88dd","text":"<p>\u57f7\u884c\u8173\u672c\u9032\u884c\u5b8c\u6574\u53e2\u96c6\u5b89\u88dd\uff08\u5305\u542b Master \u548c Worker \u7bc0\u9ede\uff09\uff1a</p> \u57f7\u884c\u5b8c\u6574\u5b89\u88dd<pre><code>./install_k8s-latest.sh -full\n</code></pre> <p>\u5b89\u88dd\u6642\u9593</p> <p>\u5b8c\u6574\u5b89\u88dd\u904e\u7a0b\u7d04\u9700 5-10 \u5206\u9418\uff0c\u53d6\u6c7a\u65bc\u7db2\u8def\u901f\u5ea6\u3002\u8acb\u8010\u5fc3\u7b49\u5f85\u3002</p>"},{"location":"lab12_k8s_install/#_4","title":"\u5b89\u88dd\u904e\u7a0b\u8aaa\u660e","text":"<p>\u8173\u672c\u6703\u81ea\u52d5\u57f7\u884c\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <pre><code>graph LR\n    A[\u5b89\u88dd sshpass] --&gt; B[\u5b89\u88dd Docker CE]\n    B --&gt; C[\u8a2d\u5b9a bash-completion]\n    C --&gt; D[\u95dc\u9589 Swap]\n    D --&gt; E[\u8a2d\u5b9a Kernel \u53c3\u6578]\n    E --&gt; F[\u5b89\u88dd kubeadm/kubectl/kubelet]\n    F --&gt; G[\u5b89\u88dd CRI-O]\n    G --&gt; H[kubeadm init]\n    H --&gt; I[Worker \u52a0\u5165\u53e2\u96c6]\n    I --&gt; J[\u5b89\u88dd Antrea CNI]</code></pre> <p>\u4e3b\u8981\u5b89\u88dd\u9805\u76ee\uff1a</p> \u968e\u6bb5 \u8aaa\u660e sshpass \u7528\u65bc\u81ea\u52d5\u5316 SSH \u767b\u5165 Worker \u7bc0\u9ede Docker CE \u5b89\u88dd Docker 29.2.0\uff08\u6240\u6709\u7bc0\u9ede\uff09 bash-completion kubectl \u6307\u4ee4\u81ea\u52d5\u88dc\u9f4a Swap \u95dc\u9589 Kubernetes \u8981\u6c42\u95dc\u9589 Swap Kernel \u53c3\u6578 \u8a2d\u5b9a ip_forward\u3001bridge-nf-call \u7b49 kubeadm/kubectl/kubelet Kubernetes 1.32.11 \u6838\u5fc3\u5143\u4ef6 CRI-O \u5bb9\u5668\u57f7\u884c\u74b0\u5883 1.32.1 Antrea CNI \u7db2\u8def\u63d2\u4ef6"},{"location":"lab12_k8s_install/#5","title":"\u6b65\u9a5f 5\uff1a\u9a57\u8b49\u5b89\u88dd\u7d50\u679c","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u8173\u672c\u6703\u986f\u793a\u985e\u4f3c\u4ee5\u4e0b\u8a0a\u606f\uff1a</p> <pre><code>Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.66.71:6443 --token hv80nh.sji1vjeju8b5l10n \\\n    --discovery-token-ca-cert-hash sha256:f2af63e6d5dafedcc62702dcb939b51bfa98b96ab996af3556665a05a7cf0a6c\n</code></pre> <p>\u5b89\u88dd\u6210\u529f</p> <p>\u770b\u5230 \"Your Kubernetes control-plane has initialized successfully!\" \u8868\u793a Master \u7bc0\u9ede\u5b89\u88dd\u6210\u529f\u3002</p>"},{"location":"lab12_k8s_install/#6","title":"\u6b65\u9a5f 6\uff1a\u76e3\u63a7\u53e2\u96c6\u72c0\u614b","text":"<p>\u4f7f\u7528 <code>while</code> \u8ff4\u5708\u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b\uff1a</p> \u6301\u7e8c\u76e3\u63a7\u7bc0\u9ede\u72c0\u614b<pre><code>while true\ndo\n  date\n  kubectl get nodes\n  sleep 5\ndone\n</code></pre> <p>\u521d\u59cb\u72c0\u614b\uff08NotReady\uff09\uff1a</p> <pre><code>Tue Jan 27 04:05:22 PM CST 2026\nNAME                       STATUS     ROLES           AGE   VERSION\nk8s-master1.training.lab   NotReady   control-plane   84s   v1.32.11\nk8s-node1.training.lab     NotReady   &lt;none&gt;          76s   v1.32.11\nk8s-node2.training.lab     NotReady   &lt;none&gt;          75s   v1.32.11\n</code></pre> <p>NotReady \u72c0\u614b</p> <p>\u525b\u5b89\u88dd\u5b8c\u6210\u6642\uff0c\u7bc0\u9ede\u6703\u986f\u793a <code>NotReady</code>\uff0c\u7b49\u5f85 CNI \u7db2\u8def\u63d2\u4ef6\u5b8c\u6210\u521d\u59cb\u5316\u5f8c\u6703\u8b8a\u6210 <code>Ready</code>\u3002</p> <p>\u6700\u7d42\u72c0\u614b\uff08Ready\uff09\uff1a</p> <pre><code>NAME                       STATUS   ROLES           AGE    VERSION\nk8s-master1.training.lab   Ready    control-plane   5m     v1.32.11\nk8s-node1.training.lab     Ready    &lt;none&gt;          4m52s  v1.32.11\nk8s-node2.training.lab     Ready    &lt;none&gt;          4m51s  v1.32.11\n</code></pre> <p>\u6309 <code>Ctrl+C</code> \u505c\u6b62\u76e3\u63a7\u3002</p>"},{"location":"lab12_k8s_install/#7","title":"\u6b65\u9a5f 7\uff1a\u9a57\u8b49\u90e8\u7f72\u529f\u80fd","text":"<p>\u5efa\u7acb\u4e00\u500b\u6e2c\u8a66 Deployment \u4f86\u9a57\u8b49\u53e2\u96c6\u529f\u80fd\uff1a</p> \u5efa\u7acb\u6e2c\u8a66 Deployment<pre><code>kubectl create deployment test1 --image=httpd\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre> <p>\u67e5\u770b Deployment \u72c0\u614b\uff1a</p> \u67e5\u770b Deployment<pre><code>kubectl get deployments\n</code></pre> \u67e5\u770b Pod \u8a73\u7d30\u8cc7\u8a0a<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08Pod Running\uff09\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE   IP            NODE\ntest1-5b88789dbb-h99dh   1/1     Running   0          30s   10.244.1.2    k8s-node1.training.lab\n</code></pre> <p>\u6e05\u7406\u6e2c\u8a66\u8cc7\u6e90</p> <p>\u6e2c\u8a66\u5b8c\u6210\u5f8c\uff0c\u53ef\u4ee5\u522a\u9664\u6e2c\u8a66 Deployment\uff1a </p><pre><code>kubectl delete deployment test1\n</code></pre><p></p>"},{"location":"lab12_k8s_install/#_5","title":"\u5e38\u7528\u6aa2\u67e5\u6307\u4ee4","text":"\u6aa2\u67e5\u6240\u6709 Pod\uff08\u5305\u542b\u7cfb\u7d71 Pod\uff09<pre><code>kubectl get pods -A\n</code></pre> \u6aa2\u67e5\u53e2\u96c6\u8cc7\u8a0a<pre><code>kubectl cluster-info\n</code></pre> \u67e5\u770b\u7bc0\u9ede\u8a73\u7d30\u8cc7\u8a0a<pre><code>kubectl describe node k8s-master1.training.lab\n</code></pre> \u6aa2\u67e5 CRI-O \u72c0\u614b<pre><code>systemctl status crio\n</code></pre> \u6aa2\u67e5 kubelet \u72c0\u614b<pre><code>systemctl status kubelet\n</code></pre>"},{"location":"lab12_k8s_install/#_6","title":"\u5b89\u88dd\u6458\u8981","text":"\u9805\u76ee \u7248\u672c/\u503c Kubernetes 1.32.11 CRI-O 1.32.1 Docker CE 29.2.0 CNI Antrea Pod Network CIDR 10.244.0.0/16 Service CIDR 172.30.0.0/16 <p>\u5b8c\u6210\u78ba\u8a8d</p> <p>\u7576\u6240\u6709\u7bc0\u9ede\u986f\u793a <code>Ready</code> \u72c0\u614b\uff0c\u4e14\u6e2c\u8a66 Pod \u53ef\u4ee5\u6b63\u5e38\u904b\u884c\uff0c\u8868\u793a Kubernetes \u53e2\u96c6\u5b89\u88dd\u6210\u529f\uff01</p>"},{"location":"lab12_k8s_install/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u74b0\u5883\u6e96\u5099\uff1a\u555f\u52d5\u4e09\u53f0\u865b\u64ec\u6a5f\uff08k8s-master1\u3001k8s-node1\u3001k8s-node2\uff09</li> <li>\u2705 \u7db2\u8def\u78ba\u8a8d\uff1a\u78ba\u4fdd\u7bc0\u9ede\u9593\u53ef\u4ee5\u4e92\u76f8\u901a\u8a0a\uff0c\u4e14\u53ef\u9023\u63a5\u7db2\u969b\u7db2\u8def</li> <li>\u2705 \u8173\u672c\u5b89\u88dd\uff1a\u4f7f\u7528 <code>install_k8s-latest.sh -full</code> \u81ea\u52d5\u5316\u5b89\u88dd</li> <li>\u2705 \u6838\u5fc3\u5143\u4ef6\uff1a\u5b89\u88dd kubeadm\u3001kubectl\u3001kubelet v1.32.11</li> <li>\u2705 \u5bb9\u5668\u57f7\u884c\u74b0\u5883\uff1a\u5b89\u88dd CRI-O v1.32.1</li> <li>\u2705 CNI \u7db2\u8def\uff1a\u90e8\u7f72 Antrea \u7db2\u8def\u63d2\u4ef6</li> <li>\u2705 \u53e2\u96c6\u9a57\u8b49\uff1a\u78ba\u8a8d\u6240\u6709\u7bc0\u9ede Ready \u4e26\u6e2c\u8a66 Deployment</li> </ul>"},{"location":"lab12_k8s_install/#_8","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li>kubeadm \u5b89\u88dd\u6307\u5357</li> <li>CRI-O \u5b98\u65b9\u6587\u4ef6</li> <li>Antrea CNI</li> </ul>"},{"location":"lab13_k8s_commands/","title":"LAB 13 kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#lab-13-kubernetes","title":"LAB 13 Kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 kubectl \u5efa\u7acb\u8207\u7ba1\u7406 Deployment</li> <li> \u4f7f\u7528 kubectl run \u5efa\u7acb\u7368\u7acb Pod</li> <li> \u4f7f\u7528 kubectl scale \u624b\u52d5\u64f4\u5c55 Deployment</li> <li> \u4f7f\u7528 kubectl autoscale \u8a2d\u5b9a\u81ea\u52d5\u64f4\u5c55\uff08HPA\uff09</li> <li> \u4f7f\u7528 Labels \u6a19\u7c64\u7ba1\u7406\u8207\u67e5\u8a62 Pod</li> <li> \u4f7f\u7528 YAML \u6a94\u6848\u90e8\u7f72\u8207\u522a\u9664\u8cc7\u6e90</li> </ul>"},{"location":"lab13_k8s_commands/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 12 Kubernetes \u53e2\u96c6\u5b89\u88dd</li> <li>\u719f\u6089 Kubernetes \u57fa\u672c\u6982\u5ff5\uff08Pod\u3001Deployment\u3001Service\uff09</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab13_k8s_commands/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab13_k8s_commands/#kubectl","title":"kubectl \u662f\u4ec0\u9ebc\uff1f","text":"<p><code>kubectl</code>\uff08\u8b80\u97f3\uff1akube-control \u6216 kube-C-T-L\uff09\u662f Kubernetes \u7684**\u547d\u4ee4\u5217\u5de5\u5177\uff08CLI\uff09**\uff0c\u7528\u4f86\u8207 Kubernetes \u53e2\u96c6\u9032\u884c\u4e92\u52d5\u3002</p> <pre><code>graph LR\n    User[\u4f7f\u7528\u8005] --&gt; kubectl[kubectl \u6307\u4ee4]\n    kubectl --&gt; API[API Server]\n    API --&gt; Controller[Controller Manager]\n    API --&gt; Scheduler[Scheduler]\n    API --&gt; etcd[(etcd)]</code></pre> <p>kubectl \u529f\u80fd</p> <ul> <li>\u5efa\u7acb\u3001\u67e5\u770b\u3001\u66f4\u65b0\u3001\u522a\u9664 Kubernetes \u8cc7\u6e90</li> <li>\u67e5\u770b\u53e2\u96c6\u72c0\u614b\u8207\u65e5\u8a8c</li> <li>\u9032\u5165\u5bb9\u5668\u57f7\u884c\u6307\u4ee4</li> <li>\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f</li> </ul>"},{"location":"lab13_k8s_commands/#pod","title":"Pod \u662f\u4ec0\u9ebc\uff1f","text":"<p>Pod\uff08\u8c46\u83a2\uff09 \u662f Kubernetes \u4e2d**\u6700\u5c0f\u7684\u90e8\u7f72\u55ae\u4f4d**\uff0c\u4e00\u500b Pod \u53ef\u4ee5\u5305\u542b\u4e00\u500b\u6216\u591a\u500b\u5bb9\u5668\uff08Container\uff09\u3002</p> <pre><code>graph TB\n    subgraph \"Pod\"\n        C1[Container 1]\n        C2[Container 2]\n        Volume[(Shared Volume)]\n        C1 -.-&gt; Volume\n        C2 -.-&gt; Volume\n    end\n    Network[Shared Network&lt;br/&gt;\u540c\u4e00\u500b IP]\n    Pod --&gt; Network</code></pre> \u7279\u6027 \u8aaa\u660e \u5171\u4eab\u7db2\u8def \u540c\u4e00\u500b Pod \u5167\u7684\u5bb9\u5668\u5171\u4eab\u76f8\u540c\u7684 IP \u4f4d\u5740\u548c Port \u5171\u4eab\u5132\u5b58 \u53ef\u4ee5\u639b\u8f09\u5171\u4eab\u7684 Volume \u751f\u547d\u9031\u671f Pod \u662f\u81e8\u6642\u6027\u7684\uff0c\u53ef\u80fd\u96a8\u6642\u88ab\u91cd\u65b0\u8abf\u5ea6 \u6700\u5c0f\u55ae\u4f4d \u7121\u6cd5\u90e8\u7f72\u300c\u534a\u500b\u5bb9\u5668\u300d\uff0cPod \u662f\u4e0d\u53ef\u5206\u5272\u7684"},{"location":"lab13_k8s_commands/#deployment","title":"Deployment \u662f\u4ec0\u9ebc\uff1f","text":"<p>Deployment\uff08\u90e8\u7f72\uff09 \u662f Kubernetes \u4e2d\u7528\u4f86**\u7ba1\u7406 Pod \u526f\u672c\u6578\u91cf\u548c\u66f4\u65b0\u7b56\u7565**\u7684\u63a7\u5236\u5668\uff08Controller\uff09\u3002</p> <pre><code>graph TB\n    D[Deployment] --&gt; RS[ReplicaSet]\n    RS --&gt; P1[Pod 1]\n    RS --&gt; P2[Pod 2]\n    RS --&gt; P3[Pod 3]</code></pre> Deployment \u529f\u80fd \u8aaa\u660e \u526f\u672c\u7ba1\u7406 \u78ba\u4fdd\u6307\u5b9a\u6578\u91cf\u7684 Pod \u526f\u672c\u59cb\u7d42\u904b\u884c \u81ea\u52d5\u4fee\u5fa9 Pod \u639b\u6389\u6642\u81ea\u52d5\u5efa\u7acb\u65b0\u7684 Pod \u6efe\u52d5\u66f4\u65b0 \u66f4\u65b0\u61c9\u7528\u7a0b\u5f0f\u6642\u9010\u6b65\u66ff\u63db\u820a Pod \u56de\u6efe \u767c\u73fe\u554f\u984c\u6642\u53ef\u4ee5\u56de\u5230\u5148\u524d\u7248\u672c <p>Pod vs Deployment</p> <ul> <li>\u76f4\u63a5\u5efa\u7acb Pod\uff08\u4f7f\u7528 <code>kubectl run</code>\uff09\uff1a\u9069\u5408\u6e2c\u8a66\uff0c\u4f46 Pod \u639b\u6389\u5f8c**\u4e0d\u6703\u81ea\u52d5\u91cd\u5efa**</li> <li>\u4f7f\u7528 Deployment\uff08\u4f7f\u7528 <code>kubectl create deployment</code>\uff09\uff1a\u6b63\u5f0f\u74b0\u5883\u63a8\u85a6\uff0c\u6703**\u81ea\u52d5\u7dad\u8b77\u6307\u5b9a\u6578\u91cf\u7684 Pod**</li> </ul>"},{"location":"lab13_k8s_commands/#api","title":"API \u8cc7\u6e90\u7c21\u7a31","text":"<p>\u5728 <code>kubectl</code> \u6307\u4ee4\u4e2d\uff0c\u4f60\u53ef\u80fd\u6703\u770b\u5230\u4e0d\u540c\u7684\u8cc7\u6e90\u540d\u7a31\u5beb\u6cd5\uff1a</p> \u5b8c\u6574\u540d\u7a31 \u7c21\u7a31 \u8aaa\u660e <code>pods</code> <code>po</code> Pod \u8cc7\u6e90 <code>deployments.apps</code> <code>deploy</code> Deployment \u8cc7\u6e90 <code>services</code> <code>svc</code> Service \u8cc7\u6e90 <code>replicasets.apps</code> <code>rs</code> ReplicaSet \u8cc7\u6e90 <code>namespaces</code> <code>ns</code> Namespace \u8cc7\u6e90 <code>configmaps</code> <code>cm</code> ConfigMap \u8cc7\u6e90 <code>secrets</code> <code>secret</code> Secret \u8cc7\u6e90 <code>persistentvolumeclaims</code> <code>pvc</code> PVC \u8cc7\u6e90 <p>\u7bc4\u4f8b\uff1a\u4ee5\u4e0b\u6307\u4ee4\u6548\u679c\u76f8\u540c\uff1a</p> <pre><code># \u5b8c\u6574\u5beb\u6cd5\nkubectl get deployments.apps\n\n# \u7c21\u7a31\u5beb\u6cd5\nkubectl get deploy\n</code></pre> <p>deployments.apps \u7684\u7531\u4f86</p> <p><code>deployments.apps</code> \u8868\u793a Deployment \u8cc7\u6e90\u5c6c\u65bc <code>apps</code> API \u7fa4\u7d44\u3002\u9019\u662f\u56e0\u70ba Kubernetes \u7684 API \u5206\u6210\u591a\u500b\u7fa4\u7d44\uff08\u5982 <code>core</code>\u3001<code>apps</code>\u3001<code>batch</code>\uff09\uff0c\u5b8c\u6574\u5beb\u6cd5\u53ef\u4ee5\u660e\u78ba\u6307\u5b9a\u8cc7\u6e90\u4f86\u6e90\u3002</p>"},{"location":"lab13_k8s_commands/#lab-kubernetes","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aKubernetes \u57fa\u672c\u6307\u4ee4\u64cd\u4f5c","text":""},{"location":"lab13_k8s_commands/#_4","title":"\u74b0\u5883\u6e96\u5099","text":"<pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        Master[k8s-master1&lt;br/&gt;192.168.66.71&lt;br/&gt;Control Plane]\n        Node1[k8s-node1&lt;br/&gt;192.168.66.81&lt;br/&gt;Worker Node]\n        Node2[k8s-node2&lt;br/&gt;192.168.66.82&lt;br/&gt;Worker Node]\n        Master --&gt; Node1\n        Master --&gt; Node2\n    end\n\n    subgraph \"Private Registry\"\n        Docker1[docker1.training.lab:5000&lt;br/&gt;\u79c1\u6709\u6620\u50cf\u6a94\u5009\u5eab]\n    end\n\n    Master -.-&gt; Docker1\n    Node1 -.-&gt; Docker1\n    Node2 -.-&gt; Docker1</code></pre>"},{"location":"lab13_k8s_commands/#1-registry","title":"\u6b65\u9a5f 1\uff1a\u521d\u59cb\u5316\u79c1\u6709 Registry \u9023\u7dda\u8a2d\u5b9a","text":"<p>\u70ba\u4e86\u8b93\u6240\u6709\u7bc0\u9ede\u90fd\u80fd\u5f9e\u79c1\u6709 Registry \u62c9\u53d6\u6620\u50cf\u6a94\uff0c\u9700\u8981\u5148\u57f7\u884c\u521d\u59cb\u5316\u8173\u672c\uff1a</p> \u4e0b\u8f09\u521d\u59cb\u5316\u8173\u672c<pre><code>wget http://10.0.1.249/k8s/scripts/init_pull_from_private_registry.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>--2026-01-28 10:40:26--  http://10.0.1.249/k8s/scripts/init_pull_from_private_registry.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3711 (3.6K) [application/x-sh]\nSaving to: 'init_pull_from_private_registry.sh'\n\ninit_pull_from_private_registry.sh   100%[======&gt;]   3.62K  --.-KB/s    in 0s      \n\n2026-01-28 10:40:26 (760 MB/s) - 'init_pull_from_private_registry.sh' saved [3711/3711]\n</code></pre> <p>\u8a2d\u5b9a\u57f7\u884c\u6b0a\u9650\u4e26\u57f7\u884c\u8173\u672c\uff1a</p> \u8a2d\u5b9a\u6b0a\u9650\u4e26\u57f7\u884c<pre><code>chmod 755 init_pull_from_private_registry.sh\n./init_pull_from_private_registry.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u90e8\u5206\u8f38\u51fa\uff09\uff1a</p> <pre><code>docker1\nWarning: Permanently added 'docker1' (ED25519) to the list of known hosts.\ndocker1.training.lab\ndocker-ce-29.1.5-1.el9.x86_64\nInstall docker-ce...\ncontainerd.io-2.2.1-1.el9.x86_64\nInstall containerd.io...\n...\nk8s-master1\nk8s-master1.training.lab\ndocker-ce-29.2.0-1.el9.x86_64\nInstall docker-ce...\ncontainerd.io-2.2.1-1.el9.x86_64\nInstall containerd.io...\ncri-o-1.32.1-150500.1.1.x86_64\nInstall cri-o...\n</code></pre> <p>\u8173\u672c\u529f\u80fd</p> <p>\u6b64\u8173\u672c\u6703\u81ea\u52d5\u8a2d\u5b9a\u6240\u6709\u7bc0\u9ede\uff08docker1\u3001docker2\u3001k8s-standalone\u3001k8s-master1\u3001k8s-node1\u3001k8s-node2\uff09\u7684 Docker\u3001containerd \u548c CRI-O \u74b0\u5883\uff0c\u4f7f\u5176\u80fd\u5920\u5f9e\u79c1\u6709 Registry \u62c9\u53d6\u6620\u50cf\u6a94\u3002</p>"},{"location":"lab13_k8s_commands/#2","title":"\u6b65\u9a5f 2\uff1a\u6e05\u7406\u73fe\u6709\u8cc7\u6e90","text":"<p>\u4e0b\u8f09\u4e26\u57f7\u884c\u6e05\u7406\u8173\u672c\uff1a</p> \u4e0b\u8f09\u6e05\u7406\u8173\u672c<pre><code>curl -LO http://10.0.1.249/k8s/scripts/kube_clean_all.sh\nchmod 755 kube_clean_all.sh\n</code></pre> <p>\u57f7\u884c\u6e05\u7406\uff1a</p> \u6e05\u7406\u6240\u6709\u8cc7\u6e90<pre><code>./kube_clean_all.sh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>service \"kubernetes\" deleted\ndeployment.apps \"test1\" deleted\nNo resources found\nconfigmap \"kube-root-ca.crt\" deleted\nnamespace \"kube-node-lease\" deleted\nError from server (Forbidden): namespaces \"default\" is forbidden: this namespace may not be deleted\nError from server (Forbidden): namespaces \"kube-public\" is forbidden: this namespace may not be deleted\nError from server (Forbidden): namespaces \"kube-system\" is forbidden: this namespace may not be deleted\n</code></pre> <p>\u7cfb\u7d71\u547d\u540d\u7a7a\u9593</p> <p><code>default</code>\u3001<code>kube-public</code>\u3001<code>kube-system</code> \u70ba\u7cfb\u7d71\u4fdd\u8b77\u7684\u547d\u540d\u7a7a\u9593\uff0c\u7121\u6cd5\u88ab\u522a\u9664\uff0c\u51fa\u73fe\u932f\u8aa4\u8a0a\u606f\u662f\u6b63\u5e38\u7684\u3002</p>"},{"location":"lab13_k8s_commands/#3-deployment","title":"\u6b65\u9a5f 3\uff1a\u5efa\u7acb Deployment","text":"<p>\u4f7f\u7528 <code>kubectl create deployment</code> \u5efa\u7acb Deployment\uff1a</p> \u5efa\u7acb Deployment (4 \u500b\u526f\u672c)<pre><code>kubectl create deployment test1 --image=docker1.training.lab:5000/httpd --replicas=4\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre> <p>\u67e5\u770b Deployment \u72c0\u614b\uff1a</p> \u67e5\u770b Deployment<pre><code>kubectl get deployments.apps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   0/4     4            0           13s\n</code></pre> <p>\u67e5\u770b Pod \u8a73\u7d30\u8cc7\u8a0a\uff1a</p> \u67e5\u770b Pod \u8a73\u7d30\u4f4d\u7f6e<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                    READY   STATUS    RESTARTS   AGE     IP       NODE     NOMINATED NODE   READINESS GATES\ntest1-dcd787f9d-9rkdj   0/1     Pending   0          5m49s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\ntest1-dcd787f9d-cqqmc   0/1     Pending   0          5m49s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\ntest1-dcd787f9d-l5rmx   0/1     Pending   0          5m49s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\ntest1-dcd787f9d-rznwh   0/1     Pending   0          5m49s   &lt;none&gt;   &lt;none&gt;   &lt;none&gt;           &lt;none&gt;\n</code></pre> <p>Pending \u72c0\u614b</p> <p>\u5982\u679c Pod \u986f\u793a <code>Pending</code> \u72c0\u614b\uff0c\u53ef\u80fd\u662f\u56e0\u70ba\uff1a</p> <ul> <li>Worker Node \u5c1a\u672a Ready</li> <li>\u8cc7\u6e90\u4e0d\u8db3</li> <li>\u7121\u6cd5\u62c9\u53d6\u6620\u50cf\u6a94</li> </ul> <p>\u4f7f\u7528 <code>kubectl describe pod &lt;pod-name&gt;</code> \u67e5\u770b\u8a73\u7d30\u539f\u56e0\u3002</p>"},{"location":"lab13_k8s_commands/#4-pod-deployment","title":"\u6b65\u9a5f 4\uff1a\u522a\u9664 Pod \u8207 Deployment","text":"<p>\u522a\u9664\u55ae\u4e00 Pod\uff1a</p> \u522a\u9664\u6307\u5b9a Pod<pre><code>kubectl delete pod/test1-dcd787f9d-rznwh\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod \"test1-dcd787f9d-rznwh\" deleted\n</code></pre> <p>Pod \u540d\u7a31\u683c\u5f0f</p> <p>Pod \u540d\u7a31\u683c\u5f0f\u70ba <code>&lt;deployment-name&gt;-&lt;replicaset-hash&gt;-&lt;pod-hash&gt;</code>\u3002 \u6ce8\u610f\u4e0d\u8981\u591a\u6253\u9023\u5b57\u865f\uff08<code>--</code>\uff09\uff0c\u5426\u5247\u6703\u627e\u4e0d\u5230 Pod\u3002</p> <p>\u522a\u9664\u6574\u500b Deployment\uff08\u6703\u540c\u6642\u522a\u9664\u6240\u6709\u76f8\u95dc Pod\uff09\uff1a</p> \u522a\u9664 Deployment<pre><code>kubectl delete deployments.apps test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps \"test1\" deleted\n</code></pre> <p>\u9a57\u8b49\u522a\u9664\u7d50\u679c\uff1a</p> \u78ba\u8a8d\u522a\u9664\u5b8c\u6210<pre><code>kubectl get deployments.apps\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>No resources found in default namespace.\n</code></pre>"},{"location":"lab13_k8s_commands/#5-kubectl-run-pod","title":"\u6b65\u9a5f 5\uff1a\u4f7f\u7528 kubectl run \u5efa\u7acb Pod","text":"<p>\u4f7f\u7528 <code>kubectl run</code> \u76f4\u63a5\u5efa\u7acb\u7368\u7acb Pod\uff08\u4e0d\u900f\u904e Deployment\uff09\uff1a</p> \u5efa\u7acb Pod \u4e26\u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578<pre><code>kubectl run test4 --image=docker1.training.lab:5000/nginx --env=\"TEST=test4\"\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod/test4 created\n</code></pre> <p>\u9032\u5165 Pod \u57f7\u884c\u6307\u4ee4\uff08\u4f7f\u7528 <code>kubectl exec</code>\uff09\uff1a</p> \u9032\u5165 Pod \u57f7\u884c bash<pre><code>kubectl exec test4 -it -- bash\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4</p> <p>\u932f\u8aa4\u5beb\u6cd5\uff1a<code>kubectl exec test4 -it --bash</code>\uff08\u7f3a\u5c11 <code>--</code> \u5206\u9694\u7b26\uff09</p> <p>\u6b63\u78ba\u5beb\u6cd5\uff1a<code>kubectl exec test4 -it -- bash</code></p> <p><code>--</code> \u7528\u4f86\u5206\u9694 kubectl \u53c3\u6578\u548c\u5bb9\u5668\u5167\u8981\u57f7\u884c\u7684\u6307\u4ee4\u3002</p>"},{"location":"lab13_k8s_commands/#6-deployment","title":"\u6b65\u9a5f 6\uff1a\u5efa\u7acb\u8207\u64f4\u5c55 Deployment","text":"<p>\u5efa\u7acb Deployment\uff1a</p> \u5efa\u7acb test5 Deployment<pre><code>kubectl create deployment test5 --image=docker1.training.lab:5000/nginx\n</code></pre> \u5efa\u7acb test6 Deployment\uff082 \u500b\u526f\u672c\uff09<pre><code>kubectl create deployment test6 --image=docker1.training.lab:5000/nginx --replicas=2\n</code></pre> <p>\u67e5\u770b Deployment \u72c0\u614b\uff1a</p> \u67e5\u770b\u7279\u5b9a Deployment<pre><code>kubectl get deployments.apps test5\nkubectl get deployments.apps test6\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/1     1            0           28s\n\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest6   0/2     2            0           4m43s\n</code></pre>"},{"location":"lab13_k8s_commands/#7-deploymentscale","title":"\u6b65\u9a5f 7\uff1a\u624b\u52d5\u64f4\u5c55 Deployment\uff08Scale\uff09","text":"<p>\u4f7f\u7528 <code>kubectl scale</code> \u624b\u52d5\u8abf\u6574\u526f\u672c\u6578\u91cf\uff1a</p> \u64f4\u5c55 test5 \u5230 3 \u500b\u526f\u672c<pre><code>kubectl scale deployment test5 --replicas=3\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test5 scaled\n</code></pre> <p>\u9a57\u8b49\u64f4\u5c55\u7d50\u679c\uff1a</p> \u67e5\u770b\u64f4\u5c55\u5f8c\u7684\u72c0\u614b<pre><code>kubectl get deployments.apps test5\nkubectl get pods | grep test5\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/3     3            0           10m\n\ntest5-8464657978-5jgj6   0/1     Pending   0          10m\ntest5-8464657978-fc7zg   0/1     Pending   0          28s\ntest5-8464657978-sqgql   0/1     Pending   0          28s\n</code></pre>"},{"location":"lab13_k8s_commands/#8autoscale-hpa","title":"\u6b65\u9a5f 8\uff1a\u8a2d\u5b9a\u81ea\u52d5\u64f4\u5c55\uff08Autoscale / HPA\uff09","text":"<p>\u4f7f\u7528 <code>kubectl autoscale</code> \u5efa\u7acb Horizontal Pod Autoscaler\uff08HPA\uff09\uff1a</p> \u8a2d\u5b9a\u81ea\u52d5\u64f4\u5c55<pre><code>kubectl autoscale deployment test5 --min=4 --max=9 --cpu-percent=80\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>horizontalpodautoscaler.autoscaling/test5 autoscaled\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4</p> <p>\u932f\u8aa4\u5beb\u6cd5\uff1a</p> <ul> <li><code>--cpu80%</code>\uff08\u7f3a\u5c11\u7b49\u865f\u548c percent\uff09</li> <li><code>--cpu 80%</code>\uff08\u6709\u7a7a\u683c\u3001\u7f3a\u5c11 percent\uff09</li> <li><code>--cpu=80%</code>\uff08flag \u540d\u7a31\u932f\u8aa4\uff09</li> </ul> <p>\u6b63\u78ba\u5beb\u6cd5\uff1a<code>--cpu-percent=80</code></p> <p>\u9a57\u8b49 HPA \u6548\u679c\uff1a</p> \u67e5\u770b\u64f4\u5c55\u5f8c\u7684 Deployment<pre><code>kubectl get deployments.apps test5\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/4     4            0           12m\n</code></pre> <p>HPA \u8aaa\u660e</p> <p>HPA \u6703\u6839\u64da CPU \u4f7f\u7528\u7387\u81ea\u52d5\u8abf\u6574 Pod \u6578\u91cf\uff1a</p> <ul> <li>--min=4\uff1a\u6700\u5c11\u7dad\u6301 4 \u500b\u526f\u672c</li> <li>--max=9\uff1a\u6700\u591a\u64f4\u5c55\u5230 9 \u500b\u526f\u672c</li> <li>--cpu-percent=80\uff1a\u7576 CPU \u4f7f\u7528\u7387\u8d85\u904e 80% \u6642\u89f8\u767c\u64f4\u5c55</li> </ul>"},{"location":"lab13_k8s_commands/#9-labels-pod","title":"\u6b65\u9a5f 9\uff1a\u4f7f\u7528 Labels \u6a19\u7c64\u7ba1\u7406 Pod","text":"<p>\u5efa\u7acb\u5e36\u6709\u81ea\u8a02 Label \u7684 Pod\uff1a</p> \u5efa\u7acb\u5e36\u6709 Label \u7684 Pod<pre><code>kubectl run test7 --image=docker1.training.lab:5000/nginx --labels=\"os=linux\"\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod/test7 created\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4</p> <p>\u932f\u8aa4\u5beb\u6cd5\uff1a<code>kubectl run test8 --image=nginx ==labels=\"os=windows\"</code>\uff08\u5169\u500b\u7b49\u865f\uff09</p> <p>\u6b63\u78ba\u5beb\u6cd5\uff1a<code>kubectl run test8 --image=nginx --labels=\"os=windows\"</code></p> <p>\u67e5\u770b Pod Labels\uff1a</p> \u986f\u793a\u6240\u6709 Pod \u7684 Labels<pre><code>kubectl get pods --show-labels\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE     LABELS\ntest4                    0/1     Pending   0          18m     run=test4\ntest5-8464657978-5jgj6   0/1     Pending   0          14m     app=test5,pod-template-hash=8464657978\ntest7                    0/1     Pending   0          47s     os=linux\ntest8                    0/1     Pending   0          13s     run=test8\n</code></pre> <p>\u4f9d\u64da Label \u904e\u6ffe Pod\uff1a</p> \u904e\u6ffe\u5305\u542b os Label \u7684 Pod<pre><code>kubectl get pods --show-labels | grep 'os='\n</code></pre> \u986f\u793a\u7279\u5b9a Label \u6b04\u4f4d<pre><code>kubectl get pods -L os\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                     READY   STATUS    RESTARTS   AGE     OS\ntest4                    0/1     Pending   0          20m     \ntest5-8464657978-5jgj6   0/1     Pending   0          16m     \ntest7                    0/1     Pending   0          2m57s   linux\ntest8                    0/1     Pending   0          2m23s   \n</code></pre> <p>Label \u4f7f\u7528\u6280\u5de7</p> <ul> <li><code>--show-labels</code>\uff1a\u986f\u793a\u6240\u6709 Labels</li> <li><code>-L &lt;label-key&gt;</code>\uff1a\u5c07\u6307\u5b9a\u7684 Label \u986f\u793a\u70ba\u7368\u7acb\u6b04\u4f4d</li> <li><code>-l &lt;label-selector&gt;</code>\uff1a\u4f9d\u64da Label \u904e\u6ffe\u8cc7\u6e90</li> </ul>"},{"location":"lab13_k8s_commands/#10-yaml","title":"\u6b65\u9a5f 10\uff1a\u4f7f\u7528 YAML \u6a94\u6848\u90e8\u7f72","text":"<p>\u5f9e URL \u76f4\u63a5\u5957\u7528 YAML \u6a94\u6848\uff1a</p> \u5f9e URL \u5957\u7528 YAML<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/test9.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod/test9 created\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4</p> <p>\u6ce8\u610f URL \u8def\u5f91\u8981\u6b63\u78ba\uff08<code>/k8s/yaml/</code>\uff09\uff0c\u6253\u932f\u6703\u51fa\u73fe 404 \u932f\u8aa4\uff1a </p><pre><code>error: unable to read URL \"http://10.0.1.249/k8s/taml/test9.yaml\", \nserver reported 404 Not Found, status code=404\n</code></pre><p></p> <p>\u4e0b\u8f09 YAML \u6a94\u6848\u67e5\u770b\u5167\u5bb9\uff1a</p> \u4e0b\u8f09 YAML \u6a94\u6848<pre><code>wget http://10.0.1.249/k8s/yaml/test9.yaml\n</code></pre> \u67e5\u770b YAML \u5167\u5bb9<pre><code>cat test9.yaml\n</code></pre> <p>YAML \u5167\u5bb9\uff1a</p> test9.yaml<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test9\nspec:\n  containers:\n  - name: test9\n    image: docker1.training.lab:5000/nginx\n</code></pre> <p>\u4f7f\u7528\u672c\u5730 YAML \u6a94\u6848\u522a\u9664\u8cc7\u6e90\uff1a</p> \u4f7f\u7528 YAML \u522a\u9664\u8cc7\u6e90<pre><code>kubectl delete -f test9.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod \"test9\" deleted\n</code></pre> <p>YAML \u90e8\u7f72\u7684\u512a\u9ede</p> <ul> <li>\u7248\u672c\u63a7\u5236\uff1a\u53ef\u4ee5\u5c07 YAML \u6a94\u6848\u7d0d\u5165 Git \u7ba1\u7406</li> <li>\u91cd\u8907\u4f7f\u7528\uff1a\u540c\u4e00\u500b YAML \u53ef\u4ee5\u91cd\u8907\u90e8\u7f72</li> <li>\u5b8c\u6574\u5b9a\u7fa9\uff1aYAML \u53ef\u4ee5\u5305\u542b\u66f4\u591a\u9032\u968e\u8a2d\u5b9a</li> </ul>"},{"location":"lab13_k8s_commands/#kubectl_1","title":"\u5e38\u7528 kubectl \u6307\u4ee4\u5c0d\u7167\u8868","text":"\u64cd\u4f5c \u6307\u4ee4 \u7bc4\u4f8b \u5efa\u7acb Deployment <code>kubectl create deployment</code> <code>kubectl create deployment test --image=nginx --replicas=3</code> \u5efa\u7acb Pod <code>kubectl run</code> <code>kubectl run test --image=nginx --env=\"KEY=value\"</code> \u67e5\u770b\u8cc7\u6e90 <code>kubectl get</code> <code>kubectl get pods -o wide</code> \u64f4\u5c55\u526f\u672c <code>kubectl scale</code> <code>kubectl scale deployment test --replicas=5</code> \u81ea\u52d5\u64f4\u5c55 <code>kubectl autoscale</code> <code>kubectl autoscale deployment test --min=2 --max=10 --cpu-percent=80</code> \u9032\u5165\u5bb9\u5668 <code>kubectl exec</code> <code>kubectl exec test -it -- bash</code> \u522a\u9664\u8cc7\u6e90 <code>kubectl delete</code> <code>kubectl delete pod/test</code> \u5957\u7528 YAML <code>kubectl apply -f</code> <code>kubectl apply -f deployment.yaml</code> \u522a\u9664 YAML \u8cc7\u6e90 <code>kubectl delete -f</code> <code>kubectl delete -f deployment.yaml</code>"},{"location":"lab13_k8s_commands/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aPod \u4e00\u76f4\u8655\u65bc Pending \u72c0\u614b\u600e\u9ebc\u8fa6\uff1f <p>\u539f\u56e0\uff1a\u901a\u5e38\u662f\u56e0\u70ba\u6c92\u6709\u53ef\u7528\u7684 Worker Node \u6216\u7bc0\u9ede\u8cc7\u6e90\u4e0d\u8db3\u3002</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u67e5\u770b\u8a73\u7d30\u539f\u56e0\nkubectl describe pod &lt;pod-name&gt;\n\n# \u78ba\u8a8d\u7bc0\u9ede\u72c0\u614b\nkubectl get nodes\n</code></pre><p></p> Q2\uff1akubectl exec \u51fa\u73fe\u932f\u8aa4 'unknown flag: --bash' <p>\u539f\u56e0\uff1a<code>--bash</code> \u61c9\u8a72\u653e\u5728 <code>--</code> \u5f8c\u9762\uff0c\u4f5c\u70ba\u5bb9\u5668\u5167\u57f7\u884c\u7684\u6307\u4ee4\u3002</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u932f\u8aa4\nkubectl exec test -it --bash\n\n# \u6b63\u78ba\nkubectl exec test -it -- bash\n</code></pre><p></p> Q3\uff1a\u5982\u4f55\u67e5\u770b\u7279\u5b9a Label \u7684 Pod\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 <code>-l</code> \u6216 <code>-L</code> \u53c3\u6578\uff1a</p> <pre><code># \u4f9d\u64da Label \u904e\u6ffe\nkubectl get pods -l os=linux\n\n# \u986f\u793a Label \u6b04\u4f4d\nkubectl get pods -L os\n</code></pre>"},{"location":"lab13_k8s_commands/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u74b0\u5883\u521d\u59cb\u5316\uff1a\u4f7f\u7528\u8173\u672c\u8a2d\u5b9a\u79c1\u6709 Registry \u9023\u7dda</li> <li>\u2705 Deployment \u7ba1\u7406\uff1a\u4f7f\u7528 <code>kubectl create deployment</code> \u5efa\u7acb\u4e26\u7ba1\u7406 Deployment</li> <li>\u2705 Pod \u64cd\u4f5c\uff1a\u4f7f\u7528 <code>kubectl run</code> \u5efa\u7acb\u7368\u7acb Pod\uff0c<code>kubectl exec</code> \u9032\u5165\u5bb9\u5668</li> <li>\u2705 \u624b\u52d5\u64f4\u5c55\uff1a\u4f7f\u7528 <code>kubectl scale</code> \u8abf\u6574\u526f\u672c\u6578\u91cf</li> <li>\u2705 \u81ea\u52d5\u64f4\u5c55\uff1a\u4f7f\u7528 <code>kubectl autoscale</code> \u8a2d\u5b9a HPA</li> <li>\u2705 Labels \u7ba1\u7406\uff1a\u4f7f\u7528 <code>--labels</code> \u5efa\u7acb\u6a19\u7c64\uff0c<code>--show-labels</code> \u548c <code>-L</code> \u67e5\u8a62</li> <li>\u2705 YAML \u90e8\u7f72\uff1a\u4f7f\u7528 <code>kubectl apply -f</code> \u548c <code>kubectl delete -f</code> \u7ba1\u7406\u8cc7\u6e90</li> </ul>"},{"location":"lab13_k8s_commands/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>kubectl \u5b8c\u6574\u6307\u4ee4\u53c3\u8003</li> <li>Kubernetes Deployments</li> <li>Horizontal Pod Autoscaler</li> <li>Labels and Selectors</li> </ul>"},{"location":"lab14_namespace_rolling/","title":"LAB 14 namespaces \u8207 rolling update","text":""},{"location":"lab14_namespace_rolling/#lab-14-namespace-rolling-update","title":"LAB 14 Namespace \u8207 Rolling Update","text":""},{"location":"lab14_namespace_rolling/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 kubectl \u5efa\u7acb\u8207\u7ba1\u7406 Namespace</li> <li> \u5728\u4e0d\u540c Namespace \u4e2d\u90e8\u7f72\u8207\u67e5\u8a62\u8cc7\u6e90</li> <li> \u4f7f\u7528 <code>--dry-run=client -o yaml</code> \u7522\u751f YAML \u6a94\u6848</li> <li> \u4f7f\u7528 <code>kubectl apply -f</code> \u5957\u7528 YAML \u66f4\u65b0\u9032\u884c Rolling Update</li> <li> \u4f7f\u7528 <code>kubectl rollout</code> \u67e5\u770b\u6b77\u53f2\u7d00\u9304\u8207\u56de\u6efe\u7248\u672c</li> </ul>"},{"location":"lab14_namespace_rolling/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 13 Kubernetes \u5e38\u7528\u6307\u4ee4</li> <li>\u719f\u6089 Pod\u3001Deployment \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab14_namespace_rolling/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab14_namespace_rolling/#namespace","title":"Namespace \u662f\u4ec0\u9ebc\uff1f","text":"<p>Namespace\uff08\u547d\u540d\u7a7a\u9593\uff09 \u662f Kubernetes \u4e2d\u7528\u4f86**\u9694\u96e2\u8cc7\u6e90\u7684\u865b\u64ec\u5206\u5340**\u3002\u4e0d\u540c Namespace \u4e2d\u7684\u8cc7\u6e90\u540d\u7a31\u53ef\u4ee5\u76f8\u540c\uff0c\u5f7c\u6b64\u4e0d\u6703\u885d\u7a81\u3002</p> <pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"default namespace\"\n            D1[Deployment A]\n            P1[Pod A]\n        end\n        subgraph \"ns1 namespace\"\n            D2[Deployment A]\n            P2[Pod A]\n        end\n        subgraph \"kube-system namespace\"\n            D3[CoreDNS]\n            D4[Antrea]\n        end\n    end</code></pre> Namespace \u7528\u9014 \u8aaa\u660e \u8cc7\u6e90\u9694\u96e2 \u4e0d\u540c\u5718\u968a\u6216\u5c08\u6848\u4f7f\u7528\u4e0d\u540c Namespace \u6b0a\u9650\u63a7\u5236 \u53ef\u4ee5\u8a2d\u5b9a\u4e0d\u540c Namespace \u7684\u5b58\u53d6\u6b0a\u9650 \u8cc7\u6e90\u914d\u984d \u53ef\u4ee5\u9650\u5236\u5404 Namespace \u7684\u8cc7\u6e90\u4f7f\u7528\u91cf \u540d\u7a31\u5340\u9694 \u540c\u540d\u8cc7\u6e90\u53ef\u4ee5\u5b58\u5728\u65bc\u4e0d\u540c Namespace"},{"location":"lab14_namespace_rolling/#rolling-update","title":"Rolling Update \u662f\u4ec0\u9ebc\uff1f","text":"<p>Rolling Update\uff08\u6efe\u52d5\u66f4\u65b0\uff09 \u662f Kubernetes \u66f4\u65b0 Deployment \u7684\u9810\u8a2d\u7b56\u7565\uff0c\u6703**\u9010\u6b65**\u5c07\u820a\u7248 Pod \u66ff\u63db\u6210\u65b0\u7248\uff0c\u78ba\u4fdd\u670d\u52d9\u4e0d\u4e2d\u65b7\u3002</p> <pre><code>graph LR\n    subgraph \"\u66f4\u65b0\u524d\"\n        P1[Pod v1.7.1]\n        P2[Pod v1.7.1]\n        P3[Pod v1.7.1]\n    end\n\n    subgraph \"\u66f4\u65b0\u4e2d\"\n        P4[Pod v1.7.1]\n        P5[Pod v1.9.1]\n        P6[Pod v1.9.1]\n    end\n\n    subgraph \"\u66f4\u65b0\u5f8c\"\n        P7[Pod v1.9.1]\n        P8[Pod v1.9.1]\n        P9[Pod v1.9.1]\n    end\n\n    \u66f4\u65b0\u524d --&gt; \u66f4\u65b0\u4e2d --&gt; \u66f4\u65b0\u5f8c</code></pre> Rolling Update \u7279\u6027 \u8aaa\u660e \u96f6\u505c\u6a5f\u6642\u9593 \u66f4\u65b0\u904e\u7a0b\u4e2d\u670d\u52d9\u4e0d\u4e2d\u65b7 \u9010\u6b65\u66ff\u63db \u4e00\u6b21\u53ea\u66ff\u63db\u90e8\u5206 Pod \u53ef\u56de\u6efe \u767c\u73fe\u554f\u984c\u53ef\u4ee5\u56de\u5230\u5148\u524d\u7248\u672c \u6b77\u53f2\u7d00\u9304 \u4fdd\u7559\u90e8\u7f72\u7248\u672c\u6b77\u53f2"},{"location":"lab14_namespace_rolling/#lab-namespace","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aNamespace \u7ba1\u7406","text":""},{"location":"lab14_namespace_rolling/#1-kubectl","title":"\u6b65\u9a5f 1\uff1a\u555f\u7528 kubectl \u6307\u4ee4\u81ea\u52d5\u88dc\u9f4a","text":"<p>\u8a2d\u5b9a bash \u81ea\u52d5\u88dc\u9f4a\u529f\u80fd\uff0c\u65b9\u4fbf\u64cd\u4f5c\uff1a</p> \u555f\u7528 bash completion<pre><code>source &lt;(kubectl completion bash)\n</code></pre> <p>\u6c38\u4e45\u751f\u6548</p> <p>\u5c07\u4e0a\u8ff0\u6307\u4ee4\u52a0\u5165 <code>~/.bashrc</code>\uff0c\u6bcf\u6b21\u767b\u5165\u81ea\u52d5\u555f\u7528\uff1a </p><pre><code>echo 'source &lt;(kubectl completion bash)' &gt;&gt; ~/.bashrc\n</code></pre><p></p>"},{"location":"lab14_namespace_rolling/#2","title":"\u6b65\u9a5f 2\uff1a\u6e05\u7406\u6240\u6709\u8cc7\u6e90","text":"<p>\u4f7f\u7528 <code>kubectl delete all --all</code> \u522a\u9664\u76ee\u524d Namespace \u4e2d\u7684\u6240\u6709\u8cc7\u6e90\uff1a</p> \u522a\u9664\u6240\u6709\u8cc7\u6e90<pre><code>kubectl delete all --all\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod \"test4\" deleted\npod \"test5-8464657978-5jgj6\" deleted\nservice \"kubernetes\" deleted\ndeployment.apps \"test5\" deleted\ndeployment.apps \"test6\" deleted\nreplicaset.apps \"test5-8464657978\" deleted\nhorizontalpodautoscaler.autoscaling \"test5\" deleted\n</code></pre> <p>all \u5305\u542b\u54ea\u4e9b\u8cc7\u6e90\uff1f</p> <p><code>kubectl delete all --all</code> \u6703\u522a\u9664\u4ee5\u4e0b\u8cc7\u6e90\u985e\u578b\uff1a</p> <ul> <li>Pod</li> <li>Service</li> <li>Deployment</li> <li>ReplicaSet</li> <li>StatefulSet</li> <li>DaemonSet</li> <li>Job</li> <li>CronJob</li> </ul> <p>\u4e0d\u5305\u542b\uff1aConfigMap\u3001Secret\u3001PV\u3001PVC\u3001Namespace \u7b49\u3002</p>"},{"location":"lab14_namespace_rolling/#3-namespace","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b\u73fe\u6709 Namespace","text":"\u67e5\u770b\u6240\u6709 Namespace<pre><code>kubectl get namespaces\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME              STATUS   AGE\ndefault           Active   19h\nkube-node-lease   Active   19h\nkube-public       Active   19h\nkube-system       Active   19h\n</code></pre> Namespace \u7528\u9014 default \u9810\u8a2d\u547d\u540d\u7a7a\u9593\uff0c\u672a\u6307\u5b9a\u6642\u4f7f\u7528 kube-system Kubernetes \u7cfb\u7d71\u5143\u4ef6\uff08CoreDNS\u3001CNI \u7b49\uff09 kube-public \u516c\u958b\u8cc7\u6e90\uff0c\u6240\u6709\u4f7f\u7528\u8005\u53ef\u8b80\u53d6 kube-node-lease \u7bc0\u9ede\u5fc3\u8df3\u8cc7\u8a0a"},{"location":"lab14_namespace_rolling/#4-namespace","title":"\u6b65\u9a5f 4\uff1a\u5efa\u7acb\u81ea\u8a02 Namespace","text":"\u5efa\u7acb Namespace<pre><code>kubectl create namespace ns1\nkubectl create namespace ns2\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>namespace/ns1 created\nnamespace/ns2 created\n</code></pre> <p>\u9a57\u8b49\u5efa\u7acb\u7d50\u679c\uff1a</p> \u67e5\u770b Namespace<pre><code>kubectl get namespaces\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME              STATUS   AGE\ndefault           Active   19h\nkube-node-lease   Active   19h\nkube-public       Active   19h\nkube-system       Active   19h\nns1               Active   12s\nns2               Active   8s\n</code></pre>"},{"location":"lab14_namespace_rolling/#5-namespace-deployment","title":"\u6b65\u9a5f 5\uff1a\u5728\u4e0d\u540c Namespace \u5efa\u7acb Deployment","text":"<p>\u4f7f\u7528 <code>--namespace=</code> \u53c3\u6578\u6307\u5b9a Namespace\uff1a</p> \u5728 ns1 \u5efa\u7acb Deployment<pre><code>kubectl create deployment test1 --image=docker1.training.lab:5000/nginx --namespace=ns1\n</code></pre> \u5728 ns2 \u5efa\u7acb Deployment<pre><code>kubectl create deployment test2 --image=docker1.training.lab:5000/nginx --namespace=ns2\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\ndeployment.apps/test2 created\n</code></pre>"},{"location":"lab14_namespace_rolling/#6-namespace","title":"\u6b65\u9a5f 6\uff1a\u67e5\u8a62\u4e0d\u540c Namespace \u7684\u8cc7\u6e90","text":"<p>\u67e5\u8a62\u9810\u8a2d Namespace\uff08\u6703\u627e\u4e0d\u5230\u8cc7\u6e90\uff09\uff1a</p> \u67e5\u8a62 default Namespace<pre><code>kubectl get deployments.apps\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>No resources found in default namespace.\n</code></pre> <p>\u67e5\u8a62\u6240\u6709 Namespace\uff1a</p> \u67e5\u8a62\u6240\u6709 Namespace\uff08\u5b8c\u6574\u53c3\u6578\uff09<pre><code>kubectl get deployments.apps --all-namespaces\n</code></pre> \u67e5\u8a62\u6240\u6709 Namespace\uff08\u7c21\u5beb\uff09<pre><code>kubectl get deployments.apps -A\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAMESPACE     NAME                READY   UP-TO-DATE   AVAILABLE   AGE\nkube-system   antrea-controller   1/1     1            1           19h\nkube-system   coredns             2/2     2            2           19h\nns1           test1               1/1     1            1           43s\nns2           test2               1/1     1            1           27s\n</code></pre> <p>\u67e5\u8a62\u7279\u5b9a Namespace\uff1a</p> \u67e5\u8a62 ns1 \u7684 Deployment<pre><code>kubectl get deployments.apps --namespace=ns1\n</code></pre> \u67e5\u8a62 ns2 \u7684 Deployment\uff08\u7c21\u5beb\uff09<pre><code>kubectl get deployments.apps -n ns2\n</code></pre> <p>\u5e38\u898b\u932f\u8aa4</p> <p>\u932f\u8aa4\u5beb\u6cd5\uff1a<code>--namespaces=ns1</code>\uff08\u591a\u4e86 s\uff09</p> <p>\u6b63\u78ba\u5beb\u6cd5\uff1a<code>--namespace=ns1</code> \u6216 <code>-n ns1</code></p>"},{"location":"lab14_namespace_rolling/#7-namespace","title":"\u6b65\u9a5f 7\uff1a\u522a\u9664 Namespace","text":"<p>\u522a\u9664 Namespace \u6703**\u540c\u6642\u522a\u9664\u8a72 Namespace \u4e2d\u7684\u6240\u6709\u8cc7\u6e90**\uff1a</p> \u522a\u9664 Namespace<pre><code>kubectl delete namespace ns1\nkubectl delete namespace ns2\n</code></pre> <p>\u522a\u9664\u6642\u9593</p> <p>Namespace \u522a\u9664\u53ef\u80fd\u9700\u8981\u4e00\u6bb5\u6642\u9593\uff0c\u72c0\u614b\u6703\u8b8a\u6210 <code>Terminating</code>\uff1a </p><pre><code>NAME   STATUS        AGE\nns1    Terminating   3m5s\nns2    Terminating   3m1s\n</code></pre> \u7b49\u5f85\u522a\u9664\u5b8c\u6210\u5373\u53ef\u3002<p></p> <p>\u7cfb\u7d71 Namespace \u7121\u6cd5\u522a\u9664</p> <p><code>default</code>\u3001<code>kube-public</code>\u3001<code>kube-system</code> \u70ba\u7cfb\u7d71\u4fdd\u8b77\u7684 Namespace\uff0c\u7121\u6cd5\u88ab\u522a\u9664\u3002</p>"},{"location":"lab14_namespace_rolling/#lab-rolling-update","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aRolling Update \u6efe\u52d5\u66f4\u65b0","text":""},{"location":"lab14_namespace_rolling/#1-dry-run-yaml","title":"\u6b65\u9a5f 1\uff1a\u4f7f\u7528 dry-run \u7522\u751f YAML","text":"<p>\u4f7f\u7528 <code>--dry-run=client -o yaml</code> \u53ef\u4ee5\u7522\u751f YAML \u6a94\u6848\u800c\u4e0d\u5be6\u969b\u5efa\u7acb\u8cc7\u6e90\uff1a</p> \u7522\u751f nginx 1.7.1 \u7684 Deployment YAML<pre><code>kubectl create deployment test1 --image=docker1.training.lab:5000/nginx:1.7.1 --replicas=3 --dry-run=client -o yaml &gt; test1-1.7.1.yaml\n</code></pre> <p>\u67e5\u770b\u7522\u751f\u7684 YAML\uff1a</p> \u67e5\u770b YAML \u5167\u5bb9<pre><code>cat test1-1.7.1.yaml\n</code></pre> <p>YAML \u5167\u5bb9\uff1a</p> test1-1.7.1.yaml<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: test1\n  name: test1\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: test1\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: test1\n    spec:\n      containers:\n      - image: docker1.training.lab:5000/nginx:1.7.1\n        name: nginx\n        resources: {}\nstatus: {}\n</code></pre> <p>dry-run \u7684\u7528\u9014</p> <ul> <li>\u7522\u751f YAML \u6a21\u677f\uff1a\u5feb\u901f\u7522\u751f\u6a19\u6e96\u683c\u5f0f\u7684 YAML</li> <li>\u7248\u672c\u7ba1\u7406\uff1a\u5c07 YAML \u5b58\u5165 Git \u9032\u884c\u7248\u672c\u63a7\u5236</li> <li>\u6e2c\u8a66\u6307\u4ee4\uff1a\u9a57\u8b49\u6307\u4ee4\u8a9e\u6cd5\u6b63\u78ba\u4f46\u4e0d\u5be6\u969b\u57f7\u884c</li> </ul>"},{"location":"lab14_namespace_rolling/#2-yaml-deployment","title":"\u6b65\u9a5f 2\uff1a\u5957\u7528 YAML \u5efa\u7acb Deployment","text":"\u5957\u7528 YAML<pre><code>kubectl apply -f test1-1.7.1.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 created\n</code></pre>"},{"location":"lab14_namespace_rolling/#3-deployment","title":"\u6b65\u9a5f 3\uff1a\u76e3\u63a7 Deployment \u72c0\u614b","text":"<p>\u4f7f\u7528 while \u8ff4\u5708\u6301\u7e8c\u76e3\u63a7\u6620\u50cf\u6a94\u7248\u672c\uff1a</p> \u76e3\u63a7 Pod \u6620\u50cf\u6a94\u7248\u672c<pre><code>while true; do \n  for i in $(kubectl get pods | tail -n +2 | awk '{ print $1 }'); do \n    kubectl get pod ${i} -o yaml | grep \"\\- image: .*nginx\"\n  done\n  echo\n  kubectl get deployments -o wide\n  echo\n  sleep 1\ndone\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>  - image: docker1.training.lab:5000/nginx:1.7.1\n  - image: docker1.training.lab:5000/nginx:1.7.1\n  - image: docker1.training.lab:5000/nginx:1.7.1\n\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                                  SELECTOR\ntest1   3/3     3            3           3m45s   nginx        docker1.training.lab:5000/nginx:1.7.1   app=test1\n</code></pre> <p>\u6309 <code>Ctrl+C</code> \u505c\u6b62\u76e3\u63a7\u3002</p>"},{"location":"lab14_namespace_rolling/#4-yaml","title":"\u6b65\u9a5f 4\uff1a\u7522\u751f\u65b0\u7248\u672c YAML","text":"<p>\u7522\u751f nginx 1.9.1 \u7248\u672c\u7684 YAML\uff1a</p> \u7522\u751f nginx 1.9.1 \u7684 YAML<pre><code>kubectl create deployment test1 --image=docker1.training.lab:5000/nginx:1.9.1 --replicas=3 --dry-run=client -o yaml &gt; test1-1.9.1.yaml\n</code></pre>"},{"location":"lab14_namespace_rolling/#5-rolling-update","title":"\u6b65\u9a5f 5\uff1a\u57f7\u884c Rolling Update","text":"<p>\u4f7f\u7528 <code>kubectl apply -f</code> \u5957\u7528\u65b0\u7248\u672c YAML\uff0c\u89f8\u767c\u6efe\u52d5\u66f4\u65b0\uff1a</p> \u5957\u7528\u65b0\u7248\u672c\u9032\u884c\u6efe\u52d5\u66f4\u65b0<pre><code>kubectl apply -f test1-1.9.1.yaml\n</code></pre> <p>apply vs create</p> <ul> <li><code>kubectl create</code>\uff1a\u5efa\u7acb\u65b0\u8cc7\u6e90\uff0c\u5982\u679c\u5df2\u5b58\u5728\u6703\u5831\u932f</li> <li><code>kubectl apply</code>\uff1a\u5efa\u7acb\u6216\u66f4\u65b0\u8cc7\u6e90\uff0c\u5982\u679c\u5df2\u5b58\u5728\u6703\u9032\u884c\u66f4\u65b0</li> </ul>"},{"location":"lab14_namespace_rolling/#6-rollout","title":"\u6b65\u9a5f 6\uff1a\u67e5\u770b Rollout \u6b77\u53f2\u7d00\u9304","text":"\u67e5\u770b\u90e8\u7f72\u6b77\u53f2<pre><code>kubectl rollout history deployment test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1\nREVISION  CHANGE-CAUSE\n1         &lt;none&gt;\n2         &lt;none&gt;\n</code></pre> \u6b04\u4f4d \u8aaa\u660e REVISION \u7248\u672c\u865f\uff0c\u6bcf\u6b21\u66f4\u65b0\u905e\u589e CHANGE-CAUSE \u8b8a\u66f4\u539f\u56e0\uff08\u53ef\u7528 <code>--record</code> \u8a18\u9304\uff09"},{"location":"lab14_namespace_rolling/#7","title":"\u6b65\u9a5f 7\uff1a\u56de\u6efe\u5230\u5148\u524d\u7248\u672c","text":"\u56de\u6efe Deployment<pre><code>kubectl rollout undo deployment test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1 rolled back\n</code></pre> <p>\u67e5\u770b\u56de\u6efe\u5f8c\u7684\u6b77\u53f2\uff1a</p> \u67e5\u770b\u56de\u6efe\u5f8c\u7684\u6b77\u53f2<pre><code>kubectl rollout history deployment test1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/test1\nREVISION  CHANGE-CAUSE\n2         &lt;none&gt;\n3         &lt;none&gt;\n</code></pre> <p>\u7248\u672c\u865f\u8aaa\u660e</p> <p>\u56de\u6efe\u5f8c\uff0cREVISION \u4e0d\u6703\u56de\u5230 1\uff0c\u800c\u662f\u7522\u751f\u65b0\u7684\u7248\u672c\u865f 3\u3002\u9019\u662f\u56e0\u70ba\u56de\u6efe\u64cd\u4f5c\u672c\u8eab\u4e5f\u7b97\u662f\u4e00\u6b21\u90e8\u7f72\u3002</p>"},{"location":"lab14_namespace_rolling/#8-url-yaml","title":"\u6b65\u9a5f 8\uff1a\u5f9e URL \u5957\u7528\u8207\u522a\u9664 YAML","text":"<p>\u53ef\u4ee5\u76f4\u63a5\u5f9e URL \u5957\u7528 YAML \u6a94\u6848\uff1a</p> \u5f9e URL \u5957\u7528 YAML<pre><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/controllers/nginx-deployment.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps/nginx-deployment created\n</code></pre> <p>\u67e5\u770b\u90e8\u7f72\u7d50\u679c\uff1a</p> \u67e5\u770b Deployment<pre><code>kubectl get deployments.apps\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   3/3     3            3           77s\ntest1              3/3     3            3           9m18s\n\nNAME                                READY   STATUS    RESTARTS   AGE\nnginx-deployment-647677fc66-2m6ww   1/1     Running   0          82s\nnginx-deployment-647677fc66-4zmqw   1/1     Running   0          82s\nnginx-deployment-647677fc66-8h9zg   1/1     Running   0          82s\n</code></pre> <p>\u5f9e URL \u522a\u9664\u8cc7\u6e90\uff1a</p> \u5f9e URL \u522a\u9664 YAML \u5b9a\u7fa9\u7684\u8cc7\u6e90<pre><code>kubectl delete -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/controllers/nginx-deployment.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>deployment.apps \"nginx-deployment\" deleted\n</code></pre>"},{"location":"lab14_namespace_rolling/#_4","title":"\u5e38\u7528\u6307\u4ee4\u5c0d\u7167\u8868","text":""},{"location":"lab14_namespace_rolling/#namespace_1","title":"Namespace \u64cd\u4f5c","text":"\u64cd\u4f5c \u6307\u4ee4 \u7bc4\u4f8b \u5efa\u7acb Namespace <code>kubectl create namespace</code> <code>kubectl create namespace ns1</code> \u67e5\u770b Namespace <code>kubectl get namespaces</code> <code>kubectl get ns</code> \u522a\u9664 Namespace <code>kubectl delete namespace</code> <code>kubectl delete namespace ns1</code> \u6307\u5b9a Namespace <code>--namespace=</code> \u6216 <code>-n</code> <code>kubectl get pods -n ns1</code> \u67e5\u770b\u6240\u6709 Namespace <code>--all-namespaces</code> \u6216 <code>-A</code> <code>kubectl get pods -A</code>"},{"location":"lab14_namespace_rolling/#rolling-update_1","title":"Rolling Update \u64cd\u4f5c","text":"\u64cd\u4f5c \u6307\u4ee4 \u7bc4\u4f8b \u7522\u751f YAML <code>--dry-run=client -o yaml</code> <code>kubectl create deploy test --image=nginx --dry-run=client -o yaml</code> \u5957\u7528 YAML <code>kubectl apply -f</code> <code>kubectl apply -f deployment.yaml</code> \u67e5\u770b\u6b77\u53f2 <code>kubectl rollout history</code> <code>kubectl rollout history deployment test</code> \u56de\u6efe\u7248\u672c <code>kubectl rollout undo</code> <code>kubectl rollout undo deployment test</code> \u56de\u6efe\u5230\u6307\u5b9a\u7248\u672c <code>--to-revision</code> <code>kubectl rollout undo deployment test --to-revision=1</code> \u67e5\u770b\u72c0\u614b <code>kubectl rollout status</code> <code>kubectl rollout status deployment test</code>"},{"location":"lab14_namespace_rolling/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aNamespace \u522a\u9664\u4e00\u76f4\u5361\u5728 Terminating \u72c0\u614b\uff1f <p>\u539f\u56e0\uff1aNamespace \u4e2d\u53ef\u80fd\u6709\u7121\u6cd5\u6b63\u5e38\u522a\u9664\u7684\u8cc7\u6e90\u3002</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u67e5\u770b\u5361\u4f4f\u7684\u8cc7\u6e90\nkubectl get all -n &lt;namespace&gt;\n\n# \u5f37\u5236\u522a\u9664\nkubectl delete namespace &lt;namespace&gt; --force --grace-period=0\n</code></pre><p></p> Q2\uff1a\u5982\u4f55\u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 <code>--to-revision</code> \u53c3\u6578\uff1a</p> <pre><code># \u5148\u67e5\u770b\u7248\u672c\u6b77\u53f2\nkubectl rollout history deployment test1\n\n# \u56de\u6efe\u5230\u6307\u5b9a\u7248\u672c\nkubectl rollout undo deployment test1 --to-revision=1\n</code></pre> Q3\uff1a--dry-run=client \u548c --dry-run=server \u7684\u5dee\u5225\uff1f <p>\u89e3\u7b54\uff1a</p> <ul> <li><code>--dry-run=client</code>\uff1a\u5728\u5ba2\u6236\u7aef\u57f7\u884c\uff0c\u4e0d\u8207 API Server \u901a\u8a0a</li> <li><code>--dry-run=server</code>\uff1a\u9001\u5230 API Server \u9a57\u8b49\uff0c\u4f46\u4e0d\u5be6\u969b\u5efa\u7acb\u8cc7\u6e90</li> </ul> <p>\u4e00\u822c\u7522\u751f YAML \u4f7f\u7528 <code>--dry-run=client</code> \u5373\u53ef\u3002</p>"},{"location":"lab14_namespace_rolling/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Namespace \u7ba1\u7406\uff1a\u4f7f\u7528 <code>kubectl create/delete namespace</code> \u5efa\u7acb\u8207\u522a\u9664\u547d\u540d\u7a7a\u9593</li> <li>\u2705 \u8de8 Namespace \u67e5\u8a62\uff1a\u4f7f\u7528 <code>--namespace=</code>\u3001<code>-n</code>\u3001<code>-A</code> \u53c3\u6578</li> <li>\u2705 YAML \u7522\u751f\uff1a\u4f7f\u7528 <code>--dry-run=client -o yaml</code> \u7522\u751f YAML \u6a21\u677f</li> <li>\u2705 Rolling Update\uff1a\u4f7f\u7528 <code>kubectl apply -f</code> \u9032\u884c\u6efe\u52d5\u66f4\u65b0</li> <li>\u2705 \u6b77\u53f2\u7d00\u9304\uff1a\u4f7f\u7528 <code>kubectl rollout history</code> \u67e5\u770b\u90e8\u7f72\u6b77\u53f2</li> <li>\u2705 \u7248\u672c\u56de\u6efe\uff1a\u4f7f\u7528 <code>kubectl rollout undo</code> \u56de\u6efe\u5230\u5148\u524d\u7248\u672c</li> </ul>"},{"location":"lab14_namespace_rolling/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes Namespaces</li> <li>Deployment \u6efe\u52d5\u66f4\u65b0</li> <li>Rollback \u90e8\u7f72\u56de\u6efe</li> </ul>"},{"location":"lab15_service/","title":"LAB 15 service","text":""},{"location":"lab15_service/#lab-15-kubernetes-service","title":"LAB 15 Kubernetes Service","text":""},{"location":"lab15_service/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Kubernetes Service \u7684\u4e09\u7a2e\u985e\u578b</li> <li> \u5efa\u7acb ClusterIP \u985e\u578b\u7684 Service</li> <li> \u5efa\u7acb NodePort \u985e\u578b\u7684 Service</li> <li> \u5efa\u7acb LoadBalancer \u985e\u578b\u7684 Service</li> <li> \u4f7f\u7528 curl \u9a57\u8b49 Service \u7684\u8ca0\u8f09\u5747\u8861\u529f\u80fd</li> </ul>"},{"location":"lab15_service/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 14 Namespace \u8207 Rolling Update</li> <li>\u719f\u6089 Pod\u3001Deployment \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab15_service/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab15_service/#service","title":"Service \u662f\u4ec0\u9ebc\uff1f","text":"<p>Service\uff08\u670d\u52d9\uff09 \u662f Kubernetes \u4e2d\u7528\u4f86**\u66b4\u9732\u61c9\u7528\u7a0b\u5f0f\u7684\u7a69\u5b9a\u7db2\u8def\u7aef\u9ede**\u3002\u7531\u65bc Pod \u7684 IP \u662f\u52d5\u614b\u7684\uff0c\u6bcf\u6b21\u91cd\u5efa\u53ef\u80fd\u6703\u6539\u8b8a\uff0cService \u63d0\u4f9b\u4e86\u4e00\u500b\u56fa\u5b9a\u7684 IP \u548c DNS \u540d\u7a31\uff0c\u8b93\u5176\u4ed6\u61c9\u7528\u7a0b\u5f0f\u53ef\u4ee5\u7a69\u5b9a\u5730\u5b58\u53d6 Pod\u3002</p> <pre><code>graph LR\n    Client[\u5ba2\u6236\u7aef] --&gt; Service[Service&lt;br/&gt;\u56fa\u5b9a IP]\n    Service --&gt; Pod1[Pod 1&lt;br/&gt;\u52d5\u614b IP]\n    Service --&gt; Pod2[Pod 2&lt;br/&gt;\u52d5\u614b IP]\n    Service --&gt; Pod3[Pod 3&lt;br/&gt;\u52d5\u614b IP]</code></pre>"},{"location":"lab15_service/#service_1","title":"Service \u985e\u578b\u6bd4\u8f03","text":"\u985e\u578b \u5b58\u53d6\u7bc4\u570d \u4f7f\u7528\u5834\u666f ClusterIP \u53e2\u96c6\u5167\u90e8 \u5167\u90e8\u670d\u52d9\u3001\u5fae\u670d\u52d9\u9593\u901a\u8a0a NodePort \u53e2\u96c6\u5916\u90e8\uff08\u900f\u904e Node IP\uff09 \u958b\u767c\u6e2c\u8a66\u3001\u5c0f\u578b\u90e8\u7f72 LoadBalancer \u53e2\u96c6\u5916\u90e8\uff08\u900f\u904e LB IP\uff09 \u751f\u7522\u74b0\u5883\u3001\u96f2\u7aef\u90e8\u7f72 <pre><code>graph TB\n    subgraph \"ClusterIP (\u53e2\u96c6\u5167\u90e8)\"\n        CI[Service ClusterIP] --&gt; P1[Pod]\n    end\n\n    subgraph \"NodePort (\u7bc0\u9ede Port)\"\n        NP[Node:30000-32767] --&gt; NPSVC[Service]\n        NPSVC --&gt; P2[Pod]\n    end\n\n    subgraph \"LoadBalancer (\u8ca0\u8f09\u5747\u8861\u5668)\"\n        LB[External LB IP] --&gt; LBSVC[Service]\n        LBSVC --&gt; P3[Pod]\n    end</code></pre>"},{"location":"lab15_service/#port","title":"Port \u5c0d\u61c9\u95dc\u4fc2","text":"<p>Service \u6d89\u53ca\u4e09\u7a2e Port\uff1a</p> Port \u540d\u7a31 \u8aaa\u660e \u7bc4\u4f8b port Service \u7684 Port\uff08ClusterIP \u4f7f\u7528\uff09 8081 targetPort Pod/Container \u7684 Port 80 nodePort Node \u5c0d\u5916\u958b\u653e\u7684 Port\uff0830000-32767\uff09 30008 <pre><code>graph LR\n    External[\u5916\u90e8\u8acb\u6c42] --&gt;|nodePort: 30008| Node[Node IP]\n    Node --&gt;|port: 8082| Service[Service ClusterIP]\n    Service --&gt;|targetPort: 80| Pod[Pod]</code></pre>"},{"location":"lab15_service/#lab-clusterip-service","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aClusterIP Service","text":""},{"location":"lab15_service/#clusterip","title":"ClusterIP \u6982\u8ff0","text":"<p>ClusterIP \u662f Service \u7684\u9810\u8a2d\u985e\u578b\uff0c\u53ea\u80fd\u5f9e\u53e2\u96c6**\u5167\u90e8**\u5b58\u53d6\u3002</p> <pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"service-clusterip-2 namespace\"\n            SVC[svc-2-httpd&lt;br/&gt;ClusterIP: 172.30.24.63:8081]\n            SVC --&gt; Pod1[httpd-2&lt;br/&gt;10.128.1.14:80]\n            SVC --&gt; Pod2[httpd-2&lt;br/&gt;10.128.2.9:80]\n        end\n    end\n    External[\u5916\u90e8\u7db2\u8def] -.-&gt;|\u7121\u6cd5\u5b58\u53d6| SVC</code></pre>"},{"location":"lab15_service/#1-clusterip-yaml","title":"\u6b65\u9a5f 1\uff1a\u4e0b\u8f09 ClusterIP YAML","text":"\u4e0b\u8f09 ClusterIP \u7bc4\u4f8b<pre><code>wget http://10.0.1.249/k8s/yaml/service-clusterIP.yaml\n</code></pre> <p>\u67e5\u770b YAML \u5167\u5bb9\uff1a</p> \u67e5\u770b YAML<pre><code>cat service-clusterIP.yaml\n</code></pre> <p>YAML \u5167\u5bb9\uff1a</p> service-clusterIP.yaml<pre><code>---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: service-clusterip-2\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd\n  labels:\n    app: svc-2-httpd\n  namespace: service-clusterip-2\nspec:\n  type: ClusterIP\n  ports:\n  - port: 8081        # Service Port\n    targetPort: 80    # Pod Port\n  selector:\n    app: httpd-2      # \u9078\u64c7\u5e36\u6709\u6b64 Label \u7684 Pod\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: httpd-2\n  labels:\n    app: httpd-2\n  namespace: service-clusterip-2\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: httpd-2\n  template:\n    metadata:\n      labels:\n        app: httpd-2\n    spec:\n      containers:\n      - image: docker1.training.lab:5000/httpd\n        name: httpd\n        ports:\n        - containerPort: 80\n</code></pre> <p>YAML \u7d50\u69cb\u8aaa\u660e</p> <p>\u6b64 YAML \u5305\u542b\u4e09\u500b\u8cc7\u6e90\uff1a</p> <ol> <li>Namespace\uff1a\u5efa\u7acb <code>service-clusterip-2</code> \u547d\u540d\u7a7a\u9593</li> <li>Service\uff1a\u5efa\u7acb ClusterIP \u985e\u578b\u7684 Service</li> <li>Deployment\uff1a\u5efa\u7acb 2 \u500b httpd Pod</li> </ol>"},{"location":"lab15_service/#2-yaml","title":"\u6b65\u9a5f 2\uff1a\u5957\u7528 YAML","text":"\u5957\u7528 YAML<pre><code>kubectl apply -f service-clusterIP.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>namespace/service-clusterip-2 created\nservice/svc-2-httpd created\ndeployment.apps/httpd-2 created\n</code></pre>"},{"location":"lab15_service/#3-service","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b Service","text":"\u67e5\u770b\u6240\u6709 Service<pre><code>kubectl get service -A\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAMESPACE             NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE\ndefault               kubernetes    ClusterIP   172.30.0.1       &lt;none&gt;        443/TCP                  13m\nkube-system           antrea        ClusterIP   172.30.116.178   &lt;none&gt;        443/TCP                  105m\nkube-system           kube-dns      ClusterIP   172.30.0.10      &lt;none&gt;        53/UDP,53/TCP,9153/TCP   106m\nservice-clusterip-2   svc-2-httpd   ClusterIP   172.30.24.63     &lt;none&gt;        8081/TCP                 95s\n</code></pre>"},{"location":"lab15_service/#4-pod","title":"\u6b65\u9a5f 4\uff1a\u67e5\u770b Pod \u4e26\u4fee\u6539\u5167\u5bb9","text":"<p>\u67e5\u770b Pod\uff1a</p> \u67e5\u770b Pod<pre><code>kubectl get pods --namespace=service-clusterip-2 -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                       READY   STATUS    RESTARTS   AGE     IP            NODE\nhttpd-2-68b85d46c7-t4v87   1/1     Running   0          5m16s   10.128.1.14   k8s-node1.training.lab\nhttpd-2-68b85d46c7-trhk5   1/1     Running   0          5m16s   10.128.2.9    k8s-node2.training.lab\n</code></pre> <p>\u9032\u5165\u7b2c\u4e00\u500b Pod \u4fee\u6539\u9996\u9801\uff1a</p> \u9032\u5165 Pod 1 \u4fee\u6539\u5167\u5bb9<pre><code>kubectl exec httpd-2-68b85d46c7-t4v87 --namespace=service-clusterip-2 -it -- bash\n</code></pre> \u5728\u5bb9\u5668\u5167\u57f7\u884c<pre><code>cd htdocs/\necho AAA &gt; index.html\nexit\n</code></pre> <p>\u9032\u5165\u7b2c\u4e8c\u500b Pod \u4fee\u6539\u9996\u9801\uff1a</p> \u9032\u5165 Pod 2 \u4fee\u6539\u5167\u5bb9<pre><code>kubectl exec httpd-2-68b85d46c7-trhk5 --namespace=service-clusterip-2 -it -- bash\n</code></pre> \u5728\u5bb9\u5668\u5167\u57f7\u884c<pre><code>cd htdocs/\necho BBB &gt; index.html\nexit\n</code></pre>"},{"location":"lab15_service/#5-clusterip","title":"\u6b65\u9a5f 5\uff1a\u6e2c\u8a66 ClusterIP \u8ca0\u8f09\u5747\u8861","text":"<p>\u76f4\u63a5\u5b58\u53d6 Pod IP\uff1a</p> \u76f4\u63a5\u5b58\u53d6 Pod IP<pre><code>curl 10.128.1.14\ncurl 10.128.2.9\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>AAA\nBBB\n</code></pre> <p>\u900f\u904e Service ClusterIP \u5b58\u53d6\uff08\u6703\u81ea\u52d5\u8ca0\u8f09\u5747\u8861\uff09\uff1a</p> \u5b58\u53d6 Service ClusterIP<pre><code>curl 172.30.24.63:8081\ncurl 172.30.24.63:8081\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u6bcf\u6b21\u53ef\u80fd\u4e0d\u540c\uff09\uff1a</p> <pre><code>BBB\nAAA\n</code></pre> <p>\u8ca0\u8f09\u5747\u8861\u9a57\u8b49</p> <p>\u591a\u6b21\u5b58\u53d6 Service IP\uff0c\u6703\u767c\u73fe\u56de\u61c9\u5167\u5bb9\u5728 AAA \u548c BBB \u4e4b\u9593\u5207\u63db\uff0c\u9019\u8868\u793a Service \u6b63\u5728\u9032\u884c\u8ca0\u8f09\u5747\u8861\u3002</p>"},{"location":"lab15_service/#lab-nodeport-service","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aNodePort Service","text":""},{"location":"lab15_service/#nodeport","title":"NodePort \u6982\u8ff0","text":"<p>NodePort \u6703\u5728\u6bcf\u500b Node \u4e0a\u958b\u653e\u4e00\u500b\u56fa\u5b9a\u7684 Port\uff0830000-32767\uff09\uff0c\u5141\u8a31\u5f9e\u53e2\u96c6**\u5916\u90e8**\u5b58\u53d6\u3002</p> <pre><code>graph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"k8s-node1\"\n            NP1[Port 30008]\n        end\n        subgraph \"k8s-node2\"\n            NP2[Port 30008]\n        end\n        subgraph \"k8s-master1\"\n            NP3[Port 30008]\n        end\n        SVC[Service NodePort&lt;br/&gt;172.30.21.179:8082]\n        NP1 --&gt; SVC\n        NP2 --&gt; SVC\n        NP3 --&gt; SVC\n        SVC --&gt; Pod1[httpd Pod 1]\n        SVC --&gt; Pod2[httpd Pod 2]\n    end\n    External[\u5916\u90e8\u7db2\u8def] --&gt; NP1\n    External --&gt; NP2\n    External --&gt; NP3</code></pre>"},{"location":"lab15_service/#1-nodeport-yaml","title":"\u6b65\u9a5f 1\uff1a\u4e0b\u8f09 NodePort YAML","text":"\u4e0b\u8f09 NodePort \u7bc4\u4f8b<pre><code>wget http://10.0.1.248/k8s/yaml/service-nodeport.yaml\n</code></pre> <p>\u67e5\u770b YAML \u5167\u5bb9\uff1a</p> \u67e5\u770b YAML<pre><code>cat service-nodeport.yaml\n</code></pre> <p>YAML \u91cd\u9ede\uff1a</p> service-nodeport.yaml\uff08\u6458\u9304\uff09<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd-nodeport\n  namespace: service-nodeport-2\nspec:\n  type: NodePort          # NodePort \u985e\u578b\n  ports:\n  - port: 8082            # Service Port\n    targetPort: 80        # Pod Port\n    nodePort: 30008       # Node \u5c0d\u5916 Port\n  selector:\n    app: httpd-2-nodeport\n</code></pre>"},{"location":"lab15_service/#2-yaml_1","title":"\u6b65\u9a5f 2\uff1a\u5957\u7528 YAML","text":"\u5957\u7528 YAML<pre><code>kubectl apply -f service-nodeport.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>namespace/service-nodeport-2 created\nservice/svc-2-httpd-nodeport created\ndeployment.apps/httpd-2-nodeport created\n</code></pre>"},{"location":"lab15_service/#3-service_1","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b Service","text":"\u67e5\u770b Service<pre><code>kubectl get services -A\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAMESPACE             NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\nservice-clusterip-2   svc-2-httpd            ClusterIP   172.30.24.63     &lt;none&gt;        8081/TCP         9m25s\nservice-nodeport-2    svc-2-httpd-nodeport   NodePort    172.30.21.179    &lt;none&gt;        8082:30008/TCP   72s\n</code></pre> <p>Port \u683c\u5f0f\u8aaa\u660e</p> <p><code>8082:30008/TCP</code> \u8868\u793a\uff1a</p> <ul> <li>8082\uff1aService \u7684 ClusterIP Port</li> <li>30008\uff1aNode \u5c0d\u5916\u7684 NodePort</li> </ul>"},{"location":"lab15_service/#4-nodeport","title":"\u6b65\u9a5f 4\uff1a\u6e2c\u8a66 NodePort \u5b58\u53d6","text":"<p>\u900f\u904e Pod IP \u5b58\u53d6\uff1a</p> \u5b58\u53d6 Pod IP<pre><code>kubectl get pods --namespace=service-nodeport-2 -o wide\ncurl 10.128.1.15\ncurl 10.128.2.10\n</code></pre> <p>\u900f\u904e Service ClusterIP \u5b58\u53d6\uff1a</p> \u5b58\u53d6 Service ClusterIP<pre><code>curl 172.30.21.179:8082\n</code></pre> <p>\u900f\u904e\u4efb\u610f Node \u7684 NodePort \u5b58\u53d6\uff1a</p> \u5b58\u53d6 NodePort<pre><code>curl k8s-node1:30008\ncurl k8s-node2:30008\ncurl k8s-master1:30008\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u4e09\u500b\u90fd\u53ef\u4ee5\u5b58\u53d6\uff09\uff1a</p> <pre><code>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\n</code></pre> <p>NodePort \u7279\u6027</p> <p>NodePort \u6703\u5728**\u6240\u6709 Node**\uff08\u5305\u542b Master \u548c Worker\uff09\u4e0a\u958b\u653e\u76f8\u540c\u7684 Port\uff0c\u7121\u8ad6 Pod \u5be6\u969b\u904b\u884c\u5728\u54ea\u500b Node \u4e0a\u3002</p>"},{"location":"lab15_service/#lab-loadbalancer-service","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aLoadBalancer Service","text":""},{"location":"lab15_service/#loadbalancer","title":"LoadBalancer \u6982\u8ff0","text":"<p>LoadBalancer \u662f\u6700\u9ad8\u7d1a\u7684 Service \u985e\u578b\uff0c\u6703\u5411\u96f2\u7aef\u4f9b\u61c9\u5546\u8acb\u6c42\u4e00\u500b**\u5916\u90e8\u8ca0\u8f09\u5747\u8861\u5668 IP**\u3002</p> <pre><code>graph TB\n    subgraph \"Cloud Provider\"\n        LB[External Load Balancer&lt;br/&gt;\u516c\u958b IP]\n    end\n    subgraph \"Kubernetes Cluster\"\n        SVC[Service LoadBalancer&lt;br/&gt;172.30.227.169:8083]\n        SVC --&gt; Pod1[httpd Pod 1]\n        SVC --&gt; Pod2[httpd Pod 2]\n    end\n    Internet[Internet] --&gt; LB\n    LB --&gt; SVC</code></pre>"},{"location":"lab15_service/#1-loadbalancer-yaml","title":"\u6b65\u9a5f 1\uff1a\u4e0b\u8f09 LoadBalancer YAML","text":"\u4e0b\u8f09 LoadBalancer \u7bc4\u4f8b<pre><code>wget http://192.168.66.248/k8s/yaml/service-loadbalancer.yaml\n</code></pre> <p>\u67e5\u770b YAML \u5167\u5bb9\uff1a</p> \u67e5\u770b YAML<pre><code>cat service-loadbalancer.yaml\n</code></pre> <p>YAML \u91cd\u9ede\uff1a</p> service-loadbalancer.yaml\uff08\u6458\u9304\uff09<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd-lb\n  namespace: service-loadbalancer-1\nspec:\n  type: LoadBalancer      # LoadBalancer \u985e\u578b\n  ports:\n  - port: 8083            # Service Port\n    targetPort: 80        # Pod Port\n  selector:\n    app: httpd-2-lb\n</code></pre>"},{"location":"lab15_service/#2-yaml_2","title":"\u6b65\u9a5f 2\uff1a\u5957\u7528 YAML","text":"\u5957\u7528 YAML<pre><code>kubectl apply -f service-loadbalancer.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>namespace/service-loadbalancer-1 created\nservice/svc-2-httpd-lb created\ndeployment.apps/httpd-2-lb created\n</code></pre>"},{"location":"lab15_service/#3-service_2","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b Service","text":"\u67e5\u770b Service<pre><code>kubectl get services --namespace=service-loadbalancer-1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME             TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\nsvc-2-httpd-lb   LoadBalancer   172.30.227.169   &lt;pending&gt;     8083:32254/TCP   60s\n</code></pre> <p>EXTERNAL-IP \u986f\u793a pending</p> <p>\u5728\u975e\u96f2\u7aef\u74b0\u5883\uff08\u5982\u672c\u5730 VMware\uff09\uff0c\u6c92\u6709\u5916\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u53ef\u7528\uff0c\u6240\u4ee5 EXTERNAL-IP \u6703\u4e00\u76f4\u986f\u793a <code>&lt;pending&gt;</code>\u3002</p> <p>\u5728 AWS\u3001GCP\u3001Azure \u7b49\u96f2\u7aef\u74b0\u5883\u4e2d\uff0c\u6703\u81ea\u52d5\u5206\u914d\u4e00\u500b\u516c\u958b IP\u3002</p>"},{"location":"lab15_service/#4-loadbalancer","title":"\u6b65\u9a5f 4\uff1a\u6e2c\u8a66 LoadBalancer \u5b58\u53d6","text":"\u67e5\u770b Pod<pre><code>kubectl get pods --namespace=service-loadbalancer-1 -o wide\n</code></pre> <p>\u900f\u904e Pod IP \u5b58\u53d6\uff1a</p> \u5b58\u53d6 Pod IP<pre><code>curl 10.128.2.11\ncurl 10.128.1.16\n</code></pre> <p>\u900f\u904e Service ClusterIP \u5b58\u53d6\uff1a</p> \u5b58\u53d6 Service ClusterIP<pre><code>curl 172.30.227.169:8083\n</code></pre> <p>\u900f\u904e NodePort \u5b58\u53d6\uff08LoadBalancer \u81ea\u52d5\u5206\u914d\uff09\uff1a</p> \u5b58\u53d6\u81ea\u52d5\u5206\u914d\u7684 NodePort<pre><code>curl k8s-node1:32254\ncurl k8s-node2:32254\ncurl k8s-master1:32254\n</code></pre> <p>LoadBalancer \u81ea\u52d5\u5206\u914d NodePort</p> <p>LoadBalancer \u985e\u578b\u7684 Service \u6703\u81ea\u52d5\u5206\u914d\u4e00\u500b NodePort\uff08\u6b64\u4f8b\u70ba 32254\uff09\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u900f\u904e Node IP:NodePort \u5b58\u53d6\u3002</p>"},{"location":"lab15_service/#service_2","title":"Service \u985e\u578b\u7e3d\u7d50","text":"\u7279\u6027 ClusterIP NodePort LoadBalancer \u5b58\u53d6\u7bc4\u570d \u53e2\u96c6\u5167\u90e8 \u53e2\u96c6\u5167\u5916 \u53e2\u96c6\u5167\u5916 \u56fa\u5b9a IP ClusterIP ClusterIP + NodePort ClusterIP + NodePort + External IP \u4f7f\u7528\u5834\u666f \u5fae\u670d\u52d9\u5167\u90e8\u901a\u8a0a \u958b\u767c\u6e2c\u8a66 \u751f\u7522\u74b0\u5883 Port \u7bc4\u570d \u4e0d\u9650 30000-32767 \u4e0d\u9650 \u9700\u8981\u96f2\u7aef \u5426 \u5426 \u662f"},{"location":"lab15_service/#_4","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aService \u5982\u4f55\u627e\u5230\u5c0d\u61c9\u7684 Pod\uff1f <p>\u89e3\u7b54\uff1a\u900f\u904e <code>selector</code> \u6a19\u7c64\u9078\u64c7\u5668\u3002Service \u6703\u5c07\u6d41\u91cf\u5c0e\u5411\u6240\u6709\u7b26\u5408 selector \u689d\u4ef6\u7684 Pod\u3002</p> <pre><code>spec:\n  selector:\n    app: httpd-2  # \u9078\u64c7\u5e36\u6709 app=httpd-2 \u6a19\u7c64\u7684 Pod\n</code></pre> Q2\uff1aLoadBalancer \u7684 EXTERNAL-IP \u4e00\u76f4\u662f pending\uff1f <p>\u539f\u56e0\uff1a\u5728\u975e\u96f2\u7aef\u74b0\u5883\u6c92\u6709\u5916\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u3002</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <ul> <li>\u4f7f\u7528 MetalLB \u5728\u672c\u5730\u74b0\u5883\u6a21\u64ec LoadBalancer</li> <li>\u6216\u76f4\u63a5\u4f7f\u7528 NodePort \u985e\u578b</li> </ul> Q3\uff1aNodePort \u7684 Port \u7bc4\u570d\u53ef\u4ee5\u4fee\u6539\u55ce\uff1f <p>\u89e3\u7b54\uff1a\u53ef\u4ee5\uff0c\u4fee\u6539 kube-apiserver \u7684 <code>--service-node-port-range</code> \u53c3\u6578\u3002</p> <p>\u9810\u8a2d\u7bc4\u570d\uff1a30000-32767</p> Q4\uff1aPod \u4e00\u76f4\u8655\u65bc Pending \u72c0\u614b\uff1f <p>\u539f\u56e0\uff1a\u901a\u5e38\u662f\u7bc0\u9ede\u6216 CNI \u672a\u5c31\u7dd2\u3002</p> <p>Debug \u6d41\u7a0b\uff1a</p> <pre><code># 1. \u6aa2\u67e5\u7bc0\u9ede\u72c0\u614b\nkubectl get nodes\n\n# 2. \u6aa2\u67e5 CNI Pod\uff08Antrea\uff09\nkubectl get pods -n kube-system | grep antrea\n\n# 3. \u67e5\u770b Pod \u4e8b\u4ef6\nkubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;\n\n# 4. \u67e5\u770b\u5bb9\u5668\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt; -n kube-system -c &lt;container-name&gt; --tail=50\n</code></pre> <p>\u8a73\u7d30 Debug \u6d41\u7a0b\u8acb\u53c3\u8003 LAB 18 RBAC \u8207 Event/Log\u3002</p>"},{"location":"lab15_service/#_5","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Service \u6982\u5ff5\uff1a\u63d0\u4f9b\u7a69\u5b9a\u7684\u7db2\u8def\u7aef\u9ede\u5b58\u53d6 Pod</li> <li>\u2705 ClusterIP\uff1a\u9810\u8a2d\u985e\u578b\uff0c\u50c5\u53e2\u96c6\u5167\u90e8\u5b58\u53d6</li> <li>\u2705 NodePort\uff1a\u900f\u904e Node IP:Port \u5f9e\u5916\u90e8\u5b58\u53d6\uff0830000-32767\uff09</li> <li>\u2705 LoadBalancer\uff1a\u900f\u904e\u5916\u90e8\u8ca0\u8f09\u5747\u8861\u5668\u5b58\u53d6\uff08\u9700\u96f2\u7aef\u74b0\u5883\uff09</li> <li>\u2705 Port \u5c0d\u61c9\uff1aport\uff08Service\uff09\u2192 targetPort\uff08Pod\uff09\u2192 nodePort\uff08Node\uff09</li> <li>\u2705 \u8ca0\u8f09\u5747\u8861\uff1aService \u81ea\u52d5\u5c07\u6d41\u91cf\u5206\u6563\u5230\u591a\u500b Pod</li> </ul>"},{"location":"lab15_service/#_6","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes Service</li> <li>Service Types</li> <li>MetalLB - LoadBalancer for Bare Metal</li> </ul>"},{"location":"lab15_service/#yaml","title":"YAML \u5be6\u7528\u5de5\u5177","text":"\u5de5\u5177 \u7528\u9014 \u9023\u7d50 YAMLint \u9a57\u8b49 YAML \u8a9e\u6cd5 www.yamllint.com YAML to JSON \u5c07 YAML \u8f49\u63db\u70ba JSON www.convertjson.com YAML to JSON/XML/CSV \u591a\u683c\u5f0f\u8f49\u63db codebeautify.org <p>YAML \u9a57\u8b49\u6280\u5de7</p> <p>\u5728\u5957\u7528 YAML \u6a94\u6848\u4e4b\u524d\uff0c\u5efa\u8b70\u5148\u4f7f\u7528\u7dda\u4e0a\u5de5\u5177\u9a57\u8b49\u8a9e\u6cd5\u662f\u5426\u6b63\u78ba\uff0c\u907f\u514d\u56e0\u7e2e\u6392\u6216\u683c\u5f0f\u932f\u8aa4\u5c0e\u81f4\u90e8\u7f72\u5931\u6557\u3002</p>"},{"location":"lab16_pv_pvc/","title":"LAB 16 PV/PVC","text":""},{"location":"lab16_pv_pvc/#lab-16-persistent-volumepv-persistent-volume-claimpvc","title":"LAB 16 Persistent Volume\uff08PV\uff09\u8207 Persistent Volume Claim\uff08PVC\uff09","text":""},{"location":"lab16_pv_pvc/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 PV \u8207 PVC \u7684\u6982\u5ff5\u8207\u95dc\u4fc2</li> <li> \u4f7f\u7528 hostPath \u5efa\u7acb\u672c\u5730\u5132\u5b58\u7684 PV</li> <li> \u5efa\u7acb PVC \u4e26\u7d81\u5b9a PV</li> <li> \u5728 Pod \u4e2d\u639b\u8f09 PVC</li> <li> \u8a2d\u5b9a NFS Server \u63d0\u4f9b\u7db2\u8def\u5132\u5b58</li> <li> \u4f7f\u7528 NFS \u985e\u578b\u7684 PV \u5be6\u73fe\u8de8\u7bc0\u9ede\u5171\u4eab\u5132\u5b58</li> </ul>"},{"location":"lab16_pv_pvc/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 15 Service</li> <li>\u719f\u6089 Pod\u3001Deployment \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\u3001k8s-node1\u3001k8s-node2\uff09</li> </ul>"},{"location":"lab16_pv_pvc/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab16_pv_pvc/#pvpvc","title":"\u70ba\u4ec0\u9ebc\u9700\u8981 PV/PVC\uff1f","text":"<p>Pod \u7684\u5132\u5b58\u662f**\u81e8\u6642\u6027\u7684**\uff0c\u7576 Pod \u88ab\u522a\u9664\u6216\u91cd\u65b0\u8abf\u5ea6\u6642\uff0c\u5bb9\u5668\u5167\u7684\u8cc7\u6599\u4e5f\u6703\u6d88\u5931\u3002PV/PVC \u63d0\u4f9b\u4e86**\u6301\u4e45\u5316\u5132\u5b58**\u7684\u89e3\u6c7a\u65b9\u6848\u3002</p> <pre><code>graph TB\n    subgraph \"\u6c92\u6709 PV/PVC\"\n        Pod1[Pod] --&gt; Data1[\u5bb9\u5668\u5167\u8cc7\u6599]\n        Data1 -.-&gt;|Pod \u522a\u9664| Lost[\u8cc7\u6599\u907a\u5931]\n    end\n\n    subgraph \"\u4f7f\u7528 PV/PVC\"\n        Pod2[Pod] --&gt; PVC[PVC]\n        PVC --&gt; PV[PV]\n        PV --&gt; Storage[(\u5132\u5b58\u7a7a\u9593)]\n        Pod2 -.-&gt;|Pod \u522a\u9664| Storage\n    end</code></pre>"},{"location":"lab16_pv_pvc/#pv-pvc","title":"PV \u8207 PVC \u7684\u95dc\u4fc2","text":"\u6982\u5ff5 \u8aaa\u660e \u8ab0\u7ba1\u7406 PV\uff08Persistent Volume\uff09 \u53e2\u96c6\u4e2d\u7684\u5132\u5b58\u8cc7\u6e90\uff0c\u985e\u4f3c Node \u7ba1\u7406\u54e1 PVC\uff08Persistent Volume Claim\uff09 \u4f7f\u7528\u8005\u5c0d\u5132\u5b58\u7684\u8acb\u6c42\uff0c\u985e\u4f3c Pod \u958b\u767c\u8005 <pre><code>graph LR\n    Admin[\u7ba1\u7406\u54e1] --&gt;|\u5efa\u7acb| PV[PV&lt;br/&gt;10Gi Storage]\n    Dev[\u958b\u767c\u8005] --&gt;|\u5efa\u7acb| PVC[PVC&lt;br/&gt;\u8acb\u6c42 3Gi]\n    PVC --&gt;|\u81ea\u52d5\u7d81\u5b9a| PV\n    Pod[Pod] --&gt;|\u639b\u8f09| PVC</code></pre>"},{"location":"lab16_pv_pvc/#pv","title":"PV \u7684\u751f\u547d\u9031\u671f","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Available: \u5efa\u7acb PV\n    Available --&gt; Bound: PVC \u7d81\u5b9a\n    Bound --&gt; Released: PVC \u522a\u9664\n    Released --&gt; Available: \u56de\u6536\n    Released --&gt; [*]: \u522a\u9664</code></pre> \u72c0\u614b \u8aaa\u660e Available \u53ef\u7528\uff0c\u5c1a\u672a\u88ab PVC \u7d81\u5b9a Bound \u5df2\u7d81\u5b9a\uff0c\u88ab\u67d0\u500b PVC \u4f7f\u7528\u4e2d Released PVC \u5df2\u522a\u9664\uff0c\u4f46\u8cc7\u6e90\u5c1a\u672a\u56de\u6536 Failed \u81ea\u52d5\u56de\u6536\u5931\u6557"},{"location":"lab16_pv_pvc/#_4","title":"\u5132\u5b58\u985e\u578b\u6bd4\u8f03","text":"\u985e\u578b \u8aaa\u660e \u512a\u9ede \u7f3a\u9ede hostPath \u7bc0\u9ede\u672c\u5730\u8def\u5f91 \u7c21\u55ae\u3001\u5feb\u901f Pod \u53ea\u80fd\u5728\u7279\u5b9a\u7bc0\u9ede\u904b\u884c NFS \u7db2\u8def\u6a94\u6848\u7cfb\u7d71 \u8de8\u7bc0\u9ede\u5171\u4eab \u9700\u8981 NFS Server CSI \u5bb9\u5668\u5132\u5b58\u4ecb\u9762 \u652f\u63f4\u5404\u7a2e\u96f2\u7aef\u5132\u5b58 \u8a2d\u5b9a\u8f03\u8907\u96dc"},{"location":"lab16_pv_pvc/#lab-hostpath","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1ahostPath \u672c\u5730\u5132\u5b58","text":""},{"location":"lab16_pv_pvc/#_5","title":"\u67b6\u69cb\u8aaa\u660e","text":"<p>\u4f7f\u7528 hostPath \u6642\uff0cPod \u6703\u4f7f\u7528\u7bc0\u9ede\u4e0a\u7684\u672c\u5730\u76ee\u9304\u4f5c\u70ba\u5132\u5b58\u7a7a\u9593\u3002</p> <pre><code>graph TB\n    subgraph node1[\"k8s-node1\"]\n        Pod1[\"pv1-pod-local\"]\n        Path1[\"/mnt/data\"]\n        Pod1 --&gt; Path1\n    end\n\n    subgraph node2[\"k8s-node2\"]\n        Path2[\"/mnt/data\"]\n    end</code></pre> \u7bc0\u9ede \u76ee\u9304 \u6a94\u6848\u5167\u5bb9 k8s-node1 /mnt/data/index.html node1...AAA k8s-node2 /mnt/data/index.html node2...BBB <p>hostPath \u9650\u5236</p> <p>\u4f7f\u7528 hostPath \u6642\uff0cPod \u53ea\u80fd\u904b\u884c\u5728\u6709\u8a72\u8def\u5f91\u7684\u7bc0\u9ede\u4e0a\u3002\u5982\u679c Pod \u88ab\u8abf\u5ea6\u5230\u5176\u4ed6\u7bc0\u9ede\uff0c\u53ef\u80fd\u6703\u627e\u4e0d\u5230\u8cc7\u6599\u6216\u770b\u5230\u4e0d\u540c\u7684\u8cc7\u6599\u3002</p>"},{"location":"lab16_pv_pvc/#1-worker-node","title":"\u6b65\u9a5f 1\uff1a\u5728 Worker Node \u6e96\u5099\u672c\u5730\u76ee\u9304","text":"<p>\u5728 k8s-node1 \u4e0a\u57f7\u884c\uff1a</p> \u5728 node1 \u5efa\u7acb\u76ee\u9304\u548c\u6e2c\u8a66\u6a94\u6848<pre><code>mkdir -p /mnt/data\necho \"node1...AAA\" &gt; /mnt/data/index.html\ncat /mnt/data/index.html\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>node1...AAA\n</code></pre> <p>\u5728 k8s-node2 \u4e0a\u57f7\u884c\uff1a</p> \u5728 node2 \u5efa\u7acb\u76ee\u9304\u548c\u6e2c\u8a66\u6a94\u6848<pre><code>mkdir -p /mnt/data\necho \"node2...BBB\" &gt; /mnt/data/index.html\ncat /mnt/data/index.html\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>node2...BBB\n</code></pre>"},{"location":"lab16_pv_pvc/#2-pvpersistent-volume","title":"\u6b65\u9a5f 2\uff1a\u5efa\u7acb PV\uff08Persistent Volume\uff09","text":"<p>\u56de\u5230 k8s-master1\uff0c\u4e0b\u8f09\u4e26\u67e5\u770b PV YAML\uff1a</p> \u4e0b\u8f09 PV YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pv1-local.yaml\n</code></pre> <p>PV YAML \u5167\u5bb9\uff1a</p> pv1-local.yaml<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv1-local\nspec:\n  capacity:\n    storage: 10Gi            # \u5132\u5b58\u5bb9\u91cf\n  accessModes:\n    - ReadWriteOnce          # \u5b58\u53d6\u6a21\u5f0f\n  persistentVolumeReclaimPolicy: Retain  # \u56de\u6536\u7b56\u7565\n  storageClassName: manual   # \u5132\u5b58\u985e\u5225\n  hostPath:\n    path: \"/mnt/data\"        # \u7bc0\u9ede\u672c\u5730\u8def\u5f91\n</code></pre> \u6b04\u4f4d \u8aaa\u660e capacity \u5132\u5b58\u5bb9\u91cf\uff0810Gi = 10 GiB\uff09 accessModes RWO\uff08\u55ae\u7bc0\u9ede\u8b80\u5beb\uff09\u3001ROX\uff08\u591a\u7bc0\u9ede\u552f\u8b80\uff09\u3001RWX\uff08\u591a\u7bc0\u9ede\u8b80\u5beb\uff09 persistentVolumeReclaimPolicy Retain\uff08\u4fdd\u7559\uff09\u3001Delete\uff08\u522a\u9664\uff09\u3001Recycle\uff08\u56de\u6536\uff09 storageClassName \u7528\u65bc PVC \u914d\u5c0d\u7684\u985e\u5225\u540d\u7a31 hostPath \u7bc0\u9ede\u672c\u5730\u8def\u5f91 <p>\u5957\u7528 PV\uff1a</p> \u5efa\u7acb PV<pre><code>kubectl apply -f pv1-local.yaml\n</code></pre> <p>\u67e5\u770b PV \u72c0\u614b\uff1a</p> \u67e5\u770b PV<pre><code>kubectl get pv\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Available           manual         3s\n</code></pre> <p>PV \u72c0\u614b</p> <p>\u72c0\u614b\u986f\u793a <code>Available</code>\uff0c\u8868\u793a PV \u53ef\u7528\uff0c\u5c1a\u672a\u88ab PVC \u7d81\u5b9a\u3002</p>"},{"location":"lab16_pv_pvc/#3-pvcpersistent-volume-claim","title":"\u6b65\u9a5f 3\uff1a\u5efa\u7acb PVC\uff08Persistent Volume Claim\uff09","text":"\u4e0b\u8f09 PVC YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pvc1-local.yaml\n</code></pre> <p>PVC YAML \u5167\u5bb9\uff1a</p> pvc1-local.yaml<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc1-local\nspec:\n  accessModes:\n    - ReadWriteOnce          # \u5fc5\u9808\u8207 PV \u76f8\u5bb9\n  resources:\n    requests:\n      storage: 3Gi           # \u8acb\u6c42\u7684\u5bb9\u91cf\n  storageClassName: manual   # \u5fc5\u9808\u8207 PV \u76f8\u540c\n</code></pre> <p>\u5957\u7528 PVC\uff1a</p> \u5efa\u7acb PVC<pre><code>kubectl apply -f pvc1-local.yaml\n</code></pre> <p>\u67e5\u770b PV \u548c PVC \u72c0\u614b\uff1a</p> \u67e5\u770b PV \u72c0\u614b<pre><code>kubectl get pv\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound    default/pvc1-local   manual         95s\n</code></pre> \u67e5\u770b PVC \u72c0\u614b<pre><code>kubectl get pvc\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME         STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npvc1-local   Bound    pv1-local   10Gi       RWO            manual         5s\n</code></pre> <p>\u7d81\u5b9a\u6210\u529f</p> <p>PV \u548c PVC \u7684\u72c0\u614b\u90fd\u8b8a\u6210 <code>Bound</code>\uff0c\u8868\u793a\u7d81\u5b9a\u6210\u529f\u3002CLAIM \u6b04\u4f4d\u986f\u793a <code>default/pvc1-local</code>\uff0c\u8868\u793a\u88ab\u54ea\u500b Namespace \u7684 PVC \u7d81\u5b9a\u3002</p>"},{"location":"lab16_pv_pvc/#4-pvc-pod","title":"\u6b65\u9a5f 4\uff1a\u5efa\u7acb\u4f7f\u7528 PVC \u7684 Pod","text":"\u4e0b\u8f09 Pod YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pv1-pod-local.yaml\n</code></pre> <p>Pod YAML \u5167\u5bb9\uff1a</p> pv1-pod-local.yaml<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pv1-pod-local\nspec:\n  containers:\n  - name: nginx\n    image: docker1.training.lab:5000/nginx\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - mountPath: \"/usr/share/nginx/html\"  # \u5bb9\u5668\u5167\u639b\u8f09\u8def\u5f91\n      name: pv1-storage\n  volumes:\n  - name: pv1-storage\n    persistentVolumeClaim:\n      claimName: pvc1-local                # \u4f7f\u7528\u7684 PVC \u540d\u7a31\n</code></pre> <p>\u5957\u7528 Pod\uff1a</p> \u5efa\u7acb Pod<pre><code>kubectl apply -f pv1-pod-local.yaml\n</code></pre> <p>\u67e5\u770b Pod \u72c0\u614b\uff1a</p> \u67e5\u770b Pod<pre><code>kubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME            READY   STATUS    RESTARTS   AGE   IP            NODE\npv1-pod-local   1/1     Running   0          21s   10.128.1.17   k8s-node1.training.lab\n</code></pre> <p>\u6e2c\u8a66\u5b58\u53d6\uff1a</p> \u6e2c\u8a66\u5b58\u53d6<pre><code>curl 10.128.1.17\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>node1...AAA\n</code></pre> <p>hostPath \u7684\u4fb7\u9650</p> <p>Pod \u88ab\u8abf\u5ea6\u5230 node1\uff0c\u6240\u4ee5\u770b\u5230\u7684\u662f node1 \u4e0a\u7684 <code>/mnt/data/index.html</code> \u5167\u5bb9\uff08node1...AAA\uff09\u3002\u5982\u679c Pod \u88ab\u8abf\u5ea6\u5230 node2\uff0c\u6703\u770b\u5230\u4e0d\u540c\u7684\u5167\u5bb9\uff08node2...BBB\uff09\u3002</p>"},{"location":"lab16_pv_pvc/#lab-nfs","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aNFS \u7db2\u8def\u5132\u5b58","text":""},{"location":"lab16_pv_pvc/#_6","title":"\u67b6\u69cb\u8aaa\u660e","text":"<p>\u4f7f\u7528 NFS \u6642\uff0c\u6240\u6709\u7bc0\u9ede\u90fd\u53ef\u4ee5\u5b58\u53d6\u76f8\u540c\u7684\u5171\u4eab\u5132\u5b58\u7a7a\u9593\u3002</p> <pre><code>graph TB\n    subgraph master[\"k8s-master1 NFS Server\"]\n        NFS[\"NFS \u670d\u52d9\"]\n        Data[\"/data\"]\n        NFS --&gt; Data\n    end\n\n    subgraph node1[\"k8s-node1\"]\n        Pod1[\"pv2-pod-nfs\"]\n        Pod1 -.-&gt; NFS\n    end\n\n    subgraph node2[\"k8s-node2\"]\n        Pod2[\"Pod\"]\n        Pod2 -.-&gt; NFS\n    end</code></pre>"},{"location":"lab16_pv_pvc/#1-nfs","title":"\u6b65\u9a5f 1\uff1a\u5b89\u88dd NFS \u5de5\u5177","text":"<p>\u5728\u6240\u6709\u7bc0\u9ede\uff08master1\u3001node1\u3001node2\uff09\u5b89\u88dd nfs-utils\uff1a</p> \u5b89\u88dd nfs-utils<pre><code>yum install nfs-utils -y\n</code></pre>"},{"location":"lab16_pv_pvc/#2-nfs-serverk8s-master1","title":"\u6b65\u9a5f 2\uff1a\u8a2d\u5b9a NFS Server\uff08k8s-master1\uff09","text":"<p>\u5728 k8s-master1 \u4e0a\u57f7\u884c\uff1a</p> <p>\u5efa\u7acb\u5171\u4eab\u76ee\u9304\uff1a</p> \u5efa\u7acb\u5171\u4eab\u76ee\u9304<pre><code>mkdir -p /data\necho \"master...CCC\" &gt; /data/index.html\n</code></pre> <p>\u8a2d\u5b9a NFS \u532f\u51fa\uff1a</p> \u7de8\u8f2f /etc/exports<pre><code>vi /etc/exports\n</code></pre> <p>\u52a0\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a</p> /etc/exports<pre><code>/data *(rw,no_root_squash)\n</code></pre> \u9078\u9805 \u8aaa\u660e <code>*</code> \u5141\u8a31\u6240\u6709\u4e3b\u6a5f\u5b58\u53d6 <code>rw</code> \u8b80\u5beb\u6b0a\u9650 <code>no_root_squash</code> root \u4f7f\u7528\u8005\u4fdd\u6301 root \u6b0a\u9650 <p>\u555f\u52d5 NFS \u670d\u52d9\uff1a</p> \u555f\u52d5\u4e26\u555f\u7528 NFS<pre><code>systemctl start nfs-server.service\nsystemctl enable nfs-server.service\nsystemctl status nfs-server.service\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>\u25cf nfs-server.service - NFS server and services\n     Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; enabled)\n     Active: active (exited)\n</code></pre>"},{"location":"lab16_pv_pvc/#3-nfs-k8s-node1","title":"\u6b65\u9a5f 3\uff1a\u6e2c\u8a66 NFS \u639b\u8f09\uff08k8s-node1\uff09","text":"<p>\u5728 k8s-node1 \u4e0a\u57f7\u884c\uff1a</p> \u5efa\u7acb\u639b\u8f09\u9ede\u4e26\u639b\u8f09 NFS<pre><code>mkdir -p /mnt/nfs\nmount -t nfs k8s-master1:/data /mnt/nfs\n</code></pre> <p>\u9a57\u8b49\u639b\u8f09\uff1a</p> \u9a57\u8b49\u639b\u8f09<pre><code>df -Th | grep nfs\ncat /mnt/nfs/index.html\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-master1:/data   nfs4   70G  7.4G  63G  11% /mnt/nfs\nmaster...CCC\n</code></pre> <p>\u5378\u8f09\uff08\u6e2c\u8a66\u5b8c\u6210\u5f8c\uff09\uff1a</p> \u5378\u8f09 NFS<pre><code>umount /mnt/nfs\n</code></pre>"},{"location":"lab16_pv_pvc/#4-nfs-pv","title":"\u6b65\u9a5f 4\uff1a\u5efa\u7acb NFS PV","text":"<p>\u56de\u5230 k8s-master1\uff1a</p> \u4e0b\u8f09 NFS PV YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pv2-nfs.yaml\n</code></pre> <p>NFS PV YAML \u5167\u5bb9\uff1a</p> pv2-nfs.yaml<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv2-nfs\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: manual\n  nfs:\n    server: k8s-master1              # NFS Server \u4e3b\u6a5f\u540d\u7a31\n    path: \"/data\"                    # NFS \u5171\u4eab\u8def\u5f91\n</code></pre> <p>\u5957\u7528 PV\uff1a</p> \u5efa\u7acb NFS PV<pre><code>kubectl apply -f pv2-nfs.yaml\nkubectl get pv\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound       default/pvc1-local   manual         19m\npv2-nfs     10Gi       RWO            Retain           Available                        manual         3s\n</code></pre>"},{"location":"lab16_pv_pvc/#5-nfs-pvc","title":"\u6b65\u9a5f 5\uff1a\u5efa\u7acb NFS PVC","text":"\u4e0b\u8f09 NFS PVC YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pvc2-nfs.yaml\n</code></pre> <p>NFS PVC YAML \u5167\u5bb9\uff1a</p> pvc2-nfs.yaml<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc2-nfs\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 3Gi\n  storageClassName: manual\n</code></pre> <p>\u5957\u7528 PVC\uff1a</p> \u5efa\u7acb NFS PVC<pre><code>kubectl apply -f pvc2-nfs.yaml\nkubectl get pv\nkubectl get pvc\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound    default/pvc1-local   manual         20m\npv2-nfs     10Gi       RWO            Retain           Bound    default/pvc2-nfs     manual         91s\n\nNAME         STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npvc1-local   Bound    pv1-local   10Gi       RWO            manual         19m\npvc2-nfs     Bound    pv2-nfs     10Gi       RWO            manual         5s\n</code></pre>"},{"location":"lab16_pv_pvc/#6-nfs-pvc-pod","title":"\u6b65\u9a5f 6\uff1a\u5efa\u7acb\u4f7f\u7528 NFS PVC \u7684 Pod","text":"\u4e0b\u8f09 NFS Pod YAML<pre><code>wget http://10.0.1.248/k8s/yaml/pv2-pod-nfs.yaml\n</code></pre> <p>NFS Pod YAML \u5167\u5bb9\uff1a</p> pv2-pod-nfs.yaml<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pv2-pod-nfs\nspec:\n  containers:\n  - name: nginx\n    image: docker1.training.lab:5000/nginx\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - mountPath: \"/usr/share/nginx/html\"\n      name: pv2-storage\n  volumes:\n  - name: pv2-storage\n    persistentVolumeClaim:\n      claimName: pvc2-nfs              # \u4f7f\u7528 NFS PVC\n</code></pre> <p>\u5957\u7528 Pod\uff1a</p> \u5efa\u7acb NFS Pod<pre><code>kubectl apply -f pv2-pod-nfs.yaml\nkubectl get pods -o wide\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME            READY   STATUS    RESTARTS   AGE   IP            NODE\npv1-pod-local   1/1     Running   0          19m   10.128.1.17   k8s-node1.training.lab\npv2-pod-nfs     1/1     Running   0          18s   10.128.1.18   k8s-node1.training.lab\n</code></pre> <p>\u6e2c\u8a66\u5b58\u53d6\uff1a</p> \u6e2c\u8a66 NFS Pod<pre><code>curl 10.128.1.18\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>master...CCC\n</code></pre> <p>NFS \u5171\u4eab\u5132\u5b58</p> <p>\u7121\u8ad6 Pod \u904b\u884c\u5728\u54ea\u500b\u7bc0\u9ede\uff0c\u90fd\u6703\u770b\u5230\u76f8\u540c\u7684\u5167\u5bb9\uff08master...CCC\uff09\uff0c\u56e0\u70ba\u8cc7\u6599\u4f86\u81ea\u5171\u4eab\u7684 NFS Server\u3002</p>"},{"location":"lab16_pv_pvc/#hostpath-vs-nfs","title":"hostPath vs NFS \u6bd4\u8f03","text":"\u7279\u6027 hostPath NFS \u8cc7\u6599\u4f4d\u7f6e \u7bc0\u9ede\u672c\u5730 \u7db2\u8def\u5171\u4eab \u8de8\u7bc0\u9ede\u5b58\u53d6 \u274c \u4e0d\u652f\u63f4 \u2705 \u652f\u63f4 Pod \u8abf\u5ea6 \u9650\u5236\u5728\u7279\u5b9a\u7bc0\u9ede \u53ef\u8abf\u5ea6\u5230\u4efb\u610f\u7bc0\u9ede \u8a2d\u5b9a\u8907\u96dc\u5ea6 \u7c21\u55ae \u9700\u8981\u8a2d\u5b9a NFS Server \u4f7f\u7528\u5834\u666f \u6e2c\u8a66\u3001\u55ae\u7bc0\u9ede \u751f\u7522\u74b0\u5883\u3001\u591a\u7bc0\u9ede\u5171\u4eab"},{"location":"lab16_pv_pvc/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aPVC \u4e00\u76f4\u8655\u65bc Pending \u72c0\u614b\uff1f <p>\u539f\u56e0\uff1a\u627e\u4e0d\u5230\u7b26\u5408\u689d\u4ef6\u7684 PV\u3002</p> <p>\u6aa2\u67e5\u9805\u76ee\uff1a</p> <ul> <li>storageClassName \u662f\u5426\u76f8\u540c</li> <li>accessModes \u662f\u5426\u76f8\u5bb9</li> <li>\u8acb\u6c42\u7684 storage \u662f\u5426\u8d85\u904e PV \u5bb9\u91cf</li> </ul> Q2\uff1aNFS \u639b\u8f09\u5931\u6557\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <ol> <li>\u78ba\u8a8d NFS Server \u6709\u555f\u52d5\uff1a<code>systemctl status nfs-server</code></li> <li>\u78ba\u8a8d\u6240\u6709\u7bc0\u9ede\u90fd\u5b89\u88dd\u4e86 nfs-utils</li> <li>\u78ba\u8a8d\u9632\u706b\u7246\u6c92\u6709\u963b\u64cb NFS \u9023\u7dda</li> <li>\u4f7f\u7528 <code>showmount -e k8s-master1</code> \u67e5\u770b\u532f\u51fa\u7684\u76ee\u9304</li> </ol> Q3\uff1aPV \u522a\u9664\u5f8c\u5982\u4f55\u91cd\u65b0\u4f7f\u7528\uff1f <p>\u89e3\u7b54\uff1a\u7576 persistentVolumeReclaimPolicy \u8a2d\u70ba Retain \u6642\uff1a</p> <ol> <li>\u624b\u52d5\u6e05\u9664 PV \u4e0a\u7684\u8cc7\u6599</li> <li>\u522a\u9664\u820a\u7684 PV</li> <li>\u91cd\u65b0\u5efa\u7acb PV</li> </ol>"},{"location":"lab16_pv_pvc/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 PV/PVC \u6982\u5ff5\uff1aPV \u662f\u5132\u5b58\u8cc7\u6e90\uff0cPVC \u662f\u4f7f\u7528\u8acb\u6c42\uff0c\u5169\u8005\u900f\u904e storageClassName \u914d\u5c0d</li> <li>\u2705 hostPath\uff1a\u4f7f\u7528\u7bc0\u9ede\u672c\u5730\u76ee\u9304\uff0c\u7c21\u55ae\u4f46\u7121\u6cd5\u8de8\u7bc0\u9ede</li> <li>\u2705 NFS\uff1a\u63d0\u4f9b\u7db2\u8def\u5171\u4eab\u5132\u5b58\uff0c\u652f\u63f4\u8de8\u7bc0\u9ede\u5b58\u53d6</li> <li>\u2705 \u7d81\u5b9a\u6d41\u7a0b\uff1a\u5efa\u7acb PV \u2192 \u5efa\u7acb PVC \u2192 \u81ea\u52d5\u7d81\u5b9a \u2192 Pod \u639b\u8f09 PVC</li> <li>\u2705 \u5b58\u53d6\u6a21\u5f0f\uff1aRWO\uff08\u55ae\u7bc0\u9ede\u8b80\u5beb\uff09\u3001ROX\uff08\u591a\u7bc0\u9ede\u552f\u8b80\uff09\u3001RWX\uff08\u591a\u7bc0\u9ede\u8b80\u5beb\uff09</li> <li>\u2705 \u56de\u6536\u7b56\u7565\uff1aRetain\uff08\u4fdd\u7559\uff09\u3001Delete\uff08\u522a\u9664\uff09</li> </ul>"},{"location":"lab16_pv_pvc/#_9","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes Persistent Volumes</li> <li>Configure a Pod to Use a PersistentVolume</li> <li>NFS \u5132\u5b58\u8a2d\u5b9a</li> </ul>"},{"location":"lab17_secret/","title":"LAB 17 secret","text":""},{"location":"lab17_secret/#lab-17-kubernetes-secret","title":"LAB 17 Kubernetes Secret","text":""},{"location":"lab17_secret/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Secret \u7684\u7528\u9014\u8207\u985e\u578b</li> <li> \u4f7f\u7528\u4e09\u7a2e\u65b9\u5f0f\u5efa\u7acb Secret\uff08\u5f9e\u6a94\u6848\u3001\u5f9e\u6307\u4ee4\u3001\u5f9e YAML\uff09</li> <li> \u900f\u904e\u74b0\u5883\u8b8a\u6578\u5c07 Secret \u50b3\u905e\u7d66 Pod</li> <li> \u900f\u904e Volume \u639b\u8f09\u5c07 Secret \u50b3\u905e\u7d66 Pod</li> <li> \u7406\u89e3 base64 \u7de8\u78bc\u5728 Secret \u4e2d\u7684\u4f5c\u7528</li> </ul>"},{"location":"lab17_secret/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 16 PV/PVC</li> <li>\u719f\u6089 Pod\u3001Volume \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab17_secret/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab17_secret/#secret","title":"Secret \u662f\u4ec0\u9ebc\uff1f","text":"<p>Secret \u662f Kubernetes \u4e2d\u7528\u4f86\u5132\u5b58**\u654f\u611f\u8cc7\u8a0a**\u7684\u8cc7\u6e90\uff0c\u4f8b\u5982\u5bc6\u78bc\u3001API \u91d1\u9470\u3001\u6191\u8b49\u7b49\u3002Secret \u6703\u4ee5 base64 \u7de8\u78bc\u5132\u5b58\uff0c\u907f\u514d\u660e\u6587\u66b4\u9732\u5728 YAML \u6a94\u6848\u4e2d\u3002</p> <pre><code>graph LR\n    Admin[\u7ba1\u7406\u54e1] --&gt;|\u5efa\u7acb| Secret[Secret&lt;br/&gt;username: root&lt;br/&gt;password: ****]\n    Secret --&gt;|\u74b0\u5883\u8b8a\u6578| Pod1[Pod]\n    Secret --&gt;|\u639b\u8f09 Volume| Pod2[Pod]</code></pre>"},{"location":"lab17_secret/#secret_1","title":"Secret \u5efa\u7acb\u8207\u5b58\u53d6\u7684\u7d44\u5408","text":"<p>Secret \u6709 3 \u7a2e\u5efa\u7acb\u65b9\u5f0f \u548c 2 \u7a2e\u5b58\u53d6\u65b9\u5f0f\uff0c\u5171 6 \u7a2e\u7d44\u5408\uff1a</p> \u5efa\u7acb\u65b9\u5f0f \u8aaa\u660e base64 \u7de8\u78bc \u5f9e\u6a94\u6848\uff08--from-file\uff09 \u5c07\u6a94\u6848\u5167\u5bb9\u532f\u5165\u6210 Secret \u81ea\u52d5\u8655\u7406 \u5f9e\u6307\u4ee4\uff08--from-literal\uff09 \u76f4\u63a5\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u503c \u81ea\u52d5\u8655\u7406 \u5f9e YAML \u4f7f\u7528 YAML \u6a94\u6848\u5b9a\u7fa9 \u26a0\ufe0f \u9700\u624b\u52d5\u7de8\u78bc \u5b58\u53d6\u65b9\u5f0f \u8aaa\u660e \u74b0\u5883\u8b8a\u6578 Secret \u503c\u6ce8\u5165\u70ba\u74b0\u5883\u8b8a\u6578 Volume \u639b\u8f09 Secret \u639b\u8f09\u70ba\u6a94\u6848 <pre><code>graph TB\n    subgraph \"\u5efa\u7acb Secret\uff083 \u7a2e\uff09\"\n        File[\u5f9e\u6a94\u6848&lt;br/&gt;--from-file]\n        Literal[\u5f9e\u6307\u4ee4&lt;br/&gt;--from-literal]\n        YAML[\u5f9e YAML&lt;br/&gt;\u9700 base64]\n    end\n\n    subgraph \"\u5b58\u53d6 Secret\uff082 \u7a2e\uff09\"\n        Env[\u74b0\u5883\u8b8a\u6578&lt;br/&gt;env]\n        Mount[Volume \u639b\u8f09&lt;br/&gt;volumeMounts]\n    end\n\n    File --&gt; Env\n    File --&gt; Mount\n    Literal --&gt; Env\n    Literal --&gt; Mount\n    YAML --&gt; Env\n    YAML --&gt; Mount</code></pre>"},{"location":"lab17_secret/#lab-secret","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1a\u5efa\u7acb Secret","text":""},{"location":"lab17_secret/#secret_2","title":"\u65b9\u5f0f\u4e00\uff1a\u5f9e\u6a94\u6848\u5efa\u7acb Secret","text":""},{"location":"lab17_secret/#1","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb\u5305\u542b\u654f\u611f\u8cc7\u6599\u7684\u6a94\u6848","text":"\u5efa\u7acb username \u548c password \u6a94\u6848<pre><code>echo -n \"root\" &gt; ./username.txt\necho -n \"pass1234\" &gt; ./password.txt\n</code></pre> <p>\u6ce8\u610f -n \u53c3\u6578</p> <p>\u4f7f\u7528 <code>echo -n</code> \u907f\u514d\u5728\u6a94\u6848\u672b\u5c3e\u52a0\u5165\u63db\u884c\u7b26\u865f\uff0c\u5426\u5247\u5bc6\u78bc\u6703\u5305\u542b\u591a\u9918\u7684\u63db\u884c\u3002</p> <p>\u9a57\u8b49\u6a94\u6848\u5167\u5bb9\uff1a</p> \u67e5\u770b\u6a94\u6848\u5167\u5bb9<pre><code>cat username.txt\ncat password.txt\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u6ce8\u610f\u6c92\u6709\u63db\u884c\uff09\uff1a</p> <pre><code>root[root@k8s-master1 ~]#\npass1234[root@k8s-master1 ~]#\n</code></pre>"},{"location":"lab17_secret/#2-secret","title":"\u6b65\u9a5f 2\uff1a\u5f9e\u6a94\u6848\u5efa\u7acb Secret","text":"\u5f9e\u6a94\u6848\u5efa\u7acb Secret<pre><code>kubectl create secret generic demo-secret-from-file \\\n  --from-file=./username.txt \\\n  --from-file=./password.txt\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>secret/demo-secret-from-file created\n</code></pre> <p>\u67e5\u770b Secret\uff1a</p> \u67e5\u770b Secret \u5217\u8868<pre><code>kubectl get secrets\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                    TYPE     DATA   AGE\ndemo-secret-from-file   Opaque   2      7s\n</code></pre> \u67e5\u770b Secret \u8a73\u7d30\u8cc7\u8a0a<pre><code>kubectl describe secrets demo-secret-from-file\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Name:         demo-secret-from-file\nNamespace:    default\nType:  Opaque\n\nData\n====\npassword.txt:  8 bytes\nusername.txt:  4 bytes\n</code></pre> <p>\u6a94\u540d\u4f5c\u70ba Key</p> <p>\u4f7f\u7528 <code>--from-file</code> \u6642\uff0c\u6a94\u540d\u6703\u6210\u70ba Secret \u7684 Key\uff08\u5982 <code>password.txt</code>\u3001<code>username.txt</code>\uff09\u3002</p>"},{"location":"lab17_secret/#secret-from-literal","title":"\u65b9\u5f0f\u4e8c\uff1a\u5f9e\u6307\u4ee4\u5efa\u7acb Secret\uff08--from-literal\uff09","text":"\u5f9e\u6307\u4ee4\u5efa\u7acb Secret<pre><code>kubectl create secret generic demo-secret-from-literal \\\n  --from-literal=username=root \\\n  --from-literal=password=pass1234\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>secret/demo-secret-from-literal created\n</code></pre> <p>\u67e5\u770b Secret\uff1a</p> \u67e5\u770b Secret<pre><code>kubectl describe secrets demo-secret-from-literal\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Name:         demo-secret-from-literal\nNamespace:    default\nType:  Opaque\n\nData\n====\npassword:  8 bytes\nusername:  4 bytes\n</code></pre> <p>\u81ea\u8a02 Key \u540d\u7a31</p> <p>\u4f7f\u7528 <code>--from-literal</code> \u6642\uff0c\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a Key \u540d\u7a31\uff08\u5982 <code>username</code>\u3001<code>password</code>\uff09\uff0c\u6bd4 <code>--from-file</code> \u66f4\u9748\u6d3b\u3002</p>"},{"location":"lab17_secret/#yaml-secret","title":"\u65b9\u5f0f\u4e09\uff1a\u5f9e YAML \u5efa\u7acb Secret","text":""},{"location":"lab17_secret/#1-base64","title":"\u6b65\u9a5f 1\uff1a\u4f7f\u7528 base64 \u7de8\u78bc\u8cc7\u6599","text":"base64 \u7de8\u78bc<pre><code>echo -n \"root\" | base64\necho -n \"pass1234\" | base64\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>cm9vdA==\ncGFzczEyMzQ=\n</code></pre> <p>YAML \u65b9\u5f0f\u9700\u8981\u624b\u52d5 base64 \u7de8\u78bc</p> <p>\u53ea\u6709\u4f7f\u7528 YAML \u5efa\u7acb Secret \u6642\uff0c\u9700\u8981\u5148\u5c07\u8cc7\u6599\u9032\u884c base64 \u7de8\u78bc\u3002<code>--from-file</code> \u548c <code>--from-literal</code> \u6703\u81ea\u52d5\u8655\u7406\u3002</p>"},{"location":"lab17_secret/#2-yaml","title":"\u6b65\u9a5f 2\uff1a\u4e0b\u8f09\u4e26\u67e5\u770b YAML","text":"\u4e0b\u8f09 Secret YAML<pre><code>wget http://10.0.1.248/k8s/yaml/my-secret.yaml\ncat my-secret.yaml\n</code></pre> <p>YAML \u5167\u5bb9\uff1a</p> my-secret.yaml<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: demo-secret-from-yaml\ntype: Opaque\ndata:\n  username: cm9vdA==          # base64 \u7de8\u78bc\u7684 \"root\"\n  password: cGFzczEyMzQ=      # base64 \u7de8\u78bc\u7684 \"pass1234\"\n</code></pre> \u6b04\u4f4d \u8aaa\u660e type: Opaque \u901a\u7528\u578b Secret data \u5b58\u653e base64 \u7de8\u78bc\u7684\u8cc7\u6599"},{"location":"lab17_secret/#3-yaml","title":"\u6b65\u9a5f 3\uff1a\u5957\u7528 YAML","text":"\u5efa\u7acb Secret<pre><code>kubectl apply -f my-secret.yaml\n</code></pre> <p>\u67e5\u770b\u6240\u6709 Secret\uff1a</p> \u67e5\u770b\u6240\u6709 Secret<pre><code>kubectl get secrets\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                       TYPE     DATA   AGE\ndemo-secret-from-file      Opaque   2      3m32s\ndemo-secret-from-literal   Opaque   2      2m13s\ndemo-secret-from-yaml      Opaque   2      5s\n</code></pre>"},{"location":"lab17_secret/#lab-pod-secret","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aPod \u5b58\u53d6 Secret","text":""},{"location":"lab17_secret/#_4","title":"\u65b9\u5f0f\u4e00\uff1a\u900f\u904e\u74b0\u5883\u8b8a\u6578\u5b58\u53d6","text":"\u4e0b\u8f09 Pod YAML<pre><code>wget http://10.0.1.248/k8s/yaml/my-pod.yaml\n</code></pre> <p>Pod YAML \u5167\u5bb9\uff1a</p> my-pod.yaml<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: docker1.training.lab:5000/nginx\n    env:\n    - name: SECRET_USERNAME           # \u74b0\u5883\u8b8a\u6578\u540d\u7a31\n      valueFrom:\n        secretKeyRef:\n          name: demo-secret-from-yaml # Secret \u540d\u7a31\n          key: username               # Secret \u4e2d\u7684 Key\n    - name: SECRET_PASSWORD\n      valueFrom:\n        secretKeyRef:\n          name: demo-secret-from-yaml\n          key: password\n</code></pre> <p>\u5957\u7528 Pod\uff1a</p> \u5efa\u7acb Pod<pre><code>kubectl apply -f my-pod.yaml\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME     READY   STATUS    RESTARTS   AGE\nmy-pod   1/1     Running   0          16s\n</code></pre> <p>\u9032\u5165 Pod \u9a57\u8b49\u74b0\u5883\u8b8a\u6578\uff1a</p> \u9a57\u8b49\u74b0\u5883\u8b8a\u6578<pre><code>kubectl exec my-pod -it -- bash\n</code></pre> \u5728\u5bb9\u5668\u5167\u57f7\u884c<pre><code>env | grep SEC\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>SECRET_USERNAME=root\nSECRET_PASSWORD=pass1234\n</code></pre> <p>\u81ea\u52d5\u89e3\u78bc</p> <p>Pod \u5b58\u53d6 Secret \u6642\uff0cKubernetes \u6703**\u81ea\u52d5\u5c07 base64 \u89e3\u78bc**\uff0c\u61c9\u7528\u7a0b\u5f0f\u76f4\u63a5\u53d6\u5f97\u539f\u59cb\u503c\u3002</p>"},{"location":"lab17_secret/#volume","title":"\u65b9\u5f0f\u4e8c\uff1a\u900f\u904e Volume \u639b\u8f09\u5b58\u53d6","text":"\u4e0b\u8f09 Pod YAML<pre><code>wget http://192.168.66.248/k8s/yaml/my-pod-with-mounting-secret.yaml\n</code></pre> <p>Pod YAML \u5167\u5bb9\uff1a</p> my-pod-with-mounting-secret.yaml<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod-with-mounting-secret\nspec:\n  containers:\n  - name: my-container\n    image: docker1.training.lab:5000/nginx\n    volumeMounts:\n    - name: secret-volume\n      mountPath: \"/etc/creds\"         # \u639b\u8f09\u8def\u5f91\n      readOnly: true\n  volumes:\n  - name: secret-volume\n    secret:\n      secretName: demo-secret-from-yaml  # Secret \u540d\u7a31\n</code></pre> <p>\u5957\u7528 Pod\uff1a</p> \u5efa\u7acb Pod<pre><code>kubectl apply -f my-pod-with-mounting-secret.yaml\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                          READY   STATUS    RESTARTS   AGE\nmy-pod                        1/1     Running   0          22m\nmy-pod-with-mounting-secret   1/1     Running   0          7s\n</code></pre> <p>\u9032\u5165 Pod \u9a57\u8b49\u639b\u8f09\u7684\u6a94\u6848\uff1a</p> \u9a57\u8b49\u639b\u8f09<pre><code>kubectl exec my-pod-with-mounting-secret -it -- bash\n</code></pre> \u5728\u5bb9\u5668\u5167\u57f7\u884c<pre><code>ls -l /etc/creds\ncat /etc/creds/username\ncat /etc/creds/password\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>total 0\nlrwxrwxrwx 1 root root 15 Feb  4 08:06 password -&gt; ..data/password\nlrwxrwxrwx 1 root root 15 Feb  4 08:06 username -&gt; ..data/username\n\nroot\npass1234\n</code></pre> <p>\u639b\u8f09\u65b9\u5f0f\u7684\u7279\u9ede</p> <ul> <li>Secret \u7684\u6bcf\u500b Key \u6703\u8b8a\u6210\u4e00\u500b\u6a94\u6848</li> <li>\u6a94\u6848\u5167\u5bb9\u662f\u89e3\u78bc\u5f8c\u7684\u539f\u59cb\u503c</li> <li>\u9069\u5408\u9700\u8981\u4ee5\u6a94\u6848\u5f62\u5f0f\u8b80\u53d6\u7684\u5834\u666f\uff08\u5982\u6191\u8b49\u3001\u8a2d\u5b9a\u6a94\uff09</li> </ul>"},{"location":"lab17_secret/#vs-volume","title":"\u74b0\u5883\u8b8a\u6578 vs Volume \u639b\u8f09","text":"\u7279\u6027 \u74b0\u5883\u8b8a\u6578 Volume \u639b\u8f09 \u5b58\u53d6\u65b9\u5f0f <code>$ENV_NAME</code> \u8b80\u53d6\u6a94\u6848 \u66f4\u65b0\u884c\u70ba Pod \u91cd\u555f\u624d\u66f4\u65b0 \u81ea\u52d5\u66f4\u65b0\uff08kubelet \u540c\u6b65\uff09 \u8cc7\u6599\u683c\u5f0f \u5b57\u4e32 \u6a94\u6848 \u9069\u7528\u5834\u666f \u7c21\u55ae\u7684 key-value \u6191\u8b49\u3001\u8a2d\u5b9a\u6a94"},{"location":"lab17_secret/#_5","title":"\u4e09\u7a2e\u5efa\u7acb\u65b9\u5f0f\u6bd4\u8f03","text":"\u7279\u6027 --from-file --from-literal YAML base64 \u7de8\u78bc \u81ea\u52d5 \u81ea\u52d5 \u26a0\ufe0f \u624b\u52d5 Key \u540d\u7a31 \u6a94\u540d \u81ea\u8a02 \u81ea\u8a02 \u7248\u672c\u63a7\u5236 \u9700\u984d\u5916\u7ba1\u7406\u6a94\u6848 \u4e0d\u6613\u7248\u63a7 \u2705 \u6613\u65bc\u7248\u63a7 \u9069\u7528\u5834\u666f \u73fe\u6709\u6a94\u6848 \u5feb\u901f\u6e2c\u8a66 \u751f\u7522\u74b0\u5883"},{"location":"lab17_secret/#_6","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u5982\u4f55\u67e5\u770b Secret \u7684\u5be6\u969b\u5167\u5bb9\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 <code>kubectl get secret -o yaml</code> \u4e26\u89e3\u78bc\uff1a</p> <pre><code>kubectl get secret demo-secret-from-yaml -o yaml\n# \u89e3\u78bc base64\necho \"cm9vdA==\" | base64 -d\n</code></pre> Q2\uff1aSecret \u548c ConfigMap \u6709\u4ec0\u9ebc\u5dee\u5225\uff1f <p>\u89e3\u7b54\uff1a</p> \u7279\u6027 Secret ConfigMap \u7528\u9014 \u654f\u611f\u8cc7\u6599 \u4e00\u822c\u8a2d\u5b9a \u7de8\u78bc base64 \u660e\u6587 \u5132\u5b58 \u8a18\u61b6\u9ad4\uff08tmpfs\uff09 \u4e00\u822c\u5132\u5b58 Q3\uff1a\u5fd8\u8a18\u52a0 -n \u5c0e\u81f4\u5bc6\u78bc\u5305\u542b\u63db\u884c\u600e\u9ebc\u8fa6\uff1f <p>\u89e3\u7b54\uff1a\u91cd\u65b0\u5efa\u7acb\u6a94\u6848\u6216\u4f7f\u7528 <code>tr</code> \u79fb\u9664\u63db\u884c\uff1a</p> <pre><code>echo \"pass1234\" | tr -d '\\n' &gt; password.txt\n</code></pre>"},{"location":"lab17_secret/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Secret \u7528\u9014\uff1a\u5132\u5b58\u654f\u611f\u8cc7\u8a0a\uff08\u5bc6\u78bc\u3001\u91d1\u9470\u3001\u6191\u8b49\uff09</li> <li>\u2705 \u4e09\u7a2e\u5efa\u7acb\u65b9\u5f0f\uff1a</li> <li><code>--from-file</code>\uff1a\u5f9e\u6a94\u6848\u5efa\u7acb\uff0c\u81ea\u52d5 base64</li> <li><code>--from-literal</code>\uff1a\u5f9e\u6307\u4ee4\u5efa\u7acb\uff0c\u81ea\u52d5 base64</li> <li>YAML\uff1a\u9700\u624b\u52d5 base64 \u7de8\u78bc</li> <li>\u2705 \u5169\u7a2e\u5b58\u53d6\u65b9\u5f0f\uff1a</li> <li>\u74b0\u5883\u8b8a\u6578\uff08env + secretKeyRef\uff09</li> <li>Volume \u639b\u8f09\uff08volumes + volumeMounts\uff09</li> <li>\u2705 \u81ea\u52d5\u89e3\u78bc\uff1aPod \u5b58\u53d6\u6642\u81ea\u52d5\u5c07 base64 \u89e3\u78bc\u70ba\u539f\u59cb\u503c</li> </ul>"},{"location":"lab17_secret/#_8","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes Secrets</li> <li>Distribute Credentials Securely Using Secrets</li> <li>Secret Types</li> </ul>"},{"location":"lab18_rbac_event_log/","title":"LAB 18 RBAC \u8207 event/log","text":""},{"location":"lab18_rbac_event_log/#lab-18-rbac-eventlog","title":"LAB 18 RBAC \u8207 Event/Log","text":""},{"location":"lab18_rbac_event_log/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 RBAC\uff08Role-Based Access Control\uff09\u7684\u6982\u5ff5</li> <li> \u4f7f\u7528 ClusterRoleBinding \u8a2d\u5b9a\u53e2\u96c6\u5c64\u7d1a\u7684\u6b0a\u9650</li> <li> \u4f7f\u7528 kubectl get events \u67e5\u770b\u53e2\u96c6\u4e8b\u4ef6</li> <li> \u4f7f\u7528 kubectl logs \u67e5\u770b Pod \u65e5\u8a8c</li> </ul>"},{"location":"lab18_rbac_event_log/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 17 Secret</li> <li>\u719f\u6089 Pod\u3001Deployment \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab18_rbac_event_log/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab18_rbac_event_log/#rbac","title":"RBAC \u662f\u4ec0\u9ebc\uff1f","text":"<p>RBAC\uff08Role-Based Access Control\uff09 \u662f Kubernetes \u7684**\u6b0a\u9650\u63a7\u5236\u6a5f\u5236**\uff0c\u7528\u4f86\u63a7\u5236\u300c\u8ab0\u300d\u53ef\u4ee5\u5c0d\u300c\u4ec0\u9ebc\u8cc7\u6e90\u300d\u57f7\u884c\u300c\u4ec0\u9ebc\u64cd\u4f5c\u300d\u3002</p> <pre><code>graph LR\n    User[\u4f7f\u7528\u8005/ServiceAccount] --&gt;|\u7d81\u5b9a| RB[RoleBinding]\n    RB --&gt;|\u53c3\u7167| Role[Role]\n    Role --&gt;|\u5141\u8a31| Actions[\u64cd\u4f5c\u6b0a\u9650&lt;br/&gt;get/list/create/delete]\n    Actions --&gt;|\u5c0d\u8c61| Resources[\u8cc7\u6e90&lt;br/&gt;pods/deployments/secrets]</code></pre>"},{"location":"lab18_rbac_event_log/#rbac_1","title":"RBAC \u56db\u7a2e\u8cc7\u6e90","text":"\u8cc7\u6e90 \u4f5c\u7528\u7bc4\u570d \u8aaa\u660e Role Namespace \u5b9a\u7fa9\u55ae\u4e00 Namespace \u5167\u7684\u6b0a\u9650 RoleBinding Namespace \u5c07 Role \u7d81\u5b9a\u7d66\u4f7f\u7528\u8005 ClusterRole \u53e2\u96c6 \u5b9a\u7fa9\u53e2\u96c6\u5c64\u7d1a\u7684\u6b0a\u9650 ClusterRoleBinding \u53e2\u96c6 \u5c07 ClusterRole \u7d81\u5b9a\u7d66\u4f7f\u7528\u8005 <pre><code>graph TB\n    subgraph \"Namespace \u5c64\u7d1a\"\n        Role[Role] --&gt; RB[RoleBinding]\n        RB --&gt; User1[User/ServiceAccount]\n    end\n\n    subgraph \"Cluster \u5c64\u7d1a\"\n        CR[ClusterRole] --&gt; CRB[ClusterRoleBinding]\n        CRB --&gt; User2[User/ServiceAccount]\n    end</code></pre>"},{"location":"lab18_rbac_event_log/#clusterrole","title":"\u5167\u5efa ClusterRole","text":"<p>Kubernetes \u9810\u8a2d\u63d0\u4f9b\u591a\u500b\u5167\u5efa\u7684 ClusterRole\uff1a</p> ClusterRole \u6b0a\u9650 view \u552f\u8b80\u6b0a\u9650\uff08get\u3001list\u3001watch\uff09 edit \u8b80\u5beb\u6b0a\u9650\uff08\u4e0d\u542b RBAC \u8a2d\u5b9a\uff09 admin \u5b8c\u6574\u7ba1\u7406\u6b0a\u9650\uff08\u542b RBAC \u76f8\u95dc\uff09 cluster-admin \u8d85\u7d1a\u7ba1\u7406\u54e1\uff08\u6240\u6709\u6b0a\u9650\uff09"},{"location":"lab18_rbac_event_log/#lab-rbac-clusterrolebinding","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aRBAC ClusterRoleBinding","text":""},{"location":"lab18_rbac_event_log/#1-clusterrolebinding","title":"\u6b65\u9a5f 1\uff1a\u5957\u7528 ClusterRoleBinding","text":"\u5957\u7528 RBAC YAML<pre><code>kubectl apply -f http://192.168.66.248/k8s/yaml/rbac3.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>clusterrolebinding.rbac.authorization.k8s.io/my-global-access created\n</code></pre> <p>rbac3.yaml \u5167\u5bb9\u7bc4\u4f8b\uff1a</p> rbac3.yaml\uff08\u7bc4\u4f8b\uff09<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: my-global-access\nsubjects:\n- kind: User\n  name: my-user              # \u6216 ServiceAccount\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: view                 # \u4f7f\u7528\u5167\u5efa\u7684 view ClusterRole\n  apiGroup: rbac.authorization.k8s.io\n</code></pre> \u6b04\u4f4d \u8aaa\u660e subjects \u6b0a\u9650\u6388\u4e88\u7684\u5c0d\u8c61\uff08User\u3001Group\u3001ServiceAccount\uff09 roleRef \u53c3\u7167\u7684 Role \u6216 ClusterRole"},{"location":"lab18_rbac_event_log/#2-clusterrolebinding","title":"\u6b65\u9a5f 2\uff1a\u67e5\u770b ClusterRoleBinding","text":"\u67e5\u770b ClusterRoleBinding<pre><code>kubectl get clusterrolebindings.rbac.authorization.k8s.io | grep my-global\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>my-global-access   ClusterRole/view   21s\n</code></pre> <p>\u7d81\u5b9a\u8aaa\u660e</p> <p>\u6b64 ClusterRoleBinding \u5c07 <code>view</code> ClusterRole \u7d81\u5b9a\u7d66\u6307\u5b9a\u7684\u4f7f\u7528\u8005\uff0c\u8b93\u8a72\u4f7f\u7528\u8005\u64c1\u6709\u53e2\u96c6\u7684\u552f\u8b80\u6b0a\u9650\u3002</p>"},{"location":"lab18_rbac_event_log/#3-clusterrolebinding","title":"\u6b65\u9a5f 3\uff1a\u522a\u9664 ClusterRoleBinding","text":"\u522a\u9664 ClusterRoleBinding<pre><code>kubectl delete -f http://192.168.66.248/k8s/yaml/rbac3.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>clusterrolebinding.rbac.authorization.k8s.io \"my-global-access\" deleted\n</code></pre>"},{"location":"lab18_rbac_event_log/#lab-event","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aEvent \u4e8b\u4ef6\u76e3\u63a7","text":""},{"location":"lab18_rbac_event_log/#event","title":"Event \u662f\u4ec0\u9ebc\uff1f","text":"<p>Event\uff08\u4e8b\u4ef6\uff09 \u662f Kubernetes \u8a18\u9304\u53e2\u96c6\u4e2d\u767c\u751f\u7684\u91cd\u8981\u4e8b\u4ef6\uff0c\u4f8b\u5982 Pod \u8abf\u5ea6\u3001\u6620\u50cf\u6a94\u62c9\u53d6\u3001\u5bb9\u5668\u555f\u52d5\u7b49\u3002</p>"},{"location":"lab18_rbac_event_log/#1-pod","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb\u6e2c\u8a66 Pod","text":"\u5efa\u7acb\u6e2c\u8a66 Pod<pre><code>kubectl apply -f http://192.168.66.248/k8s/yaml/log1.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod/log1 created\n</code></pre> <p>log1.yaml \u5167\u5bb9\u7bc4\u4f8b\uff1a</p> log1.yaml\uff08\u7bc4\u4f8b\uff09<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: log1\nspec:\n  containers:\n  - name: count\n    image: docker1.training.lab:5000/nginx\n    command: [\"/bin/sh\", \"-c\"]\n    args:\n    - i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done\n</code></pre>"},{"location":"lab18_rbac_event_log/#2","title":"\u6b65\u9a5f 2\uff1a\u67e5\u770b\u4e8b\u4ef6","text":"\u67e5\u770b\u53e2\u96c6\u4e8b\u4ef6<pre><code>kubectl get events\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>LAST SEEN   TYPE     REASON      OBJECT     MESSAGE\n13s         Normal   Scheduled   pod/log1   Successfully assigned default/log1 to k8s-node1.training.lab\n13s         Normal   Pulling     pod/log1   Pulling image \"docker1.training.lab:5000/nginx\"\n13s         Normal   Pulled      pod/log1   Successfully pulled image \"docker1.training.lab:5000/nginx\" in 177ms\n13s         Normal   Created     pod/log1   Created container: count\n13s         Normal   Started     pod/log1   Started container count\n</code></pre> \u6b04\u4f4d \u8aaa\u660e LAST SEEN \u4e8b\u4ef6\u767c\u751f\u6642\u9593 TYPE \u4e8b\u4ef6\u985e\u578b\uff08Normal\u3001Warning\uff09 REASON \u4e8b\u4ef6\u539f\u56e0\uff08Scheduled\u3001Pulling\u3001Started \u7b49\uff09 OBJECT \u76f8\u95dc\u7684\u8cc7\u6e90 MESSAGE \u8a73\u7d30\u8a0a\u606f"},{"location":"lab18_rbac_event_log/#event_1","title":"Event \u751f\u547d\u9031\u671f","text":"<pre><code>sequenceDiagram\n    participant Scheduler\n    participant Node\n    participant Container\n\n    Scheduler-&gt;&gt;Node: Scheduled (\u8abf\u5ea6\u5230\u7bc0\u9ede)\n    Node-&gt;&gt;Container: Pulling (\u62c9\u53d6\u6620\u50cf\u6a94)\n    Node-&gt;&gt;Container: Pulled (\u62c9\u53d6\u5b8c\u6210)\n    Node-&gt;&gt;Container: Created (\u5efa\u7acb\u5bb9\u5668)\n    Node-&gt;&gt;Container: Started (\u555f\u52d5\u5bb9\u5668)</code></pre>"},{"location":"lab18_rbac_event_log/#lab-log","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aLog \u65e5\u8a8c\u67e5\u770b","text":""},{"location":"lab18_rbac_event_log/#1-pod_1","title":"\u6b65\u9a5f 1\uff1a\u67e5\u770b Pod \u65e5\u8a8c","text":"\u67e5\u770b Pod \u65e5\u8a8c<pre><code>kubectl logs pod/log1\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>0: Tue Feb  4 08:17:29 UTC 2025\n1: Tue Feb  4 08:17:30 UTC 2025\n2: Tue Feb  4 08:17:31 UTC 2025\n3: Tue Feb  4 08:17:32 UTC 2025\n4: Tue Feb  4 08:17:33 UTC 2025\n...\n</code></pre>"},{"location":"lab18_rbac_event_log/#logs","title":"\u5e38\u7528 logs \u53c3\u6578","text":"\u5373\u6642\u8ffd\u8e64\u65e5\u8a8c\uff08\u985e\u4f3c tail -f\uff09<pre><code>kubectl logs pod/log1 -f\n</code></pre> \u986f\u793a\u6700\u8fd1 10 \u884c<pre><code>kubectl logs pod/log1 --tail=10\n</code></pre> \u986f\u793a\u6700\u8fd1 1 \u5c0f\u6642\u7684\u65e5\u8a8c<pre><code>kubectl logs pod/log1 --since=1h\n</code></pre> \u986f\u793a\u6642\u9593\u6233\u8a18<pre><code>kubectl logs pod/log1 --timestamps\n</code></pre> \u6307\u5b9a\u5bb9\u5668\uff08\u591a\u5bb9\u5668 Pod\uff09<pre><code>kubectl logs pod/log1 -c count\n</code></pre> \u53c3\u6578 \u8aaa\u660e <code>-f</code> \u5373\u6642\u8ffd\u8e64\uff08follow\uff09 <code>--tail=N</code> \u986f\u793a\u6700\u5f8c N \u884c <code>--since=\u6642\u9593</code> \u986f\u793a\u6307\u5b9a\u6642\u9593\u5167\u7684\u65e5\u8a8c <code>--timestamps</code> \u986f\u793a\u6642\u9593\u6233\u8a18 <code>-c \u5bb9\u5668\u540d</code> \u6307\u5b9a\u5bb9\u5668 <code>--previous</code> \u986f\u793a\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\uff08\u91cd\u555f\u5f8c\uff09"},{"location":"lab18_rbac_event_log/#2_1","title":"\u6b65\u9a5f 2\uff1a\u6e05\u7406\u8cc7\u6e90","text":"\u522a\u9664\u6e2c\u8a66 Pod<pre><code>kubectl delete -f http://192.168.66.248/k8s/yaml/log1.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>pod \"log1\" deleted\n</code></pre>"},{"location":"lab18_rbac_event_log/#event-vs-log","title":"Event vs Log \u6bd4\u8f03","text":"\u7279\u6027 Event Log \u5167\u5bb9 \u53e2\u96c6\u4e8b\u4ef6\uff08\u8abf\u5ea6\u3001\u62c9\u53d6\u6620\u50cf\u6a94\uff09 \u5bb9\u5668\u8f38\u51fa\uff08stdout/stderr\uff09 \u4f86\u6e90 Kubernetes \u5143\u4ef6 \u61c9\u7528\u7a0b\u5f0f \u7528\u9014 \u6392\u67e5\u8abf\u5ea6\u554f\u984c \u6392\u67e5\u61c9\u7528\u7a0b\u5f0f\u554f\u984c \u4fdd\u7559\u6642\u9593 \u7d04 1 \u5c0f\u6642 \u53d6\u6c7a\u65bc\u65e5\u8a8c\u8f2a\u66ff\u8a2d\u5b9a \u6307\u4ee4 <code>kubectl get events</code> <code>kubectl logs</code>"},{"location":"lab18_rbac_event_log/#lab-debug","title":"Lab \u5be6\u4f5c\u7df4\u7fd2\uff1aDebug \u5be6\u6230\u6d41\u7a0b","text":"<p>\u7576 Pod \u7121\u6cd5\u6b63\u5e38\u904b\u884c\u6642\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6d41\u7a0b\u9032\u884c\u6545\u969c\u6392\u9664\uff1a</p> <pre><code>graph TD\n    Start[Pod \u7570\u5e38] --&gt; Step1[\u6aa2\u67e5\u7bc0\u9ede\u72c0\u614b]\n    Step1 --&gt; Step2[\u6aa2\u67e5 CNI Pod]\n    Step2 --&gt; Step3[\u67e5\u770b Pod \u4e8b\u4ef6]\n    Step3 --&gt; Step4[\u67e5\u770b\u5bb9\u5668\u65e5\u8a8c]\n    Step4 --&gt; Fix[\u627e\u5230\u554f\u984c\u4e26\u4fee\u5fa9]</code></pre>"},{"location":"lab18_rbac_event_log/#1","title":"\u6b65\u9a5f 1\uff1a\u6aa2\u67e5\u7bc0\u9ede\u72c0\u614b","text":"\u6aa2\u67e5\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                       STATUS     ROLES           AGE   VERSION\nk8s-master1.training.lab   Ready      control-plane   21h   v1.32.11\nk8s-node1.training.lab     NotReady   &lt;none&gt;          21h   v1.32.11\nk8s-node2.training.lab     Ready      &lt;none&gt;          21h   v1.32.11\n</code></pre> <p>NotReady \u72c0\u614b</p> <p>\u5982\u679c\u7bc0\u9ede\u986f\u793a <code>NotReady</code>\uff0c\u901a\u5e38\u662f CNI\uff08Container Network Interface\uff09\u6216 kubelet \u6709\u554f\u984c\u3002</p>"},{"location":"lab18_rbac_event_log/#2-cni-pod","title":"\u6b65\u9a5f 2\uff1a\u6aa2\u67e5 CNI Pod \u72c0\u614b","text":"\u6aa2\u67e5 Antrea CNI Pod<pre><code>kubectl get pods -n kube-system | grep antrea\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>antrea-agent-7zn4h                                 2/2     Running   0          2m33s\nantrea-agent-mdw2f                                 2/2     Running   0          2m34s\nantrea-agent-sbv79                                 2/2     Running   0          2m34s\nantrea-controller-57964d858f-bqwf8                 1/1     Running   0          37s\n</code></pre> <p>\u5176\u4ed6 CNI</p> <p>\u5982\u679c\u4f7f\u7528\u7684\u662f Calico \u6216 Flannel\uff0c\u8acb\u6539\u7528\uff1a</p> <ul> <li>Calico\uff1a<code>kubectl get pods -n kube-system | grep calico</code></li> <li>Flannel\uff1a<code>kubectl get pods -n kube-system | grep flannel</code></li> </ul>"},{"location":"lab18_rbac_event_log/#3-pod","title":"\u6b65\u9a5f 3\uff1a\u67e5\u770b Pod \u8a73\u7d30\u4e8b\u4ef6","text":"\u67e5\u770b Pod \u4e8b\u4ef6\uff08\u5e95\u90e8\u6703\u986f\u793a Events\uff09<pre><code>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>kubectl describe pod antrea-agent-mdw2f -n kube-system | tail -20\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Events:\n  Type     Reason     Age   From               Message\n  ----     ------     ----  ----               -------\n  Normal   Scheduled  82s   default-scheduler  Successfully assigned kube-system/antrea-agent-mdw2f to k8s-node1.training.lab\n  Normal   Pulling    82s   kubelet            Pulling image \"antrea/antrea-agent-ubuntu:v2.2.0\"\n  Normal   Pulled     57s   kubelet            Successfully pulled image\n  Normal   Created    57s   kubelet            Created container: install-cni\n  Normal   Started    57s   kubelet            Started container install-cni\n  Warning  Unhealthy  43s   kubelet            Readiness probe failed: HTTP probe failed with statuscode: 500\n</code></pre>"},{"location":"lab18_rbac_event_log/#4","title":"\u6b65\u9a5f 4\uff1a\u67e5\u770b\u5bb9\u5668\u65e5\u8a8c","text":"\u67e5\u770b\u7279\u5b9a\u5bb9\u5668\u7684\u65e5\u8a8c<pre><code>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt; -c &lt;container-name&gt; --tail=50\n</code></pre> <p>\u7bc4\u4f8b\uff1a</p> <pre><code>kubectl logs antrea-agent-mdw2f -n kube-system -c antrea-agent --tail=50\n</code></pre>"},{"location":"lab18_rbac_event_log/#_4","title":"\u5b8c\u6574\u72c0\u614b\u6aa2\u67e5\u8173\u672c","text":"\u4e00\u6b21\u6aa2\u67e5\u6240\u6709\u95dc\u9375\u72c0\u614b<pre><code>echo \"=== \u7bc0\u9ede\u72c0\u614b ===\"\nkubectl get nodes\n\necho -e \"\\n=== CNI Pods ===\"\nkubectl get pods -n kube-system | grep antrea\n\necho -e \"\\n=== \u61c9\u7528 Pods ===\"\nkubectl get pods -A -o wide\n\necho -e \"\\n=== \u7cfb\u7d71\u6838\u5fc3 Pods ===\"\nkubectl get pods -n kube-system | grep -E 'coredns|kube-proxy'\n</code></pre>"},{"location":"lab18_rbac_event_log/#debug","title":"Debug \u5e38\u898b\u554f\u984c\u5c0d\u7167\u8868","text":"\u75c7\u72c0 \u53ef\u80fd\u539f\u56e0 \u6aa2\u67e5\u6307\u4ee4 Node <code>NotReady</code> CNI \u672a\u5c31\u7dd2 <code>kubectl get pods -n kube-system</code> Pod <code>Pending</code> \u7121\u53ef\u7528\u7bc0\u9ede <code>kubectl describe pod &lt;name&gt;</code> Pod <code>ImagePullBackOff</code> \u6620\u50cf\u6a94\u62c9\u53d6\u5931\u6557 <code>kubectl describe pod &lt;name&gt;</code> Pod <code>CrashLoopBackOff</code> \u5bb9\u5668\u6301\u7e8c\u5d29\u6f70 <code>kubectl logs &lt;pod&gt; --previous</code> Service \u7121\u6cd5\u5b58\u53d6 Endpoint \u672a\u7d81\u5b9a <code>kubectl get endpoints</code>"},{"location":"lab18_rbac_event_log/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u5982\u4f55\u67e5\u770b\u7279\u5b9a Pod \u7684\u4e8b\u4ef6\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 <code>kubectl describe pod</code> \u6703\u5728\u5e95\u90e8\u986f\u793a\u76f8\u95dc\u4e8b\u4ef6\uff1a</p> <pre><code>kubectl describe pod log1\n</code></pre> Q2\uff1aPod \u91cd\u555f\u5f8c\u65e5\u8a8c\u6d88\u5931\u4e86\u600e\u9ebc\u8fa6\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 <code>--previous</code> \u53c3\u6578\u67e5\u770b\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\uff1a</p> <pre><code>kubectl logs pod/log1 --previous\n</code></pre> Q3\uff1a\u5982\u4f55\u5c07\u65e5\u8a8c\u5c0e\u51fa\u5230\u6a94\u6848\uff1f <p>\u89e3\u7b54\uff1a\u4f7f\u7528 shell \u91cd\u5c0e\u5411\uff1a</p> <pre><code>kubectl logs pod/log1 &gt; pod-log.txt\n</code></pre>"},{"location":"lab18_rbac_event_log/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 RBAC \u6982\u5ff5\uff1aRole-Based Access Control \u63a7\u5236\u8cc7\u6e90\u5b58\u53d6\u6b0a\u9650</li> <li>\u2705 \u56db\u7a2e RBAC \u8cc7\u6e90\uff1aRole\u3001RoleBinding\uff08Namespace \u5c64\u7d1a\uff09\u3001ClusterRole\u3001ClusterRoleBinding\uff08\u53e2\u96c6\u5c64\u7d1a\uff09</li> <li>\u2705 \u5167\u5efa ClusterRole\uff1aview\uff08\u552f\u8b80\uff09\u3001edit\uff08\u8b80\u5beb\uff09\u3001admin\uff08\u7ba1\u7406\uff09\u3001cluster-admin\uff08\u8d85\u7d1a\u7ba1\u7406\u54e1\uff09</li> <li>\u2705 Event \u76e3\u63a7\uff1a<code>kubectl get events</code> \u67e5\u770b\u53e2\u96c6\u4e8b\u4ef6</li> <li>\u2705 Log \u67e5\u770b\uff1a<code>kubectl logs</code> \u67e5\u770b\u5bb9\u5668\u8f38\u51fa\uff0c\u652f\u63f4 <code>-f</code>\u3001<code>--tail</code>\u3001<code>--since</code> \u7b49\u53c3\u6578</li> </ul>"},{"location":"lab18_rbac_event_log/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes RBAC</li> <li>Using RBAC Authorization</li> <li>Kubectl Logs</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/","title":"LAB 19 Kubernetes + wordpress + mysql","text":""},{"location":"lab19_k8s_wordpress_mysql/#lab-19-kubernetes-wordpress-mysql","title":"LAB 19 Kubernetes + WordPress + MySQL \u90e8\u7f72","text":""},{"location":"lab19_k8s_wordpress_mysql/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u8a2d\u5b9a NFS Server \u63d0\u4f9b\u5171\u4eab\u5132\u5b58</li> <li> \u8a2d\u5b9a Worker Node \u958b\u6a5f\u81ea\u52d5\u639b\u8f09 NFS</li> <li> \u5efa\u7acb ConfigMap \u548c Secret</li> <li> \u5efa\u7acb PV/PVC \u6301\u4e45\u5316\u5132\u5b58</li> <li> \u90e8\u7f72 MySQL \u8cc7\u6599\u5eab\u548c WordPress</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 16 PV/PVC</li> <li>\u5b8c\u6210 LAB 17 Secret</li> <li>\u719f\u6089 Service\u3001Deployment \u57fa\u672c\u6982\u5ff5</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab19_k8s_wordpress_mysql/#_4","title":"\u6574\u9ad4\u67b6\u69cb","text":"<pre><code>graph TB\n    subgraph master[\"k8s-master1 NFS Server\"]\n        NFS[\"NFS \u670d\u52d9\"]\n        Data[\"/data\"]\n    end\n\n    subgraph cluster[\"Kubernetes Cluster\"]\n        subgraph wp[\"WordPress\"]\n            WP[\"WordPress Pod\"]\n            WP-SVC[\"WordPress Service\"]\n        end\n\n        subgraph db[\"MySQL\"]\n            MySQL[\"MySQL Pod\"]\n            MySQL-SVC[\"MySQL Service\"]\n        end\n\n        PV1[\"local-pv-1\"]\n        PV2[\"local-pv-2\"]\n    end\n\n    User[\"\u4f7f\u7528\u8005\"] --&gt; WP-SVC\n    WP-SVC --&gt; WP\n    WP --&gt; MySQL-SVC\n    MySQL-SVC --&gt; MySQL\n    PV1 -.-&gt; NFS\n    PV2 -.-&gt; NFS</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u6240\u6709\u64cd\u4f5c\u90fd\u5728 k8s-master1 \u4e0a\u57f7\u884c\uff0c\u4e0d\u9700\u8981\u5207\u63db\u5230\u5176\u4ed6\u865b\u64ec\u6a5f\u7684 Console\u3002</p>"},{"location":"lab19_k8s_wordpress_mysql/#1-kubernetes","title":"\u6b65\u9a5f 1\uff1a\u78ba\u8a8d Kubernetes \u74b0\u5883\u6b63\u5e38","text":"\u6aa2\u67e5\u7bc0\u9ede\u72c0\u614b<pre><code>kubectl get nodes\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                       STATUS   ROLES           AGE   VERSION\nk8s-master1.training.lab   Ready    control-plane   22h   v1.32.11\nk8s-node1.training.lab     Ready    &lt;none&gt;          22h   v1.32.11\nk8s-node2.training.lab     Ready    &lt;none&gt;          22h   v1.32.11\n</code></pre> <p>\u7bc0\u9ede\u5fc5\u9808 Ready</p> <p>\u78ba\u4fdd\u6240\u6709\u7bc0\u9ede\u90fd\u662f <code>Ready</code> \u72c0\u614b\u518d\u7e7c\u7e8c\u3002</p>"},{"location":"lab19_k8s_wordpress_mysql/#2-nfs","title":"\u6b65\u9a5f 2\uff1a\u5efa\u7acb NFS \u5171\u4eab\u76ee\u9304","text":"<p>\u5728 Master \u5efa\u7acb\u8cc7\u6599\u76ee\u9304\uff1a</p> \u5728 k8s-master1 \u5efa\u7acb\u76ee\u9304<pre><code>mkdir -p /data/db\nmkdir -p /data/wordpress\n</code></pre> <p>\u5728 Worker Node \u5efa\u7acb\u639b\u8f09\u9ede\uff1a</p> \u900f\u904e SSH \u5728 Worker Node \u5efa\u7acb\u76ee\u9304<pre><code>sshpass -p container ssh -p 22 root@k8s-node1 \"mkdir -p /data\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"mkdir -p /data\"\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#3-nfs","title":"\u6b65\u9a5f 3\uff1a\u5b89\u88dd NFS \u5957\u4ef6","text":"<p>\u5728 k8s-master1\uff08NFS Server\uff09\u5b89\u88dd\uff1a</p> \u5b89\u88dd NFS Server<pre><code>yum install nfs-utils -y\n</code></pre> <p>\u5728 Worker Node\uff08NFS Client\uff09\u5b89\u88dd\uff1a</p> \u900f\u904e SSH \u5b89\u88dd NFS Client<pre><code>sshpass -p container ssh -p 22 root@k8s-node1 \"yum install nfs-utils -y\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"yum install nfs-utils -y\"\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#4-nfs-server","title":"\u6b65\u9a5f 4\uff1a\u8a2d\u5b9a NFS Server","text":"<p>\u7de8\u8f2f /etc/exports\uff1a</p> \u7de8\u8f2f NFS \u532f\u51fa\u8a2d\u5b9a<pre><code>vi /etc/exports\n</code></pre> <p>\u52a0\u5165\u4ee5\u4e0b\u5167\u5bb9\uff1a</p> /etc/exports<pre><code>/data *(rw,no_root_squash)\n</code></pre> <p>\u555f\u52d5\u4e26\u555f\u7528 NFS \u670d\u52d9\uff1a</p> \u555f\u52d5 NFS Server<pre><code>systemctl start nfs-server.service\nsystemctl enable nfs-server.service\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Created symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service \u2192 /usr/lib/systemd/system/nfs-server.service.\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#5-nfs","title":"\u6b65\u9a5f 5\uff1a\u639b\u8f09 NFS \u4e26\u9a57\u8b49","text":"<p>\u5728 Worker Node \u639b\u8f09 NFS\uff1a</p> \u639b\u8f09 NFS<pre><code>sshpass -p container ssh -p 22 root@k8s-node1 \"mount -t nfs k8s-master1:/data /data\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"mount -t nfs k8s-master1:/data /data\"\n</code></pre> <p>\u4e3b\u6a5f\u540d\u7a31\u5f88\u91cd\u8981</p> <p>\u5fc5\u9808\u4f7f\u7528 <code>k8s-master1:/data</code>\uff0c\u4f7f\u7528 <code>master:/data</code> \u6703\u5361\u4f4f\u7121\u56de\u61c9\uff01</p> <p>\u9a57\u8b49\u639b\u8f09\u6210\u529f\uff1a</p> \u9a57\u8b49 NFS \u639b\u8f09<pre><code>sshpass -p container ssh -p 22 root@k8s-node1 \"df -Th | grep nfs\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"df -Th | grep nfs\"\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>k8s-master1:/data   nfs4       70G  8.0G   62G  12% /data\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#6","title":"\u6b65\u9a5f 6\uff1a\u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u639b\u8f09","text":"<p>\u4fee\u6539 fstab \u4e26\u8907\u88fd\u5230 Worker Node\uff1a</p> \u5efa\u7acb\u4fee\u6539\u5f8c\u7684 fstab<pre><code>cp /etc/fstab /tmp/fstab\necho \"k8s-master1:/data /data nfs defaults 0 0\" &gt;&gt; /tmp/fstab\n</code></pre> <p>\u67e5\u770b\u4fee\u6539\u5167\u5bb9\uff1a</p> \u78ba\u8a8d fstab \u5167\u5bb9<pre><code>cat /tmp/fstab\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff08\u6700\u5f8c\u4e00\u884c\uff09\uff1a</p> <pre><code>k8s-master1:/data /data nfs defaults 0 0\n</code></pre> <p>\u8907\u88fd\u5230 Worker Node\uff1a</p> \u8907\u88fd fstab \u5230 Worker Node<pre><code>sshpass -p container scp /tmp/fstab root@k8s-node1:/etc/fstab\nsshpass -p container scp /tmp/fstab root@k8s-node2:/etc/fstab\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#7-configmap","title":"\u6b65\u9a5f 7\uff1a\u5efa\u7acb ConfigMap","text":"\u5efa\u7acb ConfigMap<pre><code>kubectl create configmap mydb-env \\\n  --from-literal=MYSQL_ROOT_PASSWORD=container \\\n  --from-literal=TZ=\"Asia/Taipei\"\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u67e5\u770b ConfigMap<pre><code>kubectl get configmaps\nkubectl describe configmaps mydb-env\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Data\n====\nMYSQL_ROOT_PASSWORD:\n----\ncontainer\n\nTZ:\n----\nAsia/Taipei\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#8-secret","title":"\u6b65\u9a5f 8\uff1a\u5efa\u7acb Secret","text":"\u5efa\u7acb Secret<pre><code>kubectl create secret generic mysql-pass \\\n  --from-literal=password=container\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u67e5\u770b Secret<pre><code>kubectl get secrets\nkubectl describe secrets mysql-pass\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Data\n====\npassword:  9 bytes\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#9-pv","title":"\u6b65\u9a5f 9\uff1a\u5efa\u7acb PV","text":"\u5efa\u7acb PV<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/volumes.yaml\nkubectl get pv\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   AGE\nlocal-pv-1   20Gi       RWO            Retain           Available                          8s\nlocal-pv-2   20Gi       RWO            Retain           Available                          8s\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#10-mysql","title":"\u6b65\u9a5f 10\uff1a\u90e8\u7f72 MySQL","text":"\u90e8\u7f72 MySQL<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/mysql-deployment.yaml\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u67e5\u770b MySQL \u8cc7\u6e90<pre><code>kubectl get services\nkubectl get deployments.apps\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nwordpress-mysql   ClusterIP   None         &lt;none&gt;        3306/TCP   13s\n\nNAME              READY   UP-TO-DATE   AVAILABLE   AGE\nwordpress-mysql   1/1     1            1           28s\n\nNAME                               READY   STATUS    RESTARTS   AGE\nwordpress-mysql-57444c5587-kkwq4   1/1     Running   0          36s\n</code></pre> <p>Headless Service</p> <p><code>wordpress-mysql</code> Service \u7684 ClusterIP \u662f <code>None</code>\uff0c\u9019\u662f Headless Service\uff0cWordPress \u6703\u900f\u904e DNS \u540d\u7a31\u76f4\u63a5\u9023\u63a5 MySQL Pod\u3002</p>"},{"location":"lab19_k8s_wordpress_mysql/#11-wordpress","title":"\u6b65\u9a5f 11\uff1a\u90e8\u7f72 WordPress","text":"\u90e8\u7f72 WordPress<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/wordpress-deployment.yaml\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u67e5\u770b WordPress \u8cc7\u6e90<pre><code>kubectl get deployments.apps\nkubectl get services\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME              READY   UP-TO-DATE   AVAILABLE   AGE\nwordpress         1/1     1            1           14s\nwordpress-mysql   1/1     1            1           101s\n\nNAME              TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nwordpress         LoadBalancer   172.30.184.40   &lt;pending&gt;     80:31294/TCP   23s\nwordpress-mysql   ClusterIP      None            &lt;none&gt;        3306/TCP       110s\n</code></pre> <p>LoadBalancer \u985e\u578b</p> <p>WordPress Service \u662f <code>LoadBalancer</code> \u985e\u578b\uff0c\u5728\u672c\u5730\u74b0\u5883 EXTERNAL-IP \u6703\u986f\u793a <code>&lt;pending&gt;</code>\uff0c\u4f46\u53ef\u4ee5\u900f\u904e NodePort\uff08\u5982 31294\uff09\u6216 ClusterIP \u5b58\u53d6\u3002</p>"},{"location":"lab19_k8s_wordpress_mysql/#12-wordpress","title":"\u6b65\u9a5f 12\uff1a\u521d\u59cb\u5316 WordPress","text":"<p>\u4f7f\u7528\u700f\u89bd\u5668\u958b\u555f WordPress\uff08\u4f7f\u7528 ClusterIP\uff09\uff1a</p> \u958b\u555f WordPress<pre><code>firefox http://172.30.184.40\n</code></pre> <p>\u6216\u4f7f\u7528 Node IP + NodePort\uff1a</p> \u4f7f\u7528 NodePort \u5b58\u53d6<pre><code>firefox http://k8s-node1:31294\nfirefox http://k8s-node2:31294\n</code></pre> <p>WordPress \u5b89\u88dd\u9801\u9762</p> <p>\u5982\u679c\u770b\u5230 WordPress \u5b89\u88dd\u9801\u9762\uff08\u8a9e\u8a00\u9078\u64c7\uff09\uff0c\u8868\u793a\u90e8\u7f72\u6210\u529f\uff01\u9078\u64c7\u8a9e\u8a00\u5f8c\u4f9d\u7167\u756b\u9762\u6307\u793a\u5b8c\u6210\u8a2d\u5b9a\u3002</p> <p>WordPress \u5b89\u88dd\u6210\u529f\u756b\u9762\uff1a</p> <p></p>"},{"location":"lab19_k8s_wordpress_mysql/#_5","title":"\u8cc7\u6e90\u7e3d\u89bd","text":"\u67e5\u770b\u6240\u6709\u8cc7\u6e90<pre><code>kubectl get all\nkubectl get pv,pvc\nkubectl get configmaps,secrets\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#_6","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u6e05\u7406\u6240\u6709\u8cc7\u6e90<pre><code>kubectl delete -f http://10.0.1.249/k8s/yaml/wordpress-deployment.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/mysql-deployment.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/volumes.yaml\nkubectl delete secret mysql-pass\nkubectl delete configmap mydb-env\n</code></pre>"},{"location":"lab19_k8s_wordpress_mysql/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aNFS \u639b\u8f09\u5361\u4f4f\u7121\u56de\u61c9\uff1f <p>\u539f\u56e0\uff1a\u4f7f\u7528\u4e86\u932f\u8aa4\u7684\u4e3b\u6a5f\u540d\u7a31\u3002</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a\u4f7f\u7528\u5b8c\u6574\u4e3b\u6a5f\u540d\u7a31 <code>k8s-master1:/data</code>\uff0c\u4e0d\u8981\u7528\u7c21\u5beb <code>master:/data</code>\u3002</p> Q2\uff1aWordPress \u7121\u6cd5\u9023\u63a5 MySQL\uff1f <p>\u6aa2\u67e5\u9805\u76ee\uff1a</p> <ol> <li>MySQL Pod \u662f\u5426 Running\uff1a<code>kubectl get pods -l app=wordpress</code></li> <li>Secret \u662f\u5426\u5b58\u5728\uff1a<code>kubectl get secret mysql-pass</code></li> <li>\u67e5\u770b WordPress \u65e5\u8a8c\uff1a<code>kubectl logs -l app=wordpress,tier=frontend</code></li> </ol> Q3\uff1aPVC \u8655\u65bc Pending \u72c0\u614b\uff1f <p>\u539f\u56e0\uff1a\u627e\u4e0d\u5230\u7b26\u5408\u689d\u4ef6\u7684 PV\u3002</p> <p>\u6aa2\u67e5\uff1a\u78ba\u8a8d PV \u5df2\u5efa\u7acb\u4e14\u72c0\u614b\u662f Available\u3002</p>"},{"location":"lab19_k8s_wordpress_mysql/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 NFS Server \u8a2d\u5b9a\uff1a<code>/data *(rw,no_root_squash)</code></li> <li>\u2705 NFS Client \u639b\u8f09\uff1a\u4f7f\u7528 <code>k8s-master1:/data</code>\uff08\u4e0d\u662f <code>master:/data</code>\uff09</li> <li>\u2705 fstab \u81ea\u52d5\u639b\u8f09\uff1a\u900f\u904e scp \u8907\u88fd\u5230 Worker Node</li> <li>\u2705 ConfigMap\uff1a\u5132\u5b58 MySQL \u74b0\u5883\u8b8a\u6578</li> <li>\u2705 Secret\uff1a\u5132\u5b58 MySQL \u5bc6\u78bc</li> <li>\u2705 PV/PVC\uff1aNFS \u6301\u4e45\u5316\u5132\u5b58</li> <li>\u2705 Headless Service\uff1aMySQL \u4f7f\u7528 <code>clusterIP: None</code></li> <li>\u2705 LoadBalancer Service\uff1aWordPress \u5c0d\u5916\u66b4\u9732</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/#_9","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes WordPress + MySQL Example</li> <li>NFS Persistent Volumes</li> </ul>"},{"location":"lab20_dashboard/","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#lab-20-kubernetes-dashboard","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u90e8\u7f72 Kubernetes Dashboard</li> <li> \u4f7f\u7528 kubectl proxy \u9023\u63a5 Dashboard</li> <li> \u5efa\u7acb ServiceAccount \u4e26\u53d6\u5f97\u767b\u5165 Token</li> <li> \u900f\u904e Dashboard \u7ba1\u7406 Kubernetes \u8cc7\u6e90</li> </ul>"},{"location":"lab20_dashboard/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 19 WordPress + MySQL \u90e8\u7f72</li> <li>\u719f\u6089 RBAC \u57fa\u672c\u6982\u5ff5</li> <li>\u6e96\u5099\u597d Kubernetes \u53e2\u96c6\u74b0\u5883\uff08k8s-master1\uff09</li> </ul>"},{"location":"lab20_dashboard/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab20_dashboard/#kubernetes-dashboard","title":"Kubernetes Dashboard \u662f\u4ec0\u9ebc\uff1f","text":"<p>Kubernetes Dashboard \u662f Kubernetes \u5b98\u65b9\u63d0\u4f9b\u7684**\u7db2\u9801\u5f0f\u7ba1\u7406\u4ecb\u9762**\uff0c\u8b93\u4f60\u53ef\u4ee5\u900f\u904e\u5716\u5f62\u5316\u754c\u9762\u7ba1\u7406\u53e2\u96c6\u4e2d\u7684\u8cc7\u6e90\uff0c\u800c\u4e0d\u9700\u8981\u8a18\u61b6\u5927\u91cf\u7684 kubectl \u6307\u4ee4\u3002</p> <pre><code>graph LR\n    subgraph browser[\"\u700f\u89bd\u5668\"]\n        User[\"\u4f7f\u7528\u8005\"]\n    end\n\n    subgraph master[\"k8s-master1\"]\n        Proxy[\"kubectl proxy\"]\n        Dashboard[\"Dashboard Pod\"]\n        API[\"API Server\"]\n    end\n\n    User --&gt; Proxy\n    Proxy --&gt; API\n    API --&gt; Dashboard</code></pre>"},{"location":"lab20_dashboard/#dashboard","title":"Dashboard \u529f\u80fd","text":"\u529f\u80fd \u8aaa\u660e \u8cc7\u6e90\u6aa2\u8996 \u67e5\u770b Pods\u3001Deployments\u3001Services \u7b49\u8cc7\u6e90\u72c0\u614b \u8cc7\u6e90\u5efa\u7acb \u900f\u904e YAML \u6216\u8868\u55ae\u5efa\u7acb\u65b0\u8cc7\u6e90 \u65e5\u8a8c\u67e5\u770b \u5373\u6642\u67e5\u770b Pod \u7684\u5bb9\u5668\u65e5\u8a8c Shell \u9023\u7dda \u76f4\u63a5\u5728\u700f\u89bd\u5668\u4e2d\u958b\u555f\u5bb9\u5668\u7684 Shell \u8cc7\u6e90\u7de8\u8f2f \u7de8\u8f2f\u73fe\u6709\u8cc7\u6e90\u7684 YAML \u8a2d\u5b9a"},{"location":"lab20_dashboard/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u6240\u6709\u64cd\u4f5c\u90fd\u5728 k8s-master1 \u7684**\u5716\u5f62\u74b0\u5883**\u4e0b\u57f7\u884c\uff0c\u9700\u8981\u958b\u555f gnome-terminal\u3002</p>"},{"location":"lab20_dashboard/#1","title":"\u6b65\u9a5f 1\uff1a\u6e05\u9664\u73fe\u6709\u8cc7\u6e90","text":"<p>\u5728\u958b\u59cb\u524d\uff0c\u5148\u6e05\u9664\u4e4b\u524d Lab \u5efa\u7acb\u7684\u8cc7\u6e90\uff1a</p> \u6e05\u9664\u8cc7\u6e90<pre><code>kubectl delete all --all\nkubectl delete pvc --all\nkubectl delete pv --all\nkubectl delete secrets mysql-pass\nkubectl delete configmap mysql-config\n</code></pre>"},{"location":"lab20_dashboard/#2-kubernetes-dashboard","title":"\u6b65\u9a5f 2\uff1a\u90e8\u7f72 Kubernetes Dashboard","text":"<p>Dashboard \u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684 YAML \u6a94\u90e8\u7f72\uff1a</p> <p>YAML \u4f86\u6e90</p> <p>\u5b98\u65b9 YAML\uff1a<code>https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml</code></p> <p>\u672c\u8ab2\u7a0b\u4f7f\u7528\u8b1b\u5e2b\u63d0\u4f9b\u7684\u7248\u672c\uff1a<code>http://10.0.1.249/k8s/yaml/recommended.yaml</code></p> \u90e8\u7f72 Dashboard<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/recommended.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>namespace/kubernetes-dashboard created\nserviceaccount/kubernetes-dashboard created\nservice/kubernetes-dashboard created\nsecret/kubernetes-dashboard-certs created\nsecret/kubernetes-dashboard-csrf created\nsecret/kubernetes-dashboard-key-holder created\nconfigmap/kubernetes-dashboard-settings created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\ndeployment.apps/kubernetes-dashboard created\nservice/dashboard-metrics-scraper created\ndeployment.apps/dashboard-metrics-scraper created\n</code></pre> <p>\u9a57\u8b49\u90e8\u7f72\u72c0\u614b\uff1a</p> \u6aa2\u67e5 Dashboard Pod<pre><code>kubectl get pods -n kubernetes-dashboard\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME                                         READY   STATUS    RESTARTS   AGE\ndashboard-metrics-scraper-5cb4f4bb9c-xxxxx   1/1     Running   0          30s\nkubernetes-dashboard-6967859bff-xxxxx        1/1     Running   0          30s\n</code></pre>"},{"location":"lab20_dashboard/#3","title":"\u6b65\u9a5f 3\uff1a\u5efa\u7acb\u7ba1\u7406\u54e1\u5e33\u865f","text":"<p>Dashboard \u9810\u8a2d\u7684 ServiceAccount \u6b0a\u9650\u6709\u9650\uff0c\u6211\u5011\u9700\u8981\u5efa\u7acb\u4e00\u500b\u64c1\u6709\u7ba1\u7406\u54e1\u6b0a\u9650\u7684\u5e33\u865f\uff1a</p> \u5efa\u7acb admin-user<pre><code>kubectl apply -f http://10.0.1.249/k8s/yaml/KubernetesDashboard.yaml\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>serviceaccount/admin-user created\nclusterrolebinding.rbac.authorization.k8s.io/admin-user created\n</code></pre> <p>\u6ce8\u610f\u6a94\u540d\u5927\u5c0f\u5beb</p> <p>\u6a94\u540d\u662f <code>KubernetesDashboard.yaml</code>\uff08K \u548c D \u5927\u5beb\uff09\uff0c\u4e0d\u662f <code>kubernetesDashboard.yaml</code>\uff01</p> <p>\u9019\u500b YAML \u6703\u5efa\u7acb\uff1a</p> <ol> <li>ServiceAccount <code>admin-user</code>\uff1a\u5728 <code>kubernetes-dashboard</code> namespace</li> <li>ClusterRoleBinding\uff1a\u5c07 <code>cluster-admin</code> \u89d2\u8272\u7d81\u5b9a\u7d66 <code>admin-user</code></li> </ol>"},{"location":"lab20_dashboard/#4-kubectl-proxy","title":"\u6b65\u9a5f 4\uff1a\u555f\u52d5 kubectl proxy","text":"<p>\u5728\u5716\u5f62\u74b0\u5883\u4e2d\u958b\u555f gnome-terminal\uff0c\u57f7\u884c kubectl proxy\uff1a</p> \u555f\u52d5 Proxy\uff08\u4fdd\u6301\u6b64\u8996\u7a97\u958b\u555f\uff09<pre><code>kubectl proxy\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Starting to serve on 127.0.0.1:8001\n</code></pre> <p></p> <p>\u91cd\u8981\uff1a\u4e0d\u8981\u95dc\u9589\u9019\u500b\u8996\u7a97\uff01</p> <p><code>kubectl proxy</code> \u9700\u8981\u6301\u7e8c\u57f7\u884c\uff0c\u95dc\u9589\u8996\u7a97\u6703\u4e2d\u65b7\u8207 Dashboard \u7684\u9023\u7dda\u3002</p>"},{"location":"lab20_dashboard/#5-dashboard","title":"\u6b65\u9a5f 5\uff1a\u958b\u555f Dashboard \u7db2\u9801","text":"<p>\u5728\u5716\u5f62\u74b0\u5883\u4e2d\u958b\u555f\u700f\u89bd\u5668\uff08Firefox\uff09\uff0c\u9023\u7dda\u5230 Dashboard\uff1a</p> <p>Dashboard URL\uff1a</p> <pre><code>http://127.0.0.1:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login\n</code></pre> <p>\u958b\u555f\u65b0\u5206\u9801</p> <p>\u5728 gnome-terminal \u6309 <code>Ctrl+Shift+T</code> \u958b\u555f\u65b0\u5206\u9801\uff0c\u6216\u958b\u555f\u65b0\u8996\u7a97\u3002</p> <p>\u4f60\u6703\u770b\u5230 Dashboard \u767b\u5165\u9801\u9762\uff1a</p> <p></p>"},{"location":"lab20_dashboard/#6-token","title":"\u6b65\u9a5f 6\uff1a\u53d6\u5f97\u767b\u5165 Token","text":"<p>\u5728**\u53e6\u4e00\u500b\u7d42\u7aef\u6a5f\u8996\u7a97**\uff08\u65b0\u5206\u9801\uff09\u57f7\u884c\uff1a</p> \u7522\u751f Token<pre><code>kubectl create token admin-user -n kubernetes-dashboard\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6Ik5na0NBUnl2Z1o4dU1uZmJqcER5ZnVjdDZa...\n</code></pre> <p>Token \u6709\u6548\u671f\u9650</p> <p>\u9810\u8a2d Token \u6709\u6548\u671f\u9650\u70ba 1 \u5c0f\u6642\u3002\u5982\u9700\u66f4\u9577\u6642\u9593\uff0c\u53ef\u4f7f\u7528 <code>--duration</code> \u53c3\u6578\uff1a </p><pre><code>kubectl create token admin-user -n kubernetes-dashboard --duration=24h\n</code></pre><p></p>"},{"location":"lab20_dashboard/#7-dashboard","title":"\u6b65\u9a5f 7\uff1a\u767b\u5165 Dashboard","text":"<ol> <li>\u5728\u767b\u5165\u9801\u9762\u9078\u64c7 Token \u9078\u9805</li> <li>\u5c07\u4e0a\u4e00\u6b65\u7522\u751f\u7684 Token \u8907\u88fd\u8cbc\u4e0a</li> <li>\u9ede\u9078 Sign in</li> </ol>"},{"location":"lab20_dashboard/#8-dashboard","title":"\u6b65\u9a5f 8\uff1a\u4f7f\u7528 Dashboard \u7ba1\u7406\u8cc7\u6e90","text":"<p>\u767b\u5165\u6210\u529f\u5f8c\uff0c\u4f60\u53ef\u4ee5\u900f\u904e Dashboard \u9032\u884c\u5404\u7a2e\u64cd\u4f5c\uff1a</p>"},{"location":"lab20_dashboard/#deployment","title":"\u5efa\u7acb\u6e2c\u8a66 Deployment","text":"<p>\u5148\u7528 kubectl \u5efa\u7acb\u4e00\u500b\u6e2c\u8a66\u8cc7\u6e90\uff1a</p> \u5efa\u7acb\u6e2c\u8a66 Deployment<pre><code>kubectl create deployment test1 --image=docker1.training.lab:5000/httpd\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u6aa2\u67e5 Deployment<pre><code>kubectl get deployments.apps\nkubectl get pods\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>NAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   1/1     1            1           11s\n\nNAME                    READY   STATUS    RESTARTS   AGE\ntest1-dcd787f9d-pmklm   1/1     Running   0          22s\n</code></pre>"},{"location":"lab20_dashboard/#deployments","title":"\u6aa2\u8996 Deployments","text":"<p>\u5728\u5de6\u5074\u9078\u55ae\u9ede\u9078 Workloads &gt; Deployments\uff0c\u53ef\u4ee5\u770b\u5230\u525b\u5efa\u7acb\u7684 test1\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li>Name\uff1aDeployment \u540d\u7a31\uff08test1\uff09</li> <li>Namespace\uff1a\u6240\u5c6c\u547d\u540d\u7a7a\u9593\uff08default\uff09</li> <li>Pods\uff1aPod \u6578\u91cf\uff081/1 \u8868\u793a 1 \u500b\u5c31\u7dd2\uff09</li> <li>Images\uff1a\u4f7f\u7528\u7684\u6620\u50cf\u6a94\uff08docker1.training.lab:5000/httpd\uff09</li> </ul>"},{"location":"lab20_dashboard/#deployment_1","title":"\u6aa2\u8996 Deployment \u8a73\u7d30\u8cc7\u8a0a","text":"<p>\u9ede\u9078 Deployment \u540d\u7a31\u53ef\u4ee5\u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\uff1a</p> <p></p> <p>\u8a73\u7d30\u9801\u9762\u986f\u793a\uff1a</p> <ul> <li>Metadata\uff1a\u540d\u7a31\u3001\u547d\u540d\u7a7a\u9593\u3001\u5efa\u7acb\u6642\u9593\u3001UID</li> <li>Labels\uff1a\u6a19\u7c64\uff08app: test1\uff09</li> <li>Resource information\uff1a\u66f4\u65b0\u7b56\u7565\uff08RollingUpdate\uff09\u3001Selector</li> <li>Rolling update strategy\uff1a\u6efe\u52d5\u66f4\u65b0\u53c3\u6578\uff08maxSurge: 25%, maxUnavailable: 25%\uff09</li> </ul>"},{"location":"lab20_dashboard/#pods","title":"\u6aa2\u8996 Pods","text":"<p>\u5728\u5de6\u5074\u9078\u55ae\u9ede\u9078 Workloads &gt; Pods\uff1a</p> <p></p> <p>Pods \u5217\u8868\u986f\u793a\uff1a</p> <ul> <li>Name\uff1aPod \u5b8c\u6574\u540d\u7a31</li> <li>Node\uff1aPod \u904b\u884c\u7684\u7bc0\u9ede\uff08k8s-node1.training.lab\uff09</li> <li>Status\uff1a\u904b\u884c\u72c0\u614b\uff08Running\uff09</li> <li>Restarts\uff1a\u91cd\u555f\u6b21\u6578</li> <li>CPU/Memory Usage\uff1a\u8cc7\u6e90\u4f7f\u7528\u91cf</li> </ul>"},{"location":"lab20_dashboard/#pod","title":"\u6aa2\u8996 Pod \u8a73\u7d30\u8cc7\u8a0a","text":"<p>\u9ede\u9078 Pod \u540d\u7a31\u53ef\u4ee5\u67e5\u770b\u5b8c\u6574\u8a73\u7d30\u8cc7\u8a0a\uff1a</p> <p></p> <p>Pod \u8a73\u7d30\u9801\u9762\u986f\u793a\uff1a</p> <ul> <li>Metadata\uff1aPod \u540d\u7a31\u3001\u547d\u540d\u7a7a\u9593\u3001\u5efa\u7acb\u6642\u9593\u3001UID\u3001Labels</li> <li>Resource information\uff1a\u904b\u884c\u7bc0\u9ede\u3001IP\uff0810.128.1.5\uff09\u3001QoS Class\uff08BestEffort\uff09</li> <li>Conditions\uff1aPod \u72c0\u614b\u689d\u4ef6\uff08PodReadyToStartContainers\u3001Initialized\u3001Ready\u3001ContainersReady\uff09</li> </ul> <p>Dashboard \u529f\u80fd</p> <p>\u9664\u4e86\u6aa2\u8996\u8cc7\u6e90\uff0c\u4f60\u9084\u53ef\u4ee5\uff1a</p> <ul> <li>\ud83d\udcdd \u7de8\u8f2f YAML\uff1a\u9ede\u9078\u53f3\u4e0a\u89d2\u7684\u7de8\u8f2f\u5716\u793a</li> <li>\ud83d\udccb \u67e5\u770b\u65e5\u8a8c\uff1a\u9ede\u9078\u53f3\u4e0a\u89d2\u7684\u65e5\u8a8c\u5716\u793a</li> <li>\ud83d\udcbb \u958b\u555f Shell\uff1a\u76f4\u63a5\u5728\u700f\u89bd\u5668\u4e2d\u9023\u7dda\u5bb9\u5668</li> </ul>"},{"location":"lab20_dashboard/#_4","title":"\u8cc7\u6e90\u7e3d\u89bd","text":"<p>Dashboard \u90e8\u7f72\u5f8c\u6703\u5efa\u7acb\u4ee5\u4e0b\u8cc7\u6e90\uff1a</p> \u8cc7\u6e90\u985e\u578b \u540d\u7a31 \u8aaa\u660e Namespace kubernetes-dashboard Dashboard \u5c08\u7528\u547d\u540d\u7a7a\u9593 Deployment kubernetes-dashboard Dashboard \u4e3b\u7a0b\u5f0f Deployment dashboard-metrics-scraper \u6307\u6a19\u6536\u96c6\u5668 Service kubernetes-dashboard Dashboard \u670d\u52d9 ServiceAccount admin-user \u7ba1\u7406\u54e1\u5e33\u865f ClusterRoleBinding admin-user \u7d81\u5b9a cluster-admin \u6b0a\u9650"},{"location":"lab20_dashboard/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aDashboard \u9801\u9762\u986f\u793a\u7a7a\u767d\u6216 403 \u932f\u8aa4 <p>\u539f\u56e0\uff1aToken \u904e\u671f\u6216\u6b0a\u9650\u4e0d\u8db3</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u91cd\u65b0\u7522\u751f Token\nkubectl create token admin-user -n kubernetes-dashboard\n</code></pre><p></p> Q2\uff1a\u7121\u6cd5\u9023\u7dda\u5230 Dashboard <p>\u539f\u56e0\uff1akubectl proxy \u6c92\u6709\u57f7\u884c</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d kubectl proxy \u8996\u7a97\u662f\u5426\u958b\u555f 2. \u91cd\u65b0\u57f7\u884c <code>kubectl proxy</code></p> Q3\uff1aDashboard Pod \u4e00\u76f4\u8655\u65bc Pending <p>\u539f\u56e0\uff1a\u8cc7\u6e90\u4e0d\u8db3\u6216 Node \u6c92\u6709 Ready</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code>kubectl get nodes\nkubectl describe pod -n kubernetes-dashboard\n</code></pre><p></p>"},{"location":"lab20_dashboard/#_6","title":"\u6e05\u7406\u8cc7\u6e90","text":"<p>\u5b8c\u6210\u7df4\u7fd2\u5f8c\uff0c\u53ef\u4ee5\u6e05\u7406 Dashboard \u76f8\u95dc\u8cc7\u6e90\uff1a</p> \u6e05\u7406 Dashboard<pre><code>kubectl delete -f http://10.0.1.249/k8s/yaml/KubernetesDashboard.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/recommended.yaml\nkubectl delete deployment test1\n</code></pre>"},{"location":"lab20_dashboard/#_7","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Dashboard \u90e8\u7f72\uff1a\u4f7f\u7528\u5b98\u65b9 recommended.yaml \u90e8\u7f72</li> <li>\u2705 kubectl proxy\uff1a\u5efa\u7acb\u672c\u5730\u4ee3\u7406\u9023\u7dda\u5230 API Server</li> <li>\u2705 Token \u8a8d\u8b49\uff1a\u4f7f\u7528 <code>kubectl create token</code> \u7522\u751f\u767b\u5165\u6191\u8b49</li> <li>\u2705 \u5716\u5f62\u5316\u7ba1\u7406\uff1a\u900f\u904e\u7db2\u9801\u4ecb\u9762\u7ba1\u7406 Kubernetes \u8cc7\u6e90</li> </ul>"},{"location":"lab20_dashboard/#_8","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes Dashboard \u5b98\u65b9\u6587\u4ef6</li> <li>Dashboard GitHub</li> <li>Dashboard \u8a8d\u8b49\u65b9\u5f0f</li> </ul>"},{"location":"lab21_registry_web/","title":"LAB 21 \u79c1\u5eab\u5716\u5f62\u7ba1\u7406\u5de5\u5177 docker-registry-web","text":""},{"location":"lab21_registry_web/#lab-21-docker-registry-web","title":"LAB 21 \u79c1\u5eab\u5716\u5f62\u7ba1\u7406\u5de5\u5177 docker-registry-web","text":""},{"location":"lab21_registry_web/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u90e8\u7f72 docker-registry-web \u5716\u5f62\u4ecb\u9762</li> <li> \u900f\u904e\u7db2\u9801\u7ba1\u7406 Private Registry</li> <li> \u67e5\u770b\u6620\u50cf\u6a94\u6e05\u55ae\u8207\u6a19\u7c64</li> </ul>"},{"location":"lab21_registry_web/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210 LAB 05 Private Registry \u5efa\u7f6e</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u6e96\u5099\u597d docker1 \u865b\u64ec\u6a5f\u74b0\u5883</li> </ul>"},{"location":"lab21_registry_web/#_3","title":"\u6838\u5fc3\u6982\u5ff5\u8aaa\u660e","text":""},{"location":"lab21_registry_web/#docker-registry-web","title":"docker-registry-web \u662f\u4ec0\u9ebc\uff1f","text":"<p>docker-registry-web \u662f\u4e00\u500b\u958b\u6e90\u7684 Web UI \u5de5\u5177\uff0c\u8b93\u4f60\u53ef\u4ee5\u900f\u904e\u700f\u89bd\u5668\u7ba1\u7406 Private Registry\uff1a</p> <ul> <li>\u67e5\u770b Registry \u4e2d\u7684\u6240\u6709\u6620\u50cf\u6a94\uff08Repositories\uff09</li> <li>\u700f\u89bd\u6620\u50cf\u6a94\u7684\u6a19\u7c64\uff08Tags\uff09</li> <li>\u67e5\u770b\u6620\u50cf\u6a94\u7684\u8a73\u7d30\u8cc7\u8a0a</li> </ul> <p>\u5b98\u65b9\u6587\u4ef6</p> <p>Docker Hub: https://hub.docker.com/r/hyper/docker-registry-web</p>"},{"location":"lab21_registry_web/#_4","title":"\u67b6\u69cb\u8aaa\u660e","text":"<pre><code>graph LR\n    subgraph docker1[\"docker1 \u865b\u64ec\u6a5f\"]\n        Registry[\"registry-srv\"]\n        Web[\"registry-web-1\"]\n    end\n\n    Browser[\"\u700f\u89bd\u5668\"] --&gt; Web\n    Web --&gt; Registry\n    Registry --&gt; Data[\"/opt/data/registry\"]</code></pre> \u5bb9\u5668 \u8aaa\u660e Port registry-srv Private Registry \u670d\u52d9 5000 registry-web-1 Web \u7ba1\u7406\u4ecb\u9762 8080"},{"location":"lab21_registry_web/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":"<p>\u64cd\u4f5c\u74b0\u5883</p> <p>\u672c Lab \u6240\u6709\u64cd\u4f5c\u90fd\u5728 docker1 \u865b\u64ec\u6a5f\u4e0a\u57f7\u884c\u3002</p>"},{"location":"lab21_registry_web/#1","title":"\u6b65\u9a5f 1\uff1a\u6e05\u9664\u73fe\u6709\u5bb9\u5668\u8207\u6620\u50cf\u6a94","text":"<p>\u9996\u5148\u6e05\u9664 docker1 \u4e0a\u7684\u6240\u6709\u5bb9\u5668\u548c\u6620\u50cf\u6a94\uff1a</p> \u6e05\u9664\u6240\u6709\u5bb9\u5668\u548c\u6620\u50cf\u6a94<pre><code>./docker_clean_all.sh\n</code></pre> <p>\u6216\u624b\u52d5\u57f7\u884c\uff1a</p> \u624b\u52d5\u6e05\u9664<pre><code>docker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\ndocker rmi $(docker images -q)\n</code></pre>"},{"location":"lab21_registry_web/#2-private-registry","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 Private Registry","text":"<p>\u5bb9\u5668\u540d\u7a31\u6ce8\u610f\u4e8b\u9805</p> <p>\u6839\u64da\u5b98\u65b9\u6587\u4ef6\u8aaa\u660e\uff0c\u5bb9\u5668\u540d\u7a31\u4e0d\u53ef\u4ee5\u4f7f\u7528 <code>registry</code>\uff01</p> <p>\u56e0\u70ba docker-registry-web \u4f7f\u7528 <code>--link</code> \u9023\u63a5\uff0c\u5982\u679c Registry \u5bb9\u5668\u540d\u7a31\u662f <code>registry</code>\uff0c\u6703\u8207\u74b0\u5883\u8b8a\u6578\u885d\u7a81\u5c0e\u81f4\u932f\u8aa4\u3002</p> <p>\u555f\u52d5 Registry \u670d\u52d9\uff08\u4f7f\u7528 <code>registry-srv</code> \u4f5c\u70ba\u540d\u7a31\uff09\uff1a</p> \u555f\u52d5 Registry<pre><code>docker run -d \\\n  -p 5000:5000 \\\n  -v /opt/data/registry:/var/lib/registry \\\n  --restart=always \\\n  --name registry-srv \\\n  registry\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Unable to find image 'registry:latest' locally\nlatest: Pulling from library/registry\n...\nStatus: Downloaded newer image for registry:latest\n238cf2ffba02232cb0356f437f9e6dafb9d0f531827b2feea7da24a35da670eb\n</code></pre> <p>\u9a57\u8b49\uff1a</p> \u6aa2\u67e5 Registry<pre><code>docker ps\n</code></pre>"},{"location":"lab21_registry_web/#3-docker-registry-web","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 docker-registry-web","text":"<p>\u555f\u52d5 Web \u7ba1\u7406\u4ecb\u9762\uff1a</p> \u555f\u52d5 docker-registry-web<pre><code>docker run -it \\\n  -p 8080:8080 \\\n  --name registry-web-1 \\\n  --link registry-srv \\\n  -e REGISTRY_URL=http://registry-srv:5000/v2 \\\n  -e REGISTRY_NAME=localhost:5000 \\\n  hyper/docker-registry-web\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e <code>-p 8080:8080</code> \u6620\u5c04 Web \u4ecb\u9762\u5230 port 8080 <code>--link registry-srv</code> \u9023\u63a5\u5230 Registry \u5bb9\u5668 <code>REGISTRY_URL</code> Registry API \u4f4d\u5740 <code>REGISTRY_NAME</code> \u986f\u793a\u5728 Web \u4ecb\u9762\u7684 Registry \u540d\u7a31 <p>\u9810\u671f\u7d50\u679c\uff08\u7b49\u5f85 Tomcat \u555f\u52d5\uff09\uff1a</p> <pre><code>Jan 28, 2026 8:49:21 AM org.apache.coyote.AbstractProtocol start\nINFO: Starting ProtocolHandler [\"http-bio-8080\"]\nJan 28, 2026 8:49:21 AM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 12013 ms\n</code></pre> <p>\u4fdd\u6301\u6b64\u8996\u7a97\u958b\u555f</p> <p>docker-registry-web \u4f7f\u7528 <code>-it</code> \u524d\u666f\u57f7\u884c\uff0c\u95dc\u9589\u8996\u7a97\u6703\u505c\u6b62\u670d\u52d9\u3002</p> <p>\u5982\u9700\u80cc\u666f\u57f7\u884c\uff0c\u53ef\u6539\u7528 <code>-d</code> \u53c3\u6578\u3002</p>"},{"location":"lab21_registry_web/#4-web","title":"\u6b65\u9a5f 4\uff1a\u958b\u555f Web \u7ba1\u7406\u4ecb\u9762","text":"<p>\u5728\u5716\u5f62\u74b0\u5883\u4e2d\u958b\u555f\u700f\u89bd\u5668\uff0c\u9023\u7dda\u5230\uff1a</p> <pre><code>http://192.168.66.21:8080\n</code></pre> <p>\u6216\u5728 docker1 \u672c\u6a5f\uff1a</p> <pre><code>http://localhost:8080\n</code></pre> <p>\u4f60\u6703\u770b\u5230 Registry \u4e2d\u7684\u6240\u6709\u6620\u50cf\u6a94\u6e05\u55ae\uff1a</p> <p></p>"},{"location":"lab21_registry_web/#_5","title":"\u4ecb\u9762\u8aaa\u660e","text":"\u6b04\u4f4d \u8aaa\u660e Registry Registry \u540d\u7a31\uff08localhost:5000\uff09 Repository \u6620\u50cf\u6a94\u540d\u7a31 Tags \u8a72\u6620\u50cf\u6a94\u7684\u6a19\u7c64\u6578\u91cf <p>\u5f9e\u756b\u9762\u53ef\u4ee5\u770b\u5230 Registry \u4e2d\u6709\u591a\u500b\u6620\u50cf\u6a94\uff1a</p> <ul> <li>alpine (1 tag)</li> <li>httpd (1 tag)</li> <li>mariadb (1 tag)</li> <li>mysql (3 tags)</li> <li>nginx (3 tags)</li> <li>ubuntu (1 tag)</li> <li>wordpress (1 tag)</li> </ul> <p>\u9ede\u9078\u6620\u50cf\u6a94\u540d\u7a31\u53ef\u4ee5\u67e5\u770b\u8a72\u6620\u50cf\u6a94\u7684\u6240\u6709\u6a19\u7c64\u548c\u8a73\u7d30\u8cc7\u8a0a\u3002</p>"},{"location":"lab21_registry_web/#_6","title":"\u6e05\u7406\u8cc7\u6e90","text":"<p>\u5b8c\u6210\u7df4\u7fd2\u5f8c\uff0c\u53ef\u4ee5\u6e05\u7406\u76f8\u95dc\u8cc7\u6e90\uff1a</p> \u505c\u6b62\u4e26\u522a\u9664\u5bb9\u5668<pre><code>docker stop registry-web-1 registry-srv\ndocker rm registry-web-1 registry-srv\n</code></pre>"},{"location":"lab21_registry_web/#_7","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aWeb \u4ecb\u9762\u986f\u793a\u7a7a\u767d\u6216\u9023\u7dda\u932f\u8aa4 <p>\u539f\u56e0\uff1aRegistry \u5bb9\u5668\u540d\u7a31\u4f7f\u7528\u4e86 <code>registry</code></p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a \u522a\u9664\u5bb9\u5668\u5f8c\u91cd\u65b0\u5efa\u7acb\uff0c\u4f7f\u7528\u4e0d\u540c\u7684\u540d\u7a31\uff08\u5982 <code>registry-srv</code>\uff09</p> Q2\uff1a\u7121\u6cd5\u9023\u7dda\u5230 8080 \u57e0 <p>\u539f\u56e0\uff1adocker-registry-web \u5c1a\u672a\u555f\u52d5\u5b8c\u6210</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a \u7b49\u5f85 Tomcat \u555f\u52d5\u5b8c\u6210\uff08\u770b\u5230 <code>Server startup in xxxxx ms</code>\uff09</p> Q3\uff1a\u6620\u50cf\u6a94\u5217\u8868\u662f\u7a7a\u7684 <p>\u539f\u56e0\uff1aRegistry \u6c92\u6709\u6620\u50cf\u6a94\uff0c\u6216 REGISTRY_URL \u8a2d\u5b9a\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d Registry \u6709\u6620\u50cf\u6a94\uff1a<code>curl http://localhost:5000/v2/_catalog</code> 2. \u78ba\u8a8d REGISTRY_URL \u6307\u5411\u6b63\u78ba\u7684 Registry \u5bb9\u5668</p>"},{"location":"lab21_registry_web/#_8","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 docker-registry-web\uff1aPrivate Registry \u7684\u7db2\u9801\u7ba1\u7406\u4ecb\u9762</li> <li>\u2705 \u5bb9\u5668\u547d\u540d\u6ce8\u610f\uff1aRegistry \u5bb9\u5668\u540d\u7a31\u4e0d\u53ef\u4f7f\u7528 <code>registry</code></li> <li>\u2705 --link \u9023\u63a5\uff1aWeb \u5bb9\u5668\u900f\u904e Docker link \u9023\u63a5 Registry</li> <li>\u2705 \u6620\u50cf\u6a94\u7ba1\u7406\uff1a\u900f\u904e\u5716\u5f62\u4ecb\u9762\u67e5\u770b Repository \u548c Tags</li> </ul>"},{"location":"lab21_registry_web/#_9","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>docker-registry-web Docker Hub</li> <li>docker-registry-web GitHub</li> <li>Docker Registry API v2</li> </ul>"},{"location":"appendix/docker_cheatsheet/","title":"Docker \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/docker_cheatsheet/#docker","title":"Docker \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 Docker \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/docker_cheatsheet/#_1","title":"\u5bb9\u5668\u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_2","title":"\u57f7\u884c\u5bb9\u5668","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker run &lt;image&gt;</code> \u57f7\u884c\u5bb9\u5668 <code>docker run -d &lt;image&gt;</code> \u80cc\u666f\u57f7\u884c <code>docker run -it &lt;image&gt; /bin/bash</code> \u4e92\u52d5\u6a21\u5f0f <code>docker run --name &lt;name&gt; &lt;image&gt;</code> \u6307\u5b9a\u540d\u7a31 <code>docker run -p 8080:80 &lt;image&gt;</code> Port \u5c0d\u61c9 <code>docker run -v /host:/container &lt;image&gt;</code> \u639b\u8f09\u76ee\u9304 <code>docker run -e VAR=value &lt;image&gt;</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <code>docker run --rm &lt;image&gt;</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>docker run --restart=always &lt;image&gt;</code> \u81ea\u52d5\u91cd\u555f <code>docker run --network &lt;network&gt; &lt;image&gt;</code> \u6307\u5b9a\u7db2\u8def"},{"location":"appendix/docker_cheatsheet/#_3","title":"\u5bb9\u5668\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker ps</code> \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker ps -a</code> \u5217\u51fa\u6240\u6709\u5bb9\u5668 <code>docker start &lt;container&gt;</code> \u555f\u52d5\u5bb9\u5668 <code>docker stop &lt;container&gt;</code> \u505c\u6b62\u5bb9\u5668 <code>docker restart &lt;container&gt;</code> \u91cd\u555f\u5bb9\u5668 <code>docker pause &lt;container&gt;</code> \u66ab\u505c\u5bb9\u5668 <code>docker unpause &lt;container&gt;</code> \u7e7c\u7e8c\u5bb9\u5668 <code>docker rm &lt;container&gt;</code> \u522a\u9664\u5bb9\u5668 <code>docker rm -f &lt;container&gt;</code> \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker container prune</code> \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668"},{"location":"appendix/docker_cheatsheet/#_4","title":"\u5bb9\u5668\u64cd\u4f5c\u8207\u9664\u932f","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker exec -it &lt;container&gt; /bin/bash</code> \u9032\u5165\u5bb9\u5668 <code>docker exec &lt;container&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker logs &lt;container&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>docker logs -f &lt;container&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker logs --tail 100 &lt;container&gt;</code> \u6700\u5f8c 100 \u884c <code>docker inspect &lt;container&gt;</code> \u8a73\u7d30\u8cc7\u8a0a <code>docker stats</code> \u8cc7\u6e90\u4f7f\u7528\u7d71\u8a08 <code>docker top &lt;container&gt;</code> \u5bb9\u5668\u5167\u7a0b\u5e8f <code>docker cp &lt;src&gt; &lt;container&gt;:&lt;dest&gt;</code> \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668 <code>docker cp &lt;container&gt;:&lt;src&gt; &lt;dest&gt;</code> \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848"},{"location":"appendix/docker_cheatsheet/#image","title":"Image \u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_5","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker images</code> \u5217\u51fa\u672c\u5730 Image <code>docker pull &lt;image&gt;</code> \u62c9\u53d6 Image <code>docker push &lt;image&gt;</code> \u63a8\u9001 Image <code>docker rmi &lt;image&gt;</code> \u522a\u9664 Image <code>docker image prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Image <code>docker image prune -a</code> \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image"},{"location":"appendix/docker_cheatsheet/#_6","title":"\u5efa\u7f6e\u8207\u6a19\u7c64","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker build -t &lt;name&gt;:&lt;tag&gt; .</code> \u5efa\u7f6e Image <code>docker build -f Dockerfile.prod .</code> \u6307\u5b9a Dockerfile <code>docker build --no-cache .</code> \u4e0d\u4f7f\u7528\u5feb\u53d6 <code>docker tag &lt;image&gt; &lt;new-tag&gt;</code> \u52a0\u4e0a\u6a19\u7c64 <code>docker history &lt;image&gt;</code> \u67e5\u770b Image \u6b77\u53f2 <code>docker save -o image.tar &lt;image&gt;</code> \u532f\u51fa Image <code>docker load -i image.tar</code> \u532f\u5165 Image"},{"location":"appendix/docker_cheatsheet/#_7","title":"\u641c\u5c0b","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker search &lt;keyword&gt;</code> \u641c\u5c0b Docker Hub <code>docker search --filter is-official=true &lt;keyword&gt;</code> \u53ea\u641c\u5c0b\u5b98\u65b9 Image <code>docker search --limit 5 &lt;keyword&gt;</code> \u9650\u5236\u7d50\u679c\u6578\u91cf"},{"location":"appendix/docker_cheatsheet/#volume","title":"Volume \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker volume ls</code> \u5217\u51fa\u6240\u6709 Volume <code>docker volume create &lt;name&gt;</code> \u5efa\u7acb Volume <code>docker volume inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a <code>docker volume rm &lt;name&gt;</code> \u522a\u9664 Volume <code>docker volume prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume"},{"location":"appendix/docker_cheatsheet/#_8","title":"\u639b\u8f09\u65b9\u5f0f","text":"<pre><code># Volume \u639b\u8f09\ndocker run -v my-volume:/app/data nginx\n\n# Bind Mount\ndocker run -v /host/path:/container/path nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -v /host/path:/container/path:ro nginx\n\n# --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run --mount type=volume,source=my-volume,target=/app/data nginx\ndocker run --mount type=bind,source=/host/path,target=/container/path nginx\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#_9","title":"\u7db2\u8def\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker network ls</code> \u5217\u51fa\u6240\u6709\u7db2\u8def <code>docker network create &lt;name&gt;</code> \u5efa\u7acb\u7db2\u8def <code>docker network connect &lt;network&gt; &lt;container&gt;</code> \u9023\u63a5\u7db2\u8def <code>docker network disconnect &lt;network&gt; &lt;container&gt;</code> \u65b7\u958b\u7db2\u8def <code>docker network rm &lt;name&gt;</code> \u522a\u9664\u7db2\u8def <code>docker network prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684\u7db2\u8def <code>docker network inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a"},{"location":"appendix/docker_cheatsheet/#_10","title":"\u7db2\u8def\u985e\u578b","text":"\u985e\u578b \u8aaa\u660e <code>bridge</code> \u9810\u8a2d\uff0c\u5bb9\u5668\u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 <code>host</code> \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def <code>none</code> \u7121\u7db2\u8def <code>overlay</code> \u8de8\u4e3b\u6a5f\u901a\u8a0a\uff08Swarm\uff09"},{"location":"appendix/docker_cheatsheet/#_11","title":"\u7cfb\u7d71\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker info</code> \u7cfb\u7d71\u8cc7\u8a0a <code>docker version</code> \u7248\u672c\u8cc7\u8a0a <code>docker system df</code> \u78c1\u789f\u4f7f\u7528\u91cf <code>docker system prune</code> \u6e05\u7406\u672a\u4f7f\u7528\u8cc7\u6e90 <code>docker system prune -a --volumes</code> \u5b8c\u6574\u6e05\u7406 <code>docker events</code> \u5373\u6642\u4e8b\u4ef6"},{"location":"appendix/docker_cheatsheet/#docker-compose","title":"Docker Compose","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker compose up</code> \u555f\u52d5\u670d\u52d9 <code>docker compose up -d</code> \u80cc\u666f\u555f\u52d5 <code>docker compose down</code> \u505c\u6b62\u4e26\u79fb\u9664 <code>docker compose down -v</code> \u540c\u6642\u79fb\u9664 Volume <code>docker compose ps</code> \u5217\u51fa\u670d\u52d9 <code>docker compose logs</code> \u67e5\u770b\u65e5\u8a8c <code>docker compose logs -f</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker compose exec &lt;service&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker compose build</code> \u5efa\u7f6e\u670d\u52d9 <code>docker compose pull</code> \u62c9\u53d6 Image"},{"location":"appendix/docker_cheatsheet/#registry","title":"Registry \u767b\u5165","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker login</code> \u767b\u5165 Docker Hub <code>docker login &lt;registry&gt;</code> \u767b\u5165\u79c1\u6709 Registry <code>docker logout</code> \u767b\u51fa"},{"location":"appendix/docker_cheatsheet/#_12","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5e38\u7528\u64cd\u4f5c<pre><code># \u505c\u6b62\u6240\u6709\u5bb9\u5668\ndocker stop $(docker ps -q)\n\n# \u522a\u9664\u6240\u6709\u5bb9\u5668\ndocker rm $(docker ps -aq)\n\n# \u522a\u9664\u6240\u6709 Image\ndocker rmi $(docker images -q)\n\n# \u522a\u9664 dangling Image\ndocker rmi $(docker images -f \"dangling=true\" -q)\n\n# \u53d6\u5f97\u5bb9\u5668 IP\ndocker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container&gt;\n\n# \u9032\u5165\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker exec -it $(docker ps -q -f name=nginx) /bin/sh\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#dockerfile","title":"Dockerfile \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>FROM</code> \u57fa\u790e Image <code>RUN</code> \u57f7\u884c\u6307\u4ee4 <code>COPY</code> \u8907\u88fd\u6a94\u6848 <code>ADD</code> \u8907\u88fd\u6a94\u6848\uff08\u652f\u63f4 URL\u3001\u89e3\u58d3\u7e2e\uff09 <code>WORKDIR</code> \u5de5\u4f5c\u76ee\u9304 <code>ENV</code> \u74b0\u5883\u8b8a\u6578 <code>EXPOSE</code> \u66b4\u9732 Port <code>CMD</code> \u9810\u8a2d\u57f7\u884c\u6307\u4ee4 <code>ENTRYPOINT</code> \u5165\u53e3\u9ede <code>VOLUME</code> \u639b\u8f09\u9ede <code>USER</code> \u57f7\u884c\u8eab\u4efd <code>ARG</code> \u5efa\u7f6e\u53c3\u6578 <code>LABEL</code> \u6a19\u7c64 <code>HEALTHCHECK</code> \u5065\u5eb7\u6aa2\u67e5"},{"location":"appendix/docker_cheatsheet/#_13","title":"\u74b0\u5883\u8b8a\u6578","text":"\u8b8a\u6578 \u8aaa\u660e <code>DOCKER_HOST</code> Docker \u4e3b\u6a5f\u4f4d\u5740 <code>DOCKER_TLS_VERIFY</code> \u555f\u7528 TLS \u9a57\u8b49 <code>DOCKER_CERT_PATH</code> TLS \u6191\u8b49\u8def\u5f91 <code>DOCKER_CONFIG</code> \u8a2d\u5b9a\u6a94\u76ee\u9304"},{"location":"appendix/k8s_cheatsheet/","title":"Kubernetes \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/k8s_cheatsheet/#kubernetes","title":"Kubernetes \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 kubectl \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/k8s_cheatsheet/#_1","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_2","title":"\u53e2\u96c6\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl cluster-info</code> \u53e2\u96c6\u8cc7\u8a0a <code>kubectl version</code> \u7248\u672c\u8cc7\u8a0a <code>kubectl config view</code> \u67e5\u770b\u8a2d\u5b9a <code>kubectl config get-contexts</code> \u5217\u51fa Context <code>kubectl config use-context &lt;name&gt;</code> \u5207\u63db Context <code>kubectl api-resources</code> \u5217\u51fa API \u8cc7\u6e90 <code>kubectl api-versions</code> \u5217\u51fa API \u7248\u672c"},{"location":"appendix/k8s_cheatsheet/#_3","title":"\u8cc7\u6e90\u67e5\u8a62","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get &lt;resource&gt;</code> \u5217\u51fa\u8cc7\u6e90 <code>kubectl get pods</code> \u5217\u51fa Pod <code>kubectl get pods -o wide</code> \u8a73\u7d30\u8cc7\u8a0a\uff08\u542b IP\u3001Node\uff09 <code>kubectl get pods -o yaml</code> YAML \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -o json</code> JSON \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -w</code> \u6301\u7e8c\u76e3\u770b <code>kubectl get pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u904e\u6ffe <code>kubectl get pods -n &lt;namespace&gt;</code> \u6307\u5b9a Namespace <code>kubectl get pods --all-namespaces</code> \u6240\u6709 Namespace <code>kubectl get all</code> \u5217\u51fa\u5e38\u898b\u8cc7\u6e90"},{"location":"appendix/k8s_cheatsheet/#_4","title":"\u8cc7\u6e90\u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_5","title":"\u5efa\u7acb\u8207\u5957\u7528","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl apply -f &lt;file.yaml&gt;</code> \u5957\u7528\u8a2d\u5b9a <code>kubectl apply -f &lt;directory&gt;/</code> \u5957\u7528\u76ee\u9304\u4e0b\u6240\u6709\u8a2d\u5b9a <code>kubectl create -f &lt;file.yaml&gt;</code> \u5efa\u7acb\u8cc7\u6e90 <code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Deployment <code>kubectl create service clusterip &lt;name&gt; --tcp=80:80</code> \u5efa\u7acb Service <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb ConfigMap <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret"},{"location":"appendix/k8s_cheatsheet/#_6","title":"\u7de8\u8f2f\u8207\u522a\u9664","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl edit &lt;resource&gt; &lt;name&gt;</code> \u7de8\u8f2f\u8cc7\u6e90 <code>kubectl delete &lt;resource&gt; &lt;name&gt;</code> \u522a\u9664\u8cc7\u6e90 <code>kubectl delete -f &lt;file.yaml&gt;</code> \u4f9d\u8a2d\u5b9a\u6a94\u522a\u9664 <code>kubectl delete pods --all</code> \u522a\u9664\u6240\u6709 Pod <code>kubectl delete pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u522a\u9664"},{"location":"appendix/k8s_cheatsheet/#_7","title":"\u8a73\u7d30\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl describe &lt;resource&gt; &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl describe pod &lt;pod-name&gt;</code> \u63cf\u8ff0 Pod <code>kubectl describe node &lt;node-name&gt;</code> \u63cf\u8ff0 Node"},{"location":"appendix/k8s_cheatsheet/#pod","title":"Pod \u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_8","title":"\u57f7\u884c\u8207\u5b58\u53d6","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl run &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Pod <code>kubectl exec -it &lt;pod&gt; -- /bin/sh</code> \u9032\u5165 Pod <code>kubectl exec &lt;pod&gt; -- &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>kubectl logs &lt;pod&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>kubectl logs -f &lt;pod&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; -c &lt;container&gt;</code> \u591a\u5bb9\u5668\u6307\u5b9a <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; --tail=100</code> \u6700\u5f8c 100 \u884c <code>kubectl port-forward &lt;pod&gt; 8080:80</code> Port \u8f49\u767c <code>kubectl cp &lt;pod&gt;:&lt;path&gt; &lt;local-path&gt;</code> \u8907\u88fd\u6a94\u6848"},{"location":"appendix/k8s_cheatsheet/#deployment","title":"Deployment \u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_9","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get deployments</code> \u5217\u51fa Deployment <code>kubectl describe deployment &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl scale deployment &lt;name&gt; --replicas=3</code> \u8abf\u6574\u526f\u672c <code>kubectl set image deployment/&lt;name&gt; &lt;container&gt;=&lt;image&gt;</code> \u66f4\u65b0 Image"},{"location":"appendix/k8s_cheatsheet/#_10","title":"\u6efe\u52d5\u66f4\u65b0","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl rollout status deployment/&lt;name&gt;</code> \u67e5\u770b\u66f4\u65b0\u72c0\u614b <code>kubectl rollout history deployment/&lt;name&gt;</code> \u67e5\u770b\u6b77\u53f2 <code>kubectl rollout undo deployment/&lt;name&gt;</code> \u56de\u6efe <code>kubectl rollout undo deployment/&lt;name&gt; --to-revision=2</code> \u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c <code>kubectl rollout restart deployment/&lt;name&gt;</code> \u91cd\u555f <code>kubectl rollout pause deployment/&lt;name&gt;</code> \u66ab\u505c\u66f4\u65b0 <code>kubectl rollout resume deployment/&lt;name&gt;</code> \u7e7c\u7e8c\u66f4\u65b0"},{"location":"appendix/k8s_cheatsheet/#service","title":"Service \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get services</code> \u5217\u51fa Service <code>kubectl get endpoints</code> \u5217\u51fa Endpoints <code>kubectl expose deployment &lt;name&gt; --port=80</code> \u5efa\u7acb Service <code>kubectl expose deployment &lt;name&gt; --type=NodePort --port=80</code> NodePort <code>kubectl expose deployment &lt;name&gt; --type=LoadBalancer --port=80</code> LoadBalancer"},{"location":"appendix/k8s_cheatsheet/#namespace","title":"Namespace \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get namespaces</code> \u5217\u51fa Namespace <code>kubectl create namespace &lt;name&gt;</code> \u5efa\u7acb Namespace <code>kubectl delete namespace &lt;name&gt;</code> \u522a\u9664 Namespace <code>kubectl config set-context --current --namespace=&lt;name&gt;</code> \u5207\u63db\u9810\u8a2d Namespace"},{"location":"appendix/k8s_cheatsheet/#configmap-secret","title":"ConfigMap &amp; Secret","text":""},{"location":"appendix/k8s_cheatsheet/#configmap","title":"ConfigMap","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get configmaps</code> \u5217\u51fa ConfigMap <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5f9e\u5b57\u9762\u503c\u5efa\u7acb <code>kubectl create configmap &lt;name&gt; --from-file=&lt;file&gt;</code> \u5f9e\u6a94\u6848\u5efa\u7acb <code>kubectl describe configmap &lt;name&gt;</code> \u6aa2\u8996\u5167\u5bb9"},{"location":"appendix/k8s_cheatsheet/#secret","title":"Secret","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get secrets</code> \u5217\u51fa Secret <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret <code>kubectl get secret &lt;name&gt; -o jsonpath='{.data.key}' \\| base64 -d</code> \u89e3\u78bc Secret"},{"location":"appendix/k8s_cheatsheet/#pv-pvc","title":"PV &amp; PVC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get pv</code> \u5217\u51fa PersistentVolume <code>kubectl get pvc</code> \u5217\u51fa PersistentVolumeClaim <code>kubectl describe pv &lt;name&gt;</code> \u63cf\u8ff0 PV <code>kubectl describe pvc &lt;name&gt;</code> \u63cf\u8ff0 PVC"},{"location":"appendix/k8s_cheatsheet/#node","title":"Node \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get nodes</code> \u5217\u51fa\u7bc0\u9ede <code>kubectl describe node &lt;name&gt;</code> \u63cf\u8ff0\u7bc0\u9ede <code>kubectl top nodes</code> \u7bc0\u9ede\u8cc7\u6e90\u4f7f\u7528 <code>kubectl cordon &lt;node&gt;</code> \u6a19\u8a18\u7bc0\u9ede\u4e0d\u53ef\u8abf\u5ea6 <code>kubectl uncordon &lt;node&gt;</code> \u53d6\u6d88\u6a19\u8a18 <code>kubectl drain &lt;node&gt;</code> \u6392\u7a7a\u7bc0\u9ede <code>kubectl taint nodes &lt;node&gt; key=value:NoSchedule</code> \u52a0\u4e0a Taint"},{"location":"appendix/k8s_cheatsheet/#rbac","title":"RBAC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get roles</code> \u5217\u51fa Role <code>kubectl get clusterroles</code> \u5217\u51fa ClusterRole <code>kubectl get rolebindings</code> \u5217\u51fa RoleBinding <code>kubectl get clusterrolebindings</code> \u5217\u51fa ClusterRoleBinding <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt;</code> \u6aa2\u67e5\u6b0a\u9650 <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt; --as=&lt;user&gt;</code> \u6a21\u64ec\u4f7f\u7528\u8005\u6aa2\u67e5"},{"location":"appendix/k8s_cheatsheet/#_11","title":"\u7591\u96e3\u6392\u89e3","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get events</code> \u67e5\u770b\u4e8b\u4ef6 <code>kubectl get events --sort-by='.lastTimestamp'</code> \u4f9d\u6642\u9593\u6392\u5e8f <code>kubectl top pods</code> Pod \u8cc7\u6e90\u4f7f\u7528 <code>kubectl top nodes</code> Node \u8cc7\u6e90\u4f7f\u7528 <code>kubectl describe pod &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u65e5\u8a8c"},{"location":"appendix/k8s_cheatsheet/#_12","title":"\u8f38\u51fa\u683c\u5f0f","text":"\u683c\u5f0f \u8aaa\u660e <code>-o wide</code> \u984d\u5916\u6b04\u4f4d <code>-o yaml</code> YAML \u683c\u5f0f <code>-o json</code> JSON \u683c\u5f0f <code>-o name</code> \u53ea\u986f\u793a\u540d\u7a31 <code>-o jsonpath='{...}'</code> JSONPath \u67e5\u8a62 <code>-o custom-columns=...</code> \u81ea\u8a02\u6b04\u4f4d"},{"location":"appendix/k8s_cheatsheet/#jsonpath","title":"JSONPath \u7bc4\u4f8b","text":"<pre><code># \u53d6\u5f97 Pod IP\nkubectl get pod &lt;name&gt; -o jsonpath='{.status.podIP}'\n\n# \u53d6\u5f97\u6240\u6709 Pod \u540d\u7a31\nkubectl get pods -o jsonpath='{.items[*].metadata.name}'\n\n# \u53d6\u5f97\u6240\u6709 Container Image\nkubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#_13","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5be6\u7528\u6307\u4ee4<pre><code># \u522a\u9664\u6240\u6709 Evicted Pod\nkubectl delete pods --field-selector=status.phase=Failed --all-namespaces\n\n# \u53d6\u5f97\u6240\u6709 Pod \u7684 Image\nkubectl get pods -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq\n\n# \u4f9d\u8a18\u61b6\u9ad4\u4f7f\u7528\u91cf\u6392\u5e8f Pod\nkubectl top pods --sort-by=memory\n\n# \u5feb\u901f\u5efa\u7acb\u6e2c\u8a66 Pod\nkubectl run test --image=busybox --rm -it -- /bin/sh\n\n# \u7522\u751f YAML \u4f46\u4e0d\u57f7\u884c\nkubectl create deployment nginx --image=nginx --dry-run=client -o yaml\n\n# \u532f\u51fa\u73fe\u6709\u8cc7\u6e90\nkubectl get deployment nginx -o yaml &gt; nginx-deployment.yaml\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#minikube","title":"minikube \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>minikube start</code> \u555f\u52d5 <code>minikube stop</code> \u505c\u6b62 <code>minikube delete</code> \u522a\u9664 <code>minikube status</code> \u72c0\u614b <code>minikube dashboard</code> \u958b\u555f Dashboard <code>minikube ip</code> \u53d6\u5f97 IP <code>minikube ssh</code> SSH \u9023\u7dda <code>minikube service &lt;name&gt;</code> \u958b\u555f Service <code>minikube addons list</code> \u5217\u51fa\u63d2\u4ef6 <code>minikube addons enable &lt;name&gt;</code> \u555f\u7528\u63d2\u4ef6"},{"location":"appendix/k8s_cheatsheet/#_14","title":"\u5feb\u6377\u5225\u540d","text":"\u5efa\u8b70\u52a0\u5165 ~/.bashrc \u6216 ~/.zshrc<pre><code>alias k='kubectl'\nalias kgp='kubectl get pods'\nalias kgs='kubectl get services'\nalias kgd='kubectl get deployments'\nalias kgn='kubectl get nodes'\nalias kd='kubectl describe'\nalias kl='kubectl logs'\nalias ke='kubectl exec -it'\nalias ka='kubectl apply -f'\nalias kd='kubectl delete -f'\n\n# \u81ea\u52d5\u88dc\u5168\nsource &lt;(kubectl completion bash)\nsource &lt;(kubectl completion zsh)\n</code></pre>"},{"location":"appendix/troubleshooting/","title":"\u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#_1","title":"\u7591\u96e3\u6392\u89e3\u6307\u5357","text":"<p>\u672c\u7ae0\u7bc0\u6574\u7406 Docker \u8207 Kubernetes \u5e38\u898b\u554f\u984c\u7684\u8a3a\u65b7\u8207\u89e3\u6c7a\u65b9\u6cd5\u3002</p>"},{"location":"appendix/troubleshooting/#docker","title":"Docker \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-docker","title":"1. Docker \u670d\u52d9\u7121\u6cd5\u555f\u52d5","text":"<p>\u75c7\u72c0</p> <pre><code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5 Docker \u670d\u52d9<pre><code># \u6aa2\u67e5\u670d\u52d9\u72c0\u614b\nsudo systemctl status docker\n\n# \u67e5\u770b\u670d\u52d9\u65e5\u8a8c\nsudo journalctl -u docker -f\n\n# \u6aa2\u67e5 socket \u6a94\u6848\nls -la /var/run/docker.sock\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u555f\u52d5 Docker \u670d\u52d9\nsudo systemctl start docker\n\n# \u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5\nsudo systemctl enable docker\n\n# \u5982\u679c socket \u554f\u984c\uff0c\u91cd\u65b0\u5efa\u7acb\nsudo rm /var/run/docker.sock\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#2-permission-denied","title":"2. Permission Denied","text":"<p>\u75c7\u72c0</p> <pre><code>permission denied while trying to connect to the Docker daemon socket\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5c07\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n\n# \u91cd\u65b0\u767b\u5165\u6216\u57f7\u884c\nnewgrp docker\n\n# \u9a57\u8b49\u7fa4\u7d44\ngroups\n</code></pre>"},{"location":"appendix/troubleshooting/#3","title":"3. \u5bb9\u5668\u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7\u5bb9\u5668\u9000\u51fa<pre><code># \u6aa2\u8996\u5bb9\u5668\u72c0\u614b\ndocker ps -a\n\n# \u67e5\u770b\u9000\u51fa\u78bc\ndocker inspect &lt;container&gt; --format='{{.State.ExitCode}}'\n\n# \u67e5\u770b\u65e5\u8a8c\ndocker logs &lt;container&gt;\n\n# \u67e5\u770b\u6700\u5f8c\u8f38\u51fa\ndocker logs --tail 50 &lt;container&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u9000\u51fa\u78bc \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 0 \u6b63\u5e38\u7d50\u675f \u78ba\u8a8d CMD \u6307\u4ee4\u662f\u5426\u70ba\u524d\u666f\u7a0b\u5e8f 1 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\u627e\u51fa\u932f\u8aa4 137 OOM Killed \u589e\u52a0\u8a18\u61b6\u9ad4\u9650\u5236 139 Segmentation Fault \u6aa2\u67e5\u61c9\u7528\u7a0b\u5f0f\u76f8\u5bb9\u6027 143 SIGTERM \u6b63\u5e38\u7d42\u6b62\u4fe1\u865f \u4fdd\u6301\u5bb9\u5668\u904b\u884c\uff08\u6e2c\u8a66\u7528\uff09<pre><code># \u4f7f\u7528 sleep \u4fdd\u6301\u904b\u884c\ndocker run -d --name test ubuntu sleep infinity\n\n# \u6216\u4f7f\u7528 tail\ndocker run -d --name test ubuntu tail -f /dev/null\n</code></pre>"},{"location":"appendix/troubleshooting/#4-image","title":"4. Image \u62c9\u53d6\u5931\u6557","text":"<p>\u75c7\u72c0</p> <pre><code>Error response from daemon: pull access denied\nError response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\ndocker search &lt;image-name&gt;\n\n# \u78ba\u8a8d\u7db2\u8def\u9023\u7dda\nping registry-1.docker.io\n\n# \u78ba\u8a8d DNS\nnslookup registry-1.docker.io\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5982\u9700\u767b\u5165\ndocker login\n\n# \u8a2d\u5b9a Registry Mirror\uff08\u570b\u5167\u52a0\u901f\uff09\n# \u7de8\u8f2f /etc/docker/daemon.json\n{\n  \"registry-mirrors\": [\"https://mirror.example.com\"]\n}\n\n# \u91cd\u555f Docker\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#5","title":"5. \u78c1\u789f\u7a7a\u9593\u4e0d\u8db3","text":"<p>\u75c7\u72c0</p> <pre><code>no space left on device\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5\u78c1\u789f\u4f7f\u7528<pre><code># \u6aa2\u8996 Docker \u78c1\u789f\u4f7f\u7528\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6aa2\u67e5\u7cfb\u7d71\u78c1\u789f\ndf -h\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> \u6e05\u7406\u8cc7\u6e90<pre><code># \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u5b8c\u6574\u6e05\u7406\uff08\u5305\u542b\u672a\u4f7f\u7528\u7684 Image \u548c Volume\uff09\ndocker system prune -a --volumes\n\n# \u522a\u9664 dangling Image\ndocker image prune\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n\n# \u522a\u9664\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n</code></pre>"},{"location":"appendix/troubleshooting/#6-port","title":"6. Port \u5df2\u88ab\u4f54\u7528","text":"<p>\u75c7\u72c0</p> <pre><code>Bind for 0.0.0.0:8080 failed: port is already allocated\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b Port \u4f7f\u7528\u60c5\u6cc1\nsudo lsof -i :8080\n\n# \u6216\u4f7f\u7528 netstat\nsudo netstat -tlnp | grep 8080\n\n# \u67e5\u770b Docker \u5bb9\u5668\u4f7f\u7528\u7684 Port\ndocker ps --format \"table {{.Names}}\\t{{.Ports}}\"\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u505c\u6b62\u4f54\u7528 Port \u7684\u7a0b\u5e8f\nsudo kill &lt;PID&gt;\n\n# \u6216\u4f7f\u7528\u5176\u4ed6 Port\ndocker run -d -p 8081:80 nginx\n</code></pre>"},{"location":"appendix/troubleshooting/#7-volume","title":"7. Volume \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <p>\u5bb9\u5668\u5167\u7121\u6cd5\u5beb\u5165\u639b\u8f09\u7684\u76ee\u9304</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u8abf\u6574\u4e3b\u6a5f\u76ee\u9304\u6b0a\u9650\nsudo chown -R 1000:1000 /path/to/host/dir\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u7279\u5b9a UID \u57f7\u884c\u5bb9\u5668\ndocker run -u $(id -u):$(id -g) -v /host:/container image\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 SELinux \u6a19\u7c64\uff08RHEL/CentOS\uff09\ndocker run -v /host:/container:Z image\n</code></pre>"},{"location":"appendix/troubleshooting/#kubernetes","title":"Kubernetes \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-pod-pending","title":"1. Pod \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Pending Pod<pre><code># \u67e5\u770b Pod \u4e8b\u4ef6\nkubectl describe pod &lt;pod-name&gt;\n\n# \u67e5\u770b Events\nkubectl get events --field-selector involvedObject.name=&lt;pod-name&gt;\n\n# \u6aa2\u67e5\u7bc0\u9ede\u8cc7\u6e90\nkubectl describe nodes | grep -A 5 \"Allocated resources\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u8aaa\u660e \u89e3\u6c7a\u65b9\u6848 \u8cc7\u6e90\u4e0d\u8db3 CPU/Memory \u4e0d\u5920 \u589e\u52a0\u7bc0\u9ede\u6216\u6e1b\u5c11 requests nodeSelector \u4e0d\u7b26 \u6c92\u6709\u7b26\u5408\u7684\u7bc0\u9ede \u8abf\u6574 selector \u6216\u52a0 label PVC \u672a\u7d81\u5b9a PV \u4e0d\u5b58\u5728\u6216\u4e0d\u7b26\u5408 \u5efa\u7acb\u7b26\u5408\u7684 PV Taint/Toleration \u7bc0\u9ede\u6709 Taint \u52a0\u4e0a Toleration"},{"location":"appendix/troubleshooting/#2-pod-crashloopbackoff","title":"2. Pod \u8655\u65bc CrashLoopBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 CrashLoopBackOff<pre><code># \u67e5\u770b\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt;\n\n# \u67e5\u770b\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt; --previous\n\n# \u67e5\u770b\u8a73\u7d30\u72c0\u614b\nkubectl describe pod &lt;pod-name&gt;\n\n# \u6aa2\u67e5\u9000\u51fa\u78bc\nkubectl get pod &lt;pod-name&gt; -o jsonpath='{.status.containerStatuses[0].lastState.terminated.exitCode}'\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\uff0c\u4fee\u5fa9\u7a0b\u5f0f \u8a2d\u5b9a\u932f\u8aa4 \u6aa2\u67e5 ConfigMap/Secret \u8cc7\u6e90\u4e0d\u8db3 \u589e\u52a0 memory/cpu limits \u5065\u5eb7\u6aa2\u67e5\u5931\u6557 \u8abf\u6574 probe \u53c3\u6578 \u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2 \u4f7f\u7528 initContainer"},{"location":"appendix/troubleshooting/#3-pod-imagepullbackoff","title":"3. Pod \u8655\u65bc ImagePullBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u932f\u8aa4\u8a0a\u606f\nkubectl describe pod &lt;pod-name&gt; | grep -A 10 Events\n\n# \u9a57\u8b49 Image \u5b58\u5728\ndocker pull &lt;image-name&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\u6b63\u78ba\n# \u78ba\u8a8d Registry \u5b58\u53d6\u6b0a\u9650\n\n# \u5982\u679c\u662f\u79c1\u6709 Registry\uff0c\u5efa\u7acb Secret\nkubectl create secret docker-registry regcred \\\n  --docker-server=&lt;registry&gt; \\\n  --docker-username=&lt;username&gt; \\\n  --docker-password=&lt;password&gt;\n\n# \u5728 Pod spec \u52a0\u5165 imagePullSecrets\nspec:\n  imagePullSecrets:\n    - name: regcred\n</code></pre>"},{"location":"appendix/troubleshooting/#4-service","title":"4. Service \u7121\u6cd5\u9023\u63a5","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Service \u9023\u7dda<pre><code># \u78ba\u8a8d Service \u5b58\u5728\nkubectl get svc &lt;service-name&gt;\n\n# \u78ba\u8a8d Endpoints\nkubectl get endpoints &lt;service-name&gt;\n\n# \u78ba\u8a8d Pod \u904b\u884c\u4e2d\nkubectl get pods -l &lt;selector&gt;\n\n# \u5f9e Pod \u5167\u6e2c\u8a66\u9023\u7dda\nkubectl exec -it &lt;pod&gt; -- curl &lt;service-name&gt;:&lt;port&gt;\n\n# \u6aa2\u67e5 DNS\nkubectl exec -it &lt;pod&gt; -- nslookup &lt;service-name&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 Selector \u4e0d\u7b26 \u78ba\u8a8d Service selector \u8207 Pod label \u4e00\u81f4 Pod \u672a\u5c31\u7dd2 \u7b49\u5f85 Pod Ready \u6216\u6aa2\u67e5 readinessProbe Port \u932f\u8aa4 \u78ba\u8a8d port \u548c targetPort NetworkPolicy \u963b\u64cb \u6aa2\u67e5 NetworkPolicy \u898f\u5247"},{"location":"appendix/troubleshooting/#5-configmapsecret-pod","title":"5. ConfigMap/Secret \u66f4\u65b0\u5f8c Pod \u6c92\u6709\u8b8a\u5316","text":"<p>\u539f\u56e0\uff1aPod \u4e0d\u6703\u81ea\u52d5\u91cd\u65b0\u8f09\u5165 ConfigMap/Secret</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u91cd\u555f Deployment\nkubectl rollout restart deployment/&lt;name&gt;\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 annotation \u89f8\u767c\u66f4\u65b0\nkubectl patch deployment &lt;name&gt; -p \\\n  '{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"'$(date +%s)'\"}}}}}'\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 Reloader \u5de5\u5177\n# https://github.com/stakater/Reloader\n</code></pre>"},{"location":"appendix/troubleshooting/#6-pvc-pending","title":"6. PVC \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b PVC \u72c0\u614b\nkubectl get pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\nkubectl describe pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u53ef\u7528\u7684 PV\nkubectl get pv\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u7121\u7b26\u5408\u7684 PV \u5efa\u7acb\u7b26\u5408\u898f\u683c\u7684 PV StorageClass \u4e0d\u5b58\u5728 \u5efa\u7acb StorageClass \u6216\u6307\u5b9a\u6b63\u78ba\u540d\u7a31 \u5bb9\u91cf\u4e0d\u8db3 \u6e1b\u5c11 PVC \u8acb\u6c42\u6216\u589e\u52a0 PV \u5bb9\u91cf accessModes \u4e0d\u7b26 \u78ba\u8a8d PV/PVC accessModes \u4e00\u81f4"},{"location":"appendix/troubleshooting/#7-node-notready","title":"7. Node \u8655\u65bc NotReady","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u7bc0\u9ede\u72c0\u614b\nkubectl describe node &lt;node-name&gt;\n\n# \u6aa2\u67e5 kubelet \u72c0\u614b\nssh &lt;node&gt; \"sudo systemctl status kubelet\"\n\n# \u67e5\u770b kubelet \u65e5\u8a8c\nssh &lt;node&gt; \"sudo journalctl -u kubelet -f\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 kubelet \u505c\u6b62 \u91cd\u555f kubelet \u7db2\u8def\u554f\u984c \u6aa2\u67e5\u7bc0\u9ede\u7db2\u8def\u9023\u7dda \u78c1\u789f\u58d3\u529b \u6e05\u7406\u78c1\u789f\u7a7a\u9593 \u8a18\u61b6\u9ad4\u58d3\u529b \u589e\u52a0\u8a18\u61b6\u9ad4\u6216\u6e1b\u5c11 Pod"},{"location":"appendix/troubleshooting/#8-rbac","title":"8. RBAC \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <pre><code>Error from server (Forbidden): pods is forbidden: User \"xxx\" cannot list resource \"pods\"\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u6aa2\u67e5\u6b0a\u9650\nkubectl auth can-i list pods --as=&lt;user&gt;\n\n# \u6aa2\u67e5\u89d2\u8272\u7d81\u5b9a\nkubectl get rolebindings,clusterrolebindings -A | grep &lt;user&gt;\n\n# \u8a73\u7d30\u6aa2\u67e5\nkubectl describe rolebinding &lt;name&gt; -n &lt;namespace&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5efa\u7acb\u9069\u7576\u7684 Role \u548c RoleBinding\nkubectl create role pod-reader --verb=get,list,watch --resource=pods\nkubectl create rolebinding pod-reader-binding --role=pod-reader --user=&lt;user&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_2","title":"\u8a3a\u65b7\u5de5\u5177","text":""},{"location":"appendix/troubleshooting/#kubectl-debug","title":"kubectl debug","text":"<pre><code># \u5efa\u7acb\u9664\u932f Pod\nkubectl debug node/&lt;node-name&gt; -it --image=busybox\n\n# \u70ba Pod \u5efa\u7acb\u9664\u932f\u5bb9\u5668\nkubectl debug &lt;pod-name&gt; -it --image=busybox --target=&lt;container&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_3","title":"\u5e38\u7528\u8a3a\u65b7\u6307\u4ee4","text":"\u7d9c\u5408\u8a3a\u65b7<pre><code># \u5feb\u901f\u6aa2\u67e5\u53e2\u96c6\u72c0\u614b\nkubectl get nodes\nkubectl get pods --all-namespaces | grep -v Running\n\n# \u6aa2\u67e5\u7cfb\u7d71 Pod\nkubectl get pods -n kube-system\n\n# \u6aa2\u67e5\u6700\u8fd1\u4e8b\u4ef6\nkubectl get events --sort-by='.lastTimestamp' | tail -20\n\n# \u6aa2\u67e5\u8cc7\u6e90\u4f7f\u7528\nkubectl top nodes\nkubectl top pods --all-namespaces\n</code></pre>"},{"location":"appendix/troubleshooting/#_4","title":"\u65e5\u8a8c\u6536\u96c6","text":""},{"location":"appendix/troubleshooting/#_5","title":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a","text":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a\u8173\u672c<pre><code>#!/bin/bash\nOUTPUT_DIR=\"k8s-debug-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p $OUTPUT_DIR\n\n# \u7bc0\u9ede\u8cc7\u8a0a\nkubectl get nodes -o wide &gt; $OUTPUT_DIR/nodes.txt\nkubectl describe nodes &gt; $OUTPUT_DIR/nodes-describe.txt\n\n# Pod \u8cc7\u8a0a\nkubectl get pods --all-namespaces -o wide &gt; $OUTPUT_DIR/pods.txt\n\n# Service \u8cc7\u8a0a\nkubectl get svc --all-namespaces &gt; $OUTPUT_DIR/services.txt\n\n# Events\nkubectl get events --all-namespaces --sort-by='.lastTimestamp' &gt; $OUTPUT_DIR/events.txt\n\n# \u58d3\u7e2e\ntar -czvf $OUTPUT_DIR.tar.gz $OUTPUT_DIR\necho \"\u8a3a\u65b7\u8cc7\u8a0a\u5df2\u5132\u5b58\u81f3 $OUTPUT_DIR.tar.gz\"\n</code></pre>"}]}