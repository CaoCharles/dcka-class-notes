{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u9996\u9801","text":""},{"location":"#docker-containers-kubernetes","title":"Docker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406","text":"<p>\u6b61\u8fce\u4f86\u5230 \u6046\u9038\u6559\u80b2\u8a13\u7df4\u4e2d\u5fc3 DCKA \u8ab2\u7a0b \u5b78\u7fd2\u7b46\u8a18\uff01</p> <p>\u8ab2\u7a0b\u8cc7\u8a0a</p> <ul> <li>\u8ab2\u7a0b\u540d\u7a31\uff1aDocker Containers \u8207 Kubernetes \u7cfb\u7d71\u7ba1\u7406</li> <li>\u8ab2\u7a0b\u4ee3\u865f\uff1aDCKA</li> <li>\u7e3d\u6642\u6578\uff1a21 \u5c0f\u6642\uff083 \u5929\uff09</li> <li>\u9069\u5408\u5c0d\u8c61\uff1a\u7db2\u8def\u5de5\u7a0b\u5e2b\u3001\u96f2\u7aef\u904b\u7b97\u5de5\u7a0b\u5e2b</li> </ul>"},{"location":"#_1","title":"\u8ab2\u7a0b\u7c21\u4ecb","text":"<p>\u672c\u8ab2\u7a0b\u65e8\u5728\u5e6b\u52a9\u5b78\u54e1\u638c\u63e1 Docker Container\uff08\u5bb9\u5668\uff09\u6280\u8853\u8207 Kubernetes\uff08\u7c21\u7a31 K8S\uff09\u5bb9\u5668\u7de8\u6392\u5e73\u53f0\u7684\u6838\u5fc3\u6982\u5ff5\u8207\u5be6\u52d9\u64cd\u4f5c\u3002\u900f\u904e\u7406\u8ad6\u8b1b\u89e3\u8207\u52d5\u624b\u5be6\u4f5c\uff0c\u4f60\u5c07\u5b78\u6703\u5982\u4f55\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u90e8\u7f72\u5bb9\u5668\u5316\u61c9\u7528\u7a0b\u5f0f\u3002</p> <pre><code>graph LR\n    A[\u50b3\u7d71\u90e8\u7f72] --&gt; B[\u865b\u64ec\u5316\u90e8\u7f72]\n    B --&gt; C[\u5bb9\u5668\u5316\u90e8\u7f72]\n    C --&gt; D[\u5bb9\u5668\u7de8\u6392 K8S]\n\n    style A fill:#f9f,stroke:#333\n    style B fill:#bbf,stroke:#333\n    style C fill:#bfb,stroke:#333\n    style D fill:#ff9,stroke:#333</code></pre>"},{"location":"#_2","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u8ab2\u7a0b\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3\u5bb9\u5668\u5316\u6280\u8853\u7684\u512a\u52e2\u8207\u61c9\u7528\u5834\u666f</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u5bb9\u5668\u7684\u5efa\u7acb\u3001\u555f\u52d5\u3001\u505c\u6b62\u8207\u522a\u9664</li> <li> \u5ba2\u88fd\u5316 Docker Image\uff08\u6620\u50cf\u6a94\uff09</li> <li> \u4f7f\u7528 Kubernetes \u90e8\u7f72\u8207\u7ba1\u7406\u5bb9\u5668\u5316\u61c9\u7528</li> <li> \u5be6\u4f5c WordPress + MySQL \u7684\u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"#_3","title":"\u8ab2\u7a0b\u5927\u7db1","text":""},{"location":"#1-docker-container-micro-service-introduction","title":"\u7b2c 1 \u7ae0\uff1aDocker Container &amp; Micro Service Introduction","text":"<ul> <li>\u5bb9\u5668\u5316\u7684\u597d\u8655</li> <li>Docker \u67b6\u69cb</li> <li>Docker \u57fa\u672c\u67b6\u69cb</li> <li>Docker \u8207 Podman \u6bd4\u8f03</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#2-docker","title":"\u7b2c 2 \u7ae0\uff1aDocker \u5bb9\u5668\u5316\u7ba1\u7406","text":"<ul> <li>Public Registry \u8207 Private Registry</li> <li>Docker \u57fa\u672c\u64cd\u4f5c</li> <li>Persistent Storage\uff08\u6301\u4e45\u5316\u5132\u5b58\uff09</li> <li>Docker Network\uff08\u7db2\u8def\uff09</li> <li>\u5be6\u4f5c\uff1a\u4f7f\u7528 Docker \u67b6\u8a2d WordPress + MySQL</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#3-docker-images","title":"\u7b2c 3 \u7ae0\uff1a\u5ba2\u88fd\u5316 Docker Images","text":"<ul> <li>Docker commit</li> <li>Dockerfile \u64b0\u5beb</li> <li>Source-to-Image \u7c21\u4ecb</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#4-kubernetes-management","title":"\u7b2c 4 \u7ae0\uff1aKubernetes Management","text":"<ul> <li>Kubernetes \u8207 OpenShift/OKD</li> <li>Kubernetes \u67b6\u69cb\u8207\u5b89\u88dd</li> <li>YAML \u8207 JSON \u8a2d\u5b9a\u6a94</li> <li>Kubernetes \u8cc7\u6e90\u985e\u578b\u8207\u7ba1\u7406</li> <li>\u90e8\u7f72\u7b56\u7565\uff1aRollingUpdate\u3001Recreate\u3001Canary\u3001Blue/Green</li> <li>Persistent Volumes\u3001ConfigMaps\u3001Secrets</li> <li>RBAC \u6b0a\u9650\u63a7\u5236</li> <li>\u5be6\u4f5c\uff1a\u4f7f\u7528 Kubernetes \u67b6\u8a2d WordPress + MySQL</li> </ul> <p> \u958b\u59cb\u5b78\u7fd2</p>"},{"location":"#_4","title":"\u9810\u5099\u77e5\u8b58","text":"<p>\u958b\u59cb\u672c\u8ab2\u7a0b\u4e4b\u524d\uff0c\u5efa\u8b70\u4f60\u5177\u5099\uff1a</p> <p>\u5fc5\u5099\u77e5\u8b58</p> <ul> <li>Linux \u57fa\u790e\u6307\u4ee4\u64cd\u4f5c\uff08cd\u3001ls\u3001cat\u3001vim \u7b49\uff09</li> <li>Linux \u57fa\u672c\u7cfb\u7d71\u7ba1\u7406\u6982\u5ff5</li> <li>\u5efa\u8b70\u5177\u5099 RHCE \u8a8d\u8b49\u80fd\u529b\u6216\u540c\u7b49\u7d93\u9a57</li> </ul>"},{"location":"#_5","title":"\u9644\u9304\u8cc7\u6e90","text":"\u8cc7\u6e90 \u8aaa\u660e Docker \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 Docker \u6307\u4ee4\u5feb\u901f\u53c3\u8003 Kubernetes \u6307\u4ee4\u901f\u67e5\u8868 \u5e38\u7528 kubectl \u6307\u4ee4\u5feb\u901f\u53c3\u8003 \u7591\u96e3\u6392\u89e3\u6307\u5357 \u5e38\u898b\u554f\u984c\u8207\u89e3\u6c7a\u65b9\u6848"},{"location":"#_6","title":"\u76f8\u95dc\u8cc7\u6e90","text":"<ul> <li> Docker \u5b98\u65b9\u6587\u4ef6</li> <li> Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li> Docker Hub</li> <li>:material-podman: Podman \u5b98\u65b9\u6587\u4ef6</li> <li> \u6046\u9038 DCKA \u8ab2\u7a0b\u9801\u9762</li> </ul> <p>\u5b78\u7fd2\u5efa\u8b70</p> <ol> <li>\u5efa\u8b70\u6309\u7ae0\u7bc0\u9806\u5e8f\u5b78\u7fd2</li> <li>\u6bcf\u500b\u7ae0\u7bc0\u7684 Lab \u5be6\u4f5c\u52d9\u5fc5\u89aa\u81ea\u52d5\u624b\u64cd\u4f5c</li> <li>\u9047\u5230\u554f\u984c\u5148\u67e5\u95b1 FAQ\uff0c\u518d\u53c3\u8003\u7591\u96e3\u6392\u89e3\u6307\u5357</li> <li>\u5584\u7528\u6307\u4ee4\u901f\u67e5\u8868\u52a0\u901f\u5b78\u7fd2</li> </ol>"},{"location":"lab01_environment_setup/","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#lab-01-lab","title":"LAB 01 LAB \u74b0\u5883\u521d\u59cb\u5316","text":""},{"location":"lab01_environment_setup/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5b89\u88dd\u4e26\u8a2d\u5b9a VMware Workstation</li> <li> \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def\uff08Virtual Network Editor\uff09</li> <li> \u555f\u52d5\u4e26\u9a57\u8b49\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u6e96\u5099\u597d Windows \u4e3b\u6a5f\uff08\u5efa\u8b70 16GB+ RAM\uff09</li> <li>\u4e0b\u8f09 DCKA \u8ab2\u7a0b\u865b\u64ec\u6a5f\u6620\u50cf\u6a94</li> <li>\u4e0b\u8f09 VMware Workstation \u5b89\u88dd\u7a0b\u5f0f</li> </ul>"},{"location":"lab01_environment_setup/#01-vmware-workstation","title":"0.1 \u5b89\u88dd VMware Workstation","text":""},{"location":"lab01_environment_setup/#_3","title":"\u53d6\u5f97\u5b89\u88dd\u7a0b\u5f0f","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u7684 VMware Workstation 17.6.4 \u5b89\u88dd\u6a94\u6848\u4f4d\u65bc\uff1a</p> <pre><code>C:\\DCKA-v8 (C:)\\VMware\\VMwareWorkstation_17.6.4\\\n</code></pre> <p></p> <p>\u8cc7\u6599\u593e\u5167\u5305\u542b\uff1a</p> \u6a94\u6848 \u8aaa\u660e <code>VMware-workstation-full-17.6.4-2483....exe</code> VMware Workstation \u5b89\u88dd\u7a0b\u5f0f <code>md5sum.txt</code> MD5 \u6821\u9a57\u78bc <code>md5sum.png</code> \u6821\u9a57\u78bc\u622a\u5716"},{"location":"lab01_environment_setup/#_4","title":"\u5b89\u88dd\u6b65\u9a5f","text":"<ol> <li>\u57f7\u884c <code>VMware-workstation-full-17.6.4-2483....exe</code></li> <li>\u4f9d\u7167\u5b89\u88dd\u7cbe\u9748\u5b8c\u6210\u5b89\u88dd</li> <li>\u5b89\u88dd\u5b8c\u6210\u5f8c\u91cd\u65b0\u555f\u52d5\u96fb\u8166</li> </ol> <p>\u5b89\u88dd\u63d0\u793a</p> <p>\u5b89\u88dd\u904e\u7a0b\u4e2d\u5efa\u8b70\u9078\u64c7\u300c\u5178\u578b\u5b89\u88dd\u300d\uff0c\u4f7f\u7528\u9810\u8a2d\u8a2d\u5b9a\u5373\u53ef\u3002</p>"},{"location":"lab01_environment_setup/#02","title":"0.2 \u8a2d\u5b9a\u865b\u64ec\u7db2\u8def","text":""},{"location":"lab01_environment_setup/#virtual-network-editor","title":"\u958b\u555f Virtual Network Editor","text":"<ol> <li>\u958b\u555f VMware Workstation</li> <li>\u9078\u64c7 Edit \u2192 Virtual Network Editor</li> <li>\u9ede\u9078 Change Settings \u53d6\u5f97\u7ba1\u7406\u54e1\u6b0a\u9650</li> </ol>"},{"location":"lab01_environment_setup/#vmnet8-nat","title":"\u8a2d\u5b9a VMnet8 (NAT)","text":"<p>\u9078\u64c7 VMnet8\uff08NAT \u6a21\u5f0f\uff09\uff0c\u9032\u884c\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p>"},{"location":"lab01_environment_setup/#1-subnet-ip","title":"\u6b65\u9a5f 1\uff1a\u8a2d\u5b9a Subnet IP","text":"<p>\u5c07 Subnet IP \u4fee\u6539\u70ba\uff1a</p> <pre><code>192.168.66.0\n</code></pre>"},{"location":"lab01_environment_setup/#2-nat-settings","title":"\u6b65\u9a5f 2\uff1a\u8a2d\u5b9a NAT Settings","text":"<p>\u9ede\u9078 NAT Settings...\uff0c\u5c07 Gateway IP \u8a2d\u5b9a\u70ba\uff1a</p> <pre><code>192.168.66.2\n</code></pre>"},{"location":"lab01_environment_setup/#3-dhcp-settings","title":"\u6b65\u9a5f 3\uff1a\u8a2d\u5b9a DHCP Settings","text":"<p>\u9ede\u9078 DHCP Settings...\uff0c\u78ba\u8a8d\u4ee5\u4e0b\u8a2d\u5b9a\uff1a</p> \u8a2d\u5b9a\u9805\u76ee \u503c Starting IP address <code>192.168.66.128</code> Ending IP address <code>192.168.66.254</code> <p>\u91cd\u8981</p> <p>\u8acb\u78ba\u4fdd Subnet IP \u70ba <code>192.168.66.0</code>\uff0cGateway \u70ba <code>192.168.66.2</code>\uff0c\u5426\u5247\u5f8c\u7e8c\u5be6\u4f5c\u53ef\u80fd\u7121\u6cd5\u6b63\u5e38\u9023\u7dda\u3002</p> <p>\u9ede\u9078 OK \u5132\u5b58\u8a2d\u5b9a\u3002</p>"},{"location":"lab01_environment_setup/#03","title":"0.3 \u7db2\u8def\u62d3\u6a38\u8207\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#_5","title":"\u7db2\u8def\u67b6\u69cb","text":"<p>\u8ab2\u7a0b\u74b0\u5883\u4f7f\u7528 VMware Workstation \u7684 NAT \u7db2\u8def\uff08VMnet8\uff09\uff0c\u7db2\u6bb5\u70ba <code>192.168.66.0/24</code>\uff1a</p> <p></p> <pre><code>graph TB\n    subgraph \"\u5916\u90e8\u7db2\u8def\"\n        Internet((Internet))\n        ExtNet[10.0.1.0/24]\n    end\n\n    subgraph \"VMware NAT Gateway\"\n        NAT[\".254\"]\n    end\n\n    subgraph \"VMnet8 - 192.168.66.0/24\"\n        Host[\".xxx&lt;br/&gt;VMware Workstation\"]\n        D1[\"docker1&lt;br/&gt;.51\"]\n        D2[\"docker2&lt;br/&gt;.52\"]\n        KS[\"k8s-standalone&lt;br/&gt;.61\"]\n        KM[\"k8s-master1&lt;br/&gt;.71\"]\n        KN1[\"k8s-node1&lt;br/&gt;.81\"]\n        KN2[\"k8s-node2&lt;br/&gt;.82\"]\n    end\n\n    Internet --&gt; ExtNet --&gt; NAT\n    NAT --&gt; Host\n    Host --&gt; D1\n    Host --&gt; D2\n    Host --&gt; KS\n    Host --&gt; KM\n    Host --&gt; KN1\n    Host --&gt; KN2</code></pre>"},{"location":"lab01_environment_setup/#ip","title":"\u865b\u64ec\u6a5f\u6e05\u55ae\u8207 IP \u914d\u7f6e","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u516d\u53f0\u5df2\u9810\u5148\u8a2d\u5b9a\u597d\u7684 Rocky Linux 9 \u865b\u64ec\u6a5f\uff1a</p> <p></p> \u865b\u64ec\u6a5f\u540d\u7a31 IP \u4f4d\u5740 \u7528\u9014 <code>docker1</code> 192.168.66.51 Docker \u5be6\u4f5c\u4e3b\u6a5f 1 <code>docker2</code> 192.168.66.52 Docker \u5be6\u4f5c\u4e3b\u6a5f 2 <code>k8s-standalone</code> 192.168.66.61 \u7368\u7acb Kubernetes \u74b0\u5883\uff08\u55ae\u7bc0\u9ede\uff09 <code>k8s-master1</code> 192.168.66.71 Kubernetes Master\uff08\u63a7\u5236\u5e73\u9762\uff09\u7bc0\u9ede <code>k8s-node1</code> 192.168.66.81 Kubernetes Worker \u7bc0\u9ede 1 <code>k8s-node2</code> 192.168.66.82 Kubernetes Worker \u7bc0\u9ede 2 <code>mirror</code> - \u672c\u5730 Mirror \u4f3a\u670d\u5668\uff08\u5957\u4ef6\u5eab\u6620\u5c04\uff09 <p>IP \u914d\u7f6e\u898f\u5247</p> <ul> <li>Docker \u74b0\u5883\uff1a192.168.66.5x</li> <li>K8s Standalone\uff1a192.168.66.6x</li> <li>K8s Master\uff1a192.168.66.7x</li> <li>K8s Worker\uff1a192.168.66.8x</li> <li>NAT Gateway\uff1a192.168.66.254</li> </ul>"},{"location":"lab01_environment_setup/#_6","title":"\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f","text":""},{"location":"lab01_environment_setup/#1","title":"\u65b9\u6cd5 1\uff1a\u4f7f\u7528\u6279\u6b21\u6a94","text":"<p>\u57f7\u884c <code>PowerON-allVM.bat</code> \u4e00\u6b21\u555f\u52d5\u6240\u6709\u865b\u64ec\u6a5f\u3002</p>"},{"location":"lab01_environment_setup/#2","title":"\u65b9\u6cd5 2\uff1a\u624b\u52d5\u555f\u52d5","text":"<ol> <li>\u5728 VMware Workstation \u4e2d\u4f9d\u5e8f\u958b\u555f\u6bcf\u53f0\u865b\u64ec\u6a5f\u7684 <code>.vmx</code> \u6a94\u6848</li> <li>\u9ede\u9078 Power on this virtual machine</li> </ol>"},{"location":"lab01_environment_setup/#_7","title":"\u9a57\u8b49\u865b\u64ec\u6a5f\u72c0\u614b","text":"<p>\u555f\u52d5\u5b8c\u6210\u5f8c\uff0c\u61c9\u8a72\u53ef\u4ee5\u770b\u5230\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u5728\u904b\u884c\u4e2d\uff0c\u4e26\u986f\u793a Rocky Linux \u767b\u5165\u756b\u9762\uff1a</p> <p></p>"},{"location":"lab01_environment_setup/#_8","title":"\u767b\u5165\u8cc7\u8a0a","text":"\u5e33\u865f \u5bc6\u78bc <code>root</code> <code>container</code> <p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210</p> <p>\u7576\u6240\u6709\u865b\u64ec\u6a5f\u90fd\u6210\u529f\u555f\u52d5\u4e26\u53ef\u4ee5\u767b\u5165\u5f8c\uff0c\u5373\u53ef\u958b\u59cb\u9032\u884c Docker \u8207 Kubernetes \u5be6\u4f5c\u7df4\u7fd2\u3002</p>"},{"location":"lab01_environment_setup/#04-mirror","title":"0.4 Mirror \u4f3a\u670d\u5668","text":"<p>\u8ab2\u7a0b\u63d0\u4f9b\u672c\u5730 Mirror \u4f3a\u670d\u5668\uff0c\u52a0\u901f\u5957\u4ef6\u4e0b\u8f09\u4e26\u652f\u63f4\u96e2\u7dda\u74b0\u5883\u3002</p>"},{"location":"lab01_environment_setup/#mirror","title":"Mirror \u7db2\u5740","text":"\u7db2\u8def\u74b0\u5883 \u7db2\u5740 \u5167\u90e8\u7db2\u8def\uff08VMnet8\uff09 <code>http://192.168.66.248/k8s/</code> \u5916\u90e8\u7db2\u8def\uff08\u6559\u5ba4\u7db2\u8def\uff09 <code>http://10.0.1.249/k8s/</code>"},{"location":"lab01_environment_setup/#mirror_1","title":"Mirror \u8cc7\u6e90\u5167\u5bb9","text":"\u8cc7\u6599\u593e/\u6a94\u6848 \u7528\u9014 <code>248.repo</code> YUM/DNF \u5957\u4ef6\u5eab\u8a2d\u5b9a\u6a94 <code>ContainerImages/</code> Docker/Container \u6620\u50cf\u6a94 <code>Packages/</code> RPM \u5957\u4ef6 <code>command.txt</code> \u6307\u4ee4\u53c3\u8003 <code>docs/</code> \u8ab2\u7a0b\u6587\u4ef6 <code>scripts/</code> \u81ea\u52d5\u5316\u8173\u672c <code>yaml/</code> Kubernetes YAML \u8a2d\u5b9a\u6a94 <code>VMwareWorkstation_17.6.4/</code> VMware \u5b89\u88dd\u7a0b\u5f0f\uff08\u5916\u90e8\u7db2\u8def\uff09 <p>\u70ba\u4ec0\u9ebc\u9700\u8981 Mirror\uff1f</p> <ul> <li>\u52a0\u901f\u4e0b\u8f09\uff1a\u5f9e\u672c\u5730\u4f3a\u670d\u5668\u4e0b\u8f09\u6bd4\u7db2\u969b\u7db2\u8def\u5feb\u5f88\u591a</li> <li>\u96e2\u7dda\u74b0\u5883\uff1a\u6559\u5ba4\u53ef\u80fd\u6c92\u6709\u5c0d\u5916\u7db2\u8def</li> <li>\u7248\u672c\u4e00\u81f4\uff1a\u78ba\u4fdd\u6240\u6709\u5b78\u54e1\u4f7f\u7528\u76f8\u540c\u7248\u672c\u7684\u5957\u4ef6\u3002</li> </ul>"},{"location":"lab01_environment_setup/#_9","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1a\u865b\u64ec\u6a5f\u7121\u6cd5\u958b\u6a5f\uff0c\u986f\u793a VT-x \u932f\u8aa4 <p>\u539f\u56e0\uff1aBIOS \u672a\u555f\u7528\u865b\u64ec\u5316\u6280\u8853</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u91cd\u65b0\u555f\u52d5\u96fb\u8166\uff0c\u9032\u5165 BIOS \u8a2d\u5b9a 2. \u627e\u5230 Intel VT-x \u6216 AMD-V \u9078\u9805 3. \u5c07\u5176\u8a2d\u5b9a\u70ba Enabled 4. \u5132\u5b58\u4e26\u91cd\u65b0\u555f\u52d5</p> Q2\uff1a\u7db2\u8def\u7121\u6cd5\u9023\u7dda <p>\u539f\u56e0\uff1aVirtual Network Editor \u8a2d\u5b9a\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a 1. \u78ba\u8a8d VMnet8 \u7684 Subnet IP \u70ba <code>192.168.66.0</code> 2. \u78ba\u8a8d Gateway IP \u70ba <code>192.168.66.2</code> 3. \u78ba\u8a8d\u865b\u64ec\u6a5f\u7db2\u8def\u4ecb\u9762\u8a2d\u5b9a\u70ba NAT \u6a21\u5f0f</p> Q3\uff1a\u8a18\u61b6\u9ad4\u4e0d\u8db3 <p>\u539f\u56e0\uff1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e0d\u8db3\u4ee5\u904b\u884c\u6240\u6709\u865b\u64ec\u6a5f</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a - \u4f9d\u5e8f\u555f\u52d5\u9700\u8981\u7684\u865b\u64ec\u6a5f\uff0c\u4e0d\u8981\u4e00\u6b21\u5168\u90e8\u555f\u52d5 - \u6216\u5347\u7d1a\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u81f3 16GB \u4ee5\u4e0a</p>"},{"location":"lab01_environment_setup/#_10","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 VMware \u5b89\u88dd\uff1a\u5b89\u88dd VMware Workstation 17.6.4</li> <li>\u2705 \u7db2\u8def\u8a2d\u5b9a\uff1aVMnet8 \u8a2d\u5b9a\u70ba 192.168.66.0/24 \u7db2\u6bb5</li> <li>\u2705 \u865b\u64ec\u6a5f\u555f\u52d5\uff1a\u516d\u53f0 Rocky Linux \u865b\u64ec\u6a5f\u5168\u90e8\u555f\u52d5</li> <li>\u2705 \u74b0\u5883\u9a57\u8b49\uff1a\u78ba\u8a8d\u53ef\u4ee5\u6b63\u5e38\u767b\u5165\u865b\u64ec\u6a5f</li> </ul>"},{"location":"lab01_environment_setup/#_11","title":"\u4e0b\u4e00\u6b65","text":"<p>\u74b0\u5883\u6e96\u5099\u5b8c\u6210\u5f8c\uff0c\u8acb\u7e7c\u7e8c\u524d\u5f80 LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE</p>"},{"location":"lab02_docker_install/","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#lab-02-dockerdocker-ce","title":"LAB 02 \u5b89\u88dd DOCKER/DOCKER-CE","text":""},{"location":"lab02_docker_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3\u5bb9\u5668\u5316\u6280\u8853\u7684\u512a\u52e2\u8207\u50b3\u7d71\u90e8\u7f72\u65b9\u5f0f\u7684\u5dee\u7570</li> <li> \u8aaa\u660e Docker \u7684\u6574\u9ad4\u67b6\u69cb\u8207\u6838\u5fc3\u5143\u4ef6</li> <li> \u5340\u5206 Docker \u8207 Podman \u7684\u5dee\u7570\u8207\u9069\u7528\u5834\u666f</li> <li> \u7406\u89e3\u5fae\u670d\u52d9\u67b6\u69cb\uff08Microservices\uff09\u7684\u57fa\u672c\u6982\u5ff5</li> </ul>"},{"location":"lab02_docker_install/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5177\u5099 Linux \u57fa\u790e\u6307\u4ee4\u64cd\u4f5c\u80fd\u529b</li> <li>\u7406\u89e3\u57fa\u672c\u7684\u7db2\u8def\u6982\u5ff5\uff08IP\u3001Port\uff09</li> <li>\u4e86\u89e3\u50b3\u7d71\u61c9\u7528\u7a0b\u5f0f\u90e8\u7f72\u7684\u57fa\u672c\u6d41\u7a0b</li> </ul>"},{"location":"lab02_docker_install/#11","title":"1.1 \u5bb9\u5668\u5316\u7684\u597d\u8655","text":""},{"location":"lab02_docker_install/#_3","title":"\u4ec0\u9ebc\u662f\u5bb9\u5668\u5316\uff1f","text":"<p>Container\uff08\u5bb9\u5668\uff09\u662f\u4e00\u7a2e\u8f15\u91cf\u7d1a\u7684\u865b\u64ec\u5316\u6280\u8853\uff0c\u5b83\u5c07\u61c9\u7528\u7a0b\u5f0f\u53ca\u5176\u6240\u6709\u4f9d\u8cf4\u9805\u6253\u5305\u5728\u4e00\u8d77\uff0c\u78ba\u4fdd\u61c9\u7528\u7a0b\u5f0f\u5728\u4efb\u4f55\u74b0\u5883\u4e2d\u90fd\u80fd\u4e00\u81f4\u5730\u904b\u884c\u3002</p> <p>\u5bb9\u5668 vs \u865b\u64ec\u6a5f</p> <p>\u5bb9\u5668\u8207\u50b3\u7d71\u865b\u64ec\u6a5f\uff08VM\uff09\u7684\u6700\u5927\u5dee\u7570\u5728\u65bc\uff1a</p> <ul> <li>\u865b\u64ec\u6a5f\uff1a\u5305\u542b\u5b8c\u6574\u7684\u4f5c\u696d\u7cfb\u7d71\uff0c\u8cc7\u6e90\u6d88\u8017\u5927</li> <li>\u5bb9\u5668\uff1a\u5171\u4eab\u4e3b\u6a5f\u7684\u4f5c\u696d\u7cfb\u7d71\u6838\u5fc3\uff0c\u555f\u52d5\u5feb\u901f\u3001\u8cc7\u6e90\u6548\u7387\u9ad8</li> </ul>"},{"location":"lab02_docker_install/#vs","title":"\u50b3\u7d71\u90e8\u7f72 vs \u5bb9\u5668\u5316\u90e8\u7f72","text":"<pre><code>graph TB\n    subgraph \"\u50b3\u7d71\u90e8\u7f72\"\n        A1[\u61c9\u7528\u7a0b\u5f0f A] --&gt; OS1[\u4f5c\u696d\u7cfb\u7d71]\n        A2[\u61c9\u7528\u7a0b\u5f0f B] --&gt; OS1\n        OS1 --&gt; HW1[\u786c\u9ad4]\n    end\n\n    subgraph \"\u865b\u64ec\u5316\u90e8\u7f72\"\n        B1[App] --&gt; GOS1[Guest OS]\n        B2[App] --&gt; GOS2[Guest OS]\n        GOS1 --&gt; HV[Hypervisor]\n        GOS2 --&gt; HV\n        HV --&gt; HW2[\u786c\u9ad4]\n    end\n\n    subgraph \"\u5bb9\u5668\u5316\u90e8\u7f72\"\n        C1[Container] --&gt; CR[Container Runtime]\n        C2[Container] --&gt; CR\n        C3[Container] --&gt; CR\n        CR --&gt; OS3[Host OS]\n        OS3 --&gt; HW3[\u786c\u9ad4]\n    end</code></pre>"},{"location":"lab02_docker_install/#_4","title":"\u5bb9\u5668\u5316\u7684\u6838\u5fc3\u512a\u52e2","text":"\u512a\u52e2 \u8aaa\u660e \u53ef\u79fb\u690d\u6027 \u300cBuild once, run anywhere\u300d- \u4e00\u6b21\u5efa\u7f6e\uff0c\u5230\u8655\u904b\u884c \u8cc7\u6e90\u6548\u7387 \u5bb9\u5668\u5171\u4eab OS \u6838\u5fc3\uff0c\u6bd4 VM \u66f4\u8f15\u91cf \u5feb\u901f\u555f\u52d5 \u5bb9\u5668\u555f\u52d5\u6642\u9593\u4ee5\u79d2\u8a08\uff0cVM \u9700\u8981\u6578\u5206\u9418 \u4e00\u81f4\u6027\u74b0\u5883 \u958b\u767c\u3001\u6e2c\u8a66\u3001\u751f\u7522\u74b0\u5883\u5b8c\u5168\u4e00\u81f4 \u9694\u96e2\u6027 \u5404\u5bb9\u5668\u4e4b\u9593\u76f8\u4e92\u9694\u96e2\uff0c\u4e92\u4e0d\u5f71\u97ff \u7248\u672c\u63a7\u5236 Image \u53ef\u4ee5\u7248\u672c\u5316\u7ba1\u7406 \u6613\u65bc\u64f4\u5c55 \u5feb\u901f\u8907\u88fd\u5bb9\u5668\u5be6\u73fe\u6c34\u5e73\u64f4\u5c55 <p>\u5be6\u52d9\u61c9\u7528\u5834\u666f</p> <ul> <li>\u5fae\u670d\u52d9\u67b6\u69cb\u90e8\u7f72</li> <li>CI/CD \u6301\u7e8c\u6574\u5408\u8207\u90e8\u7f72</li> <li>\u958b\u767c\u74b0\u5883\u6a19\u6e96\u5316</li> <li>\u591a\u79df\u6236\u61c9\u7528\u7a0b\u5f0f\u9694\u96e2</li> <li>\u61c9\u7528\u7a0b\u5f0f\u5feb\u901f\u64f4\u5c55</li> </ul>"},{"location":"lab02_docker_install/#_5","title":"\u5fae\u670d\u52d9\u67b6\u69cb\u7c21\u4ecb","text":"<p>Microservices\uff08\u5fae\u670d\u52d9\uff09\u662f\u4e00\u7a2e\u8edf\u9ad4\u67b6\u69cb\u98a8\u683c\uff0c\u5c07\u55ae\u4e00\u61c9\u7528\u7a0b\u5f0f\u62c6\u5206\u70ba\u4e00\u7d44\u5c0f\u578b\u3001\u7368\u7acb\u90e8\u7f72\u7684\u670d\u52d9\u3002</p> <pre><code>graph LR\n    subgraph \"\u55ae\u9ad4\u67b6\u69cb Monolithic\"\n        M[\u6574\u500b\u61c9\u7528\u7a0b\u5f0f]\n    end\n\n    subgraph \"\u5fae\u670d\u52d9\u67b6\u69cb Microservices\"\n        S1[\u7528\u6236\u670d\u52d9]\n        S2[\u8a02\u55ae\u670d\u52d9]\n        S3[\u652f\u4ed8\u670d\u52d9]\n        S4[\u901a\u77e5\u670d\u52d9]\n        S1 &lt;--&gt; S2\n        S2 &lt;--&gt; S3\n        S3 &lt;--&gt; S4\n    end</code></pre> <p>\u5fae\u670d\u52d9\u7bc4\u4f8b</p> <p>\u4ee5\u96fb\u5546\u5e73\u53f0\u70ba\u4f8b\uff0c\u53ef\u62c6\u5206\u70ba\uff1a</p> <ul> <li>\u7528\u6236\u670d\u52d9\uff1a\u8655\u7406\u8a3b\u518a\u3001\u767b\u5165\u3001\u500b\u4eba\u8cc7\u6599</li> <li>\u5546\u54c1\u670d\u52d9\uff1a\u5546\u54c1\u76ee\u9304\u3001\u5eab\u5b58\u7ba1\u7406</li> <li>\u8a02\u55ae\u670d\u52d9\uff1a\u8cfc\u7269\u8eca\u3001\u8a02\u55ae\u8655\u7406</li> <li>\u652f\u4ed8\u670d\u52d9\uff1a\u91d1\u6d41\u6574\u5408</li> <li>\u901a\u77e5\u670d\u52d9\uff1aEmail\u3001\u7c21\u8a0a\u901a\u77e5</li> </ul>"},{"location":"lab02_docker_install/#12-docker","title":"1.2 Docker \u67b6\u69cb","text":""},{"location":"lab02_docker_install/#docker","title":"Docker \u662f\u4ec0\u9ebc\uff1f","text":"<p>Docker \u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u5bb9\u5668\u5316\u5e73\u53f0\uff0c\u7531 Docker, Inc. \u958b\u767c\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u5de5\u5177\u4f86\u5efa\u7acb\u3001\u904b\u884c\u548c\u7ba1\u7406\u5bb9\u5668\u3002</p>"},{"location":"lab02_docker_install/#docker_1","title":"Docker \u6838\u5fc3\u5143\u4ef6","text":"<pre><code>graph TB\n    subgraph \"Docker \u67b6\u69cb\"\n        CLI[Docker CLI] --&gt; API[REST API]\n        API --&gt; Daemon[Docker Daemon]\n        Daemon --&gt; C1[Container 1]\n        Daemon --&gt; C2[Container 2]\n        Daemon --&gt; I[Images]\n        Daemon --&gt; N[Networks]\n        Daemon --&gt; V[Volumes]\n        I --&gt; R[Registry]\n    end</code></pre> \u5143\u4ef6 \u8aaa\u660e Docker Client \u4f7f\u7528\u8005\u64cd\u4f5c\u4ecb\u9762\uff0c\u900f\u904e CLI \u6216 API \u8207 Daemon \u6e9d\u901a Docker Daemon \u80cc\u666f\u670d\u52d9\u7a0b\u5f0f\uff0c\u8ca0\u8cac\u5efa\u7acb\u548c\u7ba1\u7406\u5bb9\u5668 Docker Image \u5bb9\u5668\u7684\u552f\u8b80\u6a21\u677f\uff0c\u5305\u542b\u61c9\u7528\u7a0b\u5f0f\u548c\u4f9d\u8cf4 Docker Container Image \u7684\u57f7\u884c\u5be6\u4f8b Docker Registry \u5132\u5b58\u548c\u5206\u767c Image \u7684\u670d\u52d9"},{"location":"lab02_docker_install/#docker_2","title":"Docker \u904b\u4f5c\u6d41\u7a0b","text":"Docker \u57fa\u672c\u904b\u4f5c\u6d41\u7a0b<pre><code># 1. \u5f9e Registry \u62c9\u53d6 Image\ndocker pull nginx\n\n# 2. \u4f7f\u7528 Image \u5efa\u7acb\u4e26\u555f\u52d5 Container\ndocker run -d --name my-nginx -p 8080:80 nginx\n\n# 3. \u6aa2\u8996\u904b\u884c\u4e2d\u7684 Container\ndocker ps\n\n# 4. \u505c\u6b62 Container\ndocker stop my-nginx\n\n# 5. \u522a\u9664 Container\ndocker rm my-nginx\n</code></pre>"},{"location":"lab02_docker_install/#13-docker","title":"1.3 Docker \u57fa\u672c\u67b6\u69cb","text":""},{"location":"lab02_docker_install/#docker-engine","title":"Docker Engine","text":"<p>Docker Engine \u662f Docker \u7684\u6838\u5fc3\uff0c\u63a1\u7528 Client-Server \u67b6\u69cb\uff1a</p> <pre><code>graph LR\n    subgraph \"Docker Engine\"\n        Client[Docker Client] --&gt;|REST API| Server[Docker Server/Daemon]\n        Server --&gt; containerd\n        containerd --&gt; runc\n        runc --&gt; Container\n    end</code></pre> <p>\u5e95\u5c64\u6280\u8853</p> <p>Docker \u5e95\u5c64\u4f9d\u8cf4 Linux \u7684\u4ee5\u4e0b\u6280\u8853\uff1a</p> <ul> <li>Namespaces\uff1a\u63d0\u4f9b\u9694\u96e2\uff08PID\u3001Network\u3001Mount \u7b49\uff09</li> <li>cgroups\uff1a\u8cc7\u6e90\u9650\u5236\uff08CPU\u3001Memory\uff09</li> <li>UnionFS\uff1a\u5206\u5c64\u6a94\u6848\u7cfb\u7d71</li> </ul>"},{"location":"lab02_docker_install/#docker-objects","title":"Docker Objects","text":""},{"location":"lab02_docker_install/#image","title":"Image\uff08\u6620\u50cf\u6a94\uff09","text":"<p>Image \u662f\u5efa\u7acb Container \u7684\u6a21\u677f\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a</p> <ul> <li>\u552f\u8b80\uff1aImage \u672c\u8eab\u4e0d\u53ef\u4fee\u6539</li> <li>\u5206\u5c64\u7d50\u69cb\uff1a\u7531\u591a\u500b Layer \u5806\u758a\u800c\u6210</li> <li>\u53ef\u7e7c\u627f\uff1a\u53ef\u4ee5\u57fa\u65bc\u73fe\u6709 Image \u5efa\u7acb\u65b0 Image</li> </ul> <pre><code>graph TB\n    subgraph \"Image \u5206\u5c64\u7d50\u69cb\"\n        L4[\u61c9\u7528\u7a0b\u5f0f\u5c64] --&gt; L3[\u4f9d\u8cf4\u5957\u4ef6\u5c64]\n        L3 --&gt; L2[\u7cfb\u7d71\u5de5\u5177\u5c64]\n        L2 --&gt; L1[Base Image \u57fa\u790e\u5c64]\n    end</code></pre>"},{"location":"lab02_docker_install/#container","title":"Container\uff08\u5bb9\u5668\uff09","text":"<p>Container \u662f Image \u7684\u57f7\u884c\u5be6\u4f8b\uff1a</p> <ul> <li>\u53ef\u8b80\u5beb\uff1aContainer \u6709\u81ea\u5df1\u7684\u8b80\u5beb\u5c64</li> <li>\u77ed\u66ab\u6027\uff1aContainer \u505c\u6b62\u5f8c\u8cc7\u6599\u4e0d\u6703\u4fdd\u7559\uff08\u9664\u975e\u4f7f\u7528 Volume\uff09</li> <li>\u9694\u96e2\u6027\uff1a\u6bcf\u500b Container \u6709\u7368\u7acb\u7684\u6a94\u6848\u7cfb\u7d71\u3001\u7db2\u8def\u3001\u7a0b\u5e8f\u7a7a\u9593</li> </ul> Container \u751f\u547d\u9031\u671f<pre><code># \u5efa\u7acb Container\uff08\u672a\u555f\u52d5\uff09\ndocker create --name my-app nginx\n\n# \u555f\u52d5 Container\ndocker start my-app\n\n# \u66ab\u505c Container\ndocker pause my-app\n\n# \u7e7c\u7e8c Container\ndocker unpause my-app\n\n# \u505c\u6b62 Container\ndocker stop my-app\n\n# \u522a\u9664 Container\ndocker rm my-app\n</code></pre>"},{"location":"lab02_docker_install/#layer","title":"Layer \u5206\u5c64\u6a5f\u5236","text":"<pre><code>graph TB\n    subgraph \"Container \u57f7\u884c\u6642\"\n        RW[\u53ef\u8b80\u5beb\u5c64 R/W Layer]\n        RW --&gt; R4[Layer 4 - \u552f\u8b80]\n        R4 --&gt; R3[Layer 3 - \u552f\u8b80]\n        R3 --&gt; R2[Layer 2 - \u552f\u8b80]\n        R2 --&gt; R1[Layer 1 - \u552f\u8b80]\n    end</code></pre> <p>\u5206\u5c64\u512a\u9ede</p> <ul> <li>\u7bc0\u7701\u7a7a\u9593\uff1a\u76f8\u540c Layer \u53ef\u88ab\u591a\u500b Image \u5171\u7528</li> <li>\u52a0\u901f\u5efa\u7f6e\uff1a\u53ea\u6709\u8b8a\u66f4\u7684 Layer \u9700\u8981\u91cd\u5efa</li> <li>\u5feb\u901f\u50b3\u8f38\uff1a\u53ea\u9700\u4e0b\u8f09\u7f3a\u5c11\u7684 Layer</li> </ul>"},{"location":"lab02_docker_install/#14-docker-podman","title":"1.4 Docker \u8207 Podman","text":""},{"location":"lab02_docker_install/#podman","title":"Podman \u7c21\u4ecb","text":"<p>Podman \u662f Red Hat \u958b\u767c\u7684\u5bb9\u5668\u5de5\u5177\uff0c\u63d0\u4f9b\u8207 Docker \u76f8\u5bb9\u7684 CLI \u4ecb\u9762\uff0c\u4f46\u63a1\u7528\u4e0d\u540c\u7684\u67b6\u69cb\u8a2d\u8a08\u3002</p>"},{"location":"lab02_docker_install/#docker-vs-podman","title":"Docker vs Podman \u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee Docker Podman \u67b6\u69cb Daemon-based\uff08\u9700\u8981\u80cc\u666f\u670d\u52d9\uff09 Daemonless\uff08\u7121\u9700\u80cc\u666f\u670d\u52d9\uff09 Root \u6b0a\u9650 \u9810\u8a2d\u9700\u8981 root \u652f\u63f4 Rootless \u6a21\u5f0f SystemD \u6574\u5408 \u8f03\u5f31 \u539f\u751f\u652f\u63f4 Pod \u652f\u63f4 \u4e0d\u652f\u63f4 \u539f\u751f\u652f\u63f4 Pod \u6982\u5ff5 \u6307\u4ee4\u76f8\u5bb9 - \u5e7e\u4e4e 100% \u76f8\u5bb9 Docker CLI \u6620\u50cf\u683c\u5f0f Docker/OCI Docker/OCI"},{"location":"lab02_docker_install/#_6","title":"\u67b6\u69cb\u5dee\u7570","text":"Docker \u67b6\u69cbPodman \u67b6\u69cb <pre><code>graph TB\n    CLI[Docker CLI] --&gt; Daemon[Docker Daemon]\n    Daemon --&gt; Container1[Container]\n    Daemon --&gt; Container2[Container]\n\n    style Daemon fill:#f96,stroke:#333</code></pre> <p>Docker Daemon \u4f5c\u70ba\u55ae\u9ede\u670d\u52d9\uff0c\u7ba1\u7406\u6240\u6709\u5bb9\u5668\u3002</p> <pre><code>graph TB\n    CLI[Podman CLI] --&gt; Container1[Container]\n    CLI --&gt; Container2[Container]\n\n    style CLI fill:#9f6,stroke:#333\nend</code></pre> <p>Podman \u76f4\u63a5 fork \u51fa\u5bb9\u5668\u7a0b\u5e8f\uff0c\u7121\u9700\u4e2d\u592e Daemon\u3002</p>"},{"location":"lab02_docker_install/#_7","title":"\u6307\u4ee4\u5c0d\u7167","text":"Docker \u6307\u4ee4<pre><code>docker run -d nginx\ndocker ps\ndocker images\ndocker build -t myapp .\n</code></pre> Podman \u6307\u4ee4\uff08\u5e7e\u4e4e\u76f8\u540c\uff09<pre><code>podman run -d nginx\npodman ps\npodman images\npodman build -t myapp .\n</code></pre> <p>\u5feb\u901f\u5207\u63db\u6280\u5de7</p> <p>\u53ef\u4ee5\u5728 <code>.bashrc</code> \u6216 <code>.zshrc</code> \u52a0\u5165\uff1a </p><pre><code>alias docker=podman\n</code></pre><p></p>"},{"location":"lab02_docker_install/#podman_1","title":"\u4f55\u6642\u9078\u64c7 Podman\uff1f","text":"<p>\u5efa\u8b70\u4f7f\u7528 Podman \u7684\u5834\u666f</p> <ul> <li>RHEL/CentOS/Fedora \u74b0\u5883</li> <li>\u9700\u8981 Rootless \u5bb9\u5668\u7684\u5b89\u5168\u9700\u6c42</li> <li>\u4f01\u696d\u74b0\u5883\u9700\u8981\u8207 Kubernetes \u66f4\u597d\u7684\u6574\u5408</li> <li>\u4e0d\u5e0c\u671b\u904b\u884c\u6301\u7e8c\u7684\u80cc\u666f\u670d\u52d9</li> </ul>"},{"location":"lab02_docker_install/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":""},{"location":"lab02_docker_install/#lab-1-1-docker","title":"Lab 1-1\uff1a\u5b89\u88dd Docker","text":"<p>\u76ee\u6a19\uff1a\u5728 Linux \u7cfb\u7d71\u4e0a\u5b89\u88dd Docker</p> <p>\u74b0\u5883\uff1aUbuntu 22.04 \u6216 CentOS 8+</p> UbuntuCentOS/RHEL Ubuntu \u5b89\u88dd Docker<pre><code># 1. \u66f4\u65b0\u5957\u4ef6\u7d22\u5f15\nsudo apt-get update\n\n# 2. \u5b89\u88dd\u5fc5\u8981\u5957\u4ef6\nsudo apt-get install -y ca-certificates curl gnupg\n\n# 3. \u6dfb\u52a0 Docker \u5b98\u65b9 GPG \u91d1\u9470\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\n\n# 4. \u8a2d\u5b9a Docker \u5957\u4ef6\u5eab\necho \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  $(. /etc/os-release &amp;&amp; echo \"$VERSION_CODENAME\") stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n\n# 5. \u5b89\u88dd Docker\nsudo apt-get update\nsudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# 6. \u5c07\u76ee\u524d\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n\n# 7. \u91cd\u65b0\u767b\u5165\u5f8c\u751f\u6548\uff0c\u6216\u57f7\u884c\nnewgrp docker\n</code></pre> CentOS/RHEL \u5b89\u88dd Docker<pre><code># 1. \u79fb\u9664\u820a\u7248\u672c\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine\n\n# 2. \u5b89\u88dd yum-utils\nsudo yum install -y yum-utils\n\n# 3. \u8a2d\u5b9a Docker \u5957\u4ef6\u5eab\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\n# 4. \u5b89\u88dd Docker\nsudo yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# 5. \u555f\u52d5 Docker\nsudo systemctl start docker\nsudo systemctl enable docker\n\n# 6. \u5c07\u76ee\u524d\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n</code></pre> <p>\u9a57\u8b49\u5b89\u88dd\uff1a</p> \u9a57\u8b49 Docker \u5b89\u88dd<pre><code># \u6aa2\u67e5 Docker \u7248\u672c\ndocker --version\n\n# \u6aa2\u67e5 Docker \u670d\u52d9\u72c0\u614b\nsudo systemctl status docker\n\n# \u57f7\u884c\u6e2c\u8a66\u5bb9\u5668\ndocker run hello-world\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>Hello from Docker!\nThis message shows that your installation appears to be working correctly.\n...\n</code></pre>"},{"location":"lab02_docker_install/#lab-1-2docker","title":"Lab 1-2\uff1aDocker \u57fa\u672c\u64cd\u4f5c\u7df4\u7fd2","text":"<p>\u76ee\u6a19\uff1a\u719f\u6089 Docker \u57fa\u672c\u6307\u4ee4</p> \u6b65\u9a5f 1\uff1a\u62c9\u53d6 Image<pre><code># \u62c9\u53d6 nginx Image\ndocker pull nginx:latest\n\n# \u6aa2\u8996\u672c\u5730 Image\ndocker images\n</code></pre> \u6b65\u9a5f 2\uff1a\u5efa\u7acb\u4e26\u57f7\u884c Container<pre><code># \u57f7\u884c nginx Container\ndocker run -d --name my-nginx -p 8080:80 nginx:latest\n\n# \u6aa2\u8996\u904b\u884c\u4e2d\u7684 Container\ndocker ps\n</code></pre> \u6b65\u9a5f 3\uff1a\u5b58\u53d6\u670d\u52d9<pre><code># \u4f7f\u7528 curl \u6e2c\u8a66\ncurl http://localhost:8080\n\n# \u6216\u5728\u700f\u89bd\u5668\u958b\u555f http://localhost:8080\n</code></pre> \u6b65\u9a5f 4\uff1a\u9032\u5165 Container<pre><code># \u57f7\u884c\u4e92\u52d5\u5f0f Shell\ndocker exec -it my-nginx /bin/bash\n\n# \u5728 Container \u5167\u6aa2\u8996 nginx \u8a2d\u5b9a\ncat /etc/nginx/nginx.conf\n\n# \u96e2\u958b Container\nexit\n</code></pre> \u6b65\u9a5f 5\uff1a\u6e05\u7406\u8cc7\u6e90<pre><code># \u505c\u6b62 Container\ndocker stop my-nginx\n\n# \u522a\u9664 Container\ndocker rm my-nginx\n\n# \u522a\u9664 Image\ndocker rmi nginx:latest\n</code></pre>"},{"location":"lab02_docker_install/#_8","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1adocker: Cannot connect to the Docker daemon <p>\u539f\u56e0\uff1aDocker Daemon \u672a\u555f\u52d5</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u555f\u52d5 Docker \u670d\u52d9\nsudo systemctl start docker\n\n# \u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5\nsudo systemctl enable docker\n</code></pre><p></p> Q2\uff1apermission denied while trying to connect to the Docker daemon socket <p>\u539f\u56e0\uff1a\u76ee\u524d\u4f7f\u7528\u8005\u6c92\u6709\u6b0a\u9650\u5b58\u53d6 Docker</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u5c07\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n\n# \u91cd\u65b0\u767b\u5165\u6216\u57f7\u884c\nnewgrp docker\n</code></pre><p></p> Q3\uff1aDocker \u8207 Podman \u53ef\u4ee5\u540c\u6642\u5b89\u88dd\u55ce\uff1f <p>\u56de\u7b54\uff1a\u53ef\u4ee5\uff0c\u4f46\u5efa\u8b70\u9078\u64c7\u5176\u4e2d\u4e00\u500b\u4f5c\u70ba\u4e3b\u8981\u5de5\u5177\u3002</p> <p>\u5982\u679c\u9700\u8981\u540c\u6642\u4f7f\u7528\uff0c\u6ce8\u610f\u4ee5\u4e0b\u5e7e\u9ede\uff1a</p> <ul> <li>\u5169\u8005\u7684 Image \u5132\u5b58\u4f4d\u7f6e\u4e0d\u540c</li> <li>Container \u4e0d\u6703\u4e92\u76f8\u986f\u793a</li> <li>\u53ef\u80fd\u9020\u6210 Port \u885d\u7a81</li> </ul> Q4\uff1a\u5982\u4f55\u67e5\u770b Container \u7684 Log\uff1f <p>\u89e3\u7b54\uff1a </p><pre><code># \u67e5\u770b Log\ndocker logs my-nginx\n\n# \u6301\u7e8c\u8ffd\u8e64 Log\ndocker logs -f my-nginx\n\n# \u986f\u793a\u6700\u5f8c 100 \u884c\ndocker logs --tail 100 my-nginx\n</code></pre><p></p>"},{"location":"lab02_docker_install/#_9","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 \u5bb9\u5668\u5316\u512a\u52e2\uff1a\u53ef\u79fb\u690d\u6027\u3001\u8cc7\u6e90\u6548\u7387\u3001\u5feb\u901f\u555f\u52d5\u3001\u74b0\u5883\u4e00\u81f4\u6027</li> <li>\u2705 Docker \u67b6\u69cb\uff1aClient-Server \u6a21\u5f0f\uff0c\u5305\u542b Daemon\u3001Image\u3001Container\u3001Registry</li> <li>\u2705 Docker \u57fa\u672c\u5143\u4ef6\uff1aImage \u662f\u6a21\u677f\uff0cContainer \u662f\u57f7\u884c\u5be6\u4f8b</li> <li>\u2705 \u5206\u5c64\u6a5f\u5236\uff1aImage \u7531\u591a\u500b Layer \u7d44\u6210\uff0cContainer \u6709\u984d\u5916\u7684\u8b80\u5beb\u5c64</li> <li>\u2705 Docker vs Podman\uff1aPodman \u7121\u9700 Daemon\u3001\u652f\u63f4 Rootless\u3001\u8207 Docker CLI \u76f8\u5bb9</li> </ul>"},{"location":"lab02_docker_install/#_10","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Get Started</li> <li>Docker \u67b6\u69cb\u8aaa\u660e</li> <li>Podman \u5b98\u65b9\u6587\u4ef6</li> <li>\u5bb9\u5668\u6280\u8853\u539f\u7406 - Namespaces &amp; Cgroups</li> <li>OCI \u5bb9\u5668\u898f\u7bc4</li> </ul>"},{"location":"lab03_podman/","title":"LAB 03 \u5b89\u88dd podman","text":""},{"location":"lab03_podman/#lab-03-podman","title":"LAB 03 \u5b89\u88dd Podman","text":""},{"location":"lab03_podman/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab03_podman/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab04_docker_hub_rate_limit/","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#lab-04-docker-hub-rate-limiting","title":"LAB 04 \u5982\u4f55\u6aa2\u67e5 Docker Hub Rate Limiting","text":""},{"location":"lab04_docker_hub_rate_limit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab04_docker_hub_rate_limit/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab05_private_registry/","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#lab-05-private-registry","title":"LAB 05 \u5efa\u7f6e private registry","text":""},{"location":"lab05_private_registry/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u5340\u5206 Public Registry \u8207 Private Registry \u7684\u7528\u9014</li> <li> \u719f\u7df4\u64cd\u4f5c Docker \u57fa\u672c\u6307\u4ee4\uff08run\u3001exec\u3001logs\u3001inspect \u7b49\uff09</li> <li> \u8a2d\u5b9a Docker \u6301\u4e45\u5316\u5132\u5b58\uff08Volumes \u8207 Bind Mounts\uff09</li> <li> \u7406\u89e3\u4e26\u8a2d\u5b9a Docker \u7db2\u8def</li> <li> \u5f9e Docker Hub \u641c\u5c0b\u3001\u62c9\u53d6\u3001\u63a8\u9001 Image</li> <li> \u5b8c\u6210 WordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72\u5be6\u4f5c</li> </ul>"},{"location":"lab05_private_registry/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210\u7b2c 1 \u7ae0\u7684\u5167\u5bb9</li> <li>Docker \u5df2\u6b63\u78ba\u5b89\u88dd\u4e26\u53ef\u57f7\u884c</li> <li>\u7406\u89e3 Image \u8207 Container \u7684\u95dc\u4fc2</li> </ul>"},{"location":"lab05_private_registry/#21-public-registry-private-registry","title":"2.1 Public Registry \u8207 Private Registry","text":""},{"location":"lab05_private_registry/#registry","title":"\u4ec0\u9ebc\u662f Registry\uff1f","text":"<p>Registry\uff08\u5009\u5eab\uff09\u662f\u7528\u4f86\u5132\u5b58\u548c\u5206\u767c Docker Image \u7684\u670d\u52d9\u3002\u5c31\u50cf GitHub \u5132\u5b58\u7a0b\u5f0f\u78bc\u4e00\u6a23\uff0cRegistry \u5132\u5b58\u5bb9\u5668\u6620\u50cf\u6a94\u3002</p> <pre><code>graph LR\n    Dev[\u958b\u767c\u8005] --&gt;|push| Registry[(Registry)]\n    Registry --&gt;|pull| Server1[\u4f3a\u670d\u5668 1]\n    Registry --&gt;|pull| Server2[\u4f3a\u670d\u5668 2]\n    Registry --&gt;|pull| Server3[\u4f3a\u670d\u5668 3]</code></pre>"},{"location":"lab05_private_registry/#public-registry","title":"Public Registry","text":"<p>\u516c\u958b\u7684 Registry \u670d\u52d9\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5b58\u53d6\u516c\u958b\u7684 Image\u3002</p> Registry \u8aaa\u660e \u7db2\u5740 Docker Hub \u5b98\u65b9\u9810\u8a2d Registry\uff0c\u6700\u5927\u7684\u516c\u958b Image \u5009\u5eab hub.docker.com Quay.io Red Hat \u63d0\u4f9b\u7684 Registry quay.io GitHub Container Registry GitHub \u63d0\u4f9b\u7684\u5bb9\u5668 Registry ghcr.io Google Container Registry Google Cloud \u63d0\u4f9b gcr.io Amazon ECR Public AWS \u63d0\u4f9b\u7684\u516c\u958b Registry public.ecr.aws <p>Docker Hub \u4f7f\u7528\u6280\u5de7</p> <ul> <li>\u5b98\u65b9 Image\uff1a\u6c92\u6709\u524d\u7db4\uff0c\u5982 <code>nginx</code>\u3001<code>mysql</code>\u3001<code>redis</code></li> <li>\u793e\u7fa4 Image\uff1a\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff0c\u5982 <code>bitnami/nginx</code></li> <li>\u6a19\u7c64\uff1a\u6307\u5b9a\u7248\u672c\uff0c\u5982 <code>nginx:1.25</code>\u3001<code>nginx:alpine</code></li> </ul>"},{"location":"lab05_private_registry/#private-registry","title":"Private Registry","text":"<p>\u79c1\u6709 Registry \u7528\u65bc\u5132\u5b58\u4f01\u696d\u5167\u90e8\u7684 Image\uff0c\u4e0d\u5c0d\u5916\u516c\u958b\u3002</p>"},{"location":"lab05_private_registry/#registry_1","title":"\u5e38\u898b\u79c1\u6709 Registry \u65b9\u6848","text":"\u65b9\u6848 \u8aaa\u660e \u9069\u7528\u5834\u666f Docker Registry Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u8f15\u91cf\u7d1a Registry \u5c0f\u578b\u5718\u968a\u3001\u6e2c\u8a66\u74b0\u5883 Harbor VMware \u958b\u6e90\u7684\u4f01\u696d\u7d1a Registry \u5927\u578b\u4f01\u696d\u3001\u9700\u8981 RBAC Nexus Repository Sonatype \u7684\u591a\u529f\u80fd\u5009\u5eab \u5df2\u4f7f\u7528 Nexus \u7ba1\u7406\u5957\u4ef6 JFrog Artifactory \u4f01\u696d\u7d1a\u88fd\u54c1\u7ba1\u7406 \u5927\u578b\u4f01\u696d AWS ECR AWS \u79c1\u6709 Registry AWS \u96f2\u7aef\u74b0\u5883 Azure ACR Azure \u79c1\u6709 Registry Azure \u96f2\u7aef\u74b0\u5883 GCP GCR Google \u79c1\u6709 Registry GCP \u96f2\u7aef\u74b0\u5883"},{"location":"lab05_private_registry/#private-registry_1","title":"\u5efa\u7acb\u7c21\u6613 Private Registry","text":"\u4f7f\u7528 Docker \u5efa\u7acb\u79c1\u6709 Registry<pre><code># \u555f\u52d5 Registry Container\ndocker run -d \\\n  --name my-registry \\\n  -p 5000:5000 \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n\n# \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag nginx:latest localhost:5000/my-nginx:v1\n\n# \u63a8\u9001\u5230\u79c1\u6709 Registry\ndocker push localhost:5000/my-nginx:v1\n\n# \u5f9e\u79c1\u6709 Registry \u62c9\u53d6\ndocker pull localhost:5000/my-nginx:v1\n</code></pre> <p>\u751f\u7522\u74b0\u5883\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u79c1\u6709 Registry \u61c9\u914d\u7f6e TLS \u6191\u8b49</li> <li>\u8a2d\u5b9a\u9069\u7576\u7684\u5b58\u53d6\u63a7\u5236</li> <li>\u5b9a\u671f\u5099\u4efd Registry \u8cc7\u6599</li> <li>\u8003\u616e\u4f7f\u7528\u4f01\u696d\u7d1a\u65b9\u6848\u5982 Harbor</li> </ul>"},{"location":"lab05_private_registry/#22-docker","title":"2.2 Docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab05_private_registry/#container","title":"Container \u751f\u547d\u9031\u671f\u7ba1\u7406","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: docker create\n    Created --&gt; Running: docker start\n    Running --&gt; Paused: docker pause\n    Paused --&gt; Running: docker unpause\n    Running --&gt; Stopped: docker stop\n    Stopped --&gt; Running: docker start\n    Stopped --&gt; Removed: docker rm\n    Running --&gt; Removed: docker rm -f\n    Removed --&gt; [*]</code></pre>"},{"location":"lab05_private_registry/#_3","title":"\u6838\u5fc3\u6307\u4ee4\u8a73\u89e3","text":""},{"location":"lab05_private_registry/#docker-run-","title":"docker run - \u57f7\u884c\u5bb9\u5668","text":"docker run \u5e38\u7528\u9078\u9805<pre><code># \u57fa\u672c\u57f7\u884c\ndocker run nginx\n\n# \u80cc\u666f\u57f7\u884c (detached)\ndocker run -d nginx\n\n# \u6307\u5b9a\u540d\u7a31\ndocker run -d --name my-nginx nginx\n\n# Port \u5c0d\u61c9 (\u4e3b\u6a5f:\u5bb9\u5668)\ndocker run -d -p 8080:80 nginx\n\n# \u74b0\u5883\u8b8a\u6578\ndocker run -d -e MYSQL_ROOT_PASSWORD=secret mysql\n\n# \u81ea\u52d5\u522a\u9664\uff08\u7d50\u675f\u5f8c\u81ea\u52d5\u79fb\u9664\uff09\ndocker run --rm nginx echo \"Hello\"\n\n# \u4e92\u52d5\u6a21\u5f0f\ndocker run -it ubuntu /bin/bash\n\n# \u8cc7\u6e90\u9650\u5236\ndocker run -d --memory=\"512m\" --cpus=\"1.0\" nginx\n\n# \u91cd\u555f\u7b56\u7565\ndocker run -d --restart=always nginx\n</code></pre> <p>docker run \u9078\u9805\u8aaa\u660e</p> \u9078\u9805 \u8aaa\u660e <code>-d</code> Detached mode\uff0c\u80cc\u666f\u57f7\u884c <code>-it</code> \u4e92\u52d5\u6a21\u5f0f + TTY <code>-p</code> Port mapping <code>-v</code> Volume mapping <code>-e</code> \u74b0\u5883\u8b8a\u6578 <code>--name</code> \u6307\u5b9a\u5bb9\u5668\u540d\u7a31 <code>--rm</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>--restart</code> \u91cd\u555f\u7b56\u7565"},{"location":"lab05_private_registry/#docker-exec-","title":"docker exec - \u57f7\u884c\u6307\u4ee4","text":"\u5728\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u57f7\u884c\u6307\u4ee4<pre><code># \u57f7\u884c\u55ae\u4e00\u6307\u4ee4\ndocker exec my-nginx cat /etc/nginx/nginx.conf\n\n# \u9032\u5165\u4e92\u52d5\u5f0f Shell\ndocker exec -it my-nginx /bin/bash\n\n# \u4ee5\u7279\u5b9a\u4f7f\u7528\u8005\u57f7\u884c\ndocker exec -u root my-nginx whoami\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\ndocker exec -e VAR=value my-nginx printenv VAR\n</code></pre>"},{"location":"lab05_private_registry/#docker-logs-","title":"docker logs - \u6aa2\u8996\u65e5\u8a8c","text":"Container \u65e5\u8a8c\u64cd\u4f5c<pre><code># \u6aa2\u8996\u5168\u90e8\u65e5\u8a8c\ndocker logs my-nginx\n\n# \u6301\u7e8c\u8ffd\u8e64\u65e5\u8a8c\ndocker logs -f my-nginx\n\n# \u986f\u793a\u6700\u5f8c N \u884c\ndocker logs --tail 100 my-nginx\n\n# \u986f\u793a\u6642\u9593\u6233\u8a18\ndocker logs -t my-nginx\n\n# \u6307\u5b9a\u6642\u9593\u7bc4\u570d\ndocker logs --since 2024-01-01 my-nginx\ndocker logs --since 10m my-nginx  # \u6700\u8fd1 10 \u5206\u9418\n</code></pre>"},{"location":"lab05_private_registry/#docker-inspect-","title":"docker inspect - \u6aa2\u8996\u8a73\u7d30\u8cc7\u8a0a","text":"\u6aa2\u8996\u5bb9\u5668/\u6620\u50cf\u6a94\u8a73\u7d30\u8cc7\u8a0a<pre><code># \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\uff08JSON \u683c\u5f0f\uff09\ndocker inspect my-nginx\n\n# \u53d6\u5f97\u7279\u5b9a\u8cc7\u8a0a\uff08\u4f7f\u7528 Go \u6a21\u677f\uff09\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' my-nginx\n\n# \u53d6\u5f97 Port \u5c0d\u61c9\ndocker inspect --format='{{range $p, $conf := .NetworkSettings.Ports}}{{$p}} -&gt; {{(index $conf 0).HostPort}}{{end}}' my-nginx\n\n# \u53d6\u5f97\u639b\u8f09\u8cc7\u8a0a\ndocker inspect --format='{{json .Mounts}}' my-nginx | jq .\n</code></pre>"},{"location":"lab05_private_registry/#_4","title":"\u5176\u4ed6\u5e38\u7528\u6307\u4ee4","text":"\u5bb9\u5668\u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker ps\n\n# \u5217\u51fa\u6240\u6709\u5bb9\u5668\uff08\u5305\u542b\u5df2\u505c\u6b62\uff09\ndocker ps -a\n\n# \u505c\u6b62\u5bb9\u5668\ndocker stop my-nginx\n\n# \u555f\u52d5\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker start my-nginx\n\n# \u91cd\u555f\u5bb9\u5668\ndocker restart my-nginx\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm my-nginx\n\n# \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker rm -f my-nginx\n\n# \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n\n# \u6aa2\u8996\u5bb9\u5668\u8cc7\u6e90\u4f7f\u7528\ndocker stats\n\n# \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668\ndocker cp ./index.html my-nginx:/usr/share/nginx/html/\n\n# \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848\ndocker cp my-nginx:/etc/nginx/nginx.conf ./nginx.conf\n</code></pre>"},{"location":"lab05_private_registry/#23-persistent-storage","title":"2.3 Persistent Storage","text":""},{"location":"lab05_private_registry/#_5","title":"\u70ba\u4ec0\u9ebc\u9700\u8981\u6301\u4e45\u5316\u5132\u5b58\uff1f","text":"<p>Container \u9810\u8a2d\u7684\u8cc7\u6599\u662f\u77ed\u66ab\u7684\uff08ephemeral\uff09\uff0c\u7576 Container \u88ab\u522a\u9664\u6642\uff0c\u6240\u6709\u8cc7\u6599\u90fd\u6703\u6d88\u5931\u3002</p> <pre><code>graph LR\n    subgraph \"\u6c92\u6709\u6301\u4e45\u5316\"\n        C1[Container] --&gt; RW1[\u8b80\u5beb\u5c64]\n        RW1 -.-&gt;|\u522a\u9664\u5bb9\u5668| X[\u8cc7\u6599\u6d88\u5931]\n    end\n\n    subgraph \"\u4f7f\u7528\u6301\u4e45\u5316\"\n        C2[Container] --&gt; RW2[\u8b80\u5beb\u5c64]\n        C2 --&gt; V[Volume/Bind Mount]\n        V --&gt;|\u5bb9\u5668\u522a\u9664| V\n    end</code></pre>"},{"location":"lab05_private_registry/#_6","title":"\u4e09\u7a2e\u5132\u5b58\u65b9\u5f0f","text":"\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f Volume \u7531 Docker \u7ba1\u7406\u7684\u5132\u5b58\u5340\u57df \u751f\u7522\u74b0\u5883\u3001\u8cc7\u6599\u6301\u4e45\u5316 Bind Mount \u5c07\u4e3b\u6a5f\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668 \u958b\u767c\u74b0\u5883\u3001\u7a0b\u5f0f\u78bc\u540c\u6b65 tmpfs Mount \u5132\u5b58\u5728\u4e3b\u6a5f\u8a18\u61b6\u9ad4\u4e2d \u66ab\u5b58\u654f\u611f\u8cc7\u6599"},{"location":"lab05_private_registry/#volumes","title":"Volumes","text":"Volume \u57fa\u672c\u64cd\u4f5c<pre><code># \u5efa\u7acb Volume\ndocker volume create my-data\n\n# \u5217\u51fa\u6240\u6709 Volume\ndocker volume ls\n\n# \u6aa2\u8996 Volume \u8a73\u7d30\u8cc7\u8a0a\ndocker volume inspect my-data\n\n# \u4f7f\u7528 Volume \u57f7\u884c\u5bb9\u5668\ndocker run -d \\\n  --name my-nginx \\\n  -v my-data:/usr/share/nginx/html \\\n  nginx\n\n# \u522a\u9664 Volume\ndocker volume rm my-data\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n</code></pre> <p>Volume \u4f4d\u7f6e</p> <p>Docker Volume \u9810\u8a2d\u5132\u5b58\u5728\uff1a</p> <ul> <li>Linux: <code>/var/lib/docker/volumes/</code></li> <li>macOS/Windows: Docker Desktop \u7ba1\u7406\u7684\u865b\u64ec\u78c1\u789f\u5167</li> </ul>"},{"location":"lab05_private_registry/#bind-mounts","title":"Bind Mounts","text":"Bind Mount \u4f7f\u7528\u65b9\u5f0f<pre><code># \u4f7f\u7528 -v \u8a9e\u6cd5\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u4f7f\u7528 --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run -d \\\n  --name my-nginx \\\n  --mount type=bind,source=/path/on/host,target=/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html:ro \\\n  nginx\n</code></pre> <p>\u958b\u767c\u74b0\u5883\u7bc4\u4f8b</p> \u524d\u7aef\u958b\u767c\u5373\u6642\u540c\u6b65<pre><code># \u5c07\u672c\u5730\u5c08\u6848\u76ee\u9304\u639b\u8f09\u5230\u5bb9\u5668\ndocker run -d \\\n  --name frontend-dev \\\n  -v $(pwd)/src:/app/src \\\n  -p 3000:3000 \\\n  node:18\n</code></pre> <p>\u4fee\u6539\u672c\u5730 <code>src</code> \u76ee\u9304\u7684\u6a94\u6848\u6703\u7acb\u5373\u53cd\u6620\u5230\u5bb9\u5668\u4e2d\u3002</p>"},{"location":"lab05_private_registry/#volume-vs-bind-mount","title":"Volume vs Bind Mount \u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee Volume Bind Mount \u5132\u5b58\u4f4d\u7f6e Docker \u7ba1\u7406 \u6307\u5b9a\u4e3b\u6a5f\u8def\u5f91 \u53ef\u79fb\u690d\u6027 \u9ad8 \u4f9d\u8cf4\u4e3b\u6a5f\u8def\u5f91 \u6548\u80fd \u8f03\u4f73 \u53d6\u6c7a\u65bc\u4e3b\u6a5f\u6a94\u6848\u7cfb\u7d71 \u5099\u4efd \u5bb9\u6613 \u9700\u624b\u52d5\u8655\u7406 \u9069\u7528\u5834\u666f \u751f\u7522\u74b0\u5883 \u958b\u767c\u74b0\u5883"},{"location":"lab05_private_registry/#24-docker-network","title":"2.4 Docker Network","text":""},{"location":"lab05_private_registry/#_7","title":"\u9810\u8a2d\u7db2\u8def\u985e\u578b","text":"<p>Docker \u63d0\u4f9b\u591a\u7a2e\u7db2\u8def\u9a45\u52d5\uff0c\u6eff\u8db3\u4e0d\u540c\u7684\u4f7f\u7528\u5834\u666f\u3002</p> <pre><code>graph TB\n    subgraph \"Bridge Network\uff08\u9810\u8a2d\uff09\"\n        B_C1[Container 1] --- B_NET[docker0 bridge]\n        B_C2[Container 2] --- B_NET\n        B_NET --- B_HOST[Host Network Stack]\n    end\n\n    subgraph \"Host Network\"\n        H_C[Container] --- H_HOST[Host Network Stack]\n    end\n\n    subgraph \"None Network\"\n        N_C[Container - \u7121\u7db2\u8def]\n    end</code></pre> \u7db2\u8def\u985e\u578b \u8aaa\u660e \u9069\u7528\u5834\u666f bridge \u9810\u8a2d\u7db2\u8def\uff0cContainer \u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 \u55ae\u6a5f\u591a\u5bb9\u5668\u901a\u8a0a host Container \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def \u9700\u8981\u6700\u9ad8\u7db2\u8def\u6548\u80fd none \u7121\u7db2\u8def\u9023\u63a5 \u5b89\u5168\u9694\u96e2\u9700\u6c42 overlay \u8de8\u4e3b\u6a5f\u5bb9\u5668\u901a\u8a0a Docker Swarm \u53e2\u96c6 macvlan \u5206\u914d\u771f\u5be6 MAC \u5730\u5740 \u9700\u8981\u76f4\u63a5\u9023\u63a5\u5be6\u9ad4\u7db2\u8def"},{"location":"lab05_private_registry/#_8","title":"\u7db2\u8def\u57fa\u672c\u64cd\u4f5c","text":"Docker \u7db2\u8def\u7ba1\u7406<pre><code># \u5217\u51fa\u6240\u6709\u7db2\u8def\ndocker network ls\n\n# \u6aa2\u8996\u7db2\u8def\u8a73\u7d30\u8cc7\u8a0a\ndocker network inspect bridge\n\n# \u5efa\u7acb\u81ea\u8a02\u7db2\u8def\ndocker network create my-network\n\n# \u5efa\u7acb\u6307\u5b9a\u5b50\u7db2\u8def\u7684\u7db2\u8def\ndocker network create \\\n  --driver bridge \\\n  --subnet 172.20.0.0/16 \\\n  --gateway 172.20.0.1 \\\n  my-custom-network\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm my-network\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u7db2\u8def\ndocker network prune\n</code></pre>"},{"location":"lab05_private_registry/#_9","title":"\u5bb9\u5668\u9023\u63a5\u7db2\u8def","text":"\u5bb9\u5668\u7db2\u8def\u9023\u63a5<pre><code># \u57f7\u884c\u5bb9\u5668\u6642\u6307\u5b9a\u7db2\u8def\ndocker run -d --name app1 --network my-network nginx\n\n# \u5c07\u904b\u884c\u4e2d\u7684\u5bb9\u5668\u9023\u63a5\u5230\u7db2\u8def\ndocker network connect my-network container-name\n\n# \u5c07\u5bb9\u5668\u5f9e\u7db2\u8def\u65b7\u958b\ndocker network disconnect my-network container-name\n</code></pre>"},{"location":"lab05_private_registry/#_10","title":"\u5bb9\u5668\u9593\u901a\u8a0a","text":"<p>\u4f7f\u7528\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</p> <p>\u5728\u540c\u4e00\u500b\u81ea\u8a02\u7db2\u8def\u4e2d\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528**\u5bb9\u5668\u540d\u7a31**\u4f5c\u70ba hostname \u4e92\u76f8\u5b58\u53d6\u3002</p> \u5bb9\u5668\u9593\u901a\u8a0a\u7bc4\u4f8b<pre><code># \u5efa\u7acb\u7db2\u8def\ndocker network create app-network\n\n# \u555f\u52d5 MySQL Container\ndocker run -d \\\n  --name mysql-db \\\n  --network app-network \\\n  -e MYSQL_ROOT_PASSWORD=secret \\\n  mysql:8\n\n# \u555f\u52d5\u61c9\u7528\u7a0b\u5f0f Container\uff0c\u4f7f\u7528 mysql-db \u4f5c\u70ba\u8cc7\u6599\u5eab\u4e3b\u6a5f\ndocker run -d \\\n  --name my-app \\\n  --network app-network \\\n  -e DB_HOST=mysql-db \\\n  -e DB_PASSWORD=secret \\\n  my-application\n\n# \u6e2c\u8a66\u9023\u7dda\ndocker exec my-app ping mysql-db\n</code></pre>"},{"location":"lab05_private_registry/#port","title":"Port \u5c0d\u61c9","text":"Port Mapping<pre><code># \u5c0d\u61c9\u55ae\u4e00 Port\ndocker run -d -p 8080:80 nginx\n\n# \u5c0d\u61c9\u591a\u500b Port\ndocker run -d -p 8080:80 -p 8443:443 nginx\n\n# \u5c0d\u61c9\u5230\u6240\u6709\u4ecb\u9762\u7684\u96a8\u6a5f Port\ndocker run -d -P nginx\n\n# \u53ea\u5c0d\u61c9\u5230 localhost\ndocker run -d -p 127.0.0.1:8080:80 nginx\n\n# \u5c0d\u61c9 UDP Port\ndocker run -d -p 53:53/udp dns-server\n</code></pre>"},{"location":"lab05_private_registry/#25-docker-search","title":"2.5 Docker Search","text":""},{"location":"lab05_private_registry/#image","title":"\u641c\u5c0b Image","text":"\u641c\u5c0b Docker Hub<pre><code># \u57fa\u672c\u641c\u5c0b\ndocker search nginx\n\n# \u9650\u5236\u7d50\u679c\u6578\u91cf\ndocker search --limit 5 nginx\n\n# \u53ea\u986f\u793a\u5b98\u65b9 Image\ndocker search --filter is-official=true nginx\n\n# \u53ea\u986f\u793a\u81ea\u52d5\u5efa\u7f6e\u7684 Image\ndocker search --filter is-automated=true nginx\n\n# \u6839\u64da\u661f\u661f\u6578\u904e\u6ffe\ndocker search --filter stars=100 nginx\n</code></pre> <p>\u641c\u5c0b\u7d50\u679c\u8aaa\u660e\uff1a</p> \u6b04\u4f4d \u8aaa\u660e NAME Image \u540d\u7a31 DESCRIPTION \u63cf\u8ff0 STARS \u661f\u661f\u6578\uff08\u4eba\u6c23\u6307\u6a19\uff09 OFFICIAL \u662f\u5426\u70ba\u5b98\u65b9 Image AUTOMATED \u662f\u5426\u81ea\u52d5\u5efa\u7f6e <p>\u9078\u64c7 Image \u7684\u5efa\u8b70</p> <ol> <li>\u512a\u5148\u9078\u64c7**\u5b98\u65b9 Image**\uff08OFFICIAL = [OK]\uff09</li> <li>\u67e5\u770b**\u661f\u661f\u6578**\u548c**\u4e0b\u8f09\u6b21\u6578**</li> <li>\u5230 Docker Hub \u7db2\u7ad9\u67e5\u770b**\u6587\u4ef6**\u548c**\u66f4\u65b0\u983b\u7387**</li> <li>\u6aa2\u67e5 Image \u7684**\u5b89\u5168\u6383\u63cf\u7d50\u679c**</li> </ol>"},{"location":"lab05_private_registry/#26-docker-pull","title":"2.6 Docker Pull","text":""},{"location":"lab05_private_registry/#image_1","title":"\u62c9\u53d6 Image","text":"\u62c9\u53d6 Image<pre><code># \u62c9\u53d6\u6700\u65b0\u7248\u672c\uff08\u9810\u8a2d latest tag\uff09\ndocker pull nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\ndocker pull nginx:1.25\n\n# \u62c9\u53d6\u7279\u5b9a\u7248\u672c\uff08alpine \u8f15\u91cf\u7248\uff09\ndocker pull nginx:alpine\n\n# \u5f9e\u5176\u4ed6 Registry \u62c9\u53d6\ndocker pull quay.io/bitnami/nginx\n\n# \u62c9\u53d6\u7279\u5b9a\u5e73\u53f0\u7684 Image\ndocker pull --platform linux/amd64 nginx\n</code></pre>"},{"location":"lab05_private_registry/#image-tag","title":"Image \u6a19\u7c64\uff08Tag\uff09","text":"<pre><code>graph LR\n    N[nginx] --&gt; L[latest]\n    N --&gt; V1[1.25]\n    N --&gt; V2[1.25.3]\n    N --&gt; A[alpine]\n    N --&gt; VA[1.25-alpine]</code></pre> <p>\u907f\u514d\u4f7f\u7528 latest</p> <ul> <li><code>latest</code> \u6a19\u7c64\u6703\u96a8\u6642\u9593\u8b8a\u5316</li> <li>\u751f\u7522\u74b0\u5883\u61c9\u4f7f\u7528**\u660e\u78ba\u7248\u672c\u865f**</li> <li>\u4f8b\u5982\uff1a<code>nginx:1.25.3</code> \u800c\u975e <code>nginx:latest</code></li> </ul>"},{"location":"lab05_private_registry/#image_2","title":"\u7ba1\u7406\u672c\u5730 Image","text":"Image \u7ba1\u7406\u6307\u4ee4<pre><code># \u5217\u51fa\u672c\u5730 Image\ndocker images\n\n# \u5217\u51fa\u6240\u6709 Image\uff08\u5305\u542b\u4e2d\u9593\u5c64\uff09\ndocker images -a\n\n# \u6aa2\u8996 Image \u8a73\u7d30\u8cc7\u8a0a\ndocker image inspect nginx\n\n# \u6aa2\u8996 Image \u6b77\u53f2\uff08\u5206\u5c64\uff09\ndocker history nginx\n\n# \u522a\u9664 Image\ndocker rmi nginx\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Image\ndocker image prune\n\n# \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image\uff08\u5305\u542b\u672a\u6a19\u8a18\u7684\uff09\ndocker image prune -a\n</code></pre>"},{"location":"lab05_private_registry/#27-docker-push","title":"2.7 Docker Push","text":""},{"location":"lab05_private_registry/#image-registry","title":"\u63a8\u9001 Image \u5230 Registry","text":""},{"location":"lab05_private_registry/#docker-hub","title":"\u63a8\u9001\u5230 Docker Hub","text":"\u63a8\u9001\u5230 Docker Hub<pre><code># 1. \u767b\u5165 Docker Hub\ndocker login\n\n# 2. \u70ba Image \u52a0\u4e0a\u6a19\u7c64\uff08\u5fc5\u9808\u5305\u542b\u4f7f\u7528\u8005\u540d\u7a31\uff09\ndocker tag my-app:v1 username/my-app:v1\n\n# 3. \u63a8\u9001 Image\ndocker push username/my-app:v1\n\n# 4. \u767b\u51fa\uff08\u9078\u7528\uff09\ndocker logout\n</code></pre>"},{"location":"lab05_private_registry/#registry_2","title":"\u63a8\u9001\u5230\u79c1\u6709 Registry","text":"\u63a8\u9001\u5230\u79c1\u6709 Registry<pre><code># 1. \u767b\u5165\u79c1\u6709 Registry\ndocker login my-registry.example.com\n\n# 2. \u70ba Image \u52a0\u4e0a\u79c1\u6709 Registry \u6a19\u7c64\ndocker tag my-app:v1 my-registry.example.com/my-app:v1\n\n# 3. \u63a8\u9001\ndocker push my-registry.example.com/my-app:v1\n</code></pre> <p>Image \u547d\u540d\u898f\u5247</p> <pre><code>[registry/][username/]repository[:tag]\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <ul> <li><code>nginx</code> = <code>docker.io/library/nginx:latest</code></li> <li><code>bitnami/nginx</code> = <code>docker.io/bitnami/nginx:latest</code></li> <li><code>gcr.io/project/app:v1</code></li> </ul>"},{"location":"lab05_private_registry/#_11","title":"\u6a19\u7c64\u7ba1\u7406","text":"Image \u6a19\u7c64\u64cd\u4f5c<pre><code># \u52a0\u4e0a\u65b0\u6a19\u7c64\ndocker tag my-app:v1 my-app:latest\ndocker tag my-app:v1 my-app:stable\n\n# \u63a8\u9001\u591a\u500b\u6a19\u7c64\ndocker push my-app:v1\ndocker push my-app:latest\ndocker push my-app:stable\n</code></pre>"},{"location":"lab05_private_registry/#28-docker-wordpress-mysql","title":"2.8 \u4f7f\u7528 Docker \u67b6\u8a2d WordPress + MySQL","text":""},{"location":"lab05_private_registry/#lab","title":"Lab \u5be6\u4f5c\u76ee\u6a19","text":"<p>\u90e8\u7f72\u4e00\u500b\u5b8c\u6574\u7684 WordPress \u7db2\u7ad9\uff0c\u5305\u542b\uff1a</p> <ul> <li>MySQL \u8cc7\u6599\u5eab\u5bb9\u5668</li> <li>WordPress \u61c9\u7528\u7a0b\u5f0f\u5bb9\u5668</li> <li>\u4f7f\u7528 Docker Network \u9023\u63a5</li> <li>\u4f7f\u7528 Volume \u6301\u4e45\u5316\u8cc7\u6599</li> </ul>"},{"location":"lab05_private_registry/#_12","title":"\u67b6\u69cb\u5716","text":"<pre><code>graph TB\n    subgraph \"Docker \u74b0\u5883\"\n        subgraph \"wp-network\"\n            WP[WordPress&lt;br/&gt;Port: 8080] --&gt;|\u9023\u63a5| DB[(MySQL&lt;br/&gt;Port: 3306)]\n        end\n        WP_VOL[wordpress-data&lt;br/&gt;Volume] --&gt; WP\n        DB_VOL[mysql-data&lt;br/&gt;Volume] --&gt; DB\n    end\n\n    User[\u4f7f\u7528\u8005] --&gt;|http://localhost:8080| WP</code></pre>"},{"location":"lab05_private_registry/#_13","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab05_private_registry/#1","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb\u7db2\u8def","text":"\u5efa\u7acb\u5c08\u7528\u7db2\u8def<pre><code>docker network create wp-network\n</code></pre>"},{"location":"lab05_private_registry/#2-mysql","title":"\u6b65\u9a5f 2\uff1a\u555f\u52d5 MySQL \u5bb9\u5668","text":"\u555f\u52d5 MySQL<pre><code>docker run -d \\\n  --name wp-mysql \\\n  --network wp-network \\\n  -v mysql-data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=rootpassword \\\n  -e MYSQL_DATABASE=wordpress \\\n  -e MYSQL_USER=wpuser \\\n  -e MYSQL_PASSWORD=wppassword \\\n  mysql:8.0\n</code></pre> <p>MySQL \u74b0\u5883\u8b8a\u6578\u8aaa\u660e</p> \u74b0\u5883\u8b8a\u6578 \u8aaa\u660e <code>MYSQL_ROOT_PASSWORD</code> root \u5bc6\u78bc\uff08\u5fc5\u586b\uff09 <code>MYSQL_DATABASE</code> \u81ea\u52d5\u5efa\u7acb\u7684\u8cc7\u6599\u5eab <code>MYSQL_USER</code> \u81ea\u52d5\u5efa\u7acb\u7684\u4f7f\u7528\u8005 <code>MYSQL_PASSWORD</code> \u4f7f\u7528\u8005\u5bc6\u78bc"},{"location":"lab05_private_registry/#3-wordpress","title":"\u6b65\u9a5f 3\uff1a\u555f\u52d5 WordPress \u5bb9\u5668","text":"\u555f\u52d5 WordPress<pre><code>docker run -d \\\n  --name wp-app \\\n  --network wp-network \\\n  -p 8080:80 \\\n  -v wordpress-data:/var/www/html \\\n  -e WORDPRESS_DB_HOST=wp-mysql:3306 \\\n  -e WORDPRESS_DB_NAME=wordpress \\\n  -e WORDPRESS_DB_USER=wpuser \\\n  -e WORDPRESS_DB_PASSWORD=wppassword \\\n  wordpress:latest\n</code></pre>"},{"location":"lab05_private_registry/#4","title":"\u6b65\u9a5f 4\uff1a\u9a57\u8b49\u90e8\u7f72","text":"\u9a57\u8b49\u5bb9\u5668\u72c0\u614b<pre><code># \u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u904b\u884c\ndocker ps\n\n# \u6aa2\u67e5\u5bb9\u5668\u65e5\u8a8c\ndocker logs wp-mysql\ndocker logs wp-app\n\n# \u6e2c\u8a66 MySQL \u9023\u7dda\ndocker exec wp-mysql mysql -uwpuser -pwppassword -e \"SHOW DATABASES;\"\n</code></pre>"},{"location":"lab05_private_registry/#5-wordpress","title":"\u6b65\u9a5f 5\uff1a\u5b58\u53d6 WordPress","text":"<p>\u958b\u555f\u700f\u89bd\u5668\uff0c\u524d\u5f80 <code>http://localhost:8080</code>\uff0c\u5b8c\u6210 WordPress \u5b89\u88dd\u7cbe\u9748\u3002</p>"},{"location":"lab05_private_registry/#docker-compose","title":"\u4f7f\u7528 Docker Compose\uff08\u984d\u5916\u8aaa\u660e\uff09","text":"<p>\u66f4\u7c21\u6f54\u7684\u65b9\u5f0f</p> <p>\u4f7f\u7528 Docker Compose \u53ef\u4ee5\u5c07\u4ee5\u4e0a\u6240\u6709\u8a2d\u5b9a\u96c6\u4e2d\u5728\u4e00\u500b\u6a94\u6848\u4e2d\u3002</p> docker-compose.yml<pre><code>version: '3.8'\n\nservices:\n  db:\n    image: mysql:8.0\n    container_name: wp-mysql\n    volumes:\n      - mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpassword\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wpuser\n      MYSQL_PASSWORD: wppassword\n    networks:\n      - wp-network\n\n  wordpress:\n    image: wordpress:latest\n    container_name: wp-app\n    depends_on:\n      - db\n    ports:\n      - \"8080:80\"\n    volumes:\n      - wordpress-data:/var/www/html\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_NAME: wordpress\n      WORDPRESS_DB_USER: wpuser\n      WORDPRESS_DB_PASSWORD: wppassword\n    networks:\n      - wp-network\n\nnetworks:\n  wp-network:\n    driver: bridge\n\nvolumes:\n  mysql-data:\n  wordpress-data:\n</code></pre> \u4f7f\u7528 Docker Compose \u555f\u52d5<pre><code># \u555f\u52d5\u6240\u6709\u670d\u52d9\ndocker compose up -d\n\n# \u6aa2\u8996\u72c0\u614b\ndocker compose ps\n\n# \u6aa2\u8996\u65e5\u8a8c\ndocker compose logs -f\n\n# \u505c\u6b62\u4e26\u79fb\u9664\ndocker compose down\n\n# \u505c\u6b62\u4e26\u79fb\u9664\uff08\u5305\u542b Volume\uff09\ndocker compose down -v\n</code></pre>"},{"location":"lab05_private_registry/#_14","title":"\u6e05\u7406\u8cc7\u6e90","text":"\u6e05\u7406\u5be6\u4f5c\u74b0\u5883<pre><code># \u505c\u6b62\u5bb9\u5668\ndocker stop wp-app wp-mysql\n\n# \u522a\u9664\u5bb9\u5668\ndocker rm wp-app wp-mysql\n\n# \u522a\u9664\u7db2\u8def\ndocker network rm wp-network\n\n# \u522a\u9664 Volume\uff08\u8b66\u544a\uff1a\u6703\u522a\u9664\u6240\u6709\u8cc7\u6599\uff09\ndocker volume rm mysql-data wordpress-data\n</code></pre>"},{"location":"lab05_private_registry/#_15","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aContainer \u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># \u6aa2\u8996\u5bb9\u5668\u65e5\u8a8c\ndocker logs container-name\n\n# \u6aa2\u8996\u5bb9\u5668\u8a73\u7d30\u8cc7\u8a0a\ndocker inspect container-name\n\n# \u6aa2\u8996\u6700\u5f8c\u9000\u51fa\u72c0\u614b\ndocker ps -a --filter \"name=container-name\"\n</code></pre><p></p> <p>\u5e38\u898b\u539f\u56e0\uff1a</p> <ul> <li>\u555f\u52d5\u6307\u4ee4\u932f\u8aa4</li> <li>\u74b0\u5883\u8b8a\u6578\u7f3a\u5931</li> <li>\u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2</li> <li>\u8a2d\u5b9a\u6a94\u932f\u8aa4</li> </ul> Q2\uff1a\u5982\u4f55\u8b93\u5bb9\u5668\u5728\u4e3b\u6a5f\u91cd\u555f\u5f8c\u81ea\u52d5\u555f\u52d5\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a\u4f7f\u7528 <code>--restart</code> \u9078\u9805 </p><pre><code># always: \u7e3d\u662f\u91cd\u555f\ndocker run -d --restart=always nginx\n\n# unless-stopped: \u9664\u975e\u624b\u52d5\u505c\u6b62\ndocker run -d --restart=unless-stopped nginx\n\n# on-failure: \u53ea\u5728\u7570\u5e38\u9000\u51fa\u6642\u91cd\u555f\ndocker run -d --restart=on-failure:3 nginx\n</code></pre><p></p> Q3\uff1aVolume \u8cc7\u6599\u5982\u4f55\u5099\u4efd\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u65b9\u6cd5 1\uff1a\u4f7f\u7528\u81e8\u6642\u5bb9\u5668\u5099\u4efd\ndocker run --rm \\\n  -v mysql-data:/source:ro \\\n  -v $(pwd):/backup \\\n  alpine tar cvf /backup/mysql-backup.tar /source\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 docker cp\uff08\u9700\u8981\u5148\u639b\u8f09\u5230\u5bb9\u5668\uff09\ndocker cp container-name:/var/lib/mysql ./mysql-backup\n</code></pre><p></p> Q4\uff1a\u5982\u4f55\u67e5\u770b Docker \u4f54\u7528\u7684\u78c1\u789f\u7a7a\u9593\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u8996\u6574\u9ad4\u4f7f\u7528\u60c5\u6cc1\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u6e05\u7406\u6240\u6709\u672a\u4f7f\u7528\u8cc7\u6e90\uff08\u5305\u542b Volume\uff09\ndocker system prune -a --volumes\n</code></pre><p></p> Q5\uff1a\u5bb9\u5668\u9593\u7121\u6cd5\u901a\u8a0a\u600e\u9ebc\u8fa6\uff1f <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code># 1. \u78ba\u8a8d\u5bb9\u5668\u5728\u540c\u4e00\u500b\u7db2\u8def\ndocker network inspect my-network\n\n# 2. \u78ba\u8a8d\u5bb9\u5668 IP\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' container-name\n\n# 3. \u5728\u5bb9\u5668\u5167\u6e2c\u8a66\u9023\u7dda\ndocker exec container1 ping container2\n\n# 4. \u78ba\u8a8d Port \u662f\u5426\u958b\u653e\ndocker exec container1 nc -zv container2 port\n</code></pre><p></p>"},{"location":"lab05_private_registry/#_16","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Registry \u985e\u578b\uff1aPublic Registry\uff08\u5982 Docker Hub\uff09\u8207 Private Registry\uff08\u5982 Harbor\uff09</li> <li>\u2705 Container \u7ba1\u7406\uff1arun\u3001exec\u3001logs\u3001inspect \u7b49\u6838\u5fc3\u6307\u4ee4</li> <li>\u2705 \u6301\u4e45\u5316\u5132\u5b58\uff1aVolume\uff08Docker \u7ba1\u7406\uff09vs Bind Mount\uff08\u4e3b\u6a5f\u76ee\u9304\uff09</li> <li>\u2705 Docker \u7db2\u8def\uff1abridge\u3001host\u3001none \u7db2\u8def\u985e\u578b\uff0c\u81ea\u8a02\u7db2\u8def\u5be6\u73fe\u5bb9\u5668\u9593\u901a\u8a0a</li> <li>\u2705 Image \u64cd\u4f5c\uff1asearch\u3001pull\u3001push\u3001tag \u5b8c\u6574\u6d41\u7a0b</li> <li>\u2705 \u5be6\u4f5c\u7d93\u9a57\uff1aWordPress + MySQL \u5bb9\u5668\u5316\u90e8\u7f72</li> </ul>"},{"location":"lab05_private_registry/#_17","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Storage</li> <li>Docker \u5b98\u65b9\u6587\u4ef6 - Networking</li> <li>Docker Hub \u5b98\u65b9\u7db2\u7ad9</li> <li>Harbor - \u4f01\u696d\u7d1a Registry</li> <li>Docker Compose \u5b98\u65b9\u6587\u4ef6</li> </ul>"},{"location":"lab06_docker_basics/","title":"LAB 06 docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#lab-06-docker","title":"LAB 06 docker \u57fa\u672c\u64cd\u4f5c","text":""},{"location":"lab06_docker_basics/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab06_docker_basics/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab07_persistent_storage/","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#lab-07-persistent-storage","title":"LAB 07 Persistent Storage","text":""},{"location":"lab07_persistent_storage/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab07_persistent_storage/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab08_wordpress/","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - wordpress","text":""},{"location":"lab08_wordpress/#lab-08-wordpress","title":"LAB 08 \u67b6\u8a2d\u90e8\u843d\u683c - wordpress","text":""},{"location":"lab08_wordpress/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab08_wordpress/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab09_commit/","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":""},{"location":"lab09_commit/#lab-09-container-images-docker-commit","title":"LAB 09 \u5ba2\u88fd\u5316 Container Images - docker commit","text":""},{"location":"lab09_commit/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u4f7f\u7528 <code>docker commit</code> \u5f9e\u5bb9\u5668\u5efa\u7acb Image</li> <li> \u64b0\u5beb Dockerfile \u5efa\u7acb\u5ba2\u88fd\u5316 Image</li> <li> \u7406\u89e3 Dockerfile \u6307\u4ee4\u8207\u6700\u4f73\u5be6\u8e10</li> <li> \u512a\u5316 Image \u5927\u5c0f\u8207\u5efa\u7f6e\u6548\u7387</li> <li> \u4e86\u89e3 Source-to-Image\uff08S2I\uff09\u7684\u6982\u5ff5\u8207\u7528\u9014</li> </ul>"},{"location":"lab09_commit/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210\u7b2c 1\u30012 \u7ae0\u7684\u5167\u5bb9</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u5177\u5099\u57fa\u672c\u7684 Linux \u6307\u4ee4\u64cd\u4f5c\u80fd\u529b</li> </ul>"},{"location":"lab09_commit/#31-docker-commit","title":"3.1 Docker Commit","text":""},{"location":"lab09_commit/#docker-commit","title":"\u4ec0\u9ebc\u662f Docker Commit\uff1f","text":"<p><code>docker commit</code> \u662f\u5c07\u57f7\u884c\u4e2d\u7684 Container \u72c0\u614b\u5132\u5b58\u70ba\u65b0 Image \u7684\u6307\u4ee4\u3002\u9019\u662f\u5efa\u7acb\u5ba2\u88fd\u5316 Image \u7684\u7c21\u6613\u65b9\u5f0f\u3002</p> <pre><code>graph LR\n    I1[\u57fa\u790e Image] --&gt; C[Container]\n    C --&gt;|\u4fee\u6539\u914d\u7f6e| C\n    C --&gt;|docker commit| I2[\u65b0 Image]</code></pre>"},{"location":"lab09_commit/#_3","title":"\u4f7f\u7528\u6642\u6a5f","text":"<p>\u9069\u7528\u5834\u666f</p> <ul> <li>\u5feb\u901f\u6e2c\u8a66\u8207\u539f\u578b\u958b\u767c</li> <li>\u4fdd\u5b58\u9664\u932f\u5f8c\u7684\u4fee\u6539</li> <li>\u81e8\u6642\u7522\u751f\u4e00\u6b21\u6027 Image</li> </ul> <p>\u4e0d\u5efa\u8b70\u7528\u65bc\u751f\u7522\u74b0\u5883</p> <ul> <li>\u7121\u6cd5\u8ffd\u8e64\u8b8a\u66f4\u6b77\u53f2</li> <li>\u4e0d\u5177\u5099\u53ef\u91cd\u73fe\u6027</li> <li>\u5efa\u8b70\u4f7f\u7528 Dockerfile \u66ff\u4ee3</li> </ul>"},{"location":"lab09_commit/#_4","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"\u6b65\u9a5f 1\uff1a\u555f\u52d5\u57fa\u790e\u5bb9\u5668<pre><code># \u555f\u52d5 Ubuntu \u5bb9\u5668\ndocker run -it --name my-ubuntu ubuntu:22.04 /bin/bash\n</code></pre> \u6b65\u9a5f 2\uff1a\u5728\u5bb9\u5668\u5167\u9032\u884c\u4fee\u6539<pre><code># \u5728\u5bb9\u5668\u5167\u57f7\u884c\uff08Container \u5167\u90e8\uff09\napt-get update\napt-get install -y nginx vim curl\necho \"Custom Nginx Image\" &gt; /var/www/html/index.html\nexit\n</code></pre> \u6b65\u9a5f 3\uff1a\u5efa\u7acb\u65b0 Image<pre><code># \u5f9e\u5bb9\u5668\u5efa\u7acb Image\ndocker commit my-ubuntu my-nginx:v1\n\n# \u52a0\u4e0a\u4f5c\u8005\u8207\u8a0a\u606f\ndocker commit -a \"Your Name\" -m \"Added nginx and custom page\" my-ubuntu my-nginx:v1\n</code></pre> \u6b65\u9a5f 4\uff1a\u9a57\u8b49\u65b0 Image<pre><code># \u6aa2\u8996 Image\ndocker images | grep my-nginx\n\n# \u6aa2\u8996 Image \u6b77\u53f2\ndocker history my-nginx:v1\n\n# \u4f7f\u7528\u65b0 Image \u555f\u52d5\u5bb9\u5668\ndocker run -d -p 8080:80 my-nginx:v1 nginx -g \"daemon off;\"\n\n# \u6e2c\u8a66\ncurl http://localhost:8080\n</code></pre>"},{"location":"lab09_commit/#docker-commit_1","title":"docker commit \u9078\u9805","text":"\u9078\u9805 \u8aaa\u660e \u7bc4\u4f8b <code>-a</code> \u6307\u5b9a\u4f5c\u8005 <code>-a \"John Doe\"</code> <code>-m</code> \u63d0\u4ea4\u8a0a\u606f <code>-m \"Added nginx\"</code> <code>-c</code> \u5957\u7528 Dockerfile \u6307\u4ee4 <code>-c 'CMD [\"nginx\"]'</code> <code>-p</code> \u63d0\u4ea4\u524d\u66ab\u505c\u5bb9\u5668 <code>-p</code>"},{"location":"lab09_commit/#32-dockerfile","title":"3.2 Dockerfile","text":""},{"location":"lab09_commit/#dockerfile","title":"\u4ec0\u9ebc\u662f Dockerfile\uff1f","text":"<p>Dockerfile \u662f\u4e00\u500b\u6587\u5b57\u6a94\uff0c\u5305\u542b\u4e00\u7cfb\u5217\u6307\u4ee4\u4f86\u5b9a\u7fa9\u5982\u4f55\u5efa\u7acb Docker Image\u3002\u5b83\u63d0\u4f9b\u4e86\u53ef\u8ffd\u8e64\u3001\u53ef\u91cd\u73fe\u7684 Image \u5efa\u7f6e\u6d41\u7a0b\u3002</p> <pre><code>graph LR\n    DF[Dockerfile] --&gt;|docker build| I[Image]\n    I --&gt;|docker run| C[Container]</code></pre>"},{"location":"lab09_commit/#dockerfile_1","title":"Dockerfile \u57fa\u672c\u7d50\u69cb","text":"\u57fa\u672c Dockerfile \u7bc4\u4f8b<pre><code># \u57fa\u790e\u6620\u50cf\nFROM ubuntu:22.04\n\n# \u7dad\u8b77\u8005\u8cc7\u8a0a\uff08\u5df2\u68c4\u7528\uff0c\u5efa\u8b70\u7528 LABEL\uff09\nLABEL maintainer=\"your-email@example.com\"\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\nENV APP_HOME=/app\n\n# \u57f7\u884c\u6307\u4ee4\nRUN apt-get update &amp;&amp; apt-get install -y nginx\n\n# \u8907\u88fd\u6a94\u6848\nCOPY ./src /app\n\n# \u8a2d\u5b9a\u5de5\u4f5c\u76ee\u9304\nWORKDIR /app\n\n# \u958b\u653e Port\nEXPOSE 80\n\n# \u555f\u52d5\u6307\u4ee4\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n</code></pre>"},{"location":"lab09_commit/#dockerfile_2","title":"Dockerfile \u6307\u4ee4\u8a73\u89e3","text":""},{"location":"lab09_commit/#from-","title":"FROM - \u57fa\u790e\u6620\u50cf","text":"FROM \u6307\u4ee4<pre><code># \u4f7f\u7528\u5b98\u65b9 Image\nFROM nginx:1.25\n\n# \u4f7f\u7528 Alpine \u8f15\u91cf\u7248\u672c\nFROM python:3.12-alpine\n\n# \u591a\u968e\u6bb5\u5efa\u7f6e\nFROM node:18 AS builder\nFROM nginx:alpine AS production\n</code></pre> <p>\u9078\u64c7\u57fa\u790e\u6620\u50cf\u7684\u5efa\u8b70</p> <ul> <li>Alpine\uff1a\u6700\u5c0f\u5316\u6620\u50cf\uff0c\u9069\u5408\u751f\u7522\u74b0\u5883</li> <li>Slim\uff1a\u7cbe\u7c21\u7248\uff0c\u5e73\u8861\u5927\u5c0f\u8207\u529f\u80fd</li> <li>\u5b8c\u6574\u7248\uff1a\u958b\u767c\u74b0\u5883\uff0c\u529f\u80fd\u5b8c\u6574</li> </ul>"},{"location":"lab09_commit/#run-","title":"RUN - \u57f7\u884c\u6307\u4ee4","text":"RUN \u6307\u4ee4<pre><code># Shell \u683c\u5f0f\nRUN apt-get update &amp;&amp; apt-get install -y nginx\n\n# Exec \u683c\u5f0f\nRUN [\"apt-get\", \"install\", \"-y\", \"nginx\"]\n\n# \u591a\u500b\u6307\u4ee4\u5408\u4f75\uff08\u6e1b\u5c11 Layer\uff09\nRUN apt-get update \\\n    &amp;&amp; apt-get install -y \\\n        nginx \\\n        vim \\\n        curl \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre> <p>RUN \u6700\u4f73\u5be6\u8e10</p> <ul> <li>\u5408\u4f75\u591a\u500b RUN \u6307\u4ee4\u6e1b\u5c11 Layer \u6578\u91cf</li> <li>\u6e05\u7406 apt cache \u6e1b\u5c11 Image \u5927\u5c0f</li> <li>\u5c07\u8b8a\u52d5\u983b\u7387\u4f4e\u7684\u653e\u524d\u9762\uff08\u5229\u7528\u5feb\u53d6\uff09</li> </ul>"},{"location":"lab09_commit/#copy-vs-add","title":"COPY vs ADD","text":"COPY \u8207 ADD<pre><code># COPY\uff1a\u55ae\u7d14\u8907\u88fd\u6a94\u6848\nCOPY ./src /app\nCOPY requirements.txt /app/\n\n# ADD\uff1a\u984d\u5916\u652f\u63f4 URL \u548c\u81ea\u52d5\u89e3\u58d3\u7e2e\nADD https://example.com/file.tar.gz /app/\nADD archive.tar.gz /app/  # \u81ea\u52d5\u89e3\u58d3\u7e2e\n</code></pre> <p>COPY vs ADD \u9078\u64c7</p> \u7279\u6027 COPY ADD \u8907\u88fd\u672c\u5730\u6a94\u6848 \u2705 \u2705 \u652f\u63f4 URL \u274c \u2705 \u81ea\u52d5\u89e3\u58d3\u7e2e \u274c \u2705 \u63a8\u85a6\u4f7f\u7528 \u2705 \u7279\u5b9a\u60c5\u6cc1 <p>\u5efa\u8b70\uff1a\u9664\u975e\u9700\u8981\u81ea\u52d5\u89e3\u58d3\u7e2e\uff0c\u5426\u5247\u512a\u5148\u4f7f\u7528 COPY</p>"},{"location":"lab09_commit/#workdir-","title":"WORKDIR - \u5de5\u4f5c\u76ee\u9304","text":"WORKDIR \u6307\u4ee4<pre><code># \u8a2d\u5b9a\u5de5\u4f5c\u76ee\u9304\uff08\u4e0d\u5b58\u5728\u6703\u81ea\u52d5\u5efa\u7acb\uff09\nWORKDIR /app\n\n# \u5f8c\u7e8c\u6307\u4ee4\u90fd\u5728\u6b64\u76ee\u9304\u57f7\u884c\nCOPY . .\nRUN npm install\n</code></pre>"},{"location":"lab09_commit/#env-","title":"ENV - \u74b0\u5883\u8b8a\u6578","text":"ENV \u6307\u4ee4<pre><code># \u55ae\u4e00\u8b8a\u6578\nENV APP_ENV production\n\n# \u591a\u500b\u8b8a\u6578\nENV APP_HOME=/app \\\n    NODE_ENV=production \\\n    PORT=3000\n</code></pre>"},{"location":"lab09_commit/#expose-port","title":"EXPOSE - \u66b4\u9732 Port","text":"EXPOSE \u6307\u4ee4<pre><code># \u66b4\u9732\u55ae\u4e00 Port\nEXPOSE 80\n\n# \u66b4\u9732\u591a\u500b Port\nEXPOSE 80 443\n\n# \u6307\u5b9a\u5354\u8b70\nEXPOSE 53/udp\n</code></pre> <p>EXPOSE \u8aaa\u660e</p> <p>EXPOSE \u53ea\u662f**\u6587\u4ef6\u7528\u9014**\uff0c\u8aaa\u660e\u5bb9\u5668\u76e3\u807d\u7684 Port\u3002 \u5be6\u969b\u5c0d\u5916\u958b\u653e\u9700\u8981\u5728 <code>docker run</code> \u6642\u4f7f\u7528 <code>-p</code> \u9078\u9805\u3002</p>"},{"location":"lab09_commit/#cmd-vs-entrypoint","title":"CMD vs ENTRYPOINT","text":"CMD \u6307\u4ee4<pre><code># Shell \u683c\u5f0f\nCMD nginx -g \"daemon off;\"\n\n# Exec \u683c\u5f0f\uff08\u63a8\u85a6\uff09\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n\n# \u4f5c\u70ba ENTRYPOINT \u7684\u9810\u8a2d\u53c3\u6578\nCMD [\"--help\"]\n</code></pre> ENTRYPOINT \u6307\u4ee4<pre><code># Exec \u683c\u5f0f\nENTRYPOINT [\"python\", \"app.py\"]\n\n# \u7d50\u5408 CMD \u63d0\u4f9b\u9810\u8a2d\u53c3\u6578\nENTRYPOINT [\"python\"]\nCMD [\"app.py\"]\n</code></pre> <p>CMD vs ENTRYPOINT \u6bd4\u8f03</p> \u6bd4\u8f03 CMD ENTRYPOINT \u8986\u84cb\u65b9\u5f0f <code>docker run</code> \u76f4\u63a5\u8986\u84cb \u9700\u8981 <code>--entrypoint</code> \u7528\u9014 \u9810\u8a2d\u6307\u4ee4\u6216\u53c3\u6578 \u56fa\u5b9a\u7684\u57f7\u884c\u7a0b\u5f0f \u7d44\u5408\u4f7f\u7528 \u4f5c\u70ba ENTRYPOINT \u7684\u53c3\u6578 \u4e3b\u8981\u57f7\u884c\u7a0b\u5f0f"},{"location":"lab09_commit/#arg-","title":"ARG - \u5efa\u7f6e\u53c3\u6578","text":"ARG \u6307\u4ee4<pre><code># \u5b9a\u7fa9\u5efa\u7f6e\u6642\u53c3\u6578\nARG VERSION=1.0\nARG APP_NAME\n\n# \u4f7f\u7528\u53c3\u6578\nENV APP_VERSION=$VERSION\nLABEL app.version=$VERSION\n\n# \u5efa\u7f6e\u6642\u50b3\u5165\u53c3\u6578\n# docker build --build-arg VERSION=2.0 .\n</code></pre>"},{"location":"lab09_commit/#volume-","title":"VOLUME - \u639b\u8f09\u9ede","text":"VOLUME \u6307\u4ee4<pre><code># \u5b9a\u7fa9 Volume \u639b\u8f09\u9ede\nVOLUME /data\nVOLUME [\"/data\", \"/logs\"]\n</code></pre>"},{"location":"lab09_commit/#user-","title":"USER - \u57f7\u884c\u8eab\u4efd","text":"USER \u6307\u4ee4<pre><code># \u5efa\u7acb\u975e root \u4f7f\u7528\u8005\nRUN useradd -r -u 1001 appuser\n\n# \u5207\u63db\u4f7f\u7528\u8005\nUSER appuser\n\n# \u5f8c\u7e8c\u6307\u4ee4\u4ee5 appuser \u8eab\u4efd\u57f7\u884c\n</code></pre>"},{"location":"lab09_commit/#healthcheck-","title":"HEALTHCHECK - \u5065\u5eb7\u6aa2\u67e5","text":"HEALTHCHECK \u6307\u4ee4<pre><code># \u8a2d\u5b9a\u5065\u5eb7\u6aa2\u67e5\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost/ || exit 1\n\n# \u505c\u7528\u5065\u5eb7\u6aa2\u67e5\nHEALTHCHECK NONE\n</code></pre>"},{"location":"lab09_commit/#dockerfile_3","title":"\u5b8c\u6574 Dockerfile \u7bc4\u4f8b","text":""},{"location":"lab09_commit/#python-web","title":"Python Web \u61c9\u7528\u7a0b\u5f0f","text":"Dockerfile - Python Flask<pre><code># \u57fa\u790e\u6620\u50cf\nFROM python:3.12-slim\n\n# \u7dad\u8b77\u8005\u8cc7\u8a0a\nLABEL maintainer=\"developer@example.com\"\nLABEL version=\"1.0\"\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\nENV PYTHONDONTWRITEBYTECODE=1 \\\n    PYTHONUNBUFFERED=1 \\\n    APP_HOME=/app\n\n# \u5efa\u7acb\u5de5\u4f5c\u76ee\u9304\nWORKDIR $APP_HOME\n\n# \u8907\u88fd\u4e26\u5b89\u88dd\u4f9d\u8cf4\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# \u8907\u88fd\u61c9\u7528\u7a0b\u5f0f\nCOPY . .\n\n# \u5efa\u7acb\u975e root \u4f7f\u7528\u8005\nRUN useradd -r -u 1001 appuser &amp;&amp; \\\n    chown -R appuser:appuser $APP_HOME\nUSER appuser\n\n# \u66b4\u9732 Port\nEXPOSE 5000\n\n# \u5065\u5eb7\u6aa2\u67e5\nHEALTHCHECK --interval=30s --timeout=3s \\\n    CMD curl -f http://localhost:5000/health || exit 1\n\n# \u555f\u52d5\u6307\u4ee4\nCMD [\"python\", \"app.py\"]\n</code></pre>"},{"location":"lab09_commit/#nodejs","title":"Node.js \u61c9\u7528\u7a0b\u5f0f\uff08\u591a\u968e\u6bb5\u5efa\u7f6e\uff09","text":"Dockerfile - Node.js \u591a\u968e\u6bb5\u5efa\u7f6e<pre><code># ===== \u5efa\u7f6e\u968e\u6bb5 =====\nFROM node:18-alpine AS builder\n\nWORKDIR /app\n\n# \u8907\u88fd package \u6a94\u6848\nCOPY package*.json ./\n\n# \u5b89\u88dd\u4f9d\u8cf4\nRUN npm ci --only=production\n\n# \u8907\u88fd\u539f\u59cb\u78bc\nCOPY . .\n\n# \u5efa\u7f6e\u61c9\u7528\u7a0b\u5f0f\nRUN npm run build\n\n# ===== \u751f\u7522\u968e\u6bb5 =====\nFROM node:18-alpine AS production\n\nWORKDIR /app\n\n# \u5f9e\u5efa\u7f6e\u968e\u6bb5\u8907\u88fd\u9700\u8981\u7684\u6a94\u6848\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/package.json ./\n\n# \u5efa\u7acb\u975e root \u4f7f\u7528\u8005\nRUN addgroup -g 1001 -S nodejs &amp;&amp; \\\n    adduser -S nextjs -u 1001\nUSER nextjs\n\nEXPOSE 3000\n\nCMD [\"node\", \"dist/index.js\"]\n</code></pre>"},{"location":"lab09_commit/#image","title":"\u5efa\u7f6e Image","text":"docker build \u6307\u4ee4<pre><code># \u57fa\u672c\u5efa\u7f6e\ndocker build -t my-app:v1 .\n\n# \u6307\u5b9a Dockerfile\ndocker build -f Dockerfile.prod -t my-app:prod .\n\n# \u50b3\u5165\u5efa\u7f6e\u53c3\u6578\ndocker build --build-arg VERSION=2.0 -t my-app:v2 .\n\n# \u4e0d\u4f7f\u7528\u5feb\u53d6\ndocker build --no-cache -t my-app:v1 .\n\n# \u986f\u793a\u5efa\u7f6e\u904e\u7a0b\ndocker build --progress=plain -t my-app:v1 .\n\n# \u591a\u5e73\u53f0\u5efa\u7f6e\ndocker buildx build --platform linux/amd64,linux/arm64 -t my-app:v1 .\n</code></pre>"},{"location":"lab09_commit/#dockerfile_4","title":"Dockerfile \u6700\u4f73\u5be6\u8e10","text":"<p>\u512a\u5316\u5efa\u8b70</p> <p>1. \u6e1b\u5c11 Layer \u6578\u91cf </p><pre><code># \u4e0d\u597d\nRUN apt-get update\nRUN apt-get install -y nginx\nRUN apt-get install -y vim\n\n# \u597d\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    nginx \\\n    vim \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre><p></p> <p>2. \u5584\u7528\u5efa\u7f6e\u5feb\u53d6 </p><pre><code># \u5c07\u4e0d\u5e38\u8b8a\u52d5\u7684\u653e\u524d\u9762\nCOPY package.json .\nRUN npm install\nCOPY . .  # \u7a0b\u5f0f\u78bc\u8b8a\u52d5\u983b\u7e41\uff0c\u653e\u5f8c\u9762\n</code></pre><p></p> <p>3. \u4f7f\u7528 .dockerignore </p>.dockerignore<pre><code>node_modules\n.git\n.env\n*.log\nDockerfile\ndocker-compose.yml\n</code></pre><p></p> <p>4. \u4f7f\u7528\u591a\u968e\u6bb5\u5efa\u7f6e</p> <ul> <li>\u5206\u96e2\u5efa\u7f6e\u74b0\u5883\u8207\u57f7\u884c\u74b0\u5883</li> <li>\u5927\u5e45\u6e1b\u5c11\u6700\u7d42 Image \u5927\u5c0f</li> </ul>"},{"location":"lab09_commit/#dockerignore","title":".dockerignore \u6a94\u6848","text":".dockerignore<pre><code># \u7248\u672c\u63a7\u5236\n.git\n.gitignore\n\n# Node.js\nnode_modules\nnpm-debug.log\n\n# Python\n__pycache__\n*.pyc\n.venv\n\n# IDE\n.idea\n.vscode\n*.swp\n\n# Docker\nDockerfile*\ndocker-compose*.yml\n.docker\n\n# \u5176\u4ed6\n*.md\n*.log\n.env*\n</code></pre>"},{"location":"lab09_commit/#33-source-to-image","title":"3.3 Source-to-Image \u7c21\u4ecb","text":""},{"location":"lab09_commit/#source-to-image","title":"\u4ec0\u9ebc\u662f Source-to-Image\uff1f","text":"<p>Source-to-Image\uff08S2I\uff09\u662f Red Hat \u958b\u767c\u7684\u6846\u67b6\uff0c\u53ef\u4ee5\u5c07\u539f\u59cb\u78bc\u76f4\u63a5\u8f49\u63db\u6210\u53ef\u57f7\u884c\u7684 Docker Image\uff0c\u7121\u9700\u624b\u52d5\u64b0\u5beb Dockerfile\u3002</p> <pre><code>graph LR\n    SC[\u539f\u59cb\u78bc] --&gt; S2I[S2I Builder]\n    BI[Builder Image] --&gt; S2I\n    S2I --&gt; AI[\u61c9\u7528\u7a0b\u5f0f Image]</code></pre>"},{"location":"lab09_commit/#s2i","title":"S2I \u904b\u4f5c\u539f\u7406","text":"<pre><code>sequenceDiagram\n    participant Dev as \u958b\u767c\u8005\n    participant S2I as S2I \u5de5\u5177\n    participant Builder as Builder Image\n    participant Runtime as Runtime Image\n\n    Dev-&gt;&gt;S2I: \u63d0\u4f9b\u539f\u59cb\u78bc\n    S2I-&gt;&gt;Builder: \u4e0b\u8f09 Builder Image\n    S2I-&gt;&gt;Builder: assemble \u8173\u672c\n    Builder-&gt;&gt;Builder: \u7de8\u8b6f/\u5efa\u7f6e\u61c9\u7528\u7a0b\u5f0f\n    Builder-&gt;&gt;Runtime: \u7522\u751f\u6700\u7d42 Image\n    Runtime-&gt;&gt;Dev: \u53ef\u57f7\u884c\u7684 Image</code></pre>"},{"location":"lab09_commit/#s2i_1","title":"S2I \u512a\u9ede","text":"\u512a\u9ede \u8aaa\u660e \u7c21\u5316\u6d41\u7a0b \u958b\u767c\u8005\u4e0d\u9700\u8981\u4e86\u89e3 Docker \u6a19\u6e96\u5316 \u4f7f\u7528\u7d71\u4e00\u7684 Builder Image \u5b89\u5168\u6027 \u7531\u5e73\u53f0\u5718\u968a\u7dad\u8b77 Builder \u5feb\u901f\u8fed\u4ee3 \u53ea\u9700\u63d0\u4ea4\u7a0b\u5f0f\u78bc\u5373\u53ef\u5efa\u7f6e"},{"location":"lab09_commit/#s2i_2","title":"S2I \u4f7f\u7528\u5834\u666f","text":"<p>\u9069\u7528\u5834\u666f</p> <ul> <li>OpenShift/OKD \u5e73\u53f0\uff1a\u539f\u751f\u652f\u63f4 S2I</li> <li>\u4f01\u696d\u6a19\u6e96\u5316\uff1a\u7d71\u4e00\u7684\u61c9\u7528\u7a0b\u5f0f\u5efa\u7f6e\u6d41\u7a0b</li> <li>CI/CD \u6d41\u7a0b\uff1a\u81ea\u52d5\u5316\u5efa\u7f6e</li> </ul>"},{"location":"lab09_commit/#s2i_3","title":"S2I \u5b89\u88dd\u8207\u4f7f\u7528","text":"\u5b89\u88dd S2I<pre><code># macOS\nbrew install source-to-image\n\n# Linux\ncurl -L https://github.com/openshift/source-to-image/releases/download/v1.3.8/source-to-image-v1.3.8-linux-amd64.tar.gz | tar xz\nmv s2i /usr/local/bin/\n</code></pre> S2I \u57fa\u672c\u4f7f\u7528<pre><code># \u4f7f\u7528 Python Builder \u5efa\u7f6e\ns2i build https://github.com/user/python-app \\\n    registry.access.redhat.com/ubi8/python-39 \\\n    my-python-app\n\n# \u4f7f\u7528\u672c\u5730\u539f\u59cb\u78bc\ns2i build ./myapp \\\n    registry.access.redhat.com/ubi8/nodejs-14 \\\n    my-node-app\n\n# \u57f7\u884c\u5efa\u7f6e\u7684 Image\ndocker run -d -p 8080:8080 my-python-app\n</code></pre>"},{"location":"lab09_commit/#builder-images","title":"\u5e38\u898b Builder Images","text":"Builder \u8aaa\u660e \u4f86\u6e90 Python Python \u61c9\u7528\u7a0b\u5f0f Red Hat UBI Node.js Node.js \u61c9\u7528\u7a0b\u5f0f Red Hat UBI Ruby Ruby/Rails \u61c9\u7528\u7a0b\u5f0f Red Hat UBI Java Java/Maven/Gradle Red Hat UBI .NET .NET Core \u61c9\u7528\u7a0b\u5f0f Red Hat UBI"},{"location":"lab09_commit/#s2i-dockerfile","title":"S2I \u8207 Dockerfile \u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee Dockerfile S2I \u5b78\u7fd2\u66f2\u7dda \u9700\u8981\u5b78\u7fd2\u8a9e\u6cd5 \u8f03\u4f4e \u9748\u6d3b\u6027 \u9ad8 \u53d7\u9650\u65bc Builder \u6a19\u6e96\u5316 \u9700\u81ea\u884c\u7dad\u8b77 \u7531 Builder \u7dad\u8b77 OpenShift \u6574\u5408 \u9700\u984d\u5916\u914d\u7f6e \u539f\u751f\u652f\u63f4 \u9069\u7528\u5834\u666f \u901a\u7528 \u7279\u5b9a\u5e73\u53f0"},{"location":"lab09_commit/#lab","title":"Lab \u5be6\u4f5c\u7df4\u7fd2","text":""},{"location":"lab09_commit/#lab-3-1-dockerfile-nginx-image","title":"Lab 3-1\uff1a\u4f7f\u7528 Dockerfile \u5efa\u7acb Nginx \u81ea\u8a02 Image","text":"<p>\u76ee\u6a19\uff1a\u5efa\u7acb\u4e00\u500b\u5305\u542b\u81ea\u8a02\u9996\u9801\u7684 Nginx Image</p> <p>\u6b65\u9a5f\uff1a</p> \u6b65\u9a5f 1\uff1a\u5efa\u7acb\u5c08\u6848\u76ee\u9304<pre><code>mkdir nginx-custom &amp;&amp; cd nginx-custom\n</code></pre> \u6b65\u9a5f 2\uff1a\u5efa\u7acb index.html<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"zh-TW\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;DCKA \u8ab2\u7a0b - \u81ea\u8a02 Nginx&lt;/title&gt;\n    &lt;style&gt;\n        body {\n            font-family: 'Noto Sans TC', sans-serif;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n        .container {\n            text-align: center;\n            padding: 2rem;\n            background: rgba(255,255,255,0.1);\n            border-radius: 10px;\n        }\n        h1 { margin-bottom: 0.5rem; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=\"container\"&gt;\n        &lt;h1&gt;\ud83d\udc33 Docker \u81ea\u8a02 Image&lt;/h1&gt;\n        &lt;p&gt;\u606d\u559c\u4f60\u6210\u529f\u5efa\u7acb\u81ea\u8a02\u7684 Nginx Image\uff01&lt;/p&gt;\n        &lt;p&gt;\u5efa\u7f6e\u6642\u9593\uff1a&lt;span id=\"time\"&gt;&lt;/span&gt;&lt;/p&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        document.getElementById('time').textContent = new Date().toLocaleString('zh-TW');\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> \u6b65\u9a5f 3\uff1a\u5efa\u7acb Dockerfile<pre><code>FROM nginx:alpine\n\nLABEL maintainer=\"student@dcka.course\"\nLABEL description=\"Custom Nginx for DCKA course\"\n\n# \u8907\u88fd\u81ea\u8a02\u9996\u9801\nCOPY index.html /usr/share/nginx/html/\n\n# \u66b4\u9732 Port\nEXPOSE 80\n\n# \u5065\u5eb7\u6aa2\u67e5\nHEALTHCHECK --interval=30s --timeout=3s \\\n    CMD wget --quiet --tries=1 --spider http://localhost/ || exit 1\n</code></pre> \u6b65\u9a5f 4\uff1a\u5efa\u7acb .dockerignore<pre><code>echo -e \"Dockerfile\\n.git\\n*.md\" &gt; .dockerignore\n</code></pre> \u6b65\u9a5f 5\uff1a\u5efa\u7f6e Image<pre><code>docker build -t my-nginx:v1 .\n</code></pre> \u6b65\u9a5f 6\uff1a\u57f7\u884c\u4e26\u9a57\u8b49<pre><code># \u555f\u52d5\u5bb9\u5668\ndocker run -d --name my-nginx-test -p 8080:80 my-nginx:v1\n\n# \u6aa2\u67e5\u72c0\u614b\ndocker ps\n\n# \u6e2c\u8a66\u5b58\u53d6\ncurl http://localhost:8080\n\n# \u6aa2\u67e5\u5065\u5eb7\u72c0\u614b\ndocker inspect --format='{{.State.Health.Status}}' my-nginx-test\n</code></pre> \u6b65\u9a5f 7\uff1a\u6e05\u7406<pre><code>docker stop my-nginx-test\ndocker rm my-nginx-test\n</code></pre>"},{"location":"lab09_commit/#lab-3-2-go","title":"Lab 3-2\uff1a\u591a\u968e\u6bb5\u5efa\u7f6e - Go \u61c9\u7528\u7a0b\u5f0f","text":"<p>\u76ee\u6a19\uff1a\u4f7f\u7528\u591a\u968e\u6bb5\u5efa\u7f6e\u512a\u5316 Image \u5927\u5c0f</p> \u6b65\u9a5f 1\uff1a\u5efa\u7acb\u5c08\u6848<pre><code>mkdir go-app &amp;&amp; cd go-app\n</code></pre> \u6b65\u9a5f 2\uff1a\u5efa\u7acb main.go<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        hostname, _ := os.Hostname()\n        fmt.Fprintf(w, \"Hello from Go! Hostname: %s, Time: %s\\n\", \n            hostname, time.Now().Format(time.RFC3339))\n    })\n\n    http.HandleFunc(\"/health\", func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n        fmt.Fprintln(w, \"OK\")\n    })\n\n    fmt.Println(\"Server starting on port 8080...\")\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre> \u6b65\u9a5f 3\uff1a\u5efa\u7acb\u591a\u968e\u6bb5 Dockerfile<pre><code># ===== \u5efa\u7f6e\u968e\u6bb5 =====\nFROM golang:1.21-alpine AS builder\n\nWORKDIR /app\n\n# \u8907\u88fd\u539f\u59cb\u78bc\nCOPY main.go .\n\n# \u7de8\u8b6f\uff08\u975c\u614b\u9023\u7d50\uff09\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .\n\n# ===== \u751f\u7522\u968e\u6bb5 =====\nFROM scratch\n\n# \u5f9e\u5efa\u7f6e\u968e\u6bb5\u8907\u88fd\u57f7\u884c\u6a94\nCOPY --from=builder /app/app /app\n\nEXPOSE 8080\n\nENTRYPOINT [\"/app\"]\n</code></pre> \u6b65\u9a5f 4\uff1a\u5efa\u7f6e\u4e26\u6bd4\u8f03\u5927\u5c0f<pre><code># \u5efa\u7f6e\u591a\u968e\u6bb5 Image\ndocker build -t go-app:multi .\n\n# \u5efa\u7f6e\u55ae\u968e\u6bb5 Image\uff08\u6bd4\u8f03\u7528\uff09\ndocker build -f Dockerfile.single -t go-app:single .\n\n# \u6bd4\u8f03\u5927\u5c0f\ndocker images | grep go-app\n</code></pre> <p>\u9810\u671f\u7d50\u679c\uff1a</p> <pre><code>go-app    multi    xxxxx    xxx MB ago    ~10 MB\ngo-app    single   xxxxx    xxx MB ago    ~300 MB\n</code></pre>"},{"location":"lab09_commit/#_5","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aDockerfile \u5efa\u7f6e\u6642\u51fa\u73fe 'no such file or directory' \u932f\u8aa4 <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>\u8def\u5f91\u932f\u8aa4</li> <li>\u6a94\u6848\u88ab .dockerignore \u6392\u9664</li> <li>\u4f7f\u7528\u76f8\u5c0d\u8def\u5f91\u4f46 WORKDIR \u4e0d\u6b63\u78ba</li> </ol> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u6aa2\u67e5\u5efa\u7f6e\u4e0a\u4e0b\u6587\ndocker build --progress=plain -t test .\n\n# \u78ba\u8a8d .dockerignore \u5167\u5bb9\ncat .dockerignore\n</code></pre><p></p> Q2\uff1a\u5982\u4f55\u6e1b\u5c11 Image \u5927\u5c0f\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <ol> <li>\u4f7f\u7528 Alpine \u57fa\u790e\u6620\u50cf</li> <li>\u591a\u968e\u6bb5\u5efa\u7f6e</li> <li>\u5408\u4f75 RUN \u6307\u4ee4</li> <li>\u6e05\u7406\u4e0d\u5fc5\u8981\u7684\u6a94\u6848</li> <li>\u4f7f\u7528 .dockerignore</li> </ol> <pre><code># \u6e05\u7406 apt cache\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    package1 \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre> Q3\uff1aCOPY \u548c ADD \u6709\u4ec0\u9ebc\u5340\u5225\uff1f <p>\u89e3\u7b54\uff1a</p> <ul> <li><code>COPY</code>\uff1a\u55ae\u7d14\u8907\u88fd\u6a94\u6848\uff0c\u63a8\u85a6\u4e00\u822c\u60c5\u6cc1\u4f7f\u7528</li> <li><code>ADD</code>\uff1a\u984d\u5916\u652f\u63f4 URL \u4e0b\u8f09\u548c\u81ea\u52d5\u89e3\u58d3\u7e2e tar \u6a94</li> </ul> <p>\u5efa\u8b70\uff1a\u9664\u975e\u9700\u8981\u81ea\u52d5\u89e3\u58d3\u7e2e\uff0c\u5426\u5247\u512a\u5148\u4f7f\u7528 <code>COPY</code></p> Q4\uff1a\u5982\u4f55\u67e5\u770b Image \u7684\u5404\u5c64\u5927\u5c0f\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u4f7f\u7528 docker history\ndocker history --no-trunc my-image:tag\n\n# \u4f7f\u7528 dive \u5de5\u5177\uff08\u63a8\u85a6\uff09\n# \u5b89\u88dd\uff1abrew install dive \u6216 apt install dive\ndive my-image:tag\n</code></pre><p></p> Q5\uff1aCMD \u548c ENTRYPOINT \u5982\u4f55\u9078\u64c7\uff1f <p>\u89e3\u7b54\uff1a</p> <ul> <li>\u4f7f\u7528 <code>ENTRYPOINT</code> \u8a2d\u5b9a\u56fa\u5b9a\u7684\u57f7\u884c\u7a0b\u5f0f</li> <li>\u4f7f\u7528 <code>CMD</code> \u63d0\u4f9b\u53ef\u8986\u84cb\u7684\u9810\u8a2d\u53c3\u6578</li> </ul> <pre><code># \u7bc4\u4f8b\uff1a\u56fa\u5b9a\u57f7\u884c python\uff0c\u53ef\u8b8a\u66f4\u53c3\u6578\nENTRYPOINT [\"python\"]\nCMD [\"app.py\"]\n\n# \u4f7f\u7528\u8005\u53ef\u4ee5\uff1adocker run my-image script.py\n</code></pre>"},{"location":"lab09_commit/#_6","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 docker commit\uff1a\u5feb\u901f\u5f9e\u5bb9\u5668\u5efa\u7acb Image\uff0c\u9069\u5408\u6e2c\u8a66\u4f46\u4e0d\u5efa\u8b70\u7528\u65bc\u751f\u7522</li> <li>\u2705 Dockerfile \u6838\u5fc3\u6307\u4ee4\uff1aFROM\u3001RUN\u3001COPY\u3001WORKDIR\u3001ENV\u3001EXPOSE\u3001CMD\u3001ENTRYPOINT</li> <li>\u2705 \u591a\u968e\u6bb5\u5efa\u7f6e\uff1a\u5206\u96e2\u5efa\u7f6e\u8207\u57f7\u884c\u74b0\u5883\uff0c\u5927\u5e45\u6e1b\u5c11 Image \u5927\u5c0f</li> <li>\u2705 \u6700\u4f73\u5be6\u8e10\uff1a\u6e1b\u5c11 Layer\u3001\u5584\u7528\u5feb\u53d6\u3001\u4f7f\u7528 .dockerignore\u3001\u975e root \u4f7f\u7528\u8005</li> <li>\u2705 Source-to-Image\uff1aRed Hat \u7684\u81ea\u52d5\u5316\u5efa\u7f6e\u6846\u67b6\uff0c\u9069\u5408 OpenShift \u74b0\u5883</li> </ul>"},{"location":"lab09_commit/#_7","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Dockerfile \u5b98\u65b9\u53c3\u8003</li> <li>Docker \u5efa\u7f6e\u6700\u4f73\u5be6\u8e10</li> <li>\u591a\u968e\u6bb5\u5efa\u7f6e\u8aaa\u660e</li> <li>Source-to-Image GitHub</li> <li>Dive - Image \u5206\u6790\u5de5\u5177</li> </ul>"},{"location":"lab10_dockerfile/","title":"LAB 10 \u5ba2\u88fd\u5316 Container images - dockerfile","text":""},{"location":"lab10_dockerfile/#lab-10-container-images-dockerfile","title":"LAB 10 \u5ba2\u88fd\u5316 Container images - dockerfile","text":""},{"location":"lab10_dockerfile/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab10_dockerfile/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab11_standalone_k8s/","title":"LAB 11 standalone kubernetes \u5b89\u88dd","text":""},{"location":"lab11_standalone_k8s/#lab-11-standalone-kubernetes","title":"LAB 11 standalone kubernetes \u5b89\u88dd","text":""},{"location":"lab11_standalone_k8s/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab11_standalone_k8s/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab12_k8s_install/","title":"LAB 12 kubernetes \u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#lab-12-kubernetes","title":"LAB 12 kubernetes \u5b89\u88dd","text":""},{"location":"lab12_k8s_install/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<p>\u5b8c\u6210\u672c\u7ae0\u7bc0\u5f8c\uff0c\u4f60\u5c07\u80fd\u5920\uff1a</p> <ul> <li> \u7406\u89e3 Kubernetes \u8207 OpenShift/OKD \u7684\u95dc\u4fc2\u8207\u5dee\u7570</li> <li> \u5b89\u88dd\u4e26\u8a2d\u5b9a Kubernetes \u74b0\u5883\uff08minikube\uff09</li> <li> \u7406\u89e3 Kubernetes \u67b6\u69cb\u8207\u6838\u5fc3\u5143\u4ef6</li> <li> \u64b0\u5beb YAML \u8a2d\u5b9a\u6a94\u5b9a\u7fa9\u8cc7\u6e90</li> <li> \u7ba1\u7406 Deployment\u3001Service\u3001Pod \u7b49\u8cc7\u6e90</li> <li> \u5be6\u4f5c RollingUpdate\u3001Recreate\u3001Canary\u3001Blue/Green \u90e8\u7f72\u7b56\u7565</li> <li> \u8a2d\u5b9a Persistent Volumes\u3001ConfigMaps\u3001Secrets</li> <li> \u914d\u7f6e RBAC \u6b0a\u9650\u63a7\u5236</li> <li> \u5b8c\u6210 WordPress + MySQL \u7684 Kubernetes \u90e8\u7f72\u5be6\u4f5c</li> <li> \u4f7f\u7528 kubectl \u9032\u884c\u65e5\u8a8c\u67e5\u770b\u8207\u7591\u96e3\u6392\u89e3</li> </ul>"},{"location":"lab12_k8s_install/#_2","title":"\u524d\u7f6e\u77e5\u8b58","text":"<p>\u958b\u59cb\u4e4b\u524d\uff0c\u8acb\u78ba\u4fdd\u4f60\u5df2\u7d93\uff1a</p> <ul> <li>\u5b8c\u6210\u7b2c 1-3 \u7ae0\u7684\u5167\u5bb9</li> <li>\u719f\u6089 Docker \u57fa\u672c\u64cd\u4f5c</li> <li>\u7406\u89e3\u5bb9\u5668\u5316\u7684\u57fa\u672c\u6982\u5ff5</li> <li>\u5177\u5099\u57fa\u672c\u7684 YAML \u8a9e\u6cd5\u77e5\u8b58</li> </ul>"},{"location":"lab12_k8s_install/#41-kubernetes-openshiftokd","title":"4.1 Kubernetes \u8207 OpenShift/OKD","text":""},{"location":"lab12_k8s_install/#kubernetes","title":"Kubernetes \u7c21\u4ecb","text":"<p>Kubernetes\uff08\u7c21\u7a31 K8S\uff09\u662f Google \u958b\u6e90\u7684\u5bb9\u5668\u7de8\u6392\u5e73\u53f0\uff0c\u7528\u65bc\u81ea\u52d5\u5316\u90e8\u7f72\u3001\u64f4\u5c55\u548c\u7ba1\u7406\u5bb9\u5668\u5316\u61c9\u7528\u7a0b\u5f0f\u3002</p> <p>\u540d\u7a31\u7531\u4f86</p> <p>Kubernetes \u6e90\u81ea\u5e0c\u81d8\u8a9e\uff0c\u610f\u70ba\u300c\u8235\u624b\u300d\u6216\u300c\u9818\u822a\u54e1\u300d\u3002 K8S \u662f\u56e0\u70ba K \u548c S \u4e4b\u9593\u6709 8 \u500b\u5b57\u6bcd\u800c\u5f97\u540d\u3002</p>"},{"location":"lab12_k8s_install/#openshift-okd","title":"OpenShift \u8207 OKD","text":"\u9805\u76ee Kubernetes OpenShift OKD \u958b\u767c\u8005 CNCF Red Hat \u793e\u7fa4 \u6388\u6b0a \u958b\u6e90\u514d\u8cbb \u5546\u696d\u7248\uff08\u9700\u6388\u6b0a\uff09 \u958b\u6e90\u514d\u8cbb \u5b9a\u4f4d \u5bb9\u5668\u7de8\u6392\u5e73\u53f0 \u4f01\u696d\u7d1a K8S \u767c\u884c\u7248 OpenShift \u793e\u7fa4\u7248 \u652f\u63f4 \u793e\u7fa4\u652f\u63f4 \u5546\u696d\u652f\u63f4 \u793e\u7fa4\u652f\u63f4 \u984d\u5916\u529f\u80fd \u57fa\u790e\u529f\u80fd \u958b\u767c\u8005\u5de5\u5177\u3001CI/CD\u3001Web Console \u985e\u4f3c OpenShift <pre><code>graph TB\n    subgraph \"\u95dc\u4fc2\u5716\"\n        K8S[Kubernetes] --&gt; OKD[OKD&lt;br/&gt;\u793e\u7fa4\u7248]\n        OKD --&gt; OS[OpenShift&lt;br/&gt;\u4f01\u696d\u7248]\n        K8S --&gt; Other[\u5176\u4ed6\u767c\u884c\u7248&lt;br/&gt;Rancher, EKS, AKS, GKE]\n    end</code></pre>"},{"location":"lab12_k8s_install/#openshift","title":"OpenShift \u984d\u5916\u529f\u80fd","text":"<p>OpenShift \u76f8\u8f03\u65bc\u539f\u751f K8S \u7684\u512a\u52e2</p> <ul> <li>Web Console\uff1a\u529f\u80fd\u5b8c\u6574\u7684\u7ba1\u7406\u4ecb\u9762</li> <li>Source-to-Image (S2I)\uff1a\u539f\u59cb\u78bc\u76f4\u63a5\u90e8\u7f72</li> <li>\u5167\u5efa CI/CD\uff1a\u6574\u5408 Jenkins\u3001Tekton</li> <li>\u958b\u767c\u8005\u5de5\u5177\uff1aodo CLI \u7c21\u5316\u958b\u767c\u6d41\u7a0b</li> <li>\u5b89\u5168\u5f37\u5316\uff1a\u9810\u8a2d Security Context Constraints</li> <li>\u5546\u696d\u652f\u63f4\uff1aRed Hat \u4f01\u696d\u7d1a\u652f\u63f4</li> </ul>"},{"location":"lab12_k8s_install/#42-minikube-vs-minishift","title":"4.2 minikube vs minishift","text":""},{"location":"lab12_k8s_install/#_3","title":"\u672c\u5730\u958b\u767c\u74b0\u5883\u6bd4\u8f03","text":"\u6bd4\u8f03\u9805\u76ee minikube minishift \u5e73\u53f0 Kubernetes OpenShift (OKD) \u7528\u9014 K8S \u672c\u5730\u958b\u767c\u6e2c\u8a66 OpenShift \u672c\u5730\u958b\u767c\u6e2c\u8a66 \u8cc7\u6e90\u9700\u6c42 \u8f03\u4f4e \u8f03\u9ad8 \u7dad\u8b77\u72c0\u614b \u6d3b\u8e8d\u7dad\u8b77 \u5df2\u505c\u6b62\u7dad\u8b77 \u66ff\u4ee3\u65b9\u6848 - CodeReady Containers (CRC)"},{"location":"lab12_k8s_install/#minikube","title":"\u5b89\u88dd minikube","text":"macOSLinuxWindows macOS \u5b89\u88dd minikube<pre><code># \u4f7f\u7528 Homebrew \u5b89\u88dd\nbrew install minikube\n\n# \u5b89\u88dd kubectl\nbrew install kubectl\n</code></pre> Linux \u5b89\u88dd minikube<pre><code># \u4e0b\u8f09 minikube\ncurl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\nsudo install minikube-linux-amd64 /usr/local/bin/minikube\n\n# \u5b89\u88dd kubectl\ncurl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nsudo install kubectl /usr/local/bin/kubectl\n</code></pre> Windows \u5b89\u88dd minikube<pre><code># \u4f7f\u7528 Chocolatey \u5b89\u88dd\nchoco install minikube\nchoco install kubernetes-cli\n</code></pre>"},{"location":"lab12_k8s_install/#minikube_1","title":"\u555f\u52d5 minikube","text":"minikube \u57fa\u672c\u64cd\u4f5c<pre><code># \u555f\u52d5 minikube\uff08\u4f7f\u7528 Docker \u9a45\u52d5\uff09\nminikube start --driver=docker\n\n# \u6307\u5b9a\u8cc7\u6e90\nminikube start --cpus=4 --memory=8192 --driver=docker\n\n# \u6aa2\u67e5\u72c0\u614b\nminikube status\n\n# \u5b58\u53d6 Dashboard\nminikube dashboard\n\n# \u505c\u6b62\nminikube stop\n\n# \u522a\u9664\nminikube delete\n</code></pre>"},{"location":"lab12_k8s_install/#43-kubernetes","title":"4.3 Kubernetes \u67b6\u69cb","text":""},{"location":"lab12_k8s_install/#_4","title":"\u6574\u9ad4\u67b6\u69cb","text":"<pre><code>graph TB\n    subgraph \"Control Plane\uff08\u63a7\u5236\u5e73\u9762\uff09\"\n        API[API Server]\n        ETCD[(etcd)]\n        Sched[Scheduler]\n        CM[Controller Manager]\n        API --&gt; ETCD\n        API --&gt; Sched\n        API --&gt; CM\n    end\n\n    subgraph \"Worker Node 1\"\n        Kubelet1[Kubelet]\n        Proxy1[kube-proxy]\n        CR1[Container Runtime]\n        Pod1[Pod]\n        Pod2[Pod]\n        Kubelet1 --&gt; CR1\n        CR1 --&gt; Pod1\n        CR1 --&gt; Pod2\n    end\n\n    subgraph \"Worker Node 2\"\n        Kubelet2[Kubelet]\n        Proxy2[kube-proxy]\n        CR2[Container Runtime]\n        Pod3[Pod]\n        Pod4[Pod]\n        Kubelet2 --&gt; CR2\n        CR2 --&gt; Pod3\n        CR2 --&gt; Pod4\n    end\n\n    API --&gt; Kubelet1\n    API --&gt; Kubelet2</code></pre>"},{"location":"lab12_k8s_install/#control-plane","title":"Control Plane \u5143\u4ef6","text":"\u5143\u4ef6 \u8aaa\u660e API Server K8S \u7684\u5165\u53e3\uff0c\u8655\u7406\u6240\u6709 REST API \u8acb\u6c42 etcd \u5206\u6563\u5f0f\u9375\u503c\u5132\u5b58\uff0c\u4fdd\u5b58\u53e2\u96c6\u72c0\u614b Scheduler \u6c7a\u5b9a Pod \u8981\u5728\u54ea\u500b Node \u57f7\u884c Controller Manager \u7ba1\u7406\u5404\u7a2e\u63a7\u5236\u5668\uff08Deployment\u3001ReplicaSet \u7b49\uff09"},{"location":"lab12_k8s_install/#worker-node","title":"Worker Node \u5143\u4ef6","text":"\u5143\u4ef6 \u8aaa\u660e Kubelet Node \u7684\u4ee3\u7406\u7a0b\u5f0f\uff0c\u7ba1\u7406 Pod \u751f\u547d\u9031\u671f kube-proxy \u7db2\u8def\u4ee3\u7406\uff0c\u5be6\u73fe Service \u7684\u8ca0\u8f09\u5747\u8861 Container Runtime \u5bb9\u5668\u57f7\u884c\u74b0\u5883\uff08containerd\u3001CRI-O\uff09"},{"location":"lab12_k8s_install/#44-kubernetes","title":"4.4 \u5b89\u88dd Kubernetes","text":""},{"location":"lab12_k8s_install/#minikube_2","title":"\u4f7f\u7528 minikube \u5b89\u88dd","text":"\u5b8c\u6574\u5b89\u88dd\u6d41\u7a0b<pre><code># 1. \u78ba\u8a8d Docker \u5df2\u5b89\u88dd\u4e26\u904b\u884c\ndocker version\n\n# 2. \u555f\u52d5 minikube\nminikube start --driver=docker --cpus=2 --memory=4096\n\n# 3. \u9a57\u8b49\u5b89\u88dd\nkubectl cluster-info\n\n# 4. \u6aa2\u67e5 Node \u72c0\u614b\nkubectl get nodes\n\n# 5. \u6aa2\u67e5\u7cfb\u7d71 Pod\nkubectl get pods -n kube-system\n</code></pre>"},{"location":"lab12_k8s_install/#_5","title":"\u5176\u4ed6\u5b89\u88dd\u9078\u9805","text":"<p>\u751f\u7522\u74b0\u5883\u5b89\u88dd\u9078\u9805</p> \u65b9\u6848 \u9069\u7528\u5834\u666f kubeadm \u81ea\u5efa\u53e2\u96c6 k3s \u8f15\u91cf\u7d1a\uff0c\u9069\u5408\u908a\u7de3\u904b\u7b97 Amazon EKS AWS \u96f2\u7aef Azure AKS Azure \u96f2\u7aef Google GKE GCP \u96f2\u7aef"},{"location":"lab12_k8s_install/#45-yaml-json","title":"4.5 YAML \u8207 JSON \u6a94","text":""},{"location":"lab12_k8s_install/#yaml","title":"YAML \u57fa\u790e\u8a9e\u6cd5","text":"YAML \u57fa\u672c\u7d50\u69cb<pre><code># \u9019\u662f\u8a3b\u89e3\napiVersion: v1          # \u7d14\u91cf\uff08Scalar\uff09\nkind: Pod\nmetadata:\n  name: my-pod          # \u7e2e\u6392\u8868\u793a\u5c64\u7d1a\n  labels:               # \u5c0d\u61c9\uff08Mapping\uff09\n    app: web\n    tier: frontend\nspec:\n  containers:           # \u5217\u8868\uff08Sequence\uff09\n    - name: nginx\n      image: nginx:1.25\n      ports:\n        - containerPort: 80\n    - name: sidecar\n      image: busybox\n</code></pre>"},{"location":"lab12_k8s_install/#yaml-vs-json","title":"YAML vs JSON","text":"YAMLJSON Pod \u5b9a\u7fa9 (YAML)<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n</code></pre> Pod \u5b9a\u7fa9 (JSON)<pre><code>{\n  \"apiVersion\": \"v1\",\n  \"kind\": \"Pod\",\n  \"metadata\": {\n    \"name\": \"my-pod\"\n  },\n  \"spec\": {\n    \"containers\": [\n      {\n        \"name\": \"nginx\",\n        \"image\": \"nginx\"\n      }\n    ]\n  }\n}\n</code></pre> <p>\u5efa\u8b70\u4f7f\u7528 YAML</p> <ul> <li>\u66f4\u6613\u8b80</li> <li>\u652f\u63f4\u8a3b\u89e3</li> <li>\u8f03\u7c21\u6f54</li> </ul>"},{"location":"lab12_k8s_install/#46-kubernetes-resource-type","title":"4.6 Kubernetes Resource Type","text":""},{"location":"lab12_k8s_install/#_6","title":"\u5e38\u898b\u8cc7\u6e90\u985e\u578b","text":"<pre><code>graph TB\n    subgraph \"\u5de5\u4f5c\u8ca0\u8f09 Workloads\"\n        Pod[Pod]\n        Deploy[Deployment]\n        RS[ReplicaSet]\n        DS[DaemonSet]\n        SS[StatefulSet]\n        Job[Job]\n        CJ[CronJob]\n    end\n\n    subgraph \"\u7db2\u8def Networking\"\n        Svc[Service]\n        Ing[Ingress]\n        NP[NetworkPolicy]\n    end\n\n    subgraph \"\u5132\u5b58 Storage\"\n        PV[PersistentVolume]\n        PVC[PersistentVolumeClaim]\n        SC[StorageClass]\n    end\n\n    subgraph \"\u8a2d\u5b9a Configuration\"\n        CM[ConfigMap]\n        Sec[Secret]\n    end</code></pre>"},{"location":"lab12_k8s_install/#_7","title":"\u8cc7\u6e90\u8aaa\u660e","text":"\u8cc7\u6e90 \u7528\u9014 \u5e38\u7528\u7a0b\u5ea6 Pod \u6700\u5c0f\u90e8\u7f72\u55ae\u4f4d\uff0c\u5305\u542b\u4e00\u6216\u591a\u500b\u5bb9\u5668 \u2b50\u2b50\u2b50 Deployment \u7ba1\u7406 Pod \u7684\u90e8\u7f72\u8207\u66f4\u65b0 \u2b50\u2b50\u2b50 Service \u63d0\u4f9b\u7a69\u5b9a\u7684\u7db2\u8def\u7aef\u9ede \u2b50\u2b50\u2b50 ConfigMap \u5132\u5b58\u975e\u6a5f\u5bc6\u8a2d\u5b9a \u2b50\u2b50\u2b50 Secret \u5132\u5b58\u6a5f\u5bc6\u8cc7\u8a0a \u2b50\u2b50\u2b50 Ingress HTTP/HTTPS \u8def\u7531 \u2b50\u2b50 PersistentVolume \u6301\u4e45\u5316\u5132\u5b58 \u2b50\u2b50 StatefulSet \u6709\u72c0\u614b\u61c9\u7528\u7a0b\u5f0f \u2b50\u2b50"},{"location":"lab12_k8s_install/#47-kubernetes","title":"4.7 Kubernetes \u7ba1\u7406","text":""},{"location":"lab12_k8s_install/#471-deployment","title":"4.7.1 Deployment","text":"<p>Deployment\uff08\u90e8\u7f72\uff09\u662f\u7ba1\u7406 Pod \u526f\u672c\u7684\u63a7\u5236\u5668\uff0c\u63d0\u4f9b\u8072\u660e\u5f0f\u66f4\u65b0\u3002</p> deployment.yaml<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  labels:\n    app: nginx\nspec:\n  replicas: 3                    # \u526f\u672c\u6578\u91cf\n  selector:\n    matchLabels:\n      app: nginx\n  template:                      # Pod \u6a21\u677f\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:1.25\n          ports:\n            - containerPort: 80\n          resources:\n            requests:\n              memory: \"64Mi\"\n              cpu: \"250m\"\n            limits:\n              memory: \"128Mi\"\n              cpu: \"500m\"\n</code></pre> Deployment \u64cd\u4f5c<pre><code># \u5efa\u7acb Deployment\nkubectl apply -f deployment.yaml\n\n# \u67e5\u770b Deployment\nkubectl get deployments\n\n# \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\nkubectl describe deployment nginx-deployment\n\n# \u8abf\u6574\u526f\u672c\u6578\nkubectl scale deployment nginx-deployment --replicas=5\n\n# \u522a\u9664 Deployment\nkubectl delete deployment nginx-deployment\n</code></pre>"},{"location":"lab12_k8s_install/#472-service","title":"4.7.2 Service","text":"<p>Service\uff08\u670d\u52d9\uff09\u63d0\u4f9b\u7a69\u5b9a\u7684\u7db2\u8def\u7aef\u9ede\uff0c\u5be6\u73fe\u8ca0\u8f09\u5747\u8861\u3002</p> <pre><code>graph TB\n    Client[Client] --&gt; Svc[Service&lt;br/&gt;ClusterIP: 10.96.0.1]\n    Svc --&gt; Pod1[Pod 1&lt;br/&gt;10.244.0.5]\n    Svc --&gt; Pod2[Pod 2&lt;br/&gt;10.244.0.6]\n    Svc --&gt; Pod3[Pod 3&lt;br/&gt;10.244.0.7]</code></pre>"},{"location":"lab12_k8s_install/#service","title":"Service \u985e\u578b","text":"\u985e\u578b \u8aaa\u660e \u7528\u9014 ClusterIP \u50c5\u53e2\u96c6\u5167\u90e8\u5b58\u53d6\uff08\u9810\u8a2d\uff09 \u5167\u90e8\u670d\u52d9\u901a\u8a0a NodePort \u900f\u904e Node IP + Port \u5b58\u53d6 \u958b\u767c\u6e2c\u8a66 LoadBalancer \u96f2\u7aef\u8ca0\u8f09\u5747\u8861\u5668 \u751f\u7522\u74b0\u5883\u5c0d\u5916\u670d\u52d9 ExternalName \u5c0d\u61c9\u5916\u90e8 DNS \u9023\u63a5\u5916\u90e8\u670d\u52d9 service.yaml<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\nspec:\n  type: ClusterIP            # \u6216 NodePort\u3001LoadBalancer\n  selector:\n    app: nginx               # \u9078\u64c7 label \u70ba app=nginx \u7684 Pod\n  ports:\n    - protocol: TCP\n      port: 80               # Service Port\n      targetPort: 80         # Container Port\n      # nodePort: 30080      # NodePort \u985e\u578b\u4f7f\u7528\n</code></pre> Service \u64cd\u4f5c<pre><code># \u5efa\u7acb Service\nkubectl apply -f service.yaml\n\n# \u67e5\u770b Service\nkubectl get services\n\n# \u67e5\u770b\u7aef\u9ede\nkubectl get endpoints nginx-service\n\n# \u6e2c\u8a66\u9023\u7dda\uff08\u5728 Pod \u5167\uff09\nkubectl exec -it pod-name -- curl nginx-service\n</code></pre>"},{"location":"lab12_k8s_install/#473-rollingupdate-recreate","title":"4.7.3 RollingUpdate \u8207 Recreate","text":""},{"location":"lab12_k8s_install/#_8","title":"\u66f4\u65b0\u7b56\u7565\u6bd4\u8f03","text":"<pre><code>graph LR\n    subgraph \"RollingUpdate\uff08\u6efe\u52d5\u66f4\u65b0\uff09\"\n        R1[v1 v1 v1] --&gt; R2[v2 v1 v1] --&gt; R3[v2 v2 v1] --&gt; R4[v2 v2 v2]\n    end\n\n    subgraph \"Recreate\uff08\u91cd\u5efa\uff09\"\n        C1[v1 v1 v1] --&gt; C2[\u505c\u6a5f] --&gt; C3[v2 v2 v2]\n    end</code></pre> \u7b56\u7565 \u512a\u9ede \u7f3a\u9ede \u9069\u7528\u5834\u666f RollingUpdate \u96f6\u505c\u6a5f \u65b0\u820a\u7248\u672c\u5171\u5b58 \u4e00\u822c\u61c9\u7528 Recreate \u7c21\u55ae\u3001\u7121\u7248\u672c\u6df7\u7528 \u6709\u505c\u6a5f\u6642\u9593 \u7121\u6cd5\u591a\u7248\u672c\u5171\u5b58 \u66f4\u65b0\u7b56\u7565\u8a2d\u5b9a<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-app\nspec:\n  replicas: 3\n  strategy:\n    type: RollingUpdate        # \u6216 Recreate\n    rollingUpdate:\n      maxSurge: 1              # \u6700\u591a\u984d\u5916 Pod \u6578\n      maxUnavailable: 0        # \u6700\u591a\u4e0d\u53ef\u7528 Pod \u6578\n  # ... \u5176\u4ed6\u8a2d\u5b9a\n</code></pre> \u66f4\u65b0\u64cd\u4f5c<pre><code># \u66f4\u65b0 Image\nkubectl set image deployment/nginx-deployment nginx=nginx:1.26\n\n# \u67e5\u770b\u66f4\u65b0\u72c0\u614b\nkubectl rollout status deployment/nginx-deployment\n\n# \u67e5\u770b\u66f4\u65b0\u6b77\u53f2\nkubectl rollout history deployment/nginx-deployment\n\n# \u56de\u6efe\u5230\u524d\u4e00\u7248\u672c\nkubectl rollout undo deployment/nginx-deployment\n\n# \u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c\nkubectl rollout undo deployment/nginx-deployment --to-revision=2\n</code></pre>"},{"location":"lab12_k8s_install/#474-canary-bluegreen","title":"4.7.4 Canary \u8207 Blue/Green","text":""},{"location":"lab12_k8s_install/#canary","title":"Canary \u90e8\u7f72\uff08\u91d1\u7d72\u96c0\u90e8\u7f72\uff09","text":"<p>\u5c07\u65b0\u7248\u672c\u90e8\u7f72\u7d66\u5c11\u91cf\u4f7f\u7528\u8005\u6e2c\u8a66\u3002</p> <pre><code>graph LR\n    User[\u4f7f\u7528\u8005\u6d41\u91cf] --&gt; LB[\u8ca0\u8f09\u5747\u8861]\n    LB --&gt;|90%| V1[v1 Pod x 9]\n    LB --&gt;|10%| V2[v2 Pod x 1]</code></pre> Canary Deployment \u7bc4\u4f8b<pre><code># \u7a69\u5b9a\u7248\u672c Deployment\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-stable\nspec:\n  replicas: 9\n  selector:\n    matchLabels:\n      app: myapp\n      version: stable\n  template:\n    metadata:\n      labels:\n        app: myapp\n        version: stable\n    spec:\n      containers:\n        - name: app\n          image: myapp:v1\n---\n# Canary \u7248\u672c Deployment\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-canary\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: myapp\n      version: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        version: canary\n    spec:\n      containers:\n        - name: app\n          image: myapp:v2\n---\n# Service \u540c\u6642\u9078\u64c7\u5169\u500b\u7248\u672c\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-service\nspec:\n  selector:\n    app: myapp          # \u4e0d\u6307\u5b9a version\uff0c\u540c\u6642\u5305\u542b\u5169\u500b\u7248\u672c\n  ports:\n    - port: 80\n</code></pre>"},{"location":"lab12_k8s_install/#bluegreen","title":"Blue/Green \u90e8\u7f72\uff08\u85cd\u7da0\u90e8\u7f72\uff09","text":"<p>\u540c\u6642\u7dad\u8b77\u5169\u500b\u74b0\u5883\uff0c\u5feb\u901f\u5207\u63db\u3002</p> <pre><code>graph LR\n    subgraph \"\u5207\u63db\u524d\"\n        User1[\u4f7f\u7528\u8005] --&gt; Blue1[Blue \u74b0\u5883&lt;br/&gt;v1 - \u904b\u884c\u4e2d]\n        Green1[Green \u74b0\u5883&lt;br/&gt;v2 - \u5f85\u547d]\n    end\n\n    subgraph \"\u5207\u63db\u5f8c\"\n        User2[\u4f7f\u7528\u8005] --&gt; Green2[Green \u74b0\u5883&lt;br/&gt;v2 - \u904b\u884c\u4e2d]\n        Blue2[Blue \u74b0\u5883&lt;br/&gt;v1 - \u5f85\u547d]\n    end</code></pre> Blue/Green \u90e8\u7f72\u5207\u63db<pre><code># \u5047\u8a2d\u76ee\u524d Service \u6307\u5411 blue\n# \u5207\u63db\u5230 green\nkubectl patch service myapp-service -p '{\"spec\":{\"selector\":{\"version\":\"green\"}}}'\n\n# \u78ba\u8a8d\u5207\u63db\nkubectl describe service myapp-service\n</code></pre>"},{"location":"lab12_k8s_install/#475","title":"4.7.5 \u53ef\u7528\u8cc7\u6e90\u7ba1\u7406","text":""},{"location":"lab12_k8s_install/#_9","title":"\u8cc7\u6e90\u8acb\u6c42\u8207\u9650\u5236","text":"\u8cc7\u6e90\u8a2d\u5b9a<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: resource-demo\nspec:\n  template:\n    spec:\n      containers:\n        - name: app\n          image: nginx\n          resources:\n            requests:              # \u6700\u5c0f\u9700\u6c42\n              memory: \"64Mi\"\n              cpu: \"250m\"         # 0.25 CPU\n            limits:               # \u6700\u5927\u9650\u5236\n              memory: \"128Mi\"\n              cpu: \"500m\"         # 0.5 CPU\n</code></pre> <p>CPU \u55ae\u4f4d\u8aaa\u660e</p> <ul> <li><code>1</code> = 1 CPU \u6838\u5fc3</li> <li><code>500m</code> = 0.5 CPU = 500 millicores</li> <li><code>250m</code> = 0.25 CPU</li> </ul>"},{"location":"lab12_k8s_install/#resource-quota","title":"Resource Quota","text":"ResourceQuota \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: compute-quota\n  namespace: dev\nspec:\n  hard:\n    requests.cpu: \"4\"\n    requests.memory: 8Gi\n    limits.cpu: \"8\"\n    limits.memory: 16Gi\n    pods: \"10\"\n</code></pre>"},{"location":"lab12_k8s_install/#limitrange","title":"LimitRange","text":"LimitRange \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: limit-range\n  namespace: dev\nspec:\n  limits:\n    - type: Container\n      default:\n        cpu: \"500m\"\n        memory: \"256Mi\"\n      defaultRequest:\n        cpu: \"100m\"\n        memory: \"64Mi\"\n      max:\n        cpu: \"2\"\n        memory: \"1Gi\"\n      min:\n        cpu: \"50m\"\n        memory: \"32Mi\"\n</code></pre>"},{"location":"lab12_k8s_install/#48-kubernetes","title":"4.8 Kubernetes \u7db2\u8def","text":""},{"location":"lab12_k8s_install/#pod","title":"Pod \u7db2\u8def","text":"<pre><code>graph TB\n    subgraph \"Node 1\"\n        subgraph \"Pod A\"\n            C1[Container 1]\n            C2[Container 2]\n        end\n        subgraph \"Pod B\"\n            C3[Container 3]\n        end\n    end\n\n    subgraph \"Node 2\"\n        subgraph \"Pod C\"\n            C4[Container 4]\n        end\n    end\n\n    C1 &lt;--&gt;|localhost| C2\n    C1 &lt;--&gt;|Pod IP| C3\n    C3 &lt;--&gt;|CNI| C4</code></pre>"},{"location":"lab12_k8s_install/#_10","title":"\u7db2\u8def\u6a21\u578b\u539f\u5247","text":"<p>Kubernetes \u7db2\u8def\u539f\u5247</p> <ol> <li>\u6240\u6709 Pod \u53ef\u4ee5\u76f4\u63a5\u901a\u8a0a\uff08\u4e0d\u9700 NAT\uff09</li> <li>Node \u4e0a\u7684\u4ee3\u7406\u53ef\u4ee5\u8207\u6240\u6709 Pod \u901a\u8a0a</li> <li>Pod \u770b\u5230\u7684 IP \u8207\u5176\u4ed6 Pod \u770b\u5230\u7684\u76f8\u540c</li> </ol>"},{"location":"lab12_k8s_install/#cni","title":"CNI \u63d2\u4ef6","text":"CNI \u63d2\u4ef6 \u8aaa\u660e Calico \u6700\u5e38\u7528\uff0c\u652f\u63f4 Network Policy Flannel \u7c21\u55ae\u6613\u7528 Weave \u81ea\u52d5\u767c\u73fe\uff0c\u6613\u65bc\u8a2d\u5b9a Cilium eBPF \u57fa\u790e\uff0c\u9ad8\u6548\u80fd"},{"location":"lab12_k8s_install/#networkpolicy","title":"NetworkPolicy","text":"NetworkPolicy \u7bc4\u4f8b<pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-nginx\n  namespace: default\nspec:\n  podSelector:\n    matchLabels:\n      app: nginx\n  policyTypes:\n    - Ingress\n    - Egress\n  ingress:\n    - from:\n        - podSelector:\n            matchLabels:\n              app: frontend\n      ports:\n        - protocol: TCP\n          port: 80\n  egress:\n    - to:\n        - podSelector:\n            matchLabels:\n              app: database\n      ports:\n        - protocol: TCP\n          port: 3306\n</code></pre>"},{"location":"lab12_k8s_install/#49-persistent-volumes","title":"4.9 Persistent Volumes","text":""},{"location":"lab12_k8s_install/#_11","title":"\u5132\u5b58\u67b6\u69cb","text":"<pre><code>graph LR\n    Pod[Pod] --&gt; PVC[PersistentVolumeClaim]\n    PVC --&gt; PV[PersistentVolume]\n    PV --&gt; Storage[(\u5be6\u969b\u5132\u5b58&lt;br/&gt;NFS/Cloud Disk)]</code></pre>"},{"location":"lab12_k8s_install/#persistentvolume-pv","title":"PersistentVolume (PV)","text":"PersistentVolume \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-demo\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce          # RWO: \u55ae\u7bc0\u9ede\u8b80\u5beb\n    # - ReadOnlyMany         # ROX: \u591a\u7bc0\u9ede\u552f\u8b80\n    # - ReadWriteMany        # RWX: \u591a\u7bc0\u9ede\u8b80\u5beb\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: standard\n  hostPath:                  # \u50c5\u7528\u65bc\u6e2c\u8a66\n    path: /data/pv-demo\n</code></pre>"},{"location":"lab12_k8s_install/#persistentvolumeclaim-pvc","title":"PersistentVolumeClaim (PVC)","text":"PersistentVolumeClaim \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc-demo\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n  storageClassName: standard\n</code></pre>"},{"location":"lab12_k8s_install/#pod-pvc","title":"\u5728 Pod \u4e2d\u4f7f\u7528 PVC","text":"Pod \u4f7f\u7528 PVC<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-with-pvc\nspec:\n  containers:\n    - name: app\n      image: nginx\n      volumeMounts:\n        - name: data\n          mountPath: /usr/share/nginx/html\n  volumes:\n    - name: data\n      persistentVolumeClaim:\n        claimName: pvc-demo\n</code></pre>"},{"location":"lab12_k8s_install/#410-configmaps-secrets","title":"4.10 ConfigMaps \u8207 Secrets","text":""},{"location":"lab12_k8s_install/#configmap","title":"ConfigMap","text":"<p>\u7528\u65bc\u5132\u5b58\u975e\u6a5f\u5bc6\u7684\u8a2d\u5b9a\u8cc7\u6599\u3002</p> ConfigMap \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: app-config\ndata:\n  # \u9375\u503c\u5c0d\n  APP_ENV: production\n  LOG_LEVEL: info\n  # \u8a2d\u5b9a\u6a94\n  nginx.conf: |\n    server {\n        listen 80;\n        server_name localhost;\n        location / {\n            root /usr/share/nginx/html;\n        }\n    }\n</code></pre> \u5efa\u7acb ConfigMap<pre><code># \u5f9e\u5b57\u9762\u503c\u5efa\u7acb\nkubectl create configmap app-config --from-literal=APP_ENV=production\n\n# \u5f9e\u6a94\u6848\u5efa\u7acb\nkubectl create configmap nginx-config --from-file=nginx.conf\n\n# \u5f9e\u76ee\u9304\u5efa\u7acb\nkubectl create configmap configs --from-file=./config-dir/\n</code></pre>"},{"location":"lab12_k8s_install/#secret","title":"Secret","text":"<p>\u7528\u65bc\u5132\u5b58\u654f\u611f\u8cc7\u6599\uff08Base64 \u7de8\u78bc\uff09\u3002</p> Secret \u7bc4\u4f8b<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-secret\ntype: Opaque\ndata:\n  # \u4f7f\u7528 base64 \u7de8\u78bc\n  username: YWRtaW4=           # admin\n  password: cGFzc3dvcmQxMjM=   # password123\n</code></pre> \u5efa\u7acb Secret<pre><code># \u5f9e\u5b57\u9762\u503c\u5efa\u7acb\nkubectl create secret generic db-secret \\\n  --from-literal=username=admin \\\n  --from-literal=password=password123\n\n# \u6aa2\u8996 Secret\uff08\u6703\u89e3\u78bc\uff09\nkubectl get secret db-secret -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"lab12_k8s_install/#pod_1","title":"\u5728 Pod \u4e2d\u4f7f\u7528","text":"\u4f7f\u7528 ConfigMap \u548c Secret<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: app-pod\nspec:\n  containers:\n    - name: app\n      image: nginx\n      # \u74b0\u5883\u8b8a\u6578\u65b9\u5f0f\n      env:\n        - name: APP_ENV\n          valueFrom:\n            configMapKeyRef:\n              name: app-config\n              key: APP_ENV\n        - name: DB_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: password\n      # \u639b\u8f09\u70ba\u6a94\u6848\n      volumeMounts:\n        - name: config\n          mountPath: /etc/nginx/conf.d\n        - name: secret\n          mountPath: /etc/secrets\n          readOnly: true\n  volumes:\n    - name: config\n      configMap:\n        name: app-config\n    - name: secret\n      secret:\n        secretName: db-secret\n</code></pre>"},{"location":"lab12_k8s_install/#411-rbac-role-based-access-control","title":"4.11 RBAC (Role-Based Access Control)","text":""},{"location":"lab12_k8s_install/#rbac","title":"RBAC \u6982\u5ff5","text":"<pre><code>graph LR\n    User[User/ServiceAccount] --&gt; RB[RoleBinding]\n    RB --&gt; Role[Role]\n    Role --&gt; Resources[Resources&lt;br/&gt;pods, services...]\n\n    User2[User/ServiceAccount] --&gt; CRB[ClusterRoleBinding]\n    CRB --&gt; CR[ClusterRole]\n    CR --&gt; Resources2[Cluster Resources]</code></pre>"},{"location":"lab12_k8s_install/#role-clusterrole","title":"Role \u8207 ClusterRole","text":"\u985e\u578b \u7bc4\u570d \u7528\u9014 Role \u55ae\u4e00 Namespace \u9650\u5b9a Namespace \u7684\u6b0a\u9650 ClusterRole \u6574\u500b\u53e2\u96c6 \u8de8 Namespace \u6216\u53e2\u96c6\u8cc7\u6e90 Role \u7bc4\u4f8b<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: dev\n  name: pod-reader\nrules:\n  - apiGroups: [\"\"]              # \u6838\u5fc3 API \u7fa4\u7d44\n    resources: [\"pods\"]\n    verbs: [\"get\", \"watch\", \"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"pods/log\"]\n    verbs: [\"get\"]\n</code></pre> ClusterRole \u7bc4\u4f8b<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: secret-reader\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"watch\", \"list\"]\n</code></pre>"},{"location":"lab12_k8s_install/#rolebinding-clusterrolebinding","title":"RoleBinding \u8207 ClusterRoleBinding","text":"RoleBinding \u7bc4\u4f8b<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: read-pods\n  namespace: dev\nsubjects:\n  - kind: User\n    name: jane\n    apiGroup: rbac.authorization.k8s.io\n  - kind: ServiceAccount\n    name: default\n    namespace: dev\nroleRef:\n  kind: Role\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io\n</code></pre> RBAC \u64cd\u4f5c<pre><code># \u67e5\u770b\u89d2\u8272\nkubectl get roles -n dev\nkubectl get clusterroles\n\n# \u67e5\u770b\u7d81\u5b9a\nkubectl get rolebindings -n dev\nkubectl get clusterrolebindings\n\n# \u6e2c\u8a66\u6b0a\u9650\nkubectl auth can-i get pods --as=jane -n dev\nkubectl auth can-i delete pods --as=jane -n dev\n</code></pre>"},{"location":"lab12_k8s_install/#412-kubernetes-wordpress-mysql","title":"4.12 \u4f7f\u7528 Kubernetes \u67b6\u8a2d WordPress + MySQL","text":""},{"location":"lab12_k8s_install/#lab","title":"Lab \u5be6\u4f5c\u76ee\u6a19","text":"<p>\u5728 Kubernetes \u4e0a\u90e8\u7f72\u5b8c\u6574\u7684 WordPress \u7db2\u7ad9\uff0c\u5305\u542b\uff1a</p> <ul> <li>MySQL \u8cc7\u6599\u5eab\uff08StatefulSet\uff09</li> <li>WordPress \u61c9\u7528\u7a0b\u5f0f\uff08Deployment\uff09</li> <li>\u6301\u4e45\u5316\u5132\u5b58\uff08PVC\uff09</li> <li>Service \u5c0d\u5916\u670d\u52d9</li> </ul>"},{"location":"lab12_k8s_install/#_12","title":"\u67b6\u69cb\u5716","text":"<pre><code>graph TB\n    User[\u4f7f\u7528\u8005] --&gt; WP_SVC[WordPress Service&lt;br/&gt;NodePort: 30080]\n    WP_SVC --&gt; WP1[WordPress Pod]\n    WP_SVC --&gt; WP2[WordPress Pod]\n    WP1 --&gt; MySQL_SVC[MySQL Service&lt;br/&gt;ClusterIP]\n    WP2 --&gt; MySQL_SVC\n    MySQL_SVC --&gt; MySQL[MySQL Pod]\n    WP1 --&gt; WP_PVC[WordPress PVC]\n    WP2 --&gt; WP_PVC\n    MySQL --&gt; MySQL_PVC[MySQL PVC]</code></pre>"},{"location":"lab12_k8s_install/#_13","title":"\u5be6\u4f5c\u6b65\u9a5f","text":""},{"location":"lab12_k8s_install/#1-namespace","title":"\u6b65\u9a5f 1\uff1a\u5efa\u7acb Namespace","text":"01-namespace.yaml<pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: wordpress\n</code></pre> <pre><code>kubectl apply -f 01-namespace.yaml\n</code></pre>"},{"location":"lab12_k8s_install/#2-secret","title":"\u6b65\u9a5f 2\uff1a\u5efa\u7acb Secret","text":"02-secret.yaml<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-secret\n  namespace: wordpress\ntype: Opaque\ndata:\n  mysql-root-password: cm9vdHBhc3N3b3Jk      # rootpassword\n  mysql-password: d3BwYXNzd29yZA==           # wppassword\n</code></pre> <pre><code>kubectl apply -f 02-secret.yaml\n</code></pre>"},{"location":"lab12_k8s_install/#3-mysql","title":"\u6b65\u9a5f 3\uff1a\u5efa\u7acb MySQL","text":"03-mysql.yaml<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: mysql-pvc\n  namespace: wordpress\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: mysql\n  namespace: wordpress\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: mysql\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n        - name: mysql\n          image: mysql:8.0\n          ports:\n            - containerPort: 3306\n          env:\n            - name: MYSQL_ROOT_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: mysql-secret\n                  key: mysql-root-password\n            - name: MYSQL_DATABASE\n              value: wordpress\n            - name: MYSQL_USER\n              value: wpuser\n            - name: MYSQL_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: mysql-secret\n                  key: mysql-password\n          volumeMounts:\n            - name: mysql-data\n              mountPath: /var/lib/mysql\n      volumes:\n        - name: mysql-data\n          persistentVolumeClaim:\n            claimName: mysql-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mysql\n  namespace: wordpress\nspec:\n  selector:\n    app: mysql\n  ports:\n    - port: 3306\n      targetPort: 3306\n  clusterIP: None\n</code></pre> <pre><code>kubectl apply -f 03-mysql.yaml\n</code></pre>"},{"location":"lab12_k8s_install/#4-wordpress","title":"\u6b65\u9a5f 4\uff1a\u5efa\u7acb WordPress","text":"04-wordpress.yaml<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: wordpress-pvc\n  namespace: wordpress\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 5Gi\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: wordpress\n  namespace: wordpress\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: wordpress\n  template:\n    metadata:\n      labels:\n        app: wordpress\n    spec:\n      containers:\n        - name: wordpress\n          image: wordpress:latest\n          ports:\n            - containerPort: 80\n          env:\n            - name: WORDPRESS_DB_HOST\n              value: mysql\n            - name: WORDPRESS_DB_NAME\n              value: wordpress\n            - name: WORDPRESS_DB_USER\n              value: wpuser\n            - name: WORDPRESS_DB_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: mysql-secret\n                  key: mysql-password\n          volumeMounts:\n            - name: wordpress-data\n              mountPath: /var/www/html\n      volumes:\n        - name: wordpress-data\n          persistentVolumeClaim:\n            claimName: wordpress-pvc\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: wordpress\n  namespace: wordpress\nspec:\n  type: NodePort\n  selector:\n    app: wordpress\n  ports:\n    - port: 80\n      targetPort: 80\n      nodePort: 30080\n</code></pre> <pre><code>kubectl apply -f 04-wordpress.yaml\n</code></pre>"},{"location":"lab12_k8s_install/#5","title":"\u6b65\u9a5f 5\uff1a\u9a57\u8b49\u90e8\u7f72","text":"\u9a57\u8b49\u6307\u4ee4<pre><code># \u6aa2\u67e5 Pod \u72c0\u614b\nkubectl get pods -n wordpress\n\n# \u6aa2\u67e5 Service\nkubectl get services -n wordpress\n\n# \u6aa2\u67e5 PVC\nkubectl get pvc -n wordpress\n\n# \u53d6\u5f97 minikube IP\nminikube ip\n\n# \u5b58\u53d6 WordPress\n# \u700f\u89bd\u5668\u958b\u555f http://&lt;minikube-ip&gt;:30080\n</code></pre>"},{"location":"lab12_k8s_install/#minikube-service","title":"\u4f7f\u7528 minikube service","text":"<pre><code># \u81ea\u52d5\u958b\u555f\u700f\u89bd\u5668\nminikube service wordpress -n wordpress\n</code></pre>"},{"location":"lab12_k8s_install/#413-loggingmonitoring","title":"4.13 Logging\u3001Monitoring \u8207\u7591\u96e3\u6392\u9664","text":""},{"location":"lab12_k8s_install/#pod_2","title":"\u67e5\u770b Pod \u65e5\u8a8c","text":"kubectl logs<pre><code># \u67e5\u770b\u65e5\u8a8c\nkubectl logs pod-name\n\n# \u6301\u7e8c\u8ffd\u8e64\nkubectl logs -f pod-name\n\n# \u67e5\u770b\u7279\u5b9a\u5bb9\u5668\uff08\u591a\u5bb9\u5668 Pod\uff09\nkubectl logs pod-name -c container-name\n\n# \u67e5\u770b\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\uff08\u91cd\u555f\u5f8c\uff09\nkubectl logs pod-name --previous\n\n# \u986f\u793a\u6700\u5f8c N \u884c\nkubectl logs pod-name --tail=100\n\n# \u6307\u5b9a\u6642\u9593\u7bc4\u570d\nkubectl logs pod-name --since=1h\n</code></pre>"},{"location":"lab12_k8s_install/#_14","title":"\u7591\u96e3\u6392\u9664\u6307\u4ee4","text":"\u5e38\u7528\u8a3a\u65b7\u6307\u4ee4<pre><code># \u67e5\u770b Pod \u72c0\u614b\nkubectl get pods -o wide\n\n# \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\nkubectl describe pod pod-name\n\n# \u9032\u5165 Pod \u57f7\u884c\u6307\u4ee4\nkubectl exec -it pod-name -- /bin/sh\n\n# \u67e5\u770b\u4e8b\u4ef6\nkubectl get events --sort-by='.lastTimestamp'\n\n# \u67e5\u770b\u8cc7\u6e90\u4f7f\u7528\nkubectl top pods\nkubectl top nodes\n</code></pre>"},{"location":"lab12_k8s_install/#_15","title":"\u5e38\u898b\u554f\u984c\u8a3a\u65b7","text":"<p>Pod \u72c0\u614b\u8aaa\u660e</p> \u72c0\u614b \u8aaa\u660e \u8655\u7406\u65b9\u5f0f Pending \u7b49\u5f85\u8abf\u5ea6 \u6aa2\u67e5\u8cc7\u6e90\u3001Node \u72c0\u614b ContainerCreating \u5efa\u7acb\u5bb9\u5668\u4e2d \u6aa2\u67e5 Image \u62c9\u53d6 Running \u904b\u884c\u4e2d \u6b63\u5e38 CrashLoopBackOff \u6301\u7e8c\u5d29\u6f70\u91cd\u555f \u67e5\u770b logs ImagePullBackOff Image \u62c9\u53d6\u5931\u6557 \u6aa2\u67e5 Image \u540d\u7a31\u3001Registry \u5b58\u53d6 Error \u932f\u8aa4 \u67e5\u770b describe\u3001logs \u8a3a\u65b7\u7bc4\u4f8b<pre><code># Pod Pending - \u6aa2\u67e5\u539f\u56e0\nkubectl describe pod pending-pod | grep -A 10 Events\n\n# CrashLoopBackOff - \u67e5\u770b\u65e5\u8a8c\nkubectl logs crashing-pod --previous\n\n# ImagePullBackOff - \u6aa2\u67e5 Image\nkubectl describe pod image-error-pod | grep -A 5 \"Image:\"\n</code></pre>"},{"location":"lab12_k8s_install/#_16","title":"\u76e3\u63a7\u5de5\u5177","text":"<p>\u5e38\u898b\u76e3\u63a7\u65b9\u6848</p> \u5de5\u5177 \u7528\u9014 Prometheus \u6307\u6a19\u6536\u96c6\u8207\u5132\u5b58 Grafana \u8996\u89ba\u5316\u5100\u8868\u677f Loki \u65e5\u8a8c\u805a\u5408 Jaeger \u5206\u6563\u5f0f\u8ffd\u8e64 Kubernetes Dashboard \u57fa\u672c UI"},{"location":"lab12_k8s_install/#_17","title":"\u5e38\u898b\u554f\u984c","text":"Q1\uff1aPod \u4e00\u76f4\u8655\u65bc Pending \u72c0\u614b <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>\u8cc7\u6e90\u4e0d\u8db3\uff08CPU/Memory\uff09</li> <li>Node \u6a19\u7c64\u4e0d\u7b26\u5408 nodeSelector</li> <li>PVC \u672a\u7d81\u5b9a</li> </ol> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a </p><pre><code>kubectl describe pod pending-pod\nkubectl get events --field-selector involvedObject.name=pending-pod\n</code></pre><p></p> Q2\uff1aService \u7121\u6cd5\u9023\u63a5\u5230 Pod <p>\u6aa2\u67e5\u6b65\u9a5f\uff1a </p><pre><code># 1. \u78ba\u8a8d Pod \u904b\u884c\u4e2d\nkubectl get pods -l app=myapp\n\n# 2. \u78ba\u8a8d Service selector \u6b63\u78ba\nkubectl describe service myapp-service\n\n# 3. \u78ba\u8a8d Endpoints\nkubectl get endpoints myapp-service\n\n# 4. \u6e2c\u8a66 Pod \u5167\u90e8\u9023\u7dda\nkubectl exec -it test-pod -- curl myapp-service\n</code></pre><p></p> Q3\uff1a\u5982\u4f55\u56de\u6efe\u5230\u524d\u4e00\u500b\u7248\u672c\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u67e5\u770b\u6b77\u53f2\nkubectl rollout history deployment/myapp\n\n# \u56de\u6efe\u5230\u524d\u4e00\u7248\nkubectl rollout undo deployment/myapp\n\n# \u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c\nkubectl rollout undo deployment/myapp --to-revision=2\n\n# \u78ba\u8a8d\u72c0\u614b\nkubectl rollout status deployment/myapp\n</code></pre><p></p> Q4\uff1aConfigMap \u66f4\u65b0\u5f8c Pod \u70ba\u4ec0\u9ebc\u6c92\u6709\u8b8a\u5316\uff1f <p>\u539f\u56e0\uff1aPod \u4e0d\u6703\u81ea\u52d5\u91cd\u65b0\u8f09\u5165 ConfigMap</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u65b9\u6cd5 1\uff1a\u91cd\u555f Deployment\nkubectl rollout restart deployment/myapp\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 configmap hash annotation\uff08\u5efa\u8b70\uff09\n# \u5728 Deployment template \u52a0\u5165 annotation\nkubectl patch deployment myapp -p \\\n  '{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"configmap-hash\":\"'$(kubectl get cm myconfig -o jsonpath='{.metadata.resourceVersion}')'\"}}}}}' \n</code></pre><p></p> Q5\uff1a\u5982\u4f55\u6e05\u7406 Evicted \u7684 Pod\uff1f <p>\u89e3\u6c7a\u65b9\u6848\uff1a </p><pre><code># \u67e5\u770b Evicted Pod\nkubectl get pods --field-selector=status.phase=Failed\n\n# \u522a\u9664\u6240\u6709 Evicted Pod\nkubectl delete pods --field-selector=status.phase=Failed --all-namespaces\n</code></pre><p></p>"},{"location":"lab12_k8s_install/#_18","title":"\u5c0f\u7d50","text":"<p>\u672c\u7ae0\u7bc0\u91cd\u9ede\u56de\u9867\uff1a</p> <ul> <li>\u2705 Kubernetes \u6982\u8ff0\uff1aK8S \u8207 OpenShift/OKD \u7684\u95dc\u4fc2\uff0cminikube \u672c\u5730\u74b0\u5883</li> <li>\u2705 \u6838\u5fc3\u67b6\u69cb\uff1aControl Plane\uff08API Server\u3001etcd\u3001Scheduler\uff09\u8207 Worker Node</li> <li>\u2705 \u8cc7\u6e90\u985e\u578b\uff1aPod\u3001Deployment\u3001Service\u3001ConfigMap\u3001Secret \u7b49</li> <li>\u2705 \u90e8\u7f72\u7b56\u7565\uff1aRollingUpdate\u3001Recreate\u3001Canary\u3001Blue/Green</li> <li>\u2705 \u7db2\u8def\u8207\u5132\u5b58\uff1aService \u985e\u578b\u3001PV/PVC\u3001NetworkPolicy</li> <li>\u2705 \u5b89\u5168\u63a7\u7ba1\uff1aRBAC\uff08Role\u3001ClusterRole\u3001RoleBinding\uff09</li> <li>\u2705 \u5be6\u4f5c\u7d93\u9a57\uff1aWordPress + MySQL \u5728 K8S \u4e0a\u7684\u5b8c\u6574\u90e8\u7f72</li> <li>\u2705 \u7591\u96e3\u6392\u89e3\uff1akubectl logs\u3001describe\u3001exec \u8a3a\u65b7\u6280\u5de7</li> </ul>"},{"location":"lab12_k8s_install/#_19","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Kubernetes \u5b98\u65b9\u6587\u4ef6</li> <li>Kubernetes \u5b98\u65b9\u6559\u7a0b</li> <li>minikube \u5b98\u65b9\u6587\u4ef6</li> <li>OpenShift \u5b98\u65b9\u6587\u4ef6</li> <li>Kubernetes Patterns \u96fb\u5b50\u66f8</li> <li>CNCF Landscape</li> </ul>"},{"location":"lab13_k8s_commands/","title":"LAB 13 kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#lab-13-kubernetes","title":"LAB 13 kubernetes \u5e38\u7528\u6307\u4ee4","text":""},{"location":"lab13_k8s_commands/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab13_k8s_commands/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab14_namespace_rolling/","title":"LAB 14 namespaces \u8207 rolling update","text":""},{"location":"lab14_namespace_rolling/#lab-14-namespaces-rolling-update","title":"LAB 14 namespaces \u8207 rolling update","text":""},{"location":"lab14_namespace_rolling/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab14_namespace_rolling/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab15_service/","title":"LAB 15 service","text":""},{"location":"lab15_service/#lab-15-service","title":"LAB 15 service","text":""},{"location":"lab15_service/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab15_service/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab16_pv_pvc/","title":"LAB 16 PV/PVC","text":""},{"location":"lab16_pv_pvc/#lab-16-pvpvc","title":"LAB 16 PV/PVC","text":""},{"location":"lab16_pv_pvc/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab16_pv_pvc/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab17_secret/","title":"LAB 17 secret","text":""},{"location":"lab17_secret/#lab-17-secret","title":"LAB 17 secret","text":""},{"location":"lab17_secret/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab17_secret/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab18_rbac_event_log/","title":"LAB 18 RBAC \u8207 event/log","text":""},{"location":"lab18_rbac_event_log/#lab-18-rbac-eventlog","title":"LAB 18 RBAC \u8207 event/log","text":""},{"location":"lab18_rbac_event_log/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab18_rbac_event_log/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab19_k8s_wordpress_mysql/","title":"LAB 19 Kubernetes + wordpress + mysql","text":""},{"location":"lab19_k8s_wordpress_mysql/#lab-19-kubernetes-wordpress-mysql","title":"LAB 19 Kubernetes + wordpress + mysql","text":""},{"location":"lab19_k8s_wordpress_mysql/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab19_k8s_wordpress_mysql/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"lab20_dashboard/","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#lab-20-kubernetes-dashboard","title":"LAB 20 \u5716\u5f62\u7ba1\u7406\u5de5\u5177 Kubernetes Dashboard","text":""},{"location":"lab20_dashboard/#_1","title":"\u5b78\u7fd2\u76ee\u6a19","text":"<ul> <li> \u5f85\u88dc</li> </ul>"},{"location":"lab20_dashboard/#_2","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<p>(\u672c\u7ae0\u7bc0\u5167\u5bb9\u5f85\u88dc)</p>"},{"location":"appendix/docker_cheatsheet/","title":"Docker \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/docker_cheatsheet/#docker","title":"Docker \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 Docker \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/docker_cheatsheet/#_1","title":"\u5bb9\u5668\u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_2","title":"\u57f7\u884c\u5bb9\u5668","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker run &lt;image&gt;</code> \u57f7\u884c\u5bb9\u5668 <code>docker run -d &lt;image&gt;</code> \u80cc\u666f\u57f7\u884c <code>docker run -it &lt;image&gt; /bin/bash</code> \u4e92\u52d5\u6a21\u5f0f <code>docker run --name &lt;name&gt; &lt;image&gt;</code> \u6307\u5b9a\u540d\u7a31 <code>docker run -p 8080:80 &lt;image&gt;</code> Port \u5c0d\u61c9 <code>docker run -v /host:/container &lt;image&gt;</code> \u639b\u8f09\u76ee\u9304 <code>docker run -e VAR=value &lt;image&gt;</code> \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 <code>docker run --rm &lt;image&gt;</code> \u7d50\u675f\u5f8c\u81ea\u52d5\u522a\u9664 <code>docker run --restart=always &lt;image&gt;</code> \u81ea\u52d5\u91cd\u555f <code>docker run --network &lt;network&gt; &lt;image&gt;</code> \u6307\u5b9a\u7db2\u8def"},{"location":"appendix/docker_cheatsheet/#_3","title":"\u5bb9\u5668\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker ps</code> \u5217\u51fa\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker ps -a</code> \u5217\u51fa\u6240\u6709\u5bb9\u5668 <code>docker start &lt;container&gt;</code> \u555f\u52d5\u5bb9\u5668 <code>docker stop &lt;container&gt;</code> \u505c\u6b62\u5bb9\u5668 <code>docker restart &lt;container&gt;</code> \u91cd\u555f\u5bb9\u5668 <code>docker pause &lt;container&gt;</code> \u66ab\u505c\u5bb9\u5668 <code>docker unpause &lt;container&gt;</code> \u7e7c\u7e8c\u5bb9\u5668 <code>docker rm &lt;container&gt;</code> \u522a\u9664\u5bb9\u5668 <code>docker rm -f &lt;container&gt;</code> \u5f37\u5236\u522a\u9664\u904b\u884c\u4e2d\u7684\u5bb9\u5668 <code>docker container prune</code> \u522a\u9664\u6240\u6709\u5df2\u505c\u6b62\u7684\u5bb9\u5668"},{"location":"appendix/docker_cheatsheet/#_4","title":"\u5bb9\u5668\u64cd\u4f5c\u8207\u9664\u932f","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker exec -it &lt;container&gt; /bin/bash</code> \u9032\u5165\u5bb9\u5668 <code>docker exec &lt;container&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker logs &lt;container&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>docker logs -f &lt;container&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker logs --tail 100 &lt;container&gt;</code> \u6700\u5f8c 100 \u884c <code>docker inspect &lt;container&gt;</code> \u8a73\u7d30\u8cc7\u8a0a <code>docker stats</code> \u8cc7\u6e90\u4f7f\u7528\u7d71\u8a08 <code>docker top &lt;container&gt;</code> \u5bb9\u5668\u5167\u7a0b\u5e8f <code>docker cp &lt;src&gt; &lt;container&gt;:&lt;dest&gt;</code> \u8907\u88fd\u6a94\u6848\u5230\u5bb9\u5668 <code>docker cp &lt;container&gt;:&lt;src&gt; &lt;dest&gt;</code> \u5f9e\u5bb9\u5668\u8907\u88fd\u6a94\u6848"},{"location":"appendix/docker_cheatsheet/#image","title":"Image \u7ba1\u7406","text":""},{"location":"appendix/docker_cheatsheet/#_5","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker images</code> \u5217\u51fa\u672c\u5730 Image <code>docker pull &lt;image&gt;</code> \u62c9\u53d6 Image <code>docker push &lt;image&gt;</code> \u63a8\u9001 Image <code>docker rmi &lt;image&gt;</code> \u522a\u9664 Image <code>docker image prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Image <code>docker image prune -a</code> \u522a\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Image"},{"location":"appendix/docker_cheatsheet/#_6","title":"\u5efa\u7f6e\u8207\u6a19\u7c64","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker build -t &lt;name&gt;:&lt;tag&gt; .</code> \u5efa\u7f6e Image <code>docker build -f Dockerfile.prod .</code> \u6307\u5b9a Dockerfile <code>docker build --no-cache .</code> \u4e0d\u4f7f\u7528\u5feb\u53d6 <code>docker tag &lt;image&gt; &lt;new-tag&gt;</code> \u52a0\u4e0a\u6a19\u7c64 <code>docker history &lt;image&gt;</code> \u67e5\u770b Image \u6b77\u53f2 <code>docker save -o image.tar &lt;image&gt;</code> \u532f\u51fa Image <code>docker load -i image.tar</code> \u532f\u5165 Image"},{"location":"appendix/docker_cheatsheet/#_7","title":"\u641c\u5c0b","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker search &lt;keyword&gt;</code> \u641c\u5c0b Docker Hub <code>docker search --filter is-official=true &lt;keyword&gt;</code> \u53ea\u641c\u5c0b\u5b98\u65b9 Image <code>docker search --limit 5 &lt;keyword&gt;</code> \u9650\u5236\u7d50\u679c\u6578\u91cf"},{"location":"appendix/docker_cheatsheet/#volume","title":"Volume \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker volume ls</code> \u5217\u51fa\u6240\u6709 Volume <code>docker volume create &lt;name&gt;</code> \u5efa\u7acb Volume <code>docker volume inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a <code>docker volume rm &lt;name&gt;</code> \u522a\u9664 Volume <code>docker volume prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume"},{"location":"appendix/docker_cheatsheet/#_8","title":"\u639b\u8f09\u65b9\u5f0f","text":"<pre><code># Volume \u639b\u8f09\ndocker run -v my-volume:/app/data nginx\n\n# Bind Mount\ndocker run -v /host/path:/container/path nginx\n\n# \u552f\u8b80\u639b\u8f09\ndocker run -v /host/path:/container/path:ro nginx\n\n# --mount \u8a9e\u6cd5\uff08\u63a8\u85a6\uff09\ndocker run --mount type=volume,source=my-volume,target=/app/data nginx\ndocker run --mount type=bind,source=/host/path,target=/container/path nginx\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#_9","title":"\u7db2\u8def\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker network ls</code> \u5217\u51fa\u6240\u6709\u7db2\u8def <code>docker network create &lt;name&gt;</code> \u5efa\u7acb\u7db2\u8def <code>docker network connect &lt;network&gt; &lt;container&gt;</code> \u9023\u63a5\u7db2\u8def <code>docker network disconnect &lt;network&gt; &lt;container&gt;</code> \u65b7\u958b\u7db2\u8def <code>docker network rm &lt;name&gt;</code> \u522a\u9664\u7db2\u8def <code>docker network prune</code> \u522a\u9664\u672a\u4f7f\u7528\u7684\u7db2\u8def <code>docker network inspect &lt;name&gt;</code> \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a"},{"location":"appendix/docker_cheatsheet/#_10","title":"\u7db2\u8def\u985e\u578b","text":"\u985e\u578b \u8aaa\u660e <code>bridge</code> \u9810\u8a2d\uff0c\u5bb9\u5668\u900f\u904e\u865b\u64ec\u6a4b\u63a5\u5668\u9023\u63a5 <code>host</code> \u76f4\u63a5\u4f7f\u7528\u4e3b\u6a5f\u7db2\u8def <code>none</code> \u7121\u7db2\u8def <code>overlay</code> \u8de8\u4e3b\u6a5f\u901a\u8a0a\uff08Swarm\uff09"},{"location":"appendix/docker_cheatsheet/#_11","title":"\u7cfb\u7d71\u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker info</code> \u7cfb\u7d71\u8cc7\u8a0a <code>docker version</code> \u7248\u672c\u8cc7\u8a0a <code>docker system df</code> \u78c1\u789f\u4f7f\u7528\u91cf <code>docker system prune</code> \u6e05\u7406\u672a\u4f7f\u7528\u8cc7\u6e90 <code>docker system prune -a --volumes</code> \u5b8c\u6574\u6e05\u7406 <code>docker events</code> \u5373\u6642\u4e8b\u4ef6"},{"location":"appendix/docker_cheatsheet/#docker-compose","title":"Docker Compose","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker compose up</code> \u555f\u52d5\u670d\u52d9 <code>docker compose up -d</code> \u80cc\u666f\u555f\u52d5 <code>docker compose down</code> \u505c\u6b62\u4e26\u79fb\u9664 <code>docker compose down -v</code> \u540c\u6642\u79fb\u9664 Volume <code>docker compose ps</code> \u5217\u51fa\u670d\u52d9 <code>docker compose logs</code> \u67e5\u770b\u65e5\u8a8c <code>docker compose logs -f</code> \u8ffd\u8e64\u65e5\u8a8c <code>docker compose exec &lt;service&gt; &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>docker compose build</code> \u5efa\u7f6e\u670d\u52d9 <code>docker compose pull</code> \u62c9\u53d6 Image"},{"location":"appendix/docker_cheatsheet/#registry","title":"Registry \u767b\u5165","text":"\u6307\u4ee4 \u8aaa\u660e <code>docker login</code> \u767b\u5165 Docker Hub <code>docker login &lt;registry&gt;</code> \u767b\u5165\u79c1\u6709 Registry <code>docker logout</code> \u767b\u51fa"},{"location":"appendix/docker_cheatsheet/#_12","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5e38\u7528\u64cd\u4f5c<pre><code># \u505c\u6b62\u6240\u6709\u5bb9\u5668\ndocker stop $(docker ps -q)\n\n# \u522a\u9664\u6240\u6709\u5bb9\u5668\ndocker rm $(docker ps -aq)\n\n# \u522a\u9664\u6240\u6709 Image\ndocker rmi $(docker images -q)\n\n# \u522a\u9664 dangling Image\ndocker rmi $(docker images -f \"dangling=true\" -q)\n\n# \u53d6\u5f97\u5bb9\u5668 IP\ndocker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container&gt;\n\n# \u9032\u5165\u904b\u884c\u4e2d\u7684\u5bb9\u5668\ndocker exec -it $(docker ps -q -f name=nginx) /bin/sh\n</code></pre>"},{"location":"appendix/docker_cheatsheet/#dockerfile","title":"Dockerfile \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>FROM</code> \u57fa\u790e Image <code>RUN</code> \u57f7\u884c\u6307\u4ee4 <code>COPY</code> \u8907\u88fd\u6a94\u6848 <code>ADD</code> \u8907\u88fd\u6a94\u6848\uff08\u652f\u63f4 URL\u3001\u89e3\u58d3\u7e2e\uff09 <code>WORKDIR</code> \u5de5\u4f5c\u76ee\u9304 <code>ENV</code> \u74b0\u5883\u8b8a\u6578 <code>EXPOSE</code> \u66b4\u9732 Port <code>CMD</code> \u9810\u8a2d\u57f7\u884c\u6307\u4ee4 <code>ENTRYPOINT</code> \u5165\u53e3\u9ede <code>VOLUME</code> \u639b\u8f09\u9ede <code>USER</code> \u57f7\u884c\u8eab\u4efd <code>ARG</code> \u5efa\u7f6e\u53c3\u6578 <code>LABEL</code> \u6a19\u7c64 <code>HEALTHCHECK</code> \u5065\u5eb7\u6aa2\u67e5"},{"location":"appendix/docker_cheatsheet/#_13","title":"\u74b0\u5883\u8b8a\u6578","text":"\u8b8a\u6578 \u8aaa\u660e <code>DOCKER_HOST</code> Docker \u4e3b\u6a5f\u4f4d\u5740 <code>DOCKER_TLS_VERIFY</code> \u555f\u7528 TLS \u9a57\u8b49 <code>DOCKER_CERT_PATH</code> TLS \u6191\u8b49\u8def\u5f91 <code>DOCKER_CONFIG</code> \u8a2d\u5b9a\u6a94\u76ee\u9304"},{"location":"appendix/k8s_cheatsheet/","title":"Kubernetes \u6307\u4ee4\u901f\u67e5","text":""},{"location":"appendix/k8s_cheatsheet/#kubernetes","title":"Kubernetes \u6307\u4ee4\u901f\u67e5\u8868","text":"<p>\u5feb\u901f\u53c3\u8003 kubectl \u5e38\u7528\u6307\u4ee4\uff0c\u9069\u5408\u65e5\u5e38\u64cd\u4f5c\u8207\u8003\u8a66\u8907\u7fd2\u3002</p>"},{"location":"appendix/k8s_cheatsheet/#_1","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_2","title":"\u53e2\u96c6\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl cluster-info</code> \u53e2\u96c6\u8cc7\u8a0a <code>kubectl version</code> \u7248\u672c\u8cc7\u8a0a <code>kubectl config view</code> \u67e5\u770b\u8a2d\u5b9a <code>kubectl config get-contexts</code> \u5217\u51fa Context <code>kubectl config use-context &lt;name&gt;</code> \u5207\u63db Context <code>kubectl api-resources</code> \u5217\u51fa API \u8cc7\u6e90 <code>kubectl api-versions</code> \u5217\u51fa API \u7248\u672c"},{"location":"appendix/k8s_cheatsheet/#_3","title":"\u8cc7\u6e90\u67e5\u8a62","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get &lt;resource&gt;</code> \u5217\u51fa\u8cc7\u6e90 <code>kubectl get pods</code> \u5217\u51fa Pod <code>kubectl get pods -o wide</code> \u8a73\u7d30\u8cc7\u8a0a\uff08\u542b IP\u3001Node\uff09 <code>kubectl get pods -o yaml</code> YAML \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -o json</code> JSON \u683c\u5f0f\u8f38\u51fa <code>kubectl get pods -w</code> \u6301\u7e8c\u76e3\u770b <code>kubectl get pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u904e\u6ffe <code>kubectl get pods -n &lt;namespace&gt;</code> \u6307\u5b9a Namespace <code>kubectl get pods --all-namespaces</code> \u6240\u6709 Namespace <code>kubectl get all</code> \u5217\u51fa\u5e38\u898b\u8cc7\u6e90"},{"location":"appendix/k8s_cheatsheet/#_4","title":"\u8cc7\u6e90\u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_5","title":"\u5efa\u7acb\u8207\u5957\u7528","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl apply -f &lt;file.yaml&gt;</code> \u5957\u7528\u8a2d\u5b9a <code>kubectl apply -f &lt;directory&gt;/</code> \u5957\u7528\u76ee\u9304\u4e0b\u6240\u6709\u8a2d\u5b9a <code>kubectl create -f &lt;file.yaml&gt;</code> \u5efa\u7acb\u8cc7\u6e90 <code>kubectl create deployment &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Deployment <code>kubectl create service clusterip &lt;name&gt; --tcp=80:80</code> \u5efa\u7acb Service <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb ConfigMap <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret"},{"location":"appendix/k8s_cheatsheet/#_6","title":"\u7de8\u8f2f\u8207\u522a\u9664","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl edit &lt;resource&gt; &lt;name&gt;</code> \u7de8\u8f2f\u8cc7\u6e90 <code>kubectl delete &lt;resource&gt; &lt;name&gt;</code> \u522a\u9664\u8cc7\u6e90 <code>kubectl delete -f &lt;file.yaml&gt;</code> \u4f9d\u8a2d\u5b9a\u6a94\u522a\u9664 <code>kubectl delete pods --all</code> \u522a\u9664\u6240\u6709 Pod <code>kubectl delete pods -l app=nginx</code> \u4f9d\u6a19\u7c64\u522a\u9664"},{"location":"appendix/k8s_cheatsheet/#_7","title":"\u8a73\u7d30\u8cc7\u8a0a","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl describe &lt;resource&gt; &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl describe pod &lt;pod-name&gt;</code> \u63cf\u8ff0 Pod <code>kubectl describe node &lt;node-name&gt;</code> \u63cf\u8ff0 Node"},{"location":"appendix/k8s_cheatsheet/#pod","title":"Pod \u64cd\u4f5c","text":""},{"location":"appendix/k8s_cheatsheet/#_8","title":"\u57f7\u884c\u8207\u5b58\u53d6","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl run &lt;name&gt; --image=&lt;image&gt;</code> \u5efa\u7acb Pod <code>kubectl exec -it &lt;pod&gt; -- /bin/sh</code> \u9032\u5165 Pod <code>kubectl exec &lt;pod&gt; -- &lt;command&gt;</code> \u57f7\u884c\u6307\u4ee4 <code>kubectl logs &lt;pod&gt;</code> \u67e5\u770b\u65e5\u8a8c <code>kubectl logs -f &lt;pod&gt;</code> \u8ffd\u8e64\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; -c &lt;container&gt;</code> \u591a\u5bb9\u5668\u6307\u5b9a <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c <code>kubectl logs &lt;pod&gt; --tail=100</code> \u6700\u5f8c 100 \u884c <code>kubectl port-forward &lt;pod&gt; 8080:80</code> Port \u8f49\u767c <code>kubectl cp &lt;pod&gt;:&lt;path&gt; &lt;local-path&gt;</code> \u8907\u88fd\u6a94\u6848"},{"location":"appendix/k8s_cheatsheet/#deployment","title":"Deployment \u7ba1\u7406","text":""},{"location":"appendix/k8s_cheatsheet/#_9","title":"\u57fa\u672c\u64cd\u4f5c","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get deployments</code> \u5217\u51fa Deployment <code>kubectl describe deployment &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl scale deployment &lt;name&gt; --replicas=3</code> \u8abf\u6574\u526f\u672c <code>kubectl set image deployment/&lt;name&gt; &lt;container&gt;=&lt;image&gt;</code> \u66f4\u65b0 Image"},{"location":"appendix/k8s_cheatsheet/#_10","title":"\u6efe\u52d5\u66f4\u65b0","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl rollout status deployment/&lt;name&gt;</code> \u67e5\u770b\u66f4\u65b0\u72c0\u614b <code>kubectl rollout history deployment/&lt;name&gt;</code> \u67e5\u770b\u6b77\u53f2 <code>kubectl rollout undo deployment/&lt;name&gt;</code> \u56de\u6efe <code>kubectl rollout undo deployment/&lt;name&gt; --to-revision=2</code> \u56de\u6efe\u5230\u7279\u5b9a\u7248\u672c <code>kubectl rollout restart deployment/&lt;name&gt;</code> \u91cd\u555f <code>kubectl rollout pause deployment/&lt;name&gt;</code> \u66ab\u505c\u66f4\u65b0 <code>kubectl rollout resume deployment/&lt;name&gt;</code> \u7e7c\u7e8c\u66f4\u65b0"},{"location":"appendix/k8s_cheatsheet/#service","title":"Service \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get services</code> \u5217\u51fa Service <code>kubectl get endpoints</code> \u5217\u51fa Endpoints <code>kubectl expose deployment &lt;name&gt; --port=80</code> \u5efa\u7acb Service <code>kubectl expose deployment &lt;name&gt; --type=NodePort --port=80</code> NodePort <code>kubectl expose deployment &lt;name&gt; --type=LoadBalancer --port=80</code> LoadBalancer"},{"location":"appendix/k8s_cheatsheet/#namespace","title":"Namespace \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get namespaces</code> \u5217\u51fa Namespace <code>kubectl create namespace &lt;name&gt;</code> \u5efa\u7acb Namespace <code>kubectl delete namespace &lt;name&gt;</code> \u522a\u9664 Namespace <code>kubectl config set-context --current --namespace=&lt;name&gt;</code> \u5207\u63db\u9810\u8a2d Namespace"},{"location":"appendix/k8s_cheatsheet/#configmap-secret","title":"ConfigMap &amp; Secret","text":""},{"location":"appendix/k8s_cheatsheet/#configmap","title":"ConfigMap","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get configmaps</code> \u5217\u51fa ConfigMap <code>kubectl create configmap &lt;name&gt; --from-literal=key=value</code> \u5f9e\u5b57\u9762\u503c\u5efa\u7acb <code>kubectl create configmap &lt;name&gt; --from-file=&lt;file&gt;</code> \u5f9e\u6a94\u6848\u5efa\u7acb <code>kubectl describe configmap &lt;name&gt;</code> \u6aa2\u8996\u5167\u5bb9"},{"location":"appendix/k8s_cheatsheet/#secret","title":"Secret","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get secrets</code> \u5217\u51fa Secret <code>kubectl create secret generic &lt;name&gt; --from-literal=key=value</code> \u5efa\u7acb Secret <code>kubectl get secret &lt;name&gt; -o jsonpath='{.data.key}' \\| base64 -d</code> \u89e3\u78bc Secret"},{"location":"appendix/k8s_cheatsheet/#pv-pvc","title":"PV &amp; PVC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get pv</code> \u5217\u51fa PersistentVolume <code>kubectl get pvc</code> \u5217\u51fa PersistentVolumeClaim <code>kubectl describe pv &lt;name&gt;</code> \u63cf\u8ff0 PV <code>kubectl describe pvc &lt;name&gt;</code> \u63cf\u8ff0 PVC"},{"location":"appendix/k8s_cheatsheet/#node","title":"Node \u7ba1\u7406","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get nodes</code> \u5217\u51fa\u7bc0\u9ede <code>kubectl describe node &lt;name&gt;</code> \u63cf\u8ff0\u7bc0\u9ede <code>kubectl top nodes</code> \u7bc0\u9ede\u8cc7\u6e90\u4f7f\u7528 <code>kubectl cordon &lt;node&gt;</code> \u6a19\u8a18\u7bc0\u9ede\u4e0d\u53ef\u8abf\u5ea6 <code>kubectl uncordon &lt;node&gt;</code> \u53d6\u6d88\u6a19\u8a18 <code>kubectl drain &lt;node&gt;</code> \u6392\u7a7a\u7bc0\u9ede <code>kubectl taint nodes &lt;node&gt; key=value:NoSchedule</code> \u52a0\u4e0a Taint"},{"location":"appendix/k8s_cheatsheet/#rbac","title":"RBAC","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get roles</code> \u5217\u51fa Role <code>kubectl get clusterroles</code> \u5217\u51fa ClusterRole <code>kubectl get rolebindings</code> \u5217\u51fa RoleBinding <code>kubectl get clusterrolebindings</code> \u5217\u51fa ClusterRoleBinding <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt;</code> \u6aa2\u67e5\u6b0a\u9650 <code>kubectl auth can-i &lt;verb&gt; &lt;resource&gt; --as=&lt;user&gt;</code> \u6a21\u64ec\u4f7f\u7528\u8005\u6aa2\u67e5"},{"location":"appendix/k8s_cheatsheet/#_11","title":"\u7591\u96e3\u6392\u89e3","text":"\u6307\u4ee4 \u8aaa\u660e <code>kubectl get events</code> \u67e5\u770b\u4e8b\u4ef6 <code>kubectl get events --sort-by='.lastTimestamp'</code> \u4f9d\u6642\u9593\u6392\u5e8f <code>kubectl top pods</code> Pod \u8cc7\u6e90\u4f7f\u7528 <code>kubectl top nodes</code> Node \u8cc7\u6e90\u4f7f\u7528 <code>kubectl describe pod &lt;name&gt;</code> \u8a73\u7d30\u63cf\u8ff0 <code>kubectl logs &lt;pod&gt; --previous</code> \u524d\u4e00\u500b\u5bb9\u5668\u65e5\u8a8c"},{"location":"appendix/k8s_cheatsheet/#_12","title":"\u8f38\u51fa\u683c\u5f0f","text":"\u683c\u5f0f \u8aaa\u660e <code>-o wide</code> \u984d\u5916\u6b04\u4f4d <code>-o yaml</code> YAML \u683c\u5f0f <code>-o json</code> JSON \u683c\u5f0f <code>-o name</code> \u53ea\u986f\u793a\u540d\u7a31 <code>-o jsonpath='{...}'</code> JSONPath \u67e5\u8a62 <code>-o custom-columns=...</code> \u81ea\u8a02\u6b04\u4f4d"},{"location":"appendix/k8s_cheatsheet/#jsonpath","title":"JSONPath \u7bc4\u4f8b","text":"<pre><code># \u53d6\u5f97 Pod IP\nkubectl get pod &lt;name&gt; -o jsonpath='{.status.podIP}'\n\n# \u53d6\u5f97\u6240\u6709 Pod \u540d\u7a31\nkubectl get pods -o jsonpath='{.items[*].metadata.name}'\n\n# \u53d6\u5f97\u6240\u6709 Container Image\nkubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#_13","title":"\u5e38\u7528\u7d44\u5408\u6307\u4ee4","text":"\u5be6\u7528\u6307\u4ee4<pre><code># \u522a\u9664\u6240\u6709 Evicted Pod\nkubectl delete pods --field-selector=status.phase=Failed --all-namespaces\n\n# \u53d6\u5f97\u6240\u6709 Pod \u7684 Image\nkubectl get pods -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq\n\n# \u4f9d\u8a18\u61b6\u9ad4\u4f7f\u7528\u91cf\u6392\u5e8f Pod\nkubectl top pods --sort-by=memory\n\n# \u5feb\u901f\u5efa\u7acb\u6e2c\u8a66 Pod\nkubectl run test --image=busybox --rm -it -- /bin/sh\n\n# \u7522\u751f YAML \u4f46\u4e0d\u57f7\u884c\nkubectl create deployment nginx --image=nginx --dry-run=client -o yaml\n\n# \u532f\u51fa\u73fe\u6709\u8cc7\u6e90\nkubectl get deployment nginx -o yaml &gt; nginx-deployment.yaml\n</code></pre>"},{"location":"appendix/k8s_cheatsheet/#minikube","title":"minikube \u6307\u4ee4","text":"\u6307\u4ee4 \u8aaa\u660e <code>minikube start</code> \u555f\u52d5 <code>minikube stop</code> \u505c\u6b62 <code>minikube delete</code> \u522a\u9664 <code>minikube status</code> \u72c0\u614b <code>minikube dashboard</code> \u958b\u555f Dashboard <code>minikube ip</code> \u53d6\u5f97 IP <code>minikube ssh</code> SSH \u9023\u7dda <code>minikube service &lt;name&gt;</code> \u958b\u555f Service <code>minikube addons list</code> \u5217\u51fa\u63d2\u4ef6 <code>minikube addons enable &lt;name&gt;</code> \u555f\u7528\u63d2\u4ef6"},{"location":"appendix/k8s_cheatsheet/#_14","title":"\u5feb\u6377\u5225\u540d","text":"\u5efa\u8b70\u52a0\u5165 ~/.bashrc \u6216 ~/.zshrc<pre><code>alias k='kubectl'\nalias kgp='kubectl get pods'\nalias kgs='kubectl get services'\nalias kgd='kubectl get deployments'\nalias kgn='kubectl get nodes'\nalias kd='kubectl describe'\nalias kl='kubectl logs'\nalias ke='kubectl exec -it'\nalias ka='kubectl apply -f'\nalias kd='kubectl delete -f'\n\n# \u81ea\u52d5\u88dc\u5168\nsource &lt;(kubectl completion bash)\nsource &lt;(kubectl completion zsh)\n</code></pre>"},{"location":"appendix/troubleshooting/","title":"\u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#_1","title":"\u7591\u96e3\u6392\u89e3\u6307\u5357","text":"<p>\u672c\u7ae0\u7bc0\u6574\u7406 Docker \u8207 Kubernetes \u5e38\u898b\u554f\u984c\u7684\u8a3a\u65b7\u8207\u89e3\u6c7a\u65b9\u6cd5\u3002</p>"},{"location":"appendix/troubleshooting/#docker","title":"Docker \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-docker","title":"1. Docker \u670d\u52d9\u7121\u6cd5\u555f\u52d5","text":"<p>\u75c7\u72c0</p> <pre><code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5 Docker \u670d\u52d9<pre><code># \u6aa2\u67e5\u670d\u52d9\u72c0\u614b\nsudo systemctl status docker\n\n# \u67e5\u770b\u670d\u52d9\u65e5\u8a8c\nsudo journalctl -u docker -f\n\n# \u6aa2\u67e5 socket \u6a94\u6848\nls -la /var/run/docker.sock\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u555f\u52d5 Docker \u670d\u52d9\nsudo systemctl start docker\n\n# \u8a2d\u5b9a\u958b\u6a5f\u81ea\u52d5\u555f\u52d5\nsudo systemctl enable docker\n\n# \u5982\u679c socket \u554f\u984c\uff0c\u91cd\u65b0\u5efa\u7acb\nsudo rm /var/run/docker.sock\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#2-permission-denied","title":"2. Permission Denied","text":"<p>\u75c7\u72c0</p> <pre><code>permission denied while trying to connect to the Docker daemon socket\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5c07\u4f7f\u7528\u8005\u52a0\u5165 docker \u7fa4\u7d44\nsudo usermod -aG docker $USER\n\n# \u91cd\u65b0\u767b\u5165\u6216\u57f7\u884c\nnewgrp docker\n\n# \u9a57\u8b49\u7fa4\u7d44\ngroups\n</code></pre>"},{"location":"appendix/troubleshooting/#3","title":"3. \u5bb9\u5668\u555f\u52d5\u5f8c\u7acb\u5373\u9000\u51fa","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7\u5bb9\u5668\u9000\u51fa<pre><code># \u6aa2\u8996\u5bb9\u5668\u72c0\u614b\ndocker ps -a\n\n# \u67e5\u770b\u9000\u51fa\u78bc\ndocker inspect &lt;container&gt; --format='{{.State.ExitCode}}'\n\n# \u67e5\u770b\u65e5\u8a8c\ndocker logs &lt;container&gt;\n\n# \u67e5\u770b\u6700\u5f8c\u8f38\u51fa\ndocker logs --tail 50 &lt;container&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u9000\u51fa\u78bc \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 0 \u6b63\u5e38\u7d50\u675f \u78ba\u8a8d CMD \u6307\u4ee4\u662f\u5426\u70ba\u524d\u666f\u7a0b\u5e8f 1 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\u627e\u51fa\u932f\u8aa4 137 OOM Killed \u589e\u52a0\u8a18\u61b6\u9ad4\u9650\u5236 139 Segmentation Fault \u6aa2\u67e5\u61c9\u7528\u7a0b\u5f0f\u76f8\u5bb9\u6027 143 SIGTERM \u6b63\u5e38\u7d42\u6b62\u4fe1\u865f \u4fdd\u6301\u5bb9\u5668\u904b\u884c\uff08\u6e2c\u8a66\u7528\uff09<pre><code># \u4f7f\u7528 sleep \u4fdd\u6301\u904b\u884c\ndocker run -d --name test ubuntu sleep infinity\n\n# \u6216\u4f7f\u7528 tail\ndocker run -d --name test ubuntu tail -f /dev/null\n</code></pre>"},{"location":"appendix/troubleshooting/#4-image","title":"4. Image \u62c9\u53d6\u5931\u6557","text":"<p>\u75c7\u72c0</p> <pre><code>Error response from daemon: pull access denied\nError response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\ndocker search &lt;image-name&gt;\n\n# \u78ba\u8a8d\u7db2\u8def\u9023\u7dda\nping registry-1.docker.io\n\n# \u78ba\u8a8d DNS\nnslookup registry-1.docker.io\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5982\u9700\u767b\u5165\ndocker login\n\n# \u8a2d\u5b9a Registry Mirror\uff08\u570b\u5167\u52a0\u901f\uff09\n# \u7de8\u8f2f /etc/docker/daemon.json\n{\n  \"registry-mirrors\": [\"https://mirror.example.com\"]\n}\n\n# \u91cd\u555f Docker\nsudo systemctl restart docker\n</code></pre>"},{"location":"appendix/troubleshooting/#5","title":"5. \u78c1\u789f\u7a7a\u9593\u4e0d\u8db3","text":"<p>\u75c7\u72c0</p> <pre><code>no space left on device\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u6aa2\u67e5\u78c1\u789f\u4f7f\u7528<pre><code># \u6aa2\u8996 Docker \u78c1\u789f\u4f7f\u7528\ndocker system df\n\n# \u8a73\u7d30\u8cc7\u8a0a\ndocker system df -v\n\n# \u6aa2\u67e5\u7cfb\u7d71\u78c1\u789f\ndf -h\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> \u6e05\u7406\u8cc7\u6e90<pre><code># \u6e05\u7406\u672a\u4f7f\u7528\u7684\u8cc7\u6e90\ndocker system prune\n\n# \u5b8c\u6574\u6e05\u7406\uff08\u5305\u542b\u672a\u4f7f\u7528\u7684 Image \u548c Volume\uff09\ndocker system prune -a --volumes\n\n# \u522a\u9664 dangling Image\ndocker image prune\n\n# \u522a\u9664\u672a\u4f7f\u7528\u7684 Volume\ndocker volume prune\n\n# \u522a\u9664\u5df2\u505c\u6b62\u7684\u5bb9\u5668\ndocker container prune\n</code></pre>"},{"location":"appendix/troubleshooting/#6-port","title":"6. Port \u5df2\u88ab\u4f54\u7528","text":"<p>\u75c7\u72c0</p> <pre><code>Bind for 0.0.0.0:8080 failed: port is already allocated\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b Port \u4f7f\u7528\u60c5\u6cc1\nsudo lsof -i :8080\n\n# \u6216\u4f7f\u7528 netstat\nsudo netstat -tlnp | grep 8080\n\n# \u67e5\u770b Docker \u5bb9\u5668\u4f7f\u7528\u7684 Port\ndocker ps --format \"table {{.Names}}\\t{{.Ports}}\"\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u505c\u6b62\u4f54\u7528 Port \u7684\u7a0b\u5e8f\nsudo kill &lt;PID&gt;\n\n# \u6216\u4f7f\u7528\u5176\u4ed6 Port\ndocker run -d -p 8081:80 nginx\n</code></pre>"},{"location":"appendix/troubleshooting/#7-volume","title":"7. Volume \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <p>\u5bb9\u5668\u5167\u7121\u6cd5\u5beb\u5165\u639b\u8f09\u7684\u76ee\u9304</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u8abf\u6574\u4e3b\u6a5f\u76ee\u9304\u6b0a\u9650\nsudo chown -R 1000:1000 /path/to/host/dir\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u7279\u5b9a UID \u57f7\u884c\u5bb9\u5668\ndocker run -u $(id -u):$(id -g) -v /host:/container image\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 SELinux \u6a19\u7c64\uff08RHEL/CentOS\uff09\ndocker run -v /host:/container:Z image\n</code></pre>"},{"location":"appendix/troubleshooting/#kubernetes","title":"Kubernetes \u7591\u96e3\u6392\u89e3","text":""},{"location":"appendix/troubleshooting/#1-pod-pending","title":"1. Pod \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Pending Pod<pre><code># \u67e5\u770b Pod \u4e8b\u4ef6\nkubectl describe pod &lt;pod-name&gt;\n\n# \u67e5\u770b Events\nkubectl get events --field-selector involvedObject.name=&lt;pod-name&gt;\n\n# \u6aa2\u67e5\u7bc0\u9ede\u8cc7\u6e90\nkubectl describe nodes | grep -A 5 \"Allocated resources\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u8aaa\u660e \u89e3\u6c7a\u65b9\u6848 \u8cc7\u6e90\u4e0d\u8db3 CPU/Memory \u4e0d\u5920 \u589e\u52a0\u7bc0\u9ede\u6216\u6e1b\u5c11 requests nodeSelector \u4e0d\u7b26 \u6c92\u6709\u7b26\u5408\u7684\u7bc0\u9ede \u8abf\u6574 selector \u6216\u52a0 label PVC \u672a\u7d81\u5b9a PV \u4e0d\u5b58\u5728\u6216\u4e0d\u7b26\u5408 \u5efa\u7acb\u7b26\u5408\u7684 PV Taint/Toleration \u7bc0\u9ede\u6709 Taint \u52a0\u4e0a Toleration"},{"location":"appendix/troubleshooting/#2-pod-crashloopbackoff","title":"2. Pod \u8655\u65bc CrashLoopBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 CrashLoopBackOff<pre><code># \u67e5\u770b\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt;\n\n# \u67e5\u770b\u524d\u4e00\u500b\u5bb9\u5668\u7684\u65e5\u8a8c\nkubectl logs &lt;pod-name&gt; --previous\n\n# \u67e5\u770b\u8a73\u7d30\u72c0\u614b\nkubectl describe pod &lt;pod-name&gt;\n\n# \u6aa2\u67e5\u9000\u51fa\u78bc\nkubectl get pod &lt;pod-name&gt; -o jsonpath='{.status.containerStatuses[0].lastState.terminated.exitCode}'\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u61c9\u7528\u7a0b\u5f0f\u932f\u8aa4 \u67e5\u770b\u65e5\u8a8c\uff0c\u4fee\u5fa9\u7a0b\u5f0f \u8a2d\u5b9a\u932f\u8aa4 \u6aa2\u67e5 ConfigMap/Secret \u8cc7\u6e90\u4e0d\u8db3 \u589e\u52a0 memory/cpu limits \u5065\u5eb7\u6aa2\u67e5\u5931\u6557 \u8abf\u6574 probe \u53c3\u6578 \u4f9d\u8cf4\u670d\u52d9\u672a\u5c31\u7dd2 \u4f7f\u7528 initContainer"},{"location":"appendix/troubleshooting/#3-pod-imagepullbackoff","title":"3. Pod \u8655\u65bc ImagePullBackOff","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u932f\u8aa4\u8a0a\u606f\nkubectl describe pod &lt;pod-name&gt; | grep -A 10 Events\n\n# \u9a57\u8b49 Image \u5b58\u5728\ndocker pull &lt;image-name&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u78ba\u8a8d Image \u540d\u7a31\u6b63\u78ba\n# \u78ba\u8a8d Registry \u5b58\u53d6\u6b0a\u9650\n\n# \u5982\u679c\u662f\u79c1\u6709 Registry\uff0c\u5efa\u7acb Secret\nkubectl create secret docker-registry regcred \\\n  --docker-server=&lt;registry&gt; \\\n  --docker-username=&lt;username&gt; \\\n  --docker-password=&lt;password&gt;\n\n# \u5728 Pod spec \u52a0\u5165 imagePullSecrets\nspec:\n  imagePullSecrets:\n    - name: regcred\n</code></pre>"},{"location":"appendix/troubleshooting/#4-service","title":"4. Service \u7121\u6cd5\u9023\u63a5","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> \u8a3a\u65b7 Service \u9023\u7dda<pre><code># \u78ba\u8a8d Service \u5b58\u5728\nkubectl get svc &lt;service-name&gt;\n\n# \u78ba\u8a8d Endpoints\nkubectl get endpoints &lt;service-name&gt;\n\n# \u78ba\u8a8d Pod \u904b\u884c\u4e2d\nkubectl get pods -l &lt;selector&gt;\n\n# \u5f9e Pod \u5167\u6e2c\u8a66\u9023\u7dda\nkubectl exec -it &lt;pod&gt; -- curl &lt;service-name&gt;:&lt;port&gt;\n\n# \u6aa2\u67e5 DNS\nkubectl exec -it &lt;pod&gt; -- nslookup &lt;service-name&gt;\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 Selector \u4e0d\u7b26 \u78ba\u8a8d Service selector \u8207 Pod label \u4e00\u81f4 Pod \u672a\u5c31\u7dd2 \u7b49\u5f85 Pod Ready \u6216\u6aa2\u67e5 readinessProbe Port \u932f\u8aa4 \u78ba\u8a8d port \u548c targetPort NetworkPolicy \u963b\u64cb \u6aa2\u67e5 NetworkPolicy \u898f\u5247"},{"location":"appendix/troubleshooting/#5-configmapsecret-pod","title":"5. ConfigMap/Secret \u66f4\u65b0\u5f8c Pod \u6c92\u6709\u8b8a\u5316","text":"<p>\u539f\u56e0\uff1aPod \u4e0d\u6703\u81ea\u52d5\u91cd\u65b0\u8f09\u5165 ConfigMap/Secret</p> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u65b9\u6cd5 1\uff1a\u91cd\u555f Deployment\nkubectl rollout restart deployment/&lt;name&gt;\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 annotation \u89f8\u767c\u66f4\u65b0\nkubectl patch deployment &lt;name&gt; -p \\\n  '{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"'$(date +%s)'\"}}}}}'\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 Reloader \u5de5\u5177\n# https://github.com/stakater/Reloader\n</code></pre>"},{"location":"appendix/troubleshooting/#6-pvc-pending","title":"6. PVC \u8655\u65bc Pending \u72c0\u614b","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b PVC \u72c0\u614b\nkubectl get pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a\nkubectl describe pvc &lt;pvc-name&gt;\n\n# \u67e5\u770b\u53ef\u7528\u7684 PV\nkubectl get pv\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 \u7121\u7b26\u5408\u7684 PV \u5efa\u7acb\u7b26\u5408\u898f\u683c\u7684 PV StorageClass \u4e0d\u5b58\u5728 \u5efa\u7acb StorageClass \u6216\u6307\u5b9a\u6b63\u78ba\u540d\u7a31 \u5bb9\u91cf\u4e0d\u8db3 \u6e1b\u5c11 PVC \u8acb\u6c42\u6216\u589e\u52a0 PV \u5bb9\u91cf accessModes \u4e0d\u7b26 \u78ba\u8a8d PV/PVC accessModes \u4e00\u81f4"},{"location":"appendix/troubleshooting/#7-node-notready","title":"7. Node \u8655\u65bc NotReady","text":"<p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u67e5\u770b\u7bc0\u9ede\u72c0\u614b\nkubectl describe node &lt;node-name&gt;\n\n# \u6aa2\u67e5 kubelet \u72c0\u614b\nssh &lt;node&gt; \"sudo systemctl status kubelet\"\n\n# \u67e5\u770b kubelet \u65e5\u8a8c\nssh &lt;node&gt; \"sudo journalctl -u kubelet -f\"\n</code></pre> <p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\uff1a</p> \u539f\u56e0 \u89e3\u6c7a\u65b9\u6848 kubelet \u505c\u6b62 \u91cd\u555f kubelet \u7db2\u8def\u554f\u984c \u6aa2\u67e5\u7bc0\u9ede\u7db2\u8def\u9023\u7dda \u78c1\u789f\u58d3\u529b \u6e05\u7406\u78c1\u789f\u7a7a\u9593 \u8a18\u61b6\u9ad4\u58d3\u529b \u589e\u52a0\u8a18\u61b6\u9ad4\u6216\u6e1b\u5c11 Pod"},{"location":"appendix/troubleshooting/#8-rbac","title":"8. RBAC \u6b0a\u9650\u554f\u984c","text":"<p>\u75c7\u72c0</p> <pre><code>Error from server (Forbidden): pods is forbidden: User \"xxx\" cannot list resource \"pods\"\n</code></pre> <p>\u8a3a\u65b7\u6b65\u9a5f\uff1a</p> <pre><code># \u6aa2\u67e5\u6b0a\u9650\nkubectl auth can-i list pods --as=&lt;user&gt;\n\n# \u6aa2\u67e5\u89d2\u8272\u7d81\u5b9a\nkubectl get rolebindings,clusterrolebindings -A | grep &lt;user&gt;\n\n# \u8a73\u7d30\u6aa2\u67e5\nkubectl describe rolebinding &lt;name&gt; -n &lt;namespace&gt;\n</code></pre> <p>\u89e3\u6c7a\u65b9\u6848\uff1a</p> <pre><code># \u5efa\u7acb\u9069\u7576\u7684 Role \u548c RoleBinding\nkubectl create role pod-reader --verb=get,list,watch --resource=pods\nkubectl create rolebinding pod-reader-binding --role=pod-reader --user=&lt;user&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_2","title":"\u8a3a\u65b7\u5de5\u5177","text":""},{"location":"appendix/troubleshooting/#kubectl-debug","title":"kubectl debug","text":"<pre><code># \u5efa\u7acb\u9664\u932f Pod\nkubectl debug node/&lt;node-name&gt; -it --image=busybox\n\n# \u70ba Pod \u5efa\u7acb\u9664\u932f\u5bb9\u5668\nkubectl debug &lt;pod-name&gt; -it --image=busybox --target=&lt;container&gt;\n</code></pre>"},{"location":"appendix/troubleshooting/#_3","title":"\u5e38\u7528\u8a3a\u65b7\u6307\u4ee4","text":"\u7d9c\u5408\u8a3a\u65b7<pre><code># \u5feb\u901f\u6aa2\u67e5\u53e2\u96c6\u72c0\u614b\nkubectl get nodes\nkubectl get pods --all-namespaces | grep -v Running\n\n# \u6aa2\u67e5\u7cfb\u7d71 Pod\nkubectl get pods -n kube-system\n\n# \u6aa2\u67e5\u6700\u8fd1\u4e8b\u4ef6\nkubectl get events --sort-by='.lastTimestamp' | tail -20\n\n# \u6aa2\u67e5\u8cc7\u6e90\u4f7f\u7528\nkubectl top nodes\nkubectl top pods --all-namespaces\n</code></pre>"},{"location":"appendix/troubleshooting/#_4","title":"\u65e5\u8a8c\u6536\u96c6","text":""},{"location":"appendix/troubleshooting/#_5","title":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a","text":"\u6536\u96c6\u8a3a\u65b7\u8cc7\u8a0a\u8173\u672c<pre><code>#!/bin/bash\nOUTPUT_DIR=\"k8s-debug-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p $OUTPUT_DIR\n\n# \u7bc0\u9ede\u8cc7\u8a0a\nkubectl get nodes -o wide &gt; $OUTPUT_DIR/nodes.txt\nkubectl describe nodes &gt; $OUTPUT_DIR/nodes-describe.txt\n\n# Pod \u8cc7\u8a0a\nkubectl get pods --all-namespaces -o wide &gt; $OUTPUT_DIR/pods.txt\n\n# Service \u8cc7\u8a0a\nkubectl get svc --all-namespaces &gt; $OUTPUT_DIR/services.txt\n\n# Events\nkubectl get events --all-namespaces --sort-by='.lastTimestamp' &gt; $OUTPUT_DIR/events.txt\n\n# \u58d3\u7e2e\ntar -czvf $OUTPUT_DIR.tar.gz $OUTPUT_DIR\necho \"\u8a3a\u65b7\u8cc7\u8a0a\u5df2\u5132\u5b58\u81f3 $OUTPUT_DIR.tar.gz\"\n</code></pre>"}]}