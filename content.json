[
  {
    "title": "Docker æŒ‡ä»¤é€ŸæŸ¥è¡¨",
    "url": "https://caocharles.github.io/dcka-class-notes/appendix/docker_cheatsheet/",
    "content": "# Docker æŒ‡ä»¤é€ŸæŸ¥è¡¨\n\nå¿«é€Ÿåƒè€ƒ Docker å¸¸ç”¨æŒ‡ä»¤ï¼Œé©åˆæ—¥å¸¸æ“ä½œèˆ‡è€ƒè©¦è¤‡ç¿’ã€‚\n\n---\n\n## å®¹å™¨ç®¡ç†\n\n### åŸ·è¡Œå®¹å™¨\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker run <image>` | åŸ·è¡Œå®¹å™¨ |\n| `docker run -d <image>` | èƒŒæ™¯åŸ·è¡Œ |\n| `docker run -it <image> /bin/bash` | äº’å‹•æ¨¡å¼ |\n| `docker run --name <name> <image>` | æŒ‡å®šåç¨± |\n| `docker run -p 8080:80 <image>` | Port å°æ‡‰ |\n| `docker run -v /host:/container <image>` | æ›è¼‰ç›®éŒ„ |\n| `docker run -e VAR=value <image>` | è¨­å®šç’°å¢ƒè®Šæ•¸ |\n| `docker run --rm <image>` | çµæŸå¾Œè‡ªå‹•åˆªé™¤ |\n| `docker run --restart=always <image>` | è‡ªå‹•é‡å•Ÿ |\n| `docker run --network <network> <image>` | æŒ‡å®šç¶²è·¯ |\n\n### å®¹å™¨æ“ä½œ\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker ps` | åˆ—å‡ºé‹è¡Œä¸­çš„å®¹å™¨ |\n| `docker ps -a` | åˆ—å‡ºæ‰€æœ‰å®¹å™¨ |\n| `docker start <container>` | å•Ÿå‹•å®¹å™¨ |\n| `docker stop <container>` | åœæ­¢å®¹å™¨ |\n| `docker restart <container>` | é‡å•Ÿå®¹å™¨ |\n| `docker pause <container>` | æš«åœå®¹å™¨ |\n| `docker unpause <container>` | ç¹¼çºŒå®¹å™¨ |\n| `docker rm <container>` | åˆªé™¤å®¹å™¨ |\n| `docker rm -f <container>` | å¼·åˆ¶åˆªé™¤é‹è¡Œä¸­çš„å®¹å™¨ |\n| `docker container prune` | åˆªé™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ |\n\n### å®¹å™¨æ“ä½œèˆ‡é™¤éŒ¯\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker exec -it <container> /bin/bash` | é€²å…¥å®¹å™¨ |\n| `docker exec <container> <command>` | åŸ·è¡ŒæŒ‡ä»¤ |\n| `docker logs <container>` | æŸ¥çœ‹æ—¥èªŒ |\n| `docker logs -f <container>` | è¿½è¹¤æ—¥èªŒ |\n| `docker logs --tail 100 <container>` | æœ€å¾Œ 100 è¡Œ |\n| `docker inspect <container>` | è©³ç´°è³‡è¨Š |\n| `docker stats` | è³‡æºä½¿ç”¨çµ±è¨ˆ |\n| `docker top <container>` | å®¹å™¨å…§ç¨‹åº |\n| `docker cp <src> <container>:<dest>` | è¤‡è£½æª”æ¡ˆåˆ°å®¹å™¨ |\n| `docker cp <container>:<src> <dest>` | å¾å®¹å™¨è¤‡è£½æª”æ¡ˆ |\n\n---\n\n## Image ç®¡ç†\n\n### åŸºæœ¬æ“ä½œ\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker images` | åˆ—å‡ºæœ¬åœ° Image |\n| `docker pull <image>` | æ‹‰å– Image |\n| `docker push <image>` | æ¨é€ Image |\n| `docker rmi <image>` | åˆªé™¤ Image |\n| `docker image prune` | åˆªé™¤æœªä½¿ç”¨çš„ Image |\n| `docker image prune -a` | åˆªé™¤æ‰€æœ‰æœªä½¿ç”¨çš„ Image |\n\n### å»ºç½®èˆ‡æ¨™ç±¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker build -t <name>:<tag> .` | å»ºç½® Image |\n| `docker build -f Dockerfile.prod .` | æŒ‡å®š Dockerfile |\n| `docker build --no-cache .` | ä¸ä½¿ç”¨å¿«å– |\n| `docker tag <image> <new-tag>` | åŠ ä¸Šæ¨™ç±¤ |\n| `docker history <image>` | æŸ¥çœ‹ Image æ­·å² |\n| `docker save -o image.tar <image>` | åŒ¯å‡º Image |\n| `docker load -i image.tar` | åŒ¯å…¥ Image |\n\n### æœå°‹\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker search <keyword>` | æœå°‹ Docker Hub |\n| `docker search --filter is-official=true <keyword>` | åªæœå°‹å®˜æ–¹ Image |\n| `docker search --limit 5 <keyword>` | é™åˆ¶çµæœæ•¸é‡ |\n\n---\n\n## Volume ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker volume ls` | åˆ—å‡ºæ‰€æœ‰ Volume |\n| `docker volume create <name>` | å»ºç«‹ Volume |\n| `docker volume inspect <name>` | æŸ¥çœ‹è©³ç´°è³‡è¨Š |\n| `docker volume rm <name>` | åˆªé™¤ Volume |\n| `docker volume prune` | åˆªé™¤æœªä½¿ç”¨çš„ Volume |\n\n### æ›è¼‰æ–¹å¼\n\n```bash\n# Volume æ›è¼‰\ndocker run -v my-volume:/app/data nginx\n\n# Bind Mount\ndocker run -v /host/path:/container/path nginx\n\n# å”¯è®€æ›è¼‰\ndocker run -v /host/path:/container/path:ro nginx\n\n# --mount èªæ³•ï¼ˆæ¨è–¦ï¼‰\ndocker run --mount type=volume,source=my-volume,target=/app/data nginx\ndocker run --mount type=bind,source=/host/path,target=/container/path nginx\n```\n\n---\n\n## ç¶²è·¯ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker network ls` | åˆ—å‡ºæ‰€æœ‰ç¶²è·¯ |\n| `docker network create <name>` | å»ºç«‹ç¶²è·¯ |\n| `docker network connect <network> <container>` | é€£æ¥ç¶²è·¯ |\n| `docker network disconnect <network> <container>` | æ–·é–‹ç¶²è·¯ |\n| `docker network rm <name>` | åˆªé™¤ç¶²è·¯ |\n| `docker network prune` | åˆªé™¤æœªä½¿ç”¨çš„ç¶²è·¯ |\n| `docker network inspect <name>` | æŸ¥çœ‹è©³ç´°è³‡è¨Š |\n\n### ç¶²è·¯é¡å‹\n\n| é¡å‹ | èªªæ˜ |\n|------|------|\n| `bridge` | é è¨­ï¼Œå®¹å™¨é€éè™›æ“¬æ©‹æ¥å™¨é€£æ¥ |\n| `host` | ç›´æ¥ä½¿ç”¨ä¸»æ©Ÿç¶²è·¯ |\n| `none` | ç„¡ç¶²è·¯ |\n| `overlay` | è·¨ä¸»æ©Ÿé€šè¨Šï¼ˆSwarmï¼‰ |\n\n---\n\n## ç³»çµ±ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker info` | ç³»çµ±è³‡è¨Š |\n| `docker version` | ç‰ˆæœ¬è³‡è¨Š |\n| `docker system df` | ç£ç¢Ÿä½¿ç”¨é‡ |\n| `docker system prune` | æ¸…ç†æœªä½¿ç”¨è³‡æº |\n| `docker system prune -a --volumes` | å®Œæ•´æ¸…ç† |\n| `docker events` | å³æ™‚äº‹ä»¶ |\n\n---\n\n## Docker Compose\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker compose up` | å•Ÿå‹•æœå‹™ |\n| `docker compose up -d` | èƒŒæ™¯å•Ÿå‹• |\n| `docker compose down` | åœæ­¢ä¸¦ç§»é™¤ |\n| `docker compose down -v` | åŒæ™‚ç§»é™¤ Volume |\n| `docker compose ps` | åˆ—å‡ºæœå‹™ |\n| `docker compose logs` | æŸ¥çœ‹æ—¥èªŒ |\n| `docker compose logs -f` | è¿½è¹¤æ—¥èªŒ |\n| `docker compose exec <service> <command>` | åŸ·è¡ŒæŒ‡ä»¤ |\n| `docker compose build` | å»ºç½®æœå‹™ |\n| `docker compose pull` | æ‹‰å– Image |\n\n---\n\n## Registry ç™»å…¥\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker login` | ç™»å…¥ Docker Hub |\n| `docker login <registry>` | ç™»å…¥ç§æœ‰ Registry |\n| `docker logout` | ç™»å‡º |\n\n---\n\n## å¸¸ç”¨çµ„åˆæŒ‡ä»¤\n\n```bash title=\"å¸¸ç”¨æ“ä½œ\"\n# åœæ­¢æ‰€æœ‰å®¹å™¨\ndocker stop $(docker ps -q)\n\n# åˆªé™¤æ‰€æœ‰å®¹å™¨\ndocker rm $(docker ps -aq)\n\n# åˆªé™¤æ‰€æœ‰ Image\ndocker rmi $(docker images -q)\n\n# åˆªé™¤ dangling Image\ndocker rmi $(docker images -f \"dangling=true\" -q)\n\n# å–å¾—å®¹å™¨ IP\ndocker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <container>\n\n# é€²å…¥é‹è¡Œä¸­çš„å®¹å™¨\ndocker exec -it $(docker ps -q -f name=nginx) /bin/sh\n```\n\n---\n\n## Dockerfile æŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `FROM` | åŸºç¤ Image |\n| `RUN` | åŸ·è¡ŒæŒ‡ä»¤ |\n| `COPY` | è¤‡è£½æª”æ¡ˆ |\n| `ADD` | è¤‡è£½æª”æ¡ˆï¼ˆæ”¯æ´ URLã€è§£å£“ç¸®ï¼‰ |\n| `WORKDIR` | å·¥ä½œç›®éŒ„ |\n| `ENV` | ç’°å¢ƒè®Šæ•¸ |\n| `EXPOSE` | æš´éœ² Port |\n| `CMD` | é è¨­åŸ·è¡ŒæŒ‡ä»¤ |\n| `ENTRYPOINT` | å…¥å£é» |\n| `VOLUME` | æ›è¼‰é» |\n| `USER` | åŸ·è¡Œèº«ä»½ |\n| `ARG` | å»ºç½®åƒæ•¸ |\n| `LABEL` | æ¨™ç±¤ |\n| `HEALTHCHECK` | å¥åº·æª¢æŸ¥ |\n\n---\n\n## ç’°å¢ƒè®Šæ•¸\n\n| è®Šæ•¸ | èªªæ˜ |\n|------|------|\n| `DOCKER_HOST` | Docker ä¸»æ©Ÿä½å€ |\n| `DOCKER_TLS_VERIFY` | å•Ÿç”¨ TLS é©—è­‰ |\n| `DOCKER_CERT_PATH` | TLS æ†‘è­‰è·¯å¾‘ |\n| `DOCKER_CONFIG` | è¨­å®šæª”ç›®éŒ„ |\n"
  },
  {
    "title": "Kubernetes æŒ‡ä»¤é€ŸæŸ¥è¡¨",
    "url": "https://caocharles.github.io/dcka-class-notes/appendix/k8s_cheatsheet/",
    "content": "# Kubernetes æŒ‡ä»¤é€ŸæŸ¥è¡¨\n\nå¿«é€Ÿåƒè€ƒ kubectl å¸¸ç”¨æŒ‡ä»¤ï¼Œé©åˆæ—¥å¸¸æ“ä½œèˆ‡è€ƒè©¦è¤‡ç¿’ã€‚\n\n---\n\n## åŸºæœ¬æ“ä½œ\n\n### å¢é›†è³‡è¨Š\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl cluster-info` | å¢é›†è³‡è¨Š |\n| `kubectl version` | ç‰ˆæœ¬è³‡è¨Š |\n| `kubectl config view` | æŸ¥çœ‹è¨­å®š |\n| `kubectl config get-contexts` | åˆ—å‡º Context |\n| `kubectl config use-context <name>` | åˆ‡æ› Context |\n| `kubectl api-resources` | åˆ—å‡º API è³‡æº |\n| `kubectl api-versions` | åˆ—å‡º API ç‰ˆæœ¬ |\n\n### è³‡æºæŸ¥è©¢\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get <resource>` | åˆ—å‡ºè³‡æº |\n| `kubectl get pods` | åˆ—å‡º Pod |\n| `kubectl get pods -o wide` | è©³ç´°è³‡è¨Šï¼ˆå« IPã€Nodeï¼‰ |\n| `kubectl get pods -o yaml` | YAML æ ¼å¼è¼¸å‡º |\n| `kubectl get pods -o json` | JSON æ ¼å¼è¼¸å‡º |\n| `kubectl get pods -w` | æŒçºŒç›£çœ‹ |\n| `kubectl get pods -l app=nginx` | ä¾æ¨™ç±¤éæ¿¾ |\n| `kubectl get pods -n <namespace>` | æŒ‡å®š Namespace |\n| `kubectl get pods --all-namespaces` | æ‰€æœ‰ Namespace |\n| `kubectl get all` | åˆ—å‡ºå¸¸è¦‹è³‡æº |\n\n---\n\n## è³‡æºç®¡ç†\n\n### å»ºç«‹èˆ‡å¥—ç”¨\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl apply -f <file.yaml>` | å¥—ç”¨è¨­å®š |\n| `kubectl apply -f <directory>/` | å¥—ç”¨ç›®éŒ„ä¸‹æ‰€æœ‰è¨­å®š |\n| `kubectl create -f <file.yaml>` | å»ºç«‹è³‡æº |\n| `kubectl create deployment <name> --image=<image>` | å»ºç«‹ Deployment |\n| `kubectl create service clusterip <name> --tcp=80:80` | å»ºç«‹ Service |\n| `kubectl create configmap <name> --from-literal=key=value` | å»ºç«‹ ConfigMap |\n| `kubectl create secret generic <name> --from-literal=key=value` | å»ºç«‹ Secret |\n\n### ç·¨è¼¯èˆ‡åˆªé™¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl edit <resource> <name>` | ç·¨è¼¯è³‡æº |\n| `kubectl delete <resource> <name>` | åˆªé™¤è³‡æº |\n| `kubectl delete -f <file.yaml>` | ä¾è¨­å®šæª”åˆªé™¤ |\n| `kubectl delete pods --all` | åˆªé™¤æ‰€æœ‰ Pod |\n| `kubectl delete pods -l app=nginx` | ä¾æ¨™ç±¤åˆªé™¤ |\n\n### è©³ç´°è³‡è¨Š\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl describe <resource> <name>` | è©³ç´°æè¿° |\n| `kubectl describe pod <pod-name>` | æè¿° Pod |\n| `kubectl describe node <node-name>` | æè¿° Node |\n\n---\n\n## Pod æ“ä½œ\n\n### åŸ·è¡Œèˆ‡å­˜å–\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl run <name> --image=<image>` | å»ºç«‹ Pod |\n| `kubectl exec -it <pod> -- /bin/sh` | é€²å…¥ Pod |\n| `kubectl exec <pod> -- <command>` | åŸ·è¡ŒæŒ‡ä»¤ |\n| `kubectl logs <pod>` | æŸ¥çœ‹æ—¥èªŒ |\n| `kubectl logs -f <pod>` | è¿½è¹¤æ—¥èªŒ |\n| `kubectl logs <pod> -c <container>` | å¤šå®¹å™¨æŒ‡å®š |\n| `kubectl logs <pod> --previous` | å‰ä¸€å€‹å®¹å™¨çš„æ—¥èªŒ |\n| `kubectl logs <pod> --tail=100` | æœ€å¾Œ 100 è¡Œ |\n| `kubectl port-forward <pod> 8080:80` | Port è½‰ç™¼ |\n| `kubectl cp <pod>:<path> <local-path>` | è¤‡è£½æª”æ¡ˆ |\n\n---\n\n## Deployment ç®¡ç†\n\n### åŸºæœ¬æ“ä½œ\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get deployments` | åˆ—å‡º Deployment |\n| `kubectl describe deployment <name>` | è©³ç´°æè¿° |\n| `kubectl scale deployment <name> --replicas=3` | èª¿æ•´å‰¯æœ¬ |\n| `kubectl set image deployment/<name> <container>=<image>` | æ›´æ–° Image |\n\n### æ»¾å‹•æ›´æ–°\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl rollout status deployment/<name>` | æŸ¥çœ‹æ›´æ–°ç‹€æ…‹ |\n| `kubectl rollout history deployment/<name>` | æŸ¥çœ‹æ­·å² |\n| `kubectl rollout undo deployment/<name>` | å›æ»¾ |\n| `kubectl rollout undo deployment/<name> --to-revision=2` | å›æ»¾åˆ°ç‰¹å®šç‰ˆæœ¬ |\n| `kubectl rollout restart deployment/<name>` | é‡å•Ÿ |\n| `kubectl rollout pause deployment/<name>` | æš«åœæ›´æ–° |\n| `kubectl rollout resume deployment/<name>` | ç¹¼çºŒæ›´æ–° |\n\n---\n\n## Service ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get services` | åˆ—å‡º Service |\n| `kubectl get endpoints` | åˆ—å‡º Endpoints |\n| `kubectl expose deployment <name> --port=80` | å»ºç«‹ Service |\n| `kubectl expose deployment <name> --type=NodePort --port=80` | NodePort |\n| `kubectl expose deployment <name> --type=LoadBalancer --port=80` | LoadBalancer |\n\n---\n\n## Namespace ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get namespaces` | åˆ—å‡º Namespace |\n| `kubectl create namespace <name>` | å»ºç«‹ Namespace |\n| `kubectl delete namespace <name>` | åˆªé™¤ Namespace |\n| `kubectl config set-context --current --namespace=<name>` | åˆ‡æ›é è¨­ Namespace |\n\n---\n\n## ConfigMap & Secret\n\n### ConfigMap\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get configmaps` | åˆ—å‡º ConfigMap |\n| `kubectl create configmap <name> --from-literal=key=value` | å¾å­—é¢å€¼å»ºç«‹ |\n| `kubectl create configmap <name> --from-file=<file>` | å¾æª”æ¡ˆå»ºç«‹ |\n| `kubectl describe configmap <name>` | æª¢è¦–å…§å®¹ |\n\n### Secret\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get secrets` | åˆ—å‡º Secret |\n| `kubectl create secret generic <name> --from-literal=key=value` | å»ºç«‹ Secret |\n| `kubectl get secret <name> -o jsonpath='{.data.key}' \\| base64 -d` | è§£ç¢¼ Secret |\n\n---\n\n## PV & PVC\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get pv` | åˆ—å‡º PersistentVolume |\n| `kubectl get pvc` | åˆ—å‡º PersistentVolumeClaim |\n| `kubectl describe pv <name>` | æè¿° PV |\n| `kubectl describe pvc <name>` | æè¿° PVC |\n\n---\n\n## Node ç®¡ç†\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get nodes` | åˆ—å‡ºç¯€é» |\n| `kubectl describe node <name>` | æè¿°ç¯€é» |\n| `kubectl top nodes` | ç¯€é»è³‡æºä½¿ç”¨ |\n| `kubectl cordon <node>` | æ¨™è¨˜ç¯€é»ä¸å¯èª¿åº¦ |\n| `kubectl uncordon <node>` | å–æ¶ˆæ¨™è¨˜ |\n| `kubectl drain <node>` | æ’ç©ºç¯€é» |\n| `kubectl taint nodes <node> key=value:NoSchedule` | åŠ ä¸Š Taint |\n\n---\n\n## RBAC\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get roles` | åˆ—å‡º Role |\n| `kubectl get clusterroles` | åˆ—å‡º ClusterRole |\n| `kubectl get rolebindings` | åˆ—å‡º RoleBinding |\n| `kubectl get clusterrolebindings` | åˆ—å‡º ClusterRoleBinding |\n| `kubectl auth can-i <verb> <resource>` | æª¢æŸ¥æ¬Šé™ |\n| `kubectl auth can-i <verb> <resource> --as=<user>` | æ¨¡æ“¬ä½¿ç”¨è€…æª¢æŸ¥ |\n\n---\n\n## ç–‘é›£æ’è§£\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get events` | æŸ¥çœ‹äº‹ä»¶ |\n| `kubectl get events --sort-by='.lastTimestamp'` | ä¾æ™‚é–“æ’åº |\n| `kubectl top pods` | Pod è³‡æºä½¿ç”¨ |\n| `kubectl top nodes` | Node è³‡æºä½¿ç”¨ |\n| `kubectl describe pod <name>` | è©³ç´°æè¿° |\n| `kubectl logs <pod> --previous` | å‰ä¸€å€‹å®¹å™¨æ—¥èªŒ |\n\n---\n\n## è¼¸å‡ºæ ¼å¼\n\n| æ ¼å¼ | èªªæ˜ |\n|------|------|\n| `-o wide` | é¡å¤–æ¬„ä½ |\n| `-o yaml` | YAML æ ¼å¼ |\n| `-o json` | JSON æ ¼å¼ |\n| `-o name` | åªé¡¯ç¤ºåç¨± |\n| `-o jsonpath='{...}'` | JSONPath æŸ¥è©¢ |\n| `-o custom-columns=...` | è‡ªè¨‚æ¬„ä½ |\n\n### JSONPath ç¯„ä¾‹\n\n```bash\n# å–å¾— Pod IP\nkubectl get pod <name> -o jsonpath='{.status.podIP}'\n\n# å–å¾—æ‰€æœ‰ Pod åç¨±\nkubectl get pods -o jsonpath='{.items[*].metadata.name}'\n\n# å–å¾—æ‰€æœ‰ Container Image\nkubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'\n```\n\n---\n\n## å¸¸ç”¨çµ„åˆæŒ‡ä»¤\n\n```bash title=\"å¯¦ç”¨æŒ‡ä»¤\"\n# åˆªé™¤æ‰€æœ‰ Evicted Pod\nkubectl delete pods --field-selector=status.phase=Failed --all-namespaces\n\n# å–å¾—æ‰€æœ‰ Pod çš„ Image\nkubectl get pods -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq\n\n# ä¾è¨˜æ†¶é«”ä½¿ç”¨é‡æ’åº Pod\nkubectl top pods --sort-by=memory\n\n# å¿«é€Ÿå»ºç«‹æ¸¬è©¦ Pod\nkubectl run test --image=busybox --rm -it -- /bin/sh\n\n# ç”¢ç”Ÿ YAML ä½†ä¸åŸ·è¡Œ\nkubectl create deployment nginx --image=nginx --dry-run=client -o yaml\n\n# åŒ¯å‡ºç¾æœ‰è³‡æº\nkubectl get deployment nginx -o yaml > nginx-deployment.yaml\n```\n\n---\n\n## minikube æŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `minikube start` | å•Ÿå‹• |\n| `minikube stop` | åœæ­¢ |\n| `minikube delete` | åˆªé™¤ |\n| `minikube status` | ç‹€æ…‹ |\n| `minikube dashboard` | é–‹å•Ÿ Dashboard |\n| `minikube ip` | å–å¾— IP |\n| `minikube ssh` | SSH é€£ç·š |\n| `minikube service <name>` | é–‹å•Ÿ Service |\n| `minikube addons list` | åˆ—å‡ºæ’ä»¶ |\n| `minikube addons enable <name>` | å•Ÿç”¨æ’ä»¶ |\n\n---\n\n## å¿«æ·åˆ¥å\n\n```bash title=\"å»ºè­°åŠ å…¥ ~/.bashrc æˆ– ~/.zshrc\"\nalias k='kubectl'\nalias kgp='kubectl get pods'\nalias kgs='kubectl get services'\nalias kgd='kubectl get deployments'\nalias kgn='kubectl get nodes'\nalias kd='kubectl describe'\nalias kl='kubectl logs'\nalias ke='kubectl exec -it'\nalias ka='kubectl apply -f'\nalias kd='kubectl delete -f'\n\n# è‡ªå‹•è£œå…¨\nsource <(kubectl completion bash)\nsource <(kubectl completion zsh)\n```\n"
  },
  {
    "title": "ç–‘é›£æ’è§£æŒ‡å—",
    "url": "https://caocharles.github.io/dcka-class-notes/appendix/troubleshooting/",
    "content": "# ç–‘é›£æ’è§£æŒ‡å—\n\næœ¬ç« ç¯€æ•´ç† Docker èˆ‡ Kubernetes å¸¸è¦‹å•é¡Œçš„è¨ºæ–·èˆ‡è§£æ±ºæ–¹æ³•ã€‚\n\n---\n\n## Docker ç–‘é›£æ’è§£\n\n### 1. Docker æœå‹™ç„¡æ³•å•Ÿå‹•\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    Cannot connect to the Docker daemon at unix:///var/run/docker.sock\n    ```\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"æª¢æŸ¥ Docker æœå‹™\"\n# æª¢æŸ¥æœå‹™ç‹€æ…‹\nsudo systemctl status docker\n\n# æŸ¥çœ‹æœå‹™æ—¥èªŒ\nsudo journalctl -u docker -f\n\n# æª¢æŸ¥ socket æª”æ¡ˆ\nls -la /var/run/docker.sock\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# å•Ÿå‹• Docker æœå‹™\nsudo systemctl start docker\n\n# è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹•\nsudo systemctl enable docker\n\n# å¦‚æœ socket å•é¡Œï¼Œé‡æ–°å»ºç«‹\nsudo rm /var/run/docker.sock\nsudo systemctl restart docker\n```\n\n---\n\n### 2. Permission Denied\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    permission denied while trying to connect to the Docker daemon socket\n    ```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# å°‡ä½¿ç”¨è€…åŠ å…¥ docker ç¾¤çµ„\nsudo usermod -aG docker $USER\n\n# é‡æ–°ç™»å…¥æˆ–åŸ·è¡Œ\nnewgrp docker\n\n# é©—è­‰ç¾¤çµ„\ngroups\n```\n\n---\n\n### 3. å®¹å™¨å•Ÿå‹•å¾Œç«‹å³é€€å‡º\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"è¨ºæ–·å®¹å™¨é€€å‡º\"\n# æª¢è¦–å®¹å™¨ç‹€æ…‹\ndocker ps -a\n\n# æŸ¥çœ‹é€€å‡ºç¢¼\ndocker inspect <container> --format='{{.State.ExitCode}}'\n\n# æŸ¥çœ‹æ—¥èªŒ\ndocker logs <container>\n\n# æŸ¥çœ‹æœ€å¾Œè¼¸å‡º\ndocker logs --tail 50 <container>\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| é€€å‡ºç¢¼ | åŸå›  | è§£æ±ºæ–¹æ¡ˆ |\n|--------|------|----------|\n| 0 | æ­£å¸¸çµæŸ | ç¢ºèª CMD æŒ‡ä»¤æ˜¯å¦ç‚ºå‰æ™¯ç¨‹åº |\n| 1 | æ‡‰ç”¨ç¨‹å¼éŒ¯èª¤ | æŸ¥çœ‹æ—¥èªŒæ‰¾å‡ºéŒ¯èª¤ |\n| 137 | OOM Killed | å¢åŠ è¨˜æ†¶é«”é™åˆ¶ |\n| 139 | Segmentation Fault | æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼ç›¸å®¹æ€§ |\n| 143 | SIGTERM | æ­£å¸¸çµ‚æ­¢ä¿¡è™Ÿ |\n\n```bash title=\"ä¿æŒå®¹å™¨é‹è¡Œï¼ˆæ¸¬è©¦ç”¨ï¼‰\"\n# ä½¿ç”¨ sleep ä¿æŒé‹è¡Œ\ndocker run -d --name test ubuntu sleep infinity\n\n# æˆ–ä½¿ç”¨ tail\ndocker run -d --name test ubuntu tail -f /dev/null\n```\n\n---\n\n### 4. Image æ‹‰å–å¤±æ•—\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    Error response from daemon: pull access denied\n    Error response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled\n    ```\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# ç¢ºèª Image åç¨±\ndocker search <image-name>\n\n# ç¢ºèªç¶²è·¯é€£ç·š\nping registry-1.docker.io\n\n# ç¢ºèª DNS\nnslookup registry-1.docker.io\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# å¦‚éœ€ç™»å…¥\ndocker login\n\n# è¨­å®š Registry Mirrorï¼ˆåœ‹å…§åŠ é€Ÿï¼‰\n# ç·¨è¼¯ /etc/docker/daemon.json\n{\n  \"registry-mirrors\": [\"https://mirror.example.com\"]\n}\n\n# é‡å•Ÿ Docker\nsudo systemctl restart docker\n```\n\n---\n\n### 5. ç£ç¢Ÿç©ºé–“ä¸è¶³\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    no space left on device\n    ```\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"æª¢æŸ¥ç£ç¢Ÿä½¿ç”¨\"\n# æª¢è¦– Docker ç£ç¢Ÿä½¿ç”¨\ndocker system df\n\n# è©³ç´°è³‡è¨Š\ndocker system df -v\n\n# æª¢æŸ¥ç³»çµ±ç£ç¢Ÿ\ndf -h\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash title=\"æ¸…ç†è³‡æº\"\n# æ¸…ç†æœªä½¿ç”¨çš„è³‡æº\ndocker system prune\n\n# å®Œæ•´æ¸…ç†ï¼ˆåŒ…å«æœªä½¿ç”¨çš„ Image å’Œ Volumeï¼‰\ndocker system prune -a --volumes\n\n# åˆªé™¤ dangling Image\ndocker image prune\n\n# åˆªé™¤æœªä½¿ç”¨çš„ Volume\ndocker volume prune\n\n# åˆªé™¤å·²åœæ­¢çš„å®¹å™¨\ndocker container prune\n```\n\n---\n\n### 6. Port å·²è¢«ä½”ç”¨\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    Bind for 0.0.0.0:8080 failed: port is already allocated\n    ```\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# æŸ¥çœ‹ Port ä½¿ç”¨æƒ…æ³\nsudo lsof -i :8080\n\n# æˆ–ä½¿ç”¨ netstat\nsudo netstat -tlnp | grep 8080\n\n# æŸ¥çœ‹ Docker å®¹å™¨ä½¿ç”¨çš„ Port\ndocker ps --format \"table {{.Names}}\\t{{.Ports}}\"\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# åœæ­¢ä½”ç”¨ Port çš„ç¨‹åº\nsudo kill <PID>\n\n# æˆ–ä½¿ç”¨å…¶ä»– Port\ndocker run -d -p 8081:80 nginx\n```\n\n---\n\n### 7. Volume æ¬Šé™å•é¡Œ\n\n!!! warning \"ç—‡ç‹€\"\n    å®¹å™¨å…§ç„¡æ³•å¯«å…¥æ›è¼‰çš„ç›®éŒ„\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# æ–¹æ³• 1ï¼šèª¿æ•´ä¸»æ©Ÿç›®éŒ„æ¬Šé™\nsudo chown -R 1000:1000 /path/to/host/dir\n\n# æ–¹æ³• 2ï¼šä½¿ç”¨ç‰¹å®š UID åŸ·è¡Œå®¹å™¨\ndocker run -u $(id -u):$(id -g) -v /host:/container image\n\n# æ–¹æ³• 3ï¼šä½¿ç”¨ SELinux æ¨™ç±¤ï¼ˆRHEL/CentOSï¼‰\ndocker run -v /host:/container:Z image\n```\n\n---\n\n## Kubernetes ç–‘é›£æ’è§£\n\n### 1. Pod è™•æ–¼ Pending ç‹€æ…‹\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"è¨ºæ–· Pending Pod\"\n# æŸ¥çœ‹ Pod äº‹ä»¶\nkubectl describe pod <pod-name>\n\n# æŸ¥çœ‹ Events\nkubectl get events --field-selector involvedObject.name=<pod-name>\n\n# æª¢æŸ¥ç¯€é»è³‡æº\nkubectl describe nodes | grep -A 5 \"Allocated resources\"\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| åŸå›  | èªªæ˜ | è§£æ±ºæ–¹æ¡ˆ |\n|------|------|----------|\n| è³‡æºä¸è¶³ | CPU/Memory ä¸å¤  | å¢åŠ ç¯€é»æˆ–æ¸›å°‘ requests |\n| nodeSelector ä¸ç¬¦ | æ²’æœ‰ç¬¦åˆçš„ç¯€é» | èª¿æ•´ selector æˆ–åŠ  label |\n| PVC æœªç¶å®š | PV ä¸å­˜åœ¨æˆ–ä¸ç¬¦åˆ | å»ºç«‹ç¬¦åˆçš„ PV |\n| Taint/Toleration | ç¯€é»æœ‰ Taint | åŠ ä¸Š Toleration |\n\n---\n\n### 2. Pod è™•æ–¼ CrashLoopBackOff\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"è¨ºæ–· CrashLoopBackOff\"\n# æŸ¥çœ‹æ—¥èªŒ\nkubectl logs <pod-name>\n\n# æŸ¥çœ‹å‰ä¸€å€‹å®¹å™¨çš„æ—¥èªŒ\nkubectl logs <pod-name> --previous\n\n# æŸ¥çœ‹è©³ç´°ç‹€æ…‹\nkubectl describe pod <pod-name>\n\n# æª¢æŸ¥é€€å‡ºç¢¼\nkubectl get pod <pod-name> -o jsonpath='{.status.containerStatuses[0].lastState.terminated.exitCode}'\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| åŸå›  | è§£æ±ºæ–¹æ¡ˆ |\n|------|----------|\n| æ‡‰ç”¨ç¨‹å¼éŒ¯èª¤ | æŸ¥çœ‹æ—¥èªŒï¼Œä¿®å¾©ç¨‹å¼ |\n| è¨­å®šéŒ¯èª¤ | æª¢æŸ¥ ConfigMap/Secret |\n| è³‡æºä¸è¶³ | å¢åŠ  memory/cpu limits |\n| å¥åº·æª¢æŸ¥å¤±æ•— | èª¿æ•´ probe åƒæ•¸ |\n| ä¾è³´æœå‹™æœªå°±ç·’ | ä½¿ç”¨ initContainer |\n\n---\n\n### 3. Pod è™•æ–¼ ImagePullBackOff\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯\nkubectl describe pod <pod-name> | grep -A 10 Events\n\n# é©—è­‰ Image å­˜åœ¨\ndocker pull <image-name>\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# ç¢ºèª Image åç¨±æ­£ç¢º\n# ç¢ºèª Registry å­˜å–æ¬Šé™\n\n# å¦‚æœæ˜¯ç§æœ‰ Registryï¼Œå»ºç«‹ Secret\nkubectl create secret docker-registry regcred \\\n  --docker-server=<registry> \\\n  --docker-username=<username> \\\n  --docker-password=<password>\n\n# åœ¨ Pod spec åŠ å…¥ imagePullSecrets\nspec:\n  imagePullSecrets:\n    - name: regcred\n```\n\n---\n\n### 4. Service ç„¡æ³•é€£æ¥\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash title=\"è¨ºæ–· Service é€£ç·š\"\n# ç¢ºèª Service å­˜åœ¨\nkubectl get svc <service-name>\n\n# ç¢ºèª Endpoints\nkubectl get endpoints <service-name>\n\n# ç¢ºèª Pod é‹è¡Œä¸­\nkubectl get pods -l <selector>\n\n# å¾ Pod å…§æ¸¬è©¦é€£ç·š\nkubectl exec -it <pod> -- curl <service-name>:<port>\n\n# æª¢æŸ¥ DNS\nkubectl exec -it <pod> -- nslookup <service-name>\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| åŸå›  | è§£æ±ºæ–¹æ¡ˆ |\n|------|----------|\n| Selector ä¸ç¬¦ | ç¢ºèª Service selector èˆ‡ Pod label ä¸€è‡´ |\n| Pod æœªå°±ç·’ | ç­‰å¾… Pod Ready æˆ–æª¢æŸ¥ readinessProbe |\n| Port éŒ¯èª¤ | ç¢ºèª port å’Œ targetPort |\n| NetworkPolicy é˜»æ“‹ | æª¢æŸ¥ NetworkPolicy è¦å‰‡ |\n\n---\n\n### 5. ConfigMap/Secret æ›´æ–°å¾Œ Pod æ²’æœ‰è®ŠåŒ–\n\n**åŸå› **ï¼šPod ä¸æœƒè‡ªå‹•é‡æ–°è¼‰å…¥ ConfigMap/Secret\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# æ–¹æ³• 1ï¼šé‡å•Ÿ Deployment\nkubectl rollout restart deployment/<name>\n\n# æ–¹æ³• 2ï¼šä½¿ç”¨ annotation è§¸ç™¼æ›´æ–°\nkubectl patch deployment <name> -p \\\n  '{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"'$(date +%s)'\"}}}}}'\n\n# æ–¹æ³• 3ï¼šä½¿ç”¨ Reloader å·¥å…·\n# https://github.com/stakater/Reloader\n```\n\n---\n\n### 6. PVC è™•æ–¼ Pending ç‹€æ…‹\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# æŸ¥çœ‹ PVC ç‹€æ…‹\nkubectl get pvc <pvc-name>\n\n# æŸ¥çœ‹è©³ç´°è³‡è¨Š\nkubectl describe pvc <pvc-name>\n\n# æŸ¥çœ‹å¯ç”¨çš„ PV\nkubectl get pv\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| åŸå›  | è§£æ±ºæ–¹æ¡ˆ |\n|------|----------|\n| ç„¡ç¬¦åˆçš„ PV | å»ºç«‹ç¬¦åˆè¦æ ¼çš„ PV |\n| StorageClass ä¸å­˜åœ¨ | å»ºç«‹ StorageClass æˆ–æŒ‡å®šæ­£ç¢ºåç¨± |\n| å®¹é‡ä¸è¶³ | æ¸›å°‘ PVC è«‹æ±‚æˆ–å¢åŠ  PV å®¹é‡ |\n| accessModes ä¸ç¬¦ | ç¢ºèª PV/PVC accessModes ä¸€è‡´ |\n\n---\n\n### 7. Node è™•æ–¼ NotReady\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# æŸ¥çœ‹ç¯€é»ç‹€æ…‹\nkubectl describe node <node-name>\n\n# æª¢æŸ¥ kubelet ç‹€æ…‹\nssh <node> \"sudo systemctl status kubelet\"\n\n# æŸ¥çœ‹ kubelet æ—¥èªŒ\nssh <node> \"sudo journalctl -u kubelet -f\"\n```\n\n**å¸¸è¦‹åŸå› èˆ‡è§£æ±º**ï¼š\n\n| åŸå›  | è§£æ±ºæ–¹æ¡ˆ |\n|------|----------|\n| kubelet åœæ­¢ | é‡å•Ÿ kubelet |\n| ç¶²è·¯å•é¡Œ | æª¢æŸ¥ç¯€é»ç¶²è·¯é€£ç·š |\n| ç£ç¢Ÿå£“åŠ› | æ¸…ç†ç£ç¢Ÿç©ºé–“ |\n| è¨˜æ†¶é«”å£“åŠ› | å¢åŠ è¨˜æ†¶é«”æˆ–æ¸›å°‘ Pod |\n\n---\n\n### 8. RBAC æ¬Šé™å•é¡Œ\n\n!!! warning \"ç—‡ç‹€\"\n    ```\n    Error from server (Forbidden): pods is forbidden: User \"xxx\" cannot list resource \"pods\"\n    ```\n\n**è¨ºæ–·æ­¥é©Ÿ**ï¼š\n\n```bash\n# æª¢æŸ¥æ¬Šé™\nkubectl auth can-i list pods --as=<user>\n\n# æª¢æŸ¥è§’è‰²ç¶å®š\nkubectl get rolebindings,clusterrolebindings -A | grep <user>\n\n# è©³ç´°æª¢æŸ¥\nkubectl describe rolebinding <name> -n <namespace>\n```\n\n**è§£æ±ºæ–¹æ¡ˆ**ï¼š\n\n```bash\n# å»ºç«‹é©ç•¶çš„ Role å’Œ RoleBinding\nkubectl create role pod-reader --verb=get,list,watch --resource=pods\nkubectl create rolebinding pod-reader-binding --role=pod-reader --user=<user>\n```\n\n---\n\n## è¨ºæ–·å·¥å…·\n\n### kubectl debug\n\n```bash\n# å»ºç«‹é™¤éŒ¯ Pod\nkubectl debug node/<node-name> -it --image=busybox\n\n# ç‚º Pod å»ºç«‹é™¤éŒ¯å®¹å™¨\nkubectl debug <pod-name> -it --image=busybox --target=<container>\n```\n\n### å¸¸ç”¨è¨ºæ–·æŒ‡ä»¤\n\n```bash title=\"ç¶œåˆè¨ºæ–·\"\n# å¿«é€Ÿæª¢æŸ¥å¢é›†ç‹€æ…‹\nkubectl get nodes\nkubectl get pods --all-namespaces | grep -v Running\n\n# æª¢æŸ¥ç³»çµ± Pod\nkubectl get pods -n kube-system\n\n# æª¢æŸ¥æœ€è¿‘äº‹ä»¶\nkubectl get events --sort-by='.lastTimestamp' | tail -20\n\n# æª¢æŸ¥è³‡æºä½¿ç”¨\nkubectl top nodes\nkubectl top pods --all-namespaces\n```\n\n---\n\n## æ—¥èªŒæ”¶é›†\n\n### æ”¶é›†è¨ºæ–·è³‡è¨Š\n\n```bash title=\"æ”¶é›†è¨ºæ–·è³‡è¨Šè…³æœ¬\"\n#!/bin/bash\nOUTPUT_DIR=\"k8s-debug-$(date +%Y%m%d-%H%M%S)\"\nmkdir -p $OUTPUT_DIR\n\n# ç¯€é»è³‡è¨Š\nkubectl get nodes -o wide > $OUTPUT_DIR/nodes.txt\nkubectl describe nodes > $OUTPUT_DIR/nodes-describe.txt\n\n# Pod è³‡è¨Š\nkubectl get pods --all-namespaces -o wide > $OUTPUT_DIR/pods.txt\n\n# Service è³‡è¨Š\nkubectl get svc --all-namespaces > $OUTPUT_DIR/services.txt\n\n# Events\nkubectl get events --all-namespaces --sort-by='.lastTimestamp' > $OUTPUT_DIR/events.txt\n\n# å£“ç¸®\ntar -czvf $OUTPUT_DIR.tar.gz $OUTPUT_DIR\necho \"è¨ºæ–·è³‡è¨Šå·²å„²å­˜è‡³ $OUTPUT_DIR.tar.gz\"\n```\n"
  },
  {
    "title": "Docker Containers èˆ‡ Kubernetes ç³»çµ±ç®¡ç†",
    "url": "https://caocharles.github.io/dcka-class-notes/",
    "content": "# Docker Containers èˆ‡ Kubernetes ç³»çµ±ç®¡ç†\n\næ­¡è¿ä¾†åˆ°ç”± **Charles** è£½ä½œçš„ **æ†é€¸æ•™è‚²è¨“ç·´ä¸­å¿ƒ DCKA èª²ç¨‹** å­¸ç¿’ç­†è¨˜ï¼\n\n!!! info \"èª²ç¨‹è³‡è¨Š\"\n    - **èª²ç¨‹åç¨±**ï¼šDocker Containers èˆ‡ Kubernetes ç³»çµ±ç®¡ç†\n    - **èª²ç¨‹ä»£è™Ÿ**ï¼šDCKA\n    - **ç¸½æ™‚æ•¸**ï¼š21 å°æ™‚ï¼ˆ3 å¤©ï¼‰\n    - **é©åˆå°è±¡**ï¼šç¶²è·¯å·¥ç¨‹å¸«ã€é›²ç«¯é‹ç®—å·¥ç¨‹å¸«\n    - **ç­†è¨˜è£½ä½œ**ï¼š:fontawesome-solid-user-pen: **Charles**\n\n---\n\n## èª²ç¨‹ç°¡ä»‹\n\næœ¬èª²ç¨‹æ—¨åœ¨å¹«åŠ©å­¸å“¡æŒæ¡ Docker Containerï¼ˆå®¹å™¨ï¼‰æŠ€è¡“èˆ‡ Kubernetesï¼ˆç°¡ç¨± K8Sï¼‰å®¹å™¨ç·¨æ’å¹³å°çš„æ ¸å¿ƒæ¦‚å¿µèˆ‡å¯¦å‹™æ“ä½œã€‚é€éç†è«–è¬›è§£èˆ‡å‹•æ‰‹å¯¦ä½œï¼Œä½ å°‡å­¸æœƒå¦‚ä½•å»ºç«‹ã€ç®¡ç†å’Œéƒ¨ç½²å®¹å™¨åŒ–æ‡‰ç”¨ç¨‹å¼ã€‚\n\n```mermaid\ngraph LR\n    A[å‚³çµ±éƒ¨ç½²] --> B[è™›æ“¬åŒ–éƒ¨ç½²]\n    B --> C[å®¹å™¨åŒ–éƒ¨ç½²]\n    C --> D[å®¹å™¨ç·¨æ’ K8S]\n    \n    style A fill:#f9f,stroke:#333\n    style B fill:#bbf,stroke:#333\n    style C fill:#bfb,stroke:#333\n    style D fill:#ff9,stroke:#333\n```\n\n---\n\n## ğŸ“š å­¸ç¿’è³‡æº\n\n!!! tip \"å¤šå…ƒå­¸ç¿’ç®¡é“\"\n    æˆ‘å€‘æä¾›å¤šç¨®å­¸ç¿’è³‡æºï¼Œè®“æ‚¨å¯ä»¥é¸æ“‡æœ€é©åˆçš„æ–¹å¼æ·±å…¥äº†è§£èª²ç¨‹å…§å®¹ï¼\n\n<div class=\"grid cards\" markdown>\n\n-   :material-podcast:{ .lg .middle } **èª²ç¨‹ä»‹ç´¹éŸ³æª”**\n\n    ---\n\n    é€ééŸ³æª”å¿«é€Ÿäº†è§£èª²ç¨‹é‡é»èˆ‡å­¸ç¿’ç›®æ¨™\n\n    <audio controls style=\"width: 100%;\">\n      <source src=\"Docker_èˆ‡_K8s_å®¹å™¨å¯¦æˆ°ç­†è¨˜.m4a\" type=\"audio/mp4\">\n      æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Šæ’­æ”¾\n    </audio>\n\n-   :material-robot:{ .lg .middle } **AI äº’å‹•å•ç­”**\n\n    ---\n\n    ä½¿ç”¨ Google NotebookLM èˆ‡ AI é€²è¡Œèª²ç¨‹å…§å®¹å•ç­”\n\n    [:octicons-link-external-24: é–‹å•Ÿ NotebookLM](https://notebooklm.google.com/notebook/09af28d2-79ac-434c-af2e-30b182f0e099?artifactId=1083ab41-ec2c-4015-ba16-811fa32f6606){ .md-button target=\"_blank\" }\n\n</div>\n\n### :material-file-pdf-box: å®Œæ•´èª²ç¨‹ç°¡å ±é è¦½\n\nå¯ç›´æ¥åœ¨ä¸‹æ–¹æ»‘å‹•æŸ¥çœ‹ç°¡å ±ï¼Œæˆ– [:octicons-download-24: é»æ­¤ä¸‹è¼‰ PDF (15MB)](Kubernetes_Container_System_Administration.pdf)\n\n![](Kubernetes_Container_System_Administration.pdf#navpanes=0&toolbar=0){ type=application/pdf style=\"min-height:600px;width:100%\" }\n\n---\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬èª²ç¨‹å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [x] ç†è§£å®¹å™¨åŒ–æŠ€è¡“çš„å„ªå‹¢èˆ‡æ‡‰ç”¨å ´æ™¯\n- [x] ç†Ÿç·´æ“ä½œ Docker å®¹å™¨çš„å»ºç«‹ã€å•Ÿå‹•ã€åœæ­¢èˆ‡åˆªé™¤\n- [x] å®¢è£½åŒ– Docker Imageï¼ˆæ˜ åƒæª”ï¼‰\n- [x] ä½¿ç”¨ Kubernetes éƒ¨ç½²èˆ‡ç®¡ç†å®¹å™¨åŒ–æ‡‰ç”¨\n- [x] å¯¦ä½œ WordPress + MySQL çš„å®¹å™¨åŒ–éƒ¨ç½²\n\n---\n\n## èª²ç¨‹å¤§ç¶±\n\n### 1. Docker åŸºç¤èˆ‡ç®¡ç† (LAB 01-08)\n\n- ç’°å¢ƒåˆå§‹åŒ–èˆ‡åŸºæœ¬æ“ä½œ\n- Docker å®‰è£ (Docker/Podman)\n- Private Registry å»ºç½®\n- Persistent Storage èˆ‡ WordPress å¯¦ä½œ\n\n[:octicons-arrow-right-24: é–‹å§‹å­¸ç¿’](lab01_environment_setup.md)\n\n---\n\n### 2. Docker é€²éšæ‡‰ç”¨ (LAB 09-10)\n\n- å®¢è£½åŒ– Docker Images (commit & Dockerfile)\n- Dockerfile æŒ‡ä»¤èˆ‡æœ€ä½³å¯¦è¸\n\n[:octicons-arrow-right-24: é–‹å§‹å­¸ç¿’](lab09_commit.md)\n\n---\n\n### 3. Kubernetes åŸºç¤ (LAB 11-15)\n\n- Kubernetes å®‰è£ (Standalone & Cluster)\n- å¸¸ç”¨æŒ‡ä»¤èˆ‡ Namespaces\n- Rolling Update èˆ‡ Service è² è¼‰å‡è¡¡\n\n[:octicons-arrow-right-24: é–‹å§‹å­¸ç¿’](lab11_standalone_k8s.md)\n\n---\n\n### 4. Kubernetes é€²éšç®¡ç† (LAB 16-21)\n\n- å„²å­˜ç®¡ç† (PV/PVC)\n- è¨­å®šç®¡ç† (Secret/ConfigMap)\n- æ¬Šé™æ§åˆ¶ (RBAC)\n- å¯¦ä½œï¼šWordPress + MySQL å®Œæ•´éƒ¨ç½²\n- Kubernetes Dashboard\n- Private Registry åœ–å½¢ç®¡ç† (docker-registry-web)\n\n[:octicons-arrow-right-24: é–‹å§‹å­¸ç¿’](lab16_pv_pvc.md)\n\n---\n\n## é å‚™çŸ¥è­˜\n\né–‹å§‹æœ¬èª²ç¨‹ä¹‹å‰ï¼Œå»ºè­°ä½ å…·å‚™ï¼š\n\n!!! note \"å¿…å‚™çŸ¥è­˜\"\n    - Linux åŸºç¤æŒ‡ä»¤æ“ä½œï¼ˆcdã€lsã€catã€vim ç­‰ï¼‰\n    - Linux åŸºæœ¬ç³»çµ±ç®¡ç†æ¦‚å¿µ\n    - å»ºè­°å…·å‚™ RHCE èªè­‰èƒ½åŠ›æˆ–åŒç­‰ç¶“é©—\n\n---\n\n## é™„éŒ„è³‡æº\n\n| è³‡æº | èªªæ˜ |\n|------|------|\n| [Docker æŒ‡ä»¤é€ŸæŸ¥è¡¨](appendix/docker_cheatsheet.md) | å¸¸ç”¨ Docker æŒ‡ä»¤å¿«é€Ÿåƒè€ƒ |\n| [Kubernetes æŒ‡ä»¤é€ŸæŸ¥è¡¨](appendix/k8s_cheatsheet.md) | å¸¸ç”¨ kubectl æŒ‡ä»¤å¿«é€Ÿåƒè€ƒ |\n| [ç–‘é›£æ’è§£æŒ‡å—](appendix/troubleshooting.md) | å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ |\n\n---\n\n## ç›¸é—œè³‡æº\n\n- :fontawesome-brands-docker: [Docker å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/)\n- :material-kubernetes: [Kubernetes å®˜æ–¹æ–‡ä»¶](https://kubernetes.io/docs/)\n- :fontawesome-brands-docker: [Docker Hub](https://hub.docker.com/)\n- :material-podman: [Podman å®˜æ–¹æ–‡ä»¶](https://podman.io/)\n- :material-school: [æ†é€¸ DCKA èª²ç¨‹é é¢](https://www.uuu.com.tw/Course/Show/1552/Docker-Containersèˆ‡Kubernetesç³»çµ±ç®¡ç†)\n\n---\n\n!!! tip \"å­¸ç¿’å»ºè­°\"\n    1. å»ºè­°æŒ‰ç« ç¯€é †åºå­¸ç¿’\n    2. æ¯å€‹ç« ç¯€çš„ Lab å¯¦ä½œå‹™å¿…è¦ªè‡ªå‹•æ‰‹æ“ä½œ\n    3. é‡åˆ°å•é¡Œå…ˆæŸ¥é–± FAQï¼Œå†åƒè€ƒç–‘é›£æ’è§£æŒ‡å—\n    4. å–„ç”¨æŒ‡ä»¤é€ŸæŸ¥è¡¨åŠ é€Ÿå­¸ç¿’\n"
  },
  {
    "title": "LAB 01 LAB ç’°å¢ƒåˆå§‹åŒ–",
    "url": "https://caocharles.github.io/dcka-class-notes/lab01_environment_setup/",
    "content": "# LAB 01 LAB ç’°å¢ƒåˆå§‹åŒ–\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] å®‰è£ä¸¦è¨­å®š VMware Workstation\n- [ ] è¨­å®šè™›æ“¬ç¶²è·¯ï¼ˆVirtual Network Editorï¼‰\n- [ ] å•Ÿå‹•ä¸¦é©—è­‰å…­å° Rocky Linux è™›æ“¬æ©Ÿ\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- æº–å‚™å¥½ Windows ä¸»æ©Ÿï¼ˆå»ºè­° 16GB+ RAMï¼‰\n- ä¸‹è¼‰ DCKA èª²ç¨‹è™›æ“¬æ©Ÿæ˜ åƒæª”\n- ä¸‹è¼‰ VMware Workstation å®‰è£ç¨‹å¼\n\n---\n\n## 0.1 å®‰è£ VMware Workstation\n\n### å–å¾—å®‰è£ç¨‹å¼\n\nèª²ç¨‹æä¾›çš„ VMware Workstation 17.6.4 å®‰è£æª”æ¡ˆä½æ–¼ï¼š\n\n```\nC:\\DCKA-v8 (C:)\\VMware\\VMwareWorkstation_17.6.4\\\n```\n\n![VMware å®‰è£æª”æ¡ˆä½ç½®](images/00_environment/vmware_installer.png)\n\nè³‡æ–™å¤¾å…§åŒ…å«ï¼š\n\n| æª”æ¡ˆ | èªªæ˜ |\n|------|------|\n| `VMware-workstation-full-17.6.4-2483....exe` | VMware Workstation å®‰è£ç¨‹å¼ |\n| `md5sum.txt` | MD5 æ ¡é©—ç¢¼ |\n| `md5sum.png` | æ ¡é©—ç¢¼æˆªåœ– |\n\n### å®‰è£æ­¥é©Ÿ\n\n1. åŸ·è¡Œ `VMware-workstation-full-17.6.4-2483....exe`\n2. ä¾ç…§å®‰è£ç²¾éˆå®Œæˆå®‰è£\n3. å®‰è£å®Œæˆå¾Œé‡æ–°å•Ÿå‹•é›»è…¦\n\n!!! tip \"å®‰è£æç¤º\"\n    å®‰è£éç¨‹ä¸­å»ºè­°é¸æ“‡ã€Œå…¸å‹å®‰è£ã€ï¼Œä½¿ç”¨é è¨­è¨­å®šå³å¯ã€‚\n\n---\n\n## 0.2 è¨­å®šè™›æ“¬ç¶²è·¯\n\n### é–‹å•Ÿ Virtual Network Editor\n\n1. é–‹å•Ÿ VMware Workstation\n2. é¸æ“‡ **Edit** â†’ **Virtual Network Editor**\n3. é»é¸ **Change Settings** å–å¾—ç®¡ç†å“¡æ¬Šé™\n\n![Virtual Network Editor](images/00_environment/virtual_network_editor.png)\n\n### è¨­å®š VMnet8 (NAT)\n\né¸æ“‡ **VMnet8**ï¼ˆNAT æ¨¡å¼ï¼‰ï¼Œé€²è¡Œä»¥ä¸‹è¨­å®šï¼š\n\n#### æ­¥é©Ÿ 1ï¼šè¨­å®š Subnet IP\n\nå°‡ **Subnet IP** ä¿®æ”¹ç‚ºï¼š\n\n```\n192.168.66.0\n```\n\n#### æ­¥é©Ÿ 2ï¼šè¨­å®š NAT Settings\n\né»é¸ **NAT Settings...**ï¼Œå°‡ **Gateway IP** è¨­å®šç‚ºï¼š\n\n```\n192.168.66.2\n```\n\n#### æ­¥é©Ÿ 3ï¼šè¨­å®š DHCP Settings\n\né»é¸ **DHCP Settings...**ï¼Œç¢ºèªä»¥ä¸‹è¨­å®šï¼š\n\n| è¨­å®šé …ç›® | å€¼ |\n|----------|-----|\n| Starting IP address | `192.168.66.128` |\n| Ending IP address | `192.168.66.254` |\n\n!!! warning \"é‡è¦\"\n    è«‹ç¢ºä¿ Subnet IP ç‚º `192.168.66.0`ï¼ŒGateway ç‚º `192.168.66.2`ï¼Œå¦å‰‡å¾ŒçºŒå¯¦ä½œå¯èƒ½ç„¡æ³•æ­£å¸¸é€£ç·šã€‚\n\né»é¸ **OK** å„²å­˜è¨­å®šã€‚\n\n---\n\n## 0.3 ç¶²è·¯æ‹“æ¨¸èˆ‡è™›æ“¬æ©Ÿ\n\n### ç¶²è·¯æ¶æ§‹\n\nèª²ç¨‹ç’°å¢ƒä½¿ç”¨ VMware Workstation çš„ NAT ç¶²è·¯ï¼ˆVMnet8ï¼‰ï¼Œç¶²æ®µç‚º `192.168.66.0/24`ï¼š\n\n![ç¶²è·¯æ‹“æ¨¸](images/00_environment/network_topology.jpg)\n\n```mermaid\ngraph TB\n    subgraph \"å¤–éƒ¨ç¶²è·¯\"\n        Internet((Internet))\n        ExtNet[10.0.1.0/24]\n    end\n    \n    subgraph \"VMware NAT Gateway\"\n        NAT[\".254\"]\n    end\n    \n    subgraph \"VMnet8 - 192.168.66.0/24\"\n        Host[\".xxx<br/>VMware Workstation\"]\n        D1[\"docker1<br/>.51\"]\n        D2[\"docker2<br/>.52\"]\n        KS[\"k8s-standalone<br/>.61\"]\n        KM[\"k8s-master1<br/>.71\"]\n        KN1[\"k8s-node1<br/>.81\"]\n        KN2[\"k8s-node2<br/>.82\"]\n    end\n    \n    Internet --> ExtNet --> NAT\n    NAT --> Host\n    Host --> D1\n    Host --> D2\n    Host --> KS\n    Host --> KM\n    Host --> KN1\n    Host --> KN2\n```\n\n### è™›æ“¬æ©Ÿæ¸…å–®èˆ‡ IP é…ç½®\n\nèª²ç¨‹æä¾›å…­å°å·²é å…ˆè¨­å®šå¥½çš„ Rocky Linux 9 è™›æ“¬æ©Ÿï¼š\n\n![è™›æ“¬æ©Ÿè³‡æ–™å¤¾](images/00_environment/vmware_folder.png)\n\n| è™›æ“¬æ©Ÿåç¨± | IP ä½å€ | ç”¨é€” |\n|------------|---------|------|\n| `docker1` | 192.168.66.**51** | Docker å¯¦ä½œä¸»æ©Ÿ 1 |\n| `docker2` | 192.168.66.**52** | Docker å¯¦ä½œä¸»æ©Ÿ 2 |\n| `k8s-standalone` | 192.168.66.**61** | ç¨ç«‹ Kubernetes ç’°å¢ƒï¼ˆå–®ç¯€é»ï¼‰ |\n| `k8s-master1` | 192.168.66.**71** | Kubernetes Masterï¼ˆæ§åˆ¶å¹³é¢ï¼‰ç¯€é» |\n| `k8s-node1` | 192.168.66.**81** | Kubernetes Worker ç¯€é» 1 |\n| `k8s-node2` | 192.168.66.**82** | Kubernetes Worker ç¯€é» 2 |\n| `mirror` | - | æœ¬åœ° Mirror ä¼ºæœå™¨ï¼ˆå¥—ä»¶åº«æ˜ å°„ï¼‰ |\n\n!!! info \"IP é…ç½®è¦å‰‡\"\n    - **Docker ç’°å¢ƒ**ï¼š192.168.66.5x\n    - **K8s Standalone**ï¼š192.168.66.6x\n    - **K8s Master**ï¼š192.168.66.7x\n    - **K8s Worker**ï¼š192.168.66.8x\n    - **NAT Gateway**ï¼š192.168.66.254\n\n### å•Ÿå‹•æ‰€æœ‰è™›æ“¬æ©Ÿ\n\n#### æ–¹æ³• 1ï¼šä½¿ç”¨æ‰¹æ¬¡æª”ï¼ˆæ¨è–¦ï¼‰\n\nåŸ·è¡Œ `PowerON-allVM.bat` ä¸€æ¬¡å•Ÿå‹•æ‰€æœ‰è™›æ“¬æ©Ÿï¼š\n\n```batch title=\"PowerON-allVM.bat\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws start \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n```\n\n!!! tip \"æ‰¹æ¬¡æª”ä½¿ç”¨èªªæ˜\"\n    - æ­¤æ‰¹æ¬¡æª”ä½¿ç”¨ VMware çš„ `vmrun` å‘½ä»¤åˆ—å·¥å…·\n    - `-T ws` æŒ‡å®šä½¿ç”¨ VMware Workstation\n    - `start` åƒæ•¸è¡¨ç¤ºå•Ÿå‹•è™›æ“¬æ©Ÿ\n\n#### æ–¹æ³• 2ï¼šæ‰‹å‹•å•Ÿå‹•\n\n1. åœ¨ VMware Workstation ä¸­ä¾åºé–‹å•Ÿæ¯å°è™›æ“¬æ©Ÿçš„ `.vmx` æª”æ¡ˆ\n2. é»é¸ **Power on this virtual machine**\n\n### é—œé–‰æ‰€æœ‰è™›æ“¬æ©Ÿ\n\nèª²ç¨‹çµæŸå¾Œï¼Œå¯ä½¿ç”¨ `Shutdown-allVM.bat` ä¸€æ¬¡é—œé–‰æ‰€æœ‰è™›æ“¬æ©Ÿï¼š\n\n```batch title=\"Shutdown-allVM.bat\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\mirror\\mirror.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker1\\docker1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\docker2\\docker2.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-standalone\\k8s-standalone.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-master1\\k8s-master1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node1\\k8s-node1.vmx\"\n\"C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun\" -T ws stop \"C:\\VMware\\DCKA-Rocky9\\k8s-node2\\k8s-node2.vmx\"\n```\n\n!!! warning \"æ­£ç¢ºé—œæ©Ÿ\"\n    ä½¿ç”¨ `stop` å‘½ä»¤æœƒåŸ·è¡Œæ­£å¸¸é—œæ©Ÿç¨‹åºï¼ˆç›¸ç•¶æ–¼æŒ‰ä¸‹é›»æºæŒ‰éˆ•ï¼‰ã€‚å¦‚éœ€å¼·åˆ¶é—œæ©Ÿï¼Œå¯æ”¹ç”¨ `stop hard` åƒæ•¸ï¼Œä½†ä¸å»ºè­°ç¶“å¸¸ä½¿ç”¨ã€‚\n\n### é©—è­‰è™›æ“¬æ©Ÿç‹€æ…‹\n\nå•Ÿå‹•å®Œæˆå¾Œï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ°æ‰€æœ‰è™›æ“¬æ©Ÿéƒ½åœ¨é‹è¡Œä¸­ï¼Œä¸¦é¡¯ç¤º Rocky Linux ç™»å…¥ç•«é¢ï¼š\n\n![è™›æ“¬æ©ŸåŸ·è¡Œä¸­](images/00_environment/vms_running.png)\n\n### ç™»å…¥è³‡è¨Š\n\n| å¸³è™Ÿ | å¯†ç¢¼ |\n|------|------|\n| `root` | `container` |\n\n!!! success \"ç’°å¢ƒæº–å‚™å®Œæˆ\"\n    ç•¶æ‰€æœ‰è™›æ“¬æ©Ÿéƒ½æˆåŠŸå•Ÿå‹•ä¸¦å¯ä»¥ç™»å…¥å¾Œï¼Œå³å¯é–‹å§‹é€²è¡Œ Docker èˆ‡ Kubernetes å¯¦ä½œç·´ç¿’ã€‚\n\n---\n\n## 0.4 Mirror ä¼ºæœå™¨\n\nèª²ç¨‹æä¾›æœ¬åœ° Mirror ä¼ºæœå™¨ï¼ŒåŠ é€Ÿå¥—ä»¶ä¸‹è¼‰ä¸¦æ”¯æ´é›¢ç·šç’°å¢ƒã€‚\n\n### Mirror ç¶²å€\n\n| ç¶²è·¯ç’°å¢ƒ | ç¶²å€ |\n|----------|------|\n| **å…§éƒ¨ç¶²è·¯**ï¼ˆVMnet8ï¼‰ | `http://192.168.66.248/k8s/` |\n| **å¤–éƒ¨ç¶²è·¯**ï¼ˆæ•™å®¤ç¶²è·¯ï¼‰ | `http://10.0.1.249/k8s/` |\n\n![å…§éƒ¨ Mirror ä¼ºæœå™¨](images/00_environment/mirror_internal.png)\n\n![å¤–éƒ¨ Mirror ä¼ºæœå™¨](images/00_environment/mirror_external.png)\n\n### Mirror è³‡æºå…§å®¹\n\n| è³‡æ–™å¤¾/æª”æ¡ˆ | ç”¨é€” |\n|-------------|------|\n| `248.repo` | YUM/DNF å¥—ä»¶åº«è¨­å®šæª” |\n| `ContainerImages/` | Docker/Container æ˜ åƒæª” |\n| `Packages/` | RPM å¥—ä»¶ |\n| `command.txt` | æŒ‡ä»¤åƒè€ƒ |\n| `docs/` | èª²ç¨‹æ–‡ä»¶ |\n| `scripts/` | è‡ªå‹•åŒ–è…³æœ¬ |\n| `yaml/` | Kubernetes YAML è¨­å®šæª” |\n| `VMwareWorkstation_17.6.4/` | VMware å®‰è£ç¨‹å¼ï¼ˆå¤–éƒ¨ç¶²è·¯ï¼‰ |\n\n!!! tip \"ç‚ºä»€éº¼éœ€è¦ Mirrorï¼Ÿ\"\n    - **åŠ é€Ÿä¸‹è¼‰**ï¼šå¾æœ¬åœ°ä¼ºæœå™¨ä¸‹è¼‰æ¯”ç¶²éš›ç¶²è·¯å¿«å¾ˆå¤š\n    - **é›¢ç·šç’°å¢ƒ**ï¼šæ•™å®¤å¯èƒ½æ²’æœ‰å°å¤–ç¶²è·¯\n    - **ç‰ˆæœ¬ä¸€è‡´**ï¼šç¢ºä¿æ‰€æœ‰å­¸å“¡ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„å¥—ä»¶ã€‚\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šè™›æ“¬æ©Ÿç„¡æ³•é–‹æ©Ÿï¼Œé¡¯ç¤º VT-x éŒ¯èª¤\"\n    **åŸå› **ï¼šBIOS æœªå•Ÿç”¨è™›æ“¬åŒ–æŠ€è¡“\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. é‡æ–°å•Ÿå‹•é›»è…¦ï¼Œé€²å…¥ BIOS è¨­å®š\n    2. æ‰¾åˆ° Intel VT-x æˆ– AMD-V é¸é …\n    3. å°‡å…¶è¨­å®šç‚º Enabled\n    4. å„²å­˜ä¸¦é‡æ–°å•Ÿå‹•\n\n??? question \"Q2ï¼šç¶²è·¯ç„¡æ³•é€£ç·š\"\n    **åŸå› **ï¼šVirtual Network Editor è¨­å®šéŒ¯èª¤\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. ç¢ºèª VMnet8 çš„ Subnet IP ç‚º `192.168.66.0`\n    2. ç¢ºèª Gateway IP ç‚º `192.168.66.2`\n    3. ç¢ºèªè™›æ“¬æ©Ÿç¶²è·¯ä»‹é¢è¨­å®šç‚º NAT æ¨¡å¼\n\n??? question \"Q3ï¼šè¨˜æ†¶é«”ä¸è¶³\"\n    **åŸå› **ï¼šä¸»æ©Ÿè¨˜æ†¶é«”ä¸è¶³ä»¥é‹è¡Œæ‰€æœ‰è™›æ“¬æ©Ÿ\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    - ä¾åºå•Ÿå‹•éœ€è¦çš„è™›æ“¬æ©Ÿï¼Œä¸è¦ä¸€æ¬¡å…¨éƒ¨å•Ÿå‹•\n    - æˆ–å‡ç´šä¸»æ©Ÿè¨˜æ†¶é«”è‡³ 16GB ä»¥ä¸Š\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **VMware å®‰è£**ï¼šå®‰è£ VMware Workstation 17.6.4\n- âœ… **ç¶²è·¯è¨­å®š**ï¼šVMnet8 è¨­å®šç‚º 192.168.66.0/24 ç¶²æ®µ\n- âœ… **è™›æ“¬æ©Ÿå•Ÿå‹•**ï¼šå…­å° Rocky Linux è™›æ“¬æ©Ÿå…¨éƒ¨å•Ÿå‹•\n- âœ… **ç’°å¢ƒé©—è­‰**ï¼šç¢ºèªå¯ä»¥æ­£å¸¸ç™»å…¥è™›æ“¬æ©Ÿ\n\n## ä¸‹ä¸€æ­¥\n\nç’°å¢ƒæº–å‚™å®Œæˆå¾Œï¼Œè«‹ç¹¼çºŒå‰å¾€ [LAB 02 å®‰è£ DOCKER/DOCKER-CE](lab02_docker_install.md)\n"
  },
  {
    "title": "LAB 02 å®‰è£ DOCKER/DOCKER-CE",
    "url": "https://caocharles.github.io/dcka-class-notes/lab02_docker_install/",
    "content": "# LAB 02 å®‰è£ DOCKER/DOCKER-CE\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ Lab å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ RHEL/Rocky Linux é è¨­ `docker` æŒ‡ä»¤çš„è¡Œç‚º (Podman Emulation)\n- [ ] ç§»é™¤é è¨­çš„ `podman-docker` å¥—ä»¶\n- [ ] è¨­å®š Docker CE å®˜æ–¹ Repository\n- [ ] å®‰è£ä¸¦å•Ÿå‹• Docker CE (Community Edition)\n- [ ] ä½¿ç”¨ `docker pull` ä¸‹è¼‰ Image ä¸¦å‚™ä»½\n\n---\n\n## 1.1 æ ¸å¿ƒæ¦‚å¿µèˆ‡æ¯”è¼ƒ\n\nåœ¨ RHEL/CentOS 9 ç’°å¢ƒä¸­ï¼Œå¥—ä»¶åç¨±èˆ‡èƒŒå¾Œçš„æŠ€è¡“å¯èƒ½æœƒè®“äººæ··æ·†ã€‚ä»¥ä¸‹æ˜¯ä¸‰è€…çš„ä¸»è¦å·®ç•°ï¼š\n\n| é …ç›® | **docker (Red Hat å¥—ä»¶)** | **docker-ce (Docker Inc. å¥—ä»¶)** | **podman** |\n|------|---------------------------|----------------------------------|------------|\n| **ä¾†æº** | Red Hat å®˜æ–¹ Repository | Docker å®˜æ–¹ Repository | Red Hat å®˜æ–¹ Repository |\n| **æœ¬è³ª** | å…¶å¯¦æ˜¯ **podman-docker** | åŸç”Ÿ **Docker Engine** | ä¸‹ä¸€ä»£å®¹å™¨å·¥å…· |\n| **å®ˆè­·è¡Œç¨‹ (Daemon)** | ç„¡ (Daemonless) | **dockerd** (å¿…é ˆå•Ÿå‹•æœå‹™) | ç„¡ (Daemonless) |\n| **æ¶æ§‹** | æ¨¡æ“¬ Docker CLI æŒ‡ä»¤ | Client-Server æ¶æ§‹ | Fork/Exec æ¨¡å‹ |\n| **Root æ¬Šé™** | æ”¯æ´ Rootless | é è¨­éœ€è¦ Root (Rootless éœ€è¨­å®š) | åŸç”Ÿæ”¯æ´ Rootless |\n| **æŒ‡ä»¤ç›¸å®¹æ€§** | é«˜åº¦ç›¸å®¹ | åŸç”ŸæŒ‡ä»¤ | é«˜åº¦ç›¸å®¹ Docker |\n\n!!! warning \"ç‚ºä»€éº¼ `dnf install docker` è£çš„æ˜¯ Podmanï¼Ÿ\"\n    Red Hat ç‚ºäº†æ¨å»£è‡ªå·±çš„å®¹å™¨æŠ€è¡“ (Podman/Buildah/Skopeo)ï¼Œåœ¨ RHEL 8/9 çš„å¥—ä»¶åº«ä¸­ï¼Œå°‡ `docker` å¥—ä»¶æŒ‡å‘äº† `podman-docker`ã€‚é€™å€‹å¥—ä»¶ä¸»è¦æä¾›ä¸€å€‹ shell scriptï¼Œå°‡ `docker` æŒ‡ä»¤è½‰å°çµ¦ `podman` åŸ·è¡Œã€‚\n    \n    è‹¥ä½ ç¿’æ…£ä½¿ç”¨åŸæœ¬çš„ Docker Daemon (ä¾‹å¦‚éœ€è¦èˆ‡èˆŠæœ‰çš„ Docker Compose æµç¨‹æ•´åˆ)ï¼Œå‰‡å¿…é ˆç§»é™¤æ­¤å¥—ä»¶ï¼Œä¸¦å®‰è£ `docker-ce`ã€‚\n\n---\n\n## å¯¦ä½œæ­¥é©Ÿ\n\n### æ­¥é©Ÿ 1ï¼šè§€å¯Ÿé è¨­çš„ Docker å¥—ä»¶ (Podman)\n\nåœ¨ RHEL 9 / Rocky Linux 9 ä¸­ï¼Œå®˜æ–¹é è¨­çš„ `docker` æŒ‡ä»¤å…¶å¯¦æ˜¯ `podman` çš„æ¨¡æ“¬å™¨ã€‚\n\n1.  **å®‰è£é è¨­ docker å¥—ä»¶**\n    ```bash\n    dnf install docker -y\n    ```\n    > **æŒ‡ä»¤èªªæ˜**ï¼š\n    > - `dnf`: (Dandified YUM) æ˜¯ RHEL 8/9 èˆ‡ Rocky Linux çš„é è¨­å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œç”¨ä¾†å–ä»£èˆŠçš„ `yum`ã€‚\n    > - `install`: å®‰è£å¥—ä»¶ã€‚\n    > - `-y`: è‡ªå‹•å›ç­” \"Yes\" ç¢ºèªå®‰è£ï¼Œä¸éœ€äººå·¥ä»‹å…¥ã€‚\n\n    ![å®‰è£é è¨­ docker å¥—ä»¶](images/lab02/dnf_install_podman.png)\n\n2.  **æª¢æŸ¥ docker æŒ‡ä»¤ä¾†æº**\n    ```bash\n    ls -l /usr/bin/docker\n    file /usr/bin/docker\n    cat /usr/bin/docker\n    ```\n    > ä½ æœƒç™¼ç¾ `/usr/bin/docker` å…¶å¯¦æ˜¯ä¸€å€‹ Shell Scriptï¼Œå…§å®¹æ˜¯åŸ·è¡Œ `/usr/bin/podman`ã€‚\n    > ```bash\n    > exec /usr/bin/podman \"$@\"\n    > ```\n\n3.  **å˜—è©¦å•Ÿå‹• Docker æœå‹™**\n    ```bash\n    systemctl start docker\n    ```\n    > âŒ **å¤±æ•—**ï¼šå› ç‚ºæ ¹æœ¬æ²’æœ‰å®‰è£çœŸæ­£çš„ Docker Daemonï¼Œé¡¯ç¤º `Unit docker.service not found`ã€‚\n\n4.  **æª¢æŸ¥ç‰ˆæœ¬**\n    ```bash\n    docker version\n    ```\n    > è¼¸å‡ºé¡¯ç¤º `Client: Podman Engine`ï¼Œä¸¦æç¤º `Emulate Docker CLI using podman`ã€‚\n\n---\n\n### æ­¥é©Ÿ 2ï¼šç§»é™¤ Podman-Docker ä¸¦å®‰è£ Docker CE\n\nç‚ºäº†ä½¿ç”¨åŸç”Ÿçš„ Docker Engineï¼Œæˆ‘å€‘éœ€è¦ç§»é™¤æ¨¡æ“¬å¥—ä»¶ä¸¦å®‰è£å®˜æ–¹ç‰ˆæœ¬ã€‚\n\n1.  **ç§»é™¤é è¨­å¥—ä»¶**\n    ```bash\n    dnf remove docker -y\n    ```\n    > é€™æœƒç§»é™¤ `podman-docker` å¥—ä»¶ã€‚\n\n2.  **æ–°å¢ Docker CE Repository**\n    ```bash\n    dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo\n    ```\n    > **æŒ‡ä»¤èªªæ˜**ï¼š\n    > - `config-manager`: `dnf` çš„å¤–æ›æ¨¡çµ„ï¼Œç”¨æ–¼ç®¡ç†è¨­å®šã€‚\n    > - `--add-repo`: æ–°å¢ä¸€å€‹å¤–éƒ¨çš„å¥—ä»¶ä¾†æº (Repository)ã€‚é€™è£¡æˆ‘å€‘æŒ‡å‘ Docker å®˜æ–¹ç‚º CentOS ç¶­è­·çš„ Repoã€‚\n\n    > é©—è­‰ Repo æ˜¯å¦åŠ å…¥æˆåŠŸï¼š\n    > ```bash\n    > cat /etc/yum.repos.d/docker-ce.repo\n    > ```\n\n3.  **å®‰è£ Docker CE**\n    ```bash\n    dnf install docker-ce -y\n    ```\n    > å®‰è£éç¨‹ä¸­æœƒä¸‹è¼‰ `docker-ce` (Daemon), `docker-ce-cli` (æŒ‡ä»¤å·¥å…·), `containerd.io` (Runtime) ç­‰å¥—ä»¶ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• Docker æœå‹™\n\nå®‰è£å®Œæˆå¾Œï¼ŒçœŸæ­£çš„ Docker Daemon (`dockerd`) å°±å·²ç¶“å°±ç·’äº†ã€‚\n\n1.  **å•Ÿå‹•ä¸¦è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹•**\n    ```bash\n    systemctl start docker\n    systemctl enable docker\n    ```\n    > **æŒ‡ä»¤èªªæ˜**ï¼š\n    > - `systemctl`: ç”¨æ–¼ç®¡ç†ç³»çµ±æœå‹™ (Systemd)ã€‚\n    > - `start`: ç«‹å³å•Ÿå‹•æœå‹™ã€‚\n    > - `enable`: è¨­å®šæœå‹™åœ¨é–‹æ©Ÿæ™‚è‡ªå‹•å•Ÿå‹•ã€‚\n\n2.  **æª¢æŸ¥æœå‹™ç‹€æ…‹**\n    ```bash\n    systemctl status docker\n    ```\n    > âœ… æ‡‰é¡¯ç¤º `Active: active (running)`ã€‚\n\n3.  **æª¢æŸ¥ç‰ˆæœ¬**\n    ```bash\n    docker version\n    ```\n    > ç¾åœ¨æ‡‰è©²é¡¯ç¤º `Client: Docker Engine - Community` å’Œ `Server: Docker Engine - Community`ã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šä¸‹è¼‰èˆ‡ç®¡ç† Container Image\n\n1.  **ä¸‹è¼‰æ˜ åƒæª”**\n    ```bash\n    docker pull rockylinux:9\n    ```\n\n2.  **æŸ¥çœ‹æ˜ åƒæª”åˆ—è¡¨**\n    ```bash\n    docker images\n    ```\n\n3.  **æŸ¥çœ‹æ˜ åƒæª”æ­·å²**\n    ```bash\n    docker history rockylinux:9\n    ```\n\n4.  **å‚™ä»½æ˜ åƒæª” (Docker Save)**\n    å°‡æ˜ åƒæª”åŒ¯å‡ºç‚º tar æª”æ¡ˆã€‚\n    ```bash\n    docker save --output=/root/rockylinux-9.tar rockylinux:9\n    ls -lh /root/rockylinux-9.tar\n    ```\n\n---\n\n## å°çµ\n\nåœ¨æœ¬ Lab ä¸­ï¼Œæˆ‘å€‘ç™¼ç¾ Linux ç™¼è¡Œç‰ˆå¯èƒ½æœƒç”¨ Podman ä¾†æ¨¡æ“¬ Dockerã€‚è‹¥è¦ä½¿ç”¨æ¨™æº– Docker Engineï¼Œå¿…é ˆæ‰‹å‹•è¨­å®š Docker å®˜æ–¹ Repository ä¸¦å®‰è£ `docker-ce`ã€‚\n"
  },
  {
    "title": "Lab03 Podman",
    "url": "https://caocharles.github.io/dcka-class-notes/lab03_podman/",
    "content": "ï»¿# LAB 03 å®‰è£ Podman\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ Lab å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ Podman çš„æ ¸å¿ƒæ¶æ§‹ (Daemonless & Rootless)\n- [ ] åœ¨ Linux ä¸Šå®‰è£ Podman\n- [ ] é©—è­‰ Podman ç„¡éœ€å®ˆè­·è¡Œç¨‹ (Daemon) å³å¯é‹ä½œ\n- [ ] è™•ç† Image Registry æœå°‹é †åºèˆ‡é©—è­‰å•é¡Œ\n\n---\n\n## 1.1 Podman ç°¡ä»‹\n\n**Podman** (Pod Manager) æ˜¯ä¸€å€‹ç”± Red Hat é–‹ç™¼çš„é–‹æºå®¹å™¨å¼•æ“ï¼Œç”¨æ–¼åœ¨ Linux ç³»çµ±ä¸Šé–‹ç™¼ã€ç®¡ç†å’ŒåŸ·è¡Œ OCI (Open Container Initiative) å®¹å™¨ã€‚\n\n- **å®˜æ–¹ç¶²ç«™**ï¼š[https://podman.io/](https://podman.io/)\n- **æœ€æ–°æ–‡ä»¶**ï¼š[Podman Documentation](https://docs.podman.io/en/latest/)\n\n### Podman èˆ‡ Docker çš„é—œéµå·®ç•°\n\n| ç‰¹æ€§ | Docker | Podman |\n|------|--------|--------|\n| **æ¶æ§‹** | **Client-Server** (ä¾è³´ dockerd å®ˆè­·è¡Œç¨‹) | **Daemonless** (ç›´æ¥ Fork/Exec ç¨‹åº) |\n| **åŸ·è¡Œæ¬Šé™** | é è¨­éœ€è¦ **Root** | åŸç”Ÿæ”¯æ´ **Rootless** (ä¸€èˆ¬ä½¿ç”¨è€…å¯åŸ·è¡Œ) |\n| **Pod æ”¯æ´** | éœ€é€é Docker Compose æˆ– K8S | **åŸç”Ÿæ”¯æ´ Pod** (å¯åœ¨ä¸€å€‹ Pod è·‘å¤šå€‹å®¹å™¨) |\n| **æœå‹™ç›¸ä¾** | è‹¥ Daemon æ›æ‰ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å—å½±éŸ¿ | å®¹å™¨æ˜¯ç¨ç«‹ç¨‹åºï¼Œäº’ä¸å½±éŸ¿ |\n| **Systemd** | æ•´åˆè¼ƒå¼± | åŸç”Ÿæ•´åˆï¼Œå®¹æ˜“å°‡å®¹å™¨ä½œæˆç³»çµ±æœå‹™ |\n\n!!! quote \"Podman çš„è¨­è¨ˆç†å¿µ\"\n    \"Alias docker=podman\" â€”â€” Podman çš„ CLI æŒ‡ä»¤èˆ‡ Docker é«˜åº¦ç›¸å®¹ï¼Œçµ•å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠ `docker` æŒ‡ä»¤æ›æˆ `podman` åŸ·è¡Œã€‚\n\n---\n\n## å¯¦ä½œæ­¥é©Ÿ\n\n### æ­¥é©Ÿ 1ï¼šå®‰è£ Podman å¥—ä»¶\n\nåœ¨ RHEL 9 / Rocky Linux 9 ä¸­ï¼ŒPodman é€šå¸¸å·²ç¶“é è£ã€‚å¦‚æœæ²’æœ‰ï¼Œå¯ä»¥ä½¿ç”¨ `dnf` å®‰è£ã€‚\n\n1.  **å®‰è£ Podman**\n    ```bash\n    dnf install podman -y\n    ```\n    > **æŒ‡ä»¤èªªæ˜**ï¼š\n    > - å¥—ä»¶åç¨±å°±æ˜¯ `podman`ï¼Œä¸éœ€è¦åƒ Docker é‚„è¦å»æ‰¾ `docker-ce`ã€‚\n    > - å¦‚æœç³»çµ±é¡¯ç¤º `Nothing to do`ï¼Œè¡¨ç¤ºå·²ç¶“å®‰è£éäº†ã€‚\n\n    ![å®‰è£ podman](images/lab03/podman_install.png)\n\n2.  **æª¢æŸ¥ç‰ˆæœ¬èˆ‡ç’°å¢ƒè³‡è¨Š**\n    ```bash\n    podman version\n    podman info\n    ```\n    > - `podman version`: é¡¯ç¤º Client/Server ç‰ˆæœ¬ï¼ˆæ³¨æ„ï¼šPodman çš„ Client å’Œ Server é€šå¸¸æ˜¯åŒä¸€å€‹ binaryï¼Œé™¤éæ˜¯é ç«¯æ“ä½œï¼‰ã€‚\n    > - `podman info`: é¡¯ç¤ºè©³ç´°çš„ç³»çµ±è¨­å®šï¼ŒåŒ…æ‹¬ Storage Driver (é€šå¸¸æ˜¯ overlay)ã€cgroup version (v2) ä»¥åŠé è¨­çš„ Registryã€‚\n\n---\n\n### æ­¥é©Ÿ 2ï¼šé©—è­‰ Daemonless æ¶æ§‹ï¼ˆç„¡éœ€å•Ÿå‹•æœå‹™ï¼‰\n\né€™æ˜¯ Podman æœ€ç‰¹åˆ¥çš„åœ°æ–¹ï¼š**ä½ ä¸éœ€è¦å•Ÿå‹•ä»»ä½•æœå‹™**ã€‚\n\n1.  **å˜—è©¦å°‹æ‰¾ podman æœå‹™**\n    åœ¨ä½ å®‰è£å®Œ Docker æ™‚ï¼Œé€šå¸¸ä¸‹ä¸€æ­¥æ˜¯ `systemctl start docker`ã€‚ä½†åœ¨ Podmanï¼š\n    \n    > ä½ **ä¸éœ€è¦**åŸ·è¡Œ `systemctl start podman`ã€‚\n    \n    Podman æ˜¯ä¸€å€‹å–®ç´”çš„ binaryåŸ·è¡Œæª”ã€‚ç•¶ä½ åŸ·è¡Œ `podman run` æ™‚ï¼Œå®ƒæœƒç›´æ¥åœ¨ç•¶å‰ä½¿ç”¨è€…çš„æ¬Šé™ä¸‹ç”¢ç”Ÿå®¹å™¨ç¨‹åºã€‚\n\n2.  **ç‚ºä»€éº¼æœƒæœ‰ `podman.socket`ï¼Ÿ**\n    å¦‚æœä½ æª¢æŸ¥ systemdï¼Œå¯èƒ½æœƒçœ‹åˆ° `podman.socket` æˆ– `podman.service`ã€‚é€™ä¸»è¦æ˜¯ç‚ºäº†æä¾› API çµ¦é ç«¯å·¥å…·ï¼ˆå¦‚ Docker Compose æˆ– IDEï¼‰é€£ç·šä½¿ç”¨ï¼Œå°æ–¼æœ¬åœ° CLI æ“ä½œä¸¦éå¿…è¦ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šä½¿ç”¨ Podman ä¸‹è¼‰ Container Image\n\nPodman é è¨­æœƒæœå°‹å¤šå€‹ Registryã€‚\n\n1.  **æŸ¥çœ‹ç›®å‰çš„ Image**\n    ```bash\n    podman images\n    ```\n\n2.  **å˜—è©¦ä¸‹è¼‰ MySQL Image**\n    åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š\n    ```bash\n    podman pull mysql\n    ```\n\n    **è§€å¯Ÿè¼¸å‡ºçµæœï¼š**\n    \n    Podman æœƒä¾åºå˜—è©¦è¨­å®šæª” (`/etc/containers/registries.conf`) ä¸­å®šç¾©çš„ Registryï¼š\n\n    1.  âŒ **`registry.access.redhat.com/mysql:latest`**\n        > `name unknown: Repo not found` (Red Hat å®˜æ–¹åº«æ²’æœ‰é€™å€‹ Image)\n    \n    2.  âŒ **`registry.redhat.io/mysql:latest`**\n        > `unauthorized: Please login` (éœ€è¦ Red Hat è¨‚é–±å¸³è™Ÿæ‰èƒ½å­˜å–)\n    \n    3.  âœ… **`docker.io/library/mysql:latest`**\n        > æˆåŠŸå¾ Docker Hub ä¸‹è¼‰ã€‚\n\n3.  **é©—è­‰ä¸‹è¼‰çµæœ**\n    ```bash\n    podman images\n    ```\n    > æ‡‰è©²æœƒçœ‹åˆ°ä¾†è‡ª `docker.io/library/mysql` çš„ Imageã€‚\n\n!!! tip \"Registry æœå°‹é †åºä¸¦ééš¨æ©Ÿ\"\n    RHEL/CentOS é è¨­çš„ `/etc/containers/registries.conf` æª”æ¡ˆå®šç¾©äº†æœå°‹é †åº (Search Registries)ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼ Podman æœƒå…ˆå»å• Red Hatï¼Œæœ€å¾Œæ‰å• Docker Hubã€‚\n    è€Œ Docker CE é è¨­åªæœƒæ‰¾ Docker Hub (`docker.io`)ã€‚\n"
  },
  {
    "title": "ä½¿ç”¨ wget ä¸‹è¼‰è…³æœ¬",
    "url": "https://caocharles.github.io/dcka-class-notes/lab04_docker_hub_rate_limit/",
    "content": "ï»¿# LAB 04 å¦‚ä½•æª¢æŸ¥ Docker Hub Rate Limiting\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ Lab å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ Docker Hub çš„ä¸‹è¼‰é™åˆ¶ (Rate Limiting)\n- [ ] ä½¿ç”¨ `curl` èˆ‡ `jq` æŒ‡ä»¤æª¢æŸ¥ç•¶å‰çš„ Rate Limit ç‹€æ…‹\n- [ ] æ¯”è¼ƒåŒ¿åä½¿ç”¨è€…èˆ‡å…è²»å¸³è™Ÿ (Free Account) çš„é™åˆ¶å·®ç•°\n\n---\n\n## 1.1 ä»€éº¼æ˜¯ Docker Hub Rate Limitingï¼Ÿ\n\nDocker Hub ç‚ºäº†é˜²æ­¢è³‡æºæ¿«ç”¨ï¼Œå° Container Image çš„ `pull` (ä¸‹è¼‰) æ¬¡æ•¸é€²è¡Œäº†é™åˆ¶ï¼š\n\n| å¸³è™Ÿé¡å‹ | é™åˆ¶å…§å®¹ |\n|----------|----------|\n| **åŒ¿åä½¿ç”¨è€… (Anonymous)** | æ¯ 6 å°æ™‚ **100** æ¬¡ pull (ä»¥ IP ç‚ºæº–) |\n| **å…è²»å¸³è™Ÿ (Free Account)** | æ¯ 6 å°æ™‚ **200** æ¬¡ pull (ä»¥å¸³è™Ÿç‚ºæº–) |\n| **Pro / Team / Business** | **5000** æ¬¡ (æ¯æ—¥) æˆ– ç„¡é™åˆ¶ |\n\nç•¶ä½ é‡åˆ° `Before you can look around... 429 Too Many Requests` éŒ¯èª¤æ™‚ï¼Œé€šå¸¸å°±æ˜¯è¢«é™æµäº†ã€‚\n\n---\n\n## å¯¦ä½œæ­¥é©Ÿ\n\n### æ­¥é©Ÿ 1ï¼šå®‰è£å¿…è¦å·¥å…· jq\n\nç‚ºäº†æ–¹ä¾¿è§£æ Docker Hub API å›å‚³çš„ JSON æ ¼å¼ Tokenï¼Œæˆ‘å€‘éœ€è¦å®‰è£ `jq` å·¥å…·ã€‚\n\n1.  **å®‰è£ jq**\n    ```bash\n    yum install jq -y\n    ```\n    > **æŒ‡ä»¤èªªæ˜**ï¼š`jq` æ˜¯ä¸€å€‹è¼•é‡ç´šä¸”éˆæ´»çš„ command-line JSON è™•ç†å™¨ã€‚\n\n    ![å®‰è£ jq èˆ‡æª¢æŸ¥ limit](images/lab04/check_limit.png)\n\n---\n\n### æ­¥é©Ÿ 2ï¼šä¸‹è¼‰æª¢æŸ¥è…³æœ¬\n\næˆ‘å€‘ä½¿ç”¨ä¸€æ®µ Shell Script ä¾†ç°¡åŒ–æª¢æŸ¥æµç¨‹ã€‚é€™å€‹ Script æœƒå‘ Docker Hub ç”³è«‹ Token ä¸¦æŸ¥è©¢ Header è³‡è¨Šã€‚\n\n1.  **ä¸‹è¼‰ Script** (å‡è¨­èª²å ‚ç’°å¢ƒæä¾›)\n    ```bash\n    # ä½¿ç”¨ wget ä¸‹è¼‰è…³æœ¬\n    wget http://10.0.1.248/k8s/scripts/check_docker_pull_rate_limit.sh\n    \n    # è‹¥ä¸Šè¿°é€£çµç„¡æ³•é€£ç·š (Connection refused)ï¼Œè«‹å˜—è©¦å‚™ç”¨ä½ç½®\n    wget http://10.0.1.249/k8s/scripts/check_docker_pull_rate_limit.sh\n    ```\n\n2.  **è³¦äºˆåŸ·è¡Œæ¬Šé™**\n    ```bash\n    chmod 755 check_docker_pull_rate_limit.sh\n    ```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæª¢æŸ¥åŒ¿åä½¿ç”¨è€…é™åˆ¶ (Anonymous)\n\n1.  **åŸ·è¡Œ Script**\n    ```bash\n    ./check_docker_pull_rate_limit.sh\n    ```\n\n2.  **è§€å¯Ÿè¼¸å‡ºçµæœ**\n    ```yaml\n    ratelimit-limit: 100;w=21600\n    ratelimit-remaining: 58;w=21600\n    docker-ratelimit-source: 118.163.116.129\n    ```\n    > **è¼¸å‡ºè§£æ**ï¼š\n    > - `ratelimit-limit: 100;w=21600`: é™åˆ¶ç‚ºæ¯ 21600 ç§’ (6å°æ™‚) **100** æ¬¡ã€‚\n    > - `ratelimit-remaining: 58`: ç›®å‰å‰©é¤˜ **58** æ¬¡é¡åº¦ã€‚\n    > - `docker-ratelimit-source`: è­˜åˆ¥ä¾†æº IPã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šæª¢æŸ¥å…è²»å¸³è™Ÿé™åˆ¶ (Free Account)\n\nè‹¥è¦ç²å¾—æ›´é«˜çš„é¡åº¦ï¼Œå¯ä»¥ç™»å…¥ Docker Hub å¸³è™Ÿã€‚\n\n1.  **ä¿®æ”¹ Script åŠ å…¥èªè­‰è³‡è¨Š**\n    ç·¨è¼¯ `check_docker_pull_rate_limit.sh`ï¼Œå°‡ä½ çš„ Docker Hub å¸³è™Ÿå¯†ç¢¼å¡«å…¥è®Šæ•¸ (æˆ–æ˜¯é€é `docker login` å¾Œä¿®æ”¹ Script ä»¥ä½¿ç”¨ Token)ã€‚\n    \n    *å‡è¨­ Script æ”¯æ´ä»¥è®Šæ•¸æ–¹å¼å¸¶å…¥å¸³å¯†ï¼š*\n    ```bash\n    # ç·¨è¼¯è…³æœ¬å¡«å…¥ USER=\"ä½ çš„å¸³è™Ÿ\" PASSWORD=\"ä½ çš„å¯†ç¢¼\"\n    vi check_docker_pull_rate_limit.sh\n    ```\n\n    !!! tip \"æ‰‹å‹•æª¢æŸ¥æŒ‡ä»¤ (åƒè€ƒ)\"\n        å¦‚æœæ²’æœ‰ Scriptï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤æ‰‹å‹•æª¢æŸ¥ (è¨˜å¾—æ›¿æ›å¸³å¯†)ï¼š\n        ```bash\n        # 1. å–å¾— Token\n        TOKEN=$(curl -s -u \"ä½ çš„å¸³è™Ÿ:ä½ çš„å¯†ç¢¼\" \"https://auth.docker.io/token?service=registry.docker.io&scope=repository:ratelimitpreview/test:pull\" | jq -r .token)\n        \n        # 2. æŸ¥è©¢ Header\n        curl --head -H \"Authorization: Bearer $TOKEN\" https://registry-1.docker.io/v2/ratelimitpreview/test/manifests/latest\n        ```\n\n2.  **å†æ¬¡åŸ·è¡Œ Script**\n    ```bash\n    ./check_docker_pull_rate_limit.sh\n    ```\n\n3.  **é æœŸçµæœ**\n    ```yaml\n    ratelimit-limit: 200;w=21600   <-- é¡åº¦è®Šç‚º 200\n    ratelimit-remaining: 198;w=21600\n    docker-ratelimit-source: [ä½ çš„å¸³è™ŸUUID]\n    ```\n    > ç™»å…¥å¾Œï¼Œ`ratelimit-source` é€šå¸¸æœƒè®Šæˆä½ çš„ User IDï¼Œä¸”é¡åº¦æœƒæå‡è‡³ **200** æ¬¡ã€‚\n\n---\n\n## å°çµ\n\n- **åŒ¿åä¸‹è¼‰**ï¼šæ–¹ä¾¿ä½†é™åˆ¶åš´æ ¼ (100æ¬¡/6hr)ï¼Œå¤šå°æ©Ÿå™¨å…±ç”¨ Public IP æ™‚å®¹æ˜“è¢«é–ã€‚\n- **ç™»å…¥ä¸‹è¼‰**ï¼šå»ºè­°åœ¨ Server ä¸Šé€é `docker login` ç™»å…¥ï¼Œå¯å°‡é¡åº¦æå‡è‡³ (200æ¬¡/6hr)ï¼Œæˆ–è³¼è²· Pro æ–¹æ¡ˆè§£é™¤é™åˆ¶ã€‚\n"
  },
  {
    "title": "LAB 05 å»ºç½® private registry",
    "url": "https://caocharles.github.io/dcka-class-notes/lab05_private_registry/",
    "content": "# LAB 05 å»ºç½® private registry\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] å€åˆ† Public Registry èˆ‡ Private Registry çš„ç”¨é€”\n- [ ] ç†Ÿç·´æ“ä½œ Docker åŸºæœ¬æŒ‡ä»¤ï¼ˆrunã€execã€logsã€inspect ç­‰ï¼‰\n- [ ] è¨­å®š Docker æŒä¹…åŒ–å„²å­˜ï¼ˆVolumes èˆ‡ Bind Mountsï¼‰\n- [ ] ç†è§£ä¸¦è¨­å®š Docker ç¶²è·¯\n- [ ] å¾ Docker Hub æœå°‹ã€æ‹‰å–ã€æ¨é€ Image\n- [ ] å®Œæˆ WordPress + MySQL å®¹å™¨åŒ–éƒ¨ç½²å¯¦ä½œ\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆç¬¬ 1 ç« çš„å…§å®¹\n- Docker å·²æ­£ç¢ºå®‰è£ä¸¦å¯åŸ·è¡Œ\n- ç†è§£ Image èˆ‡ Container çš„é—œä¿‚\n\n---\n\n## 2.1 Public Registry èˆ‡ Private Registry\n\n### ä»€éº¼æ˜¯ Registryï¼Ÿ\n\nRegistryï¼ˆå€‰åº«ï¼‰æ˜¯ç”¨ä¾†å„²å­˜å’Œåˆ†ç™¼ Docker Image çš„æœå‹™ã€‚å°±åƒ GitHub å„²å­˜ç¨‹å¼ç¢¼ä¸€æ¨£ï¼ŒRegistry å„²å­˜å®¹å™¨æ˜ åƒæª”ã€‚\n\n```mermaid\ngraph LR\n    Dev[é–‹ç™¼è€…] -->|push| Registry[(Registry)]\n    Registry -->|pull| Server1[ä¼ºæœå™¨ 1]\n    Registry -->|pull| Server2[ä¼ºæœå™¨ 2]\n    Registry -->|pull| Server3[ä¼ºæœå™¨ 3]\n```\n\n### Public Registry\n\nå…¬é–‹çš„ Registry æœå‹™ï¼Œä»»ä½•äººéƒ½å¯ä»¥å­˜å–å…¬é–‹çš„ Imageã€‚\n\n| Registry | èªªæ˜ | ç¶²å€ |\n|----------|------|------|\n| **Docker Hub** | å®˜æ–¹é è¨­ Registryï¼Œæœ€å¤§çš„å…¬é–‹ Image å€‰åº« | hub.docker.com |\n| **Quay.io** | Red Hat æä¾›çš„ Registry | quay.io |\n| **GitHub Container Registry** | GitHub æä¾›çš„å®¹å™¨ Registry | ghcr.io |\n| **Google Container Registry** | Google Cloud æä¾› | gcr.io |\n| **Amazon ECR Public** | AWS æä¾›çš„å…¬é–‹ Registry | public.ecr.aws |\n\n!!! tip \"Docker Hub ä½¿ç”¨æŠ€å·§\"\n    - **å®˜æ–¹ Image**ï¼šæ²’æœ‰å‰ç¶´ï¼Œå¦‚ `nginx`ã€`mysql`ã€`redis`\n    - **ç¤¾ç¾¤ Image**ï¼šåŒ…å«ä½¿ç”¨è€…åç¨±ï¼Œå¦‚ `bitnami/nginx`\n    - **æ¨™ç±¤**ï¼šæŒ‡å®šç‰ˆæœ¬ï¼Œå¦‚ `nginx:1.25`ã€`nginx:alpine`\n\n### Private Registry\n\nç§æœ‰ Registry ç”¨æ–¼å„²å­˜ä¼æ¥­å…§éƒ¨çš„ Imageï¼Œä¸å°å¤–å…¬é–‹ã€‚\n\n#### å¸¸è¦‹ç§æœ‰ Registry æ–¹æ¡ˆ\n\n| æ–¹æ¡ˆ | èªªæ˜ | é©ç”¨å ´æ™¯ |\n|------|------|----------|\n| **Docker Registry** | Docker å®˜æ–¹æä¾›çš„è¼•é‡ç´š Registry | å°å‹åœ˜éšŠã€æ¸¬è©¦ç’°å¢ƒ |\n| **Harbor** | VMware é–‹æºçš„ä¼æ¥­ç´š Registry | å¤§å‹ä¼æ¥­ã€éœ€è¦ RBAC |\n| **Nexus Repository** | Sonatype çš„å¤šåŠŸèƒ½å€‰åº« | å·²ä½¿ç”¨ Nexus ç®¡ç†å¥—ä»¶ |\n| **JFrog Artifactory** | ä¼æ¥­ç´šè£½å“ç®¡ç† | å¤§å‹ä¼æ¥­ |\n| **AWS ECR** | AWS ç§æœ‰ Registry | AWS é›²ç«¯ç’°å¢ƒ |\n| **Azure ACR** | Azure ç§æœ‰ Registry | Azure é›²ç«¯ç’°å¢ƒ |\n| **GCP GCR** | Google ç§æœ‰ Registry | GCP é›²ç«¯ç’°å¢ƒ |\n\n#### å»ºç«‹ç°¡æ˜“ Private Registry\n\n```bash title=\"ä½¿ç”¨ Docker å»ºç«‹ç§æœ‰ Registry\"\n# å•Ÿå‹• Registry Container\ndocker run -d \\\n  --name my-registry \\\n  -p 5000:5000 \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n\n# ç‚º Image åŠ ä¸Šç§æœ‰ Registry æ¨™ç±¤\ndocker tag nginx:latest localhost:5000/my-nginx:v1\n\n# æ¨é€åˆ°ç§æœ‰ Registry\ndocker push localhost:5000/my-nginx:v1\n\n# å¾ç§æœ‰ Registry æ‹‰å–\ndocker pull localhost:5000/my-nginx:v1\n```\n\n!!! warning \"ç”Ÿç”¢ç’°å¢ƒæ³¨æ„äº‹é …\"\n    - ç§æœ‰ Registry æ‡‰é…ç½® TLS æ†‘è­‰\n    - è¨­å®šé©ç•¶çš„å­˜å–æ§åˆ¶\n    - å®šæœŸå‚™ä»½ Registry è³‡æ–™\n    - è€ƒæ…®ä½¿ç”¨ä¼æ¥­ç´šæ–¹æ¡ˆå¦‚ Harbor\n\n---\n\n## 2.2 Docker åŸºæœ¬æ“ä½œ\n\n### Container ç”Ÿå‘½é€±æœŸç®¡ç†\n\n```mermaid\nstateDiagram-v2\n    [*] --> Created: docker create\n    Created --> Running: docker start\n    Running --> Paused: docker pause\n    Paused --> Running: docker unpause\n    Running --> Stopped: docker stop\n    Stopped --> Running: docker start\n    Stopped --> Removed: docker rm\n    Running --> Removed: docker rm -f\n    Removed --> [*]\n```\n\n### æ ¸å¿ƒæŒ‡ä»¤è©³è§£\n\n#### docker run - åŸ·è¡Œå®¹å™¨\n\n```bash title=\"docker run å¸¸ç”¨é¸é …\"\n# åŸºæœ¬åŸ·è¡Œ\ndocker run nginx\n\n# èƒŒæ™¯åŸ·è¡Œ (detached)\ndocker run -d nginx\n\n# æŒ‡å®šåç¨±\ndocker run -d --name my-nginx nginx\n\n# Port å°æ‡‰ (ä¸»æ©Ÿ:å®¹å™¨)\ndocker run -d -p 8080:80 nginx\n\n# ç’°å¢ƒè®Šæ•¸\ndocker run -d -e MYSQL_ROOT_PASSWORD=secret mysql\n\n# è‡ªå‹•åˆªé™¤ï¼ˆçµæŸå¾Œè‡ªå‹•ç§»é™¤ï¼‰\ndocker run --rm nginx echo \"Hello\"\n\n# äº’å‹•æ¨¡å¼\ndocker run -it ubuntu /bin/bash\n\n# è³‡æºé™åˆ¶\ndocker run -d --memory=\"512m\" --cpus=\"1.0\" nginx\n\n# é‡å•Ÿç­–ç•¥\ndocker run -d --restart=always nginx\n```\n\n!!! note \"docker run é¸é …èªªæ˜\"\n    | é¸é … | èªªæ˜ |\n    |------|------|\n    | `-d` | Detached modeï¼ŒèƒŒæ™¯åŸ·è¡Œ |\n    | `-it` | äº’å‹•æ¨¡å¼ + TTY |\n    | `-p` | Port mapping |\n    | `-v` | Volume mapping |\n    | `-e` | ç’°å¢ƒè®Šæ•¸ |\n    | `--name` | æŒ‡å®šå®¹å™¨åç¨± |\n    | `--rm` | çµæŸå¾Œè‡ªå‹•åˆªé™¤ |\n    | `--restart` | é‡å•Ÿç­–ç•¥ |\n\n#### docker exec - åŸ·è¡ŒæŒ‡ä»¤\n\n```bash title=\"åœ¨é‹è¡Œä¸­çš„å®¹å™¨åŸ·è¡ŒæŒ‡ä»¤\"\n# åŸ·è¡Œå–®ä¸€æŒ‡ä»¤\ndocker exec my-nginx cat /etc/nginx/nginx.conf\n\n# é€²å…¥äº’å‹•å¼ Shell\ndocker exec -it my-nginx /bin/bash\n\n# ä»¥ç‰¹å®šä½¿ç”¨è€…åŸ·è¡Œ\ndocker exec -u root my-nginx whoami\n\n# è¨­å®šç’°å¢ƒè®Šæ•¸\ndocker exec -e VAR=value my-nginx printenv VAR\n```\n\n#### docker logs - æª¢è¦–æ—¥èªŒ\n\n```bash title=\"Container æ—¥èªŒæ“ä½œ\"\n# æª¢è¦–å…¨éƒ¨æ—¥èªŒ\ndocker logs my-nginx\n\n# æŒçºŒè¿½è¹¤æ—¥èªŒ\ndocker logs -f my-nginx\n\n# é¡¯ç¤ºæœ€å¾Œ N è¡Œ\ndocker logs --tail 100 my-nginx\n\n# é¡¯ç¤ºæ™‚é–“æˆ³è¨˜\ndocker logs -t my-nginx\n\n# æŒ‡å®šæ™‚é–“ç¯„åœ\ndocker logs --since 2024-01-01 my-nginx\ndocker logs --since 10m my-nginx  # æœ€è¿‘ 10 åˆ†é˜\n```\n\n#### docker inspect - æª¢è¦–è©³ç´°è³‡è¨Š\n\n```bash title=\"æª¢è¦–å®¹å™¨/æ˜ åƒæª”è©³ç´°è³‡è¨Š\"\n# æª¢è¦–å®¹å™¨è©³ç´°è³‡è¨Šï¼ˆJSON æ ¼å¼ï¼‰\ndocker inspect my-nginx\n\n# å–å¾—ç‰¹å®šè³‡è¨Šï¼ˆä½¿ç”¨ Go æ¨¡æ¿ï¼‰\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' my-nginx\n\n# å–å¾— Port å°æ‡‰\ndocker inspect --format='{{range $p, $conf := .NetworkSettings.Ports}}{{$p}} -> {{(index $conf 0).HostPort}}{{end}}' my-nginx\n\n# å–å¾—æ›è¼‰è³‡è¨Š\ndocker inspect --format='{{json .Mounts}}' my-nginx | jq .\n```\n\n#### å…¶ä»–å¸¸ç”¨æŒ‡ä»¤\n\n```bash title=\"å®¹å™¨ç®¡ç†æŒ‡ä»¤\"\n# åˆ—å‡ºé‹è¡Œä¸­çš„å®¹å™¨\ndocker ps\n\n# åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…å«å·²åœæ­¢ï¼‰\ndocker ps -a\n\n# åœæ­¢å®¹å™¨\ndocker stop my-nginx\n\n# å•Ÿå‹•å·²åœæ­¢çš„å®¹å™¨\ndocker start my-nginx\n\n# é‡å•Ÿå®¹å™¨\ndocker restart my-nginx\n\n# åˆªé™¤å®¹å™¨\ndocker rm my-nginx\n\n# å¼·åˆ¶åˆªé™¤é‹è¡Œä¸­çš„å®¹å™¨\ndocker rm -f my-nginx\n\n# åˆªé™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨\ndocker container prune\n\n# æª¢è¦–å®¹å™¨è³‡æºä½¿ç”¨\ndocker stats\n\n# è¤‡è£½æª”æ¡ˆåˆ°å®¹å™¨\ndocker cp ./index.html my-nginx:/usr/share/nginx/html/\n\n# å¾å®¹å™¨è¤‡è£½æª”æ¡ˆ\ndocker cp my-nginx:/etc/nginx/nginx.conf ./nginx.conf\n```\n\n---\n\n## 2.3 Persistent Storage\n\n### ç‚ºä»€éº¼éœ€è¦æŒä¹…åŒ–å„²å­˜ï¼Ÿ\n\nContainer é è¨­çš„è³‡æ–™æ˜¯çŸ­æš«çš„ï¼ˆephemeralï¼‰ï¼Œç•¶ Container è¢«åˆªé™¤æ™‚ï¼Œæ‰€æœ‰è³‡æ–™éƒ½æœƒæ¶ˆå¤±ã€‚\n\n```mermaid\ngraph LR\n    subgraph \"æ²’æœ‰æŒä¹…åŒ–\"\n        C1[Container] --> RW1[è®€å¯«å±¤]\n        RW1 -.->|åˆªé™¤å®¹å™¨| X[è³‡æ–™æ¶ˆå¤±]\n    end\n    \n    subgraph \"ä½¿ç”¨æŒä¹…åŒ–\"\n        C2[Container] --> RW2[è®€å¯«å±¤]\n        C2 --> V[Volume/Bind Mount]\n        V -->|å®¹å™¨åˆªé™¤| V\n    end\n```\n\n### ä¸‰ç¨®å„²å­˜æ–¹å¼\n\n| é¡å‹ | èªªæ˜ | é©ç”¨å ´æ™¯ |\n|------|------|----------|\n| **Volume** | ç”± Docker ç®¡ç†çš„å„²å­˜å€åŸŸ | ç”Ÿç”¢ç’°å¢ƒã€è³‡æ–™æŒä¹…åŒ– |\n| **Bind Mount** | å°‡ä¸»æ©Ÿç›®éŒ„æ›è¼‰åˆ°å®¹å™¨ | é–‹ç™¼ç’°å¢ƒã€ç¨‹å¼ç¢¼åŒæ­¥ |\n| **tmpfs Mount** | å„²å­˜åœ¨ä¸»æ©Ÿè¨˜æ†¶é«”ä¸­ | æš«å­˜æ•æ„Ÿè³‡æ–™ |\n\n### Volumes\n\n```bash title=\"Volume åŸºæœ¬æ“ä½œ\"\n# å»ºç«‹ Volume\ndocker volume create my-data\n\n# åˆ—å‡ºæ‰€æœ‰ Volume\ndocker volume ls\n\n# æª¢è¦– Volume è©³ç´°è³‡è¨Š\ndocker volume inspect my-data\n\n# ä½¿ç”¨ Volume åŸ·è¡Œå®¹å™¨\ndocker run -d \\\n  --name my-nginx \\\n  -v my-data:/usr/share/nginx/html \\\n  nginx\n\n# åˆªé™¤ Volume\ndocker volume rm my-data\n\n# æ¸…ç†æœªä½¿ç”¨çš„ Volume\ndocker volume prune\n```\n\n!!! tip \"Volume ä½ç½®\"\n    Docker Volume é è¨­å„²å­˜åœ¨ï¼š\n    \n    - **Linux**: `/var/lib/docker/volumes/`\n    - **macOS/Windows**: Docker Desktop ç®¡ç†çš„è™›æ“¬ç£ç¢Ÿå…§\n\n### Bind Mounts\n\n```bash title=\"Bind Mount ä½¿ç”¨æ–¹å¼\"\n# ä½¿ç”¨ -v èªæ³•\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# ä½¿ç”¨ --mount èªæ³•ï¼ˆæ¨è–¦ï¼‰\ndocker run -d \\\n  --name my-nginx \\\n  --mount type=bind,source=/path/on/host,target=/usr/share/nginx/html \\\n  -p 8080:80 \\\n  nginx\n\n# å”¯è®€æ›è¼‰\ndocker run -d \\\n  --name my-nginx \\\n  -v /path/on/host:/usr/share/nginx/html:ro \\\n  nginx\n```\n\n!!! example \"é–‹ç™¼ç’°å¢ƒç¯„ä¾‹\"\n    ```bash title=\"å‰ç«¯é–‹ç™¼å³æ™‚åŒæ­¥\"\n    # å°‡æœ¬åœ°å°ˆæ¡ˆç›®éŒ„æ›è¼‰åˆ°å®¹å™¨\n    docker run -d \\\n      --name frontend-dev \\\n      -v $(pwd)/src:/app/src \\\n      -p 3000:3000 \\\n      node:18\n    ```\n    \n    ä¿®æ”¹æœ¬åœ° `src` ç›®éŒ„çš„æª”æ¡ˆæœƒç«‹å³åæ˜ åˆ°å®¹å™¨ä¸­ã€‚\n\n### Volume vs Bind Mount æ¯”è¼ƒ\n\n| æ¯”è¼ƒé …ç›® | Volume | Bind Mount |\n|----------|--------|------------|\n| å„²å­˜ä½ç½® | Docker ç®¡ç† | æŒ‡å®šä¸»æ©Ÿè·¯å¾‘ |\n| å¯ç§»æ¤æ€§ | é«˜ | ä¾è³´ä¸»æ©Ÿè·¯å¾‘ |\n| æ•ˆèƒ½ | è¼ƒä½³ | å–æ±ºæ–¼ä¸»æ©Ÿæª”æ¡ˆç³»çµ± |\n| å‚™ä»½ | å®¹æ˜“ | éœ€æ‰‹å‹•è™•ç† |\n| é©ç”¨å ´æ™¯ | ç”Ÿç”¢ç’°å¢ƒ | é–‹ç™¼ç’°å¢ƒ |\n\n---\n\n## 2.4 Docker Network\n\n### é è¨­ç¶²è·¯é¡å‹\n\nDocker æä¾›å¤šç¨®ç¶²è·¯é©…å‹•ï¼Œæ»¿è¶³ä¸åŒçš„ä½¿ç”¨å ´æ™¯ã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Bridge Networkï¼ˆé è¨­ï¼‰\"\n        B_C1[Container 1] --- B_NET[docker0 bridge]\n        B_C2[Container 2] --- B_NET\n        B_NET --- B_HOST[Host Network Stack]\n    end\n    \n    subgraph \"Host Network\"\n        H_C[Container] --- H_HOST[Host Network Stack]\n    end\n    \n    subgraph \"None Network\"\n        N_C[Container - ç„¡ç¶²è·¯]\n    end\n```\n\n| ç¶²è·¯é¡å‹ | èªªæ˜ | é©ç”¨å ´æ™¯ |\n|----------|------|----------|\n| **bridge** | é è¨­ç¶²è·¯ï¼ŒContainer é€éè™›æ“¬æ©‹æ¥å™¨é€£æ¥ | å–®æ©Ÿå¤šå®¹å™¨é€šè¨Š |\n| **host** | Container ç›´æ¥ä½¿ç”¨ä¸»æ©Ÿç¶²è·¯ | éœ€è¦æœ€é«˜ç¶²è·¯æ•ˆèƒ½ |\n| **none** | ç„¡ç¶²è·¯é€£æ¥ | å®‰å…¨éš”é›¢éœ€æ±‚ |\n| **overlay** | è·¨ä¸»æ©Ÿå®¹å™¨é€šè¨Š | Docker Swarm å¢é›† |\n| **macvlan** | åˆ†é…çœŸå¯¦ MAC åœ°å€ | éœ€è¦ç›´æ¥é€£æ¥å¯¦é«”ç¶²è·¯ |\n\n### ç¶²è·¯åŸºæœ¬æ“ä½œ\n\n```bash title=\"Docker ç¶²è·¯ç®¡ç†\"\n# åˆ—å‡ºæ‰€æœ‰ç¶²è·¯\ndocker network ls\n\n# æª¢è¦–ç¶²è·¯è©³ç´°è³‡è¨Š\ndocker network inspect bridge\n\n# å»ºç«‹è‡ªè¨‚ç¶²è·¯\ndocker network create my-network\n\n# å»ºç«‹æŒ‡å®šå­ç¶²è·¯çš„ç¶²è·¯\ndocker network create \\\n  --driver bridge \\\n  --subnet 172.20.0.0/16 \\\n  --gateway 172.20.0.1 \\\n  my-custom-network\n\n# åˆªé™¤ç¶²è·¯\ndocker network rm my-network\n\n# æ¸…ç†æœªä½¿ç”¨çš„ç¶²è·¯\ndocker network prune\n```\n\n### å®¹å™¨é€£æ¥ç¶²è·¯\n\n```bash title=\"å®¹å™¨ç¶²è·¯é€£æ¥\"\n# åŸ·è¡Œå®¹å™¨æ™‚æŒ‡å®šç¶²è·¯\ndocker run -d --name app1 --network my-network nginx\n\n# å°‡é‹è¡Œä¸­çš„å®¹å™¨é€£æ¥åˆ°ç¶²è·¯\ndocker network connect my-network container-name\n\n# å°‡å®¹å™¨å¾ç¶²è·¯æ–·é–‹\ndocker network disconnect my-network container-name\n```\n\n### å®¹å™¨é–“é€šè¨Š\n\n!!! tip \"ä½¿ç”¨è‡ªè¨‚ç¶²è·¯å¯¦ç¾å®¹å™¨é–“é€šè¨Š\"\n    åœ¨åŒä¸€å€‹è‡ªè¨‚ç¶²è·¯ä¸­çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨**å®¹å™¨åç¨±**ä½œç‚º hostname äº’ç›¸å­˜å–ã€‚\n\n```bash title=\"å®¹å™¨é–“é€šè¨Šç¯„ä¾‹\"\n# å»ºç«‹ç¶²è·¯\ndocker network create app-network\n\n# å•Ÿå‹• MySQL Container\ndocker run -d \\\n  --name mysql-db \\\n  --network app-network \\\n  -e MYSQL_ROOT_PASSWORD=secret \\\n  mysql:8\n\n# å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ Containerï¼Œä½¿ç”¨ mysql-db ä½œç‚ºè³‡æ–™åº«ä¸»æ©Ÿ\ndocker run -d \\\n  --name my-app \\\n  --network app-network \\\n  -e DB_HOST=mysql-db \\\n  -e DB_PASSWORD=secret \\\n  my-application\n\n# æ¸¬è©¦é€£ç·š\ndocker exec my-app ping mysql-db\n```\n\n### Port å°æ‡‰\n\n```bash title=\"Port Mapping\"\n# å°æ‡‰å–®ä¸€ Port\ndocker run -d -p 8080:80 nginx\n\n# å°æ‡‰å¤šå€‹ Port\ndocker run -d -p 8080:80 -p 8443:443 nginx\n\n# å°æ‡‰åˆ°æ‰€æœ‰ä»‹é¢çš„éš¨æ©Ÿ Port\ndocker run -d -P nginx\n\n# åªå°æ‡‰åˆ° localhost\ndocker run -d -p 127.0.0.1:8080:80 nginx\n\n# å°æ‡‰ UDP Port\ndocker run -d -p 53:53/udp dns-server\n```\n\n---\n\n## 2.5 Docker Search\n\n### æœå°‹ Image\n\n```bash title=\"æœå°‹ Docker Hub\"\n# åŸºæœ¬æœå°‹\ndocker search nginx\n\n# é™åˆ¶çµæœæ•¸é‡\ndocker search --limit 5 nginx\n\n# åªé¡¯ç¤ºå®˜æ–¹ Image\ndocker search --filter is-official=true nginx\n\n# åªé¡¯ç¤ºè‡ªå‹•å»ºç½®çš„ Image\ndocker search --filter is-automated=true nginx\n\n# æ ¹æ“šæ˜Ÿæ˜Ÿæ•¸éæ¿¾\ndocker search --filter stars=100 nginx\n```\n\n**æœå°‹çµæœèªªæ˜**ï¼š\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| NAME | Image åç¨± |\n| DESCRIPTION | æè¿° |\n| STARS | æ˜Ÿæ˜Ÿæ•¸ï¼ˆäººæ°£æŒ‡æ¨™ï¼‰ |\n| OFFICIAL | æ˜¯å¦ç‚ºå®˜æ–¹ Image |\n| AUTOMATED | æ˜¯å¦è‡ªå‹•å»ºç½® |\n\n!!! tip \"é¸æ“‡ Image çš„å»ºè­°\"\n    1. å„ªå…ˆé¸æ“‡**å®˜æ–¹ Image**ï¼ˆOFFICIAL = [OK]ï¼‰\n    2. æŸ¥çœ‹**æ˜Ÿæ˜Ÿæ•¸**å’Œ**ä¸‹è¼‰æ¬¡æ•¸**\n    3. åˆ° Docker Hub ç¶²ç«™æŸ¥çœ‹**æ–‡ä»¶**å’Œ**æ›´æ–°é »ç‡**\n    4. æª¢æŸ¥ Image çš„**å®‰å…¨æƒæçµæœ**\n\n---\n\n## 2.6 Docker Pull\n\n### æ‹‰å– Image\n\n```bash title=\"æ‹‰å– Image\"\n# æ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼ˆé è¨­ latest tagï¼‰\ndocker pull nginx\n\n# æ‹‰å–ç‰¹å®šç‰ˆæœ¬\ndocker pull nginx:1.25\n\n# æ‹‰å–ç‰¹å®šç‰ˆæœ¬ï¼ˆalpine è¼•é‡ç‰ˆï¼‰\ndocker pull nginx:alpine\n\n# å¾å…¶ä»– Registry æ‹‰å–\ndocker pull quay.io/bitnami/nginx\n\n# æ‹‰å–ç‰¹å®šå¹³å°çš„ Image\ndocker pull --platform linux/amd64 nginx\n```\n\n### Image æ¨™ç±¤ï¼ˆTagï¼‰\n\n```mermaid\ngraph LR\n    N[nginx] --> L[latest]\n    N --> V1[1.25]\n    N --> V2[1.25.3]\n    N --> A[alpine]\n    N --> VA[1.25-alpine]\n```\n\n!!! warning \"é¿å…ä½¿ç”¨ latest\"\n    - `latest` æ¨™ç±¤æœƒéš¨æ™‚é–“è®ŠåŒ–\n    - ç”Ÿç”¢ç’°å¢ƒæ‡‰ä½¿ç”¨**æ˜ç¢ºç‰ˆæœ¬è™Ÿ**\n    - ä¾‹å¦‚ï¼š`nginx:1.25.3` è€Œé `nginx:latest`\n\n### ç®¡ç†æœ¬åœ° Image\n\n```bash title=\"Image ç®¡ç†æŒ‡ä»¤\"\n# åˆ—å‡ºæœ¬åœ° Image\ndocker images\n\n# åˆ—å‡ºæ‰€æœ‰ Imageï¼ˆåŒ…å«ä¸­é–“å±¤ï¼‰\ndocker images -a\n\n# æª¢è¦– Image è©³ç´°è³‡è¨Š\ndocker image inspect nginx\n\n# æª¢è¦– Image æ­·å²ï¼ˆåˆ†å±¤ï¼‰\ndocker history nginx\n\n# åˆªé™¤ Image\ndocker rmi nginx\n\n# åˆªé™¤æœªä½¿ç”¨çš„ Image\ndocker image prune\n\n# åˆªé™¤æ‰€æœ‰æœªä½¿ç”¨çš„ Imageï¼ˆåŒ…å«æœªæ¨™è¨˜çš„ï¼‰\ndocker image prune -a\n```\n\n---\n\n## 2.7 Docker Push\n\n### æ¨é€ Image åˆ° Registry\n\n#### æ¨é€åˆ° Docker Hub\n\n```bash title=\"æ¨é€åˆ° Docker Hub\"\n# 1. ç™»å…¥ Docker Hub\ndocker login\n\n# 2. ç‚º Image åŠ ä¸Šæ¨™ç±¤ï¼ˆå¿…é ˆåŒ…å«ä½¿ç”¨è€…åç¨±ï¼‰\ndocker tag my-app:v1 username/my-app:v1\n\n# 3. æ¨é€ Image\ndocker push username/my-app:v1\n\n# 4. ç™»å‡ºï¼ˆé¸ç”¨ï¼‰\ndocker logout\n```\n\n#### æ¨é€åˆ°ç§æœ‰ Registry\n\n```bash title=\"æ¨é€åˆ°ç§æœ‰ Registry\"\n# 1. ç™»å…¥ç§æœ‰ Registry\ndocker login my-registry.example.com\n\n# 2. ç‚º Image åŠ ä¸Šç§æœ‰ Registry æ¨™ç±¤\ndocker tag my-app:v1 my-registry.example.com/my-app:v1\n\n# 3. æ¨é€\ndocker push my-registry.example.com/my-app:v1\n```\n\n!!! note \"Image å‘½åè¦å‰‡\"\n    ```\n    [registry/][username/]repository[:tag]\n    ```\n    \n    ä¾‹å¦‚ï¼š\n    \n    - `nginx` = `docker.io/library/nginx:latest`\n    - `bitnami/nginx` = `docker.io/bitnami/nginx:latest`\n    - `gcr.io/project/app:v1`\n\n### æ¨™ç±¤ç®¡ç†\n\n```bash title=\"Image æ¨™ç±¤æ“ä½œ\"\n# åŠ ä¸Šæ–°æ¨™ç±¤\ndocker tag my-app:v1 my-app:latest\ndocker tag my-app:v1 my-app:stable\n\n# æ¨é€å¤šå€‹æ¨™ç±¤\ndocker push my-app:v1\ndocker push my-app:latest\ndocker push my-app:stable\n```\n\n---\n\n## 2.8 ä½¿ç”¨ Docker æ¶è¨­ WordPress + MySQL\n\n### Lab å¯¦ä½œç›®æ¨™\n\néƒ¨ç½²ä¸€å€‹å®Œæ•´çš„ WordPress ç¶²ç«™ï¼ŒåŒ…å«ï¼š\n\n- MySQL è³‡æ–™åº«å®¹å™¨\n- WordPress æ‡‰ç”¨ç¨‹å¼å®¹å™¨\n- ä½¿ç”¨ Docker Network é€£æ¥\n- ä½¿ç”¨ Volume æŒä¹…åŒ–è³‡æ–™\n\n### æ¶æ§‹åœ–\n\n```mermaid\ngraph TB\n    subgraph \"Docker ç’°å¢ƒ\"\n        subgraph \"wp-network\"\n            WP[WordPress<br/>Port: 8080] -->|é€£æ¥| DB[(MySQL<br/>Port: 3306)]\n        end\n        WP_VOL[wordpress-data<br/>Volume] --> WP\n        DB_VOL[mysql-data<br/>Volume] --> DB\n    end\n    \n    User[ä½¿ç”¨è€…] -->|http://localhost:8080| WP\n```\n\n### å¯¦ä½œæ­¥é©Ÿ\n\n#### æ­¥é©Ÿ 1ï¼šå»ºç«‹ç¶²è·¯\n\n```bash title=\"å»ºç«‹å°ˆç”¨ç¶²è·¯\"\ndocker network create wp-network\n```\n\n#### æ­¥é©Ÿ 2ï¼šå•Ÿå‹• MySQL å®¹å™¨\n\n```bash title=\"å•Ÿå‹• MySQL\"\ndocker run -d \\\n  --name wp-mysql \\\n  --network wp-network \\\n  -v mysql-data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=rootpassword \\\n  -e MYSQL_DATABASE=wordpress \\\n  -e MYSQL_USER=wpuser \\\n  -e MYSQL_PASSWORD=wppassword \\\n  mysql:8.0\n```\n\n!!! note \"MySQL ç’°å¢ƒè®Šæ•¸èªªæ˜\"\n    | ç’°å¢ƒè®Šæ•¸ | èªªæ˜ |\n    |----------|------|\n    | `MYSQL_ROOT_PASSWORD` | root å¯†ç¢¼ï¼ˆå¿…å¡«ï¼‰ |\n    | `MYSQL_DATABASE` | è‡ªå‹•å»ºç«‹çš„è³‡æ–™åº« |\n    | `MYSQL_USER` | è‡ªå‹•å»ºç«‹çš„ä½¿ç”¨è€… |\n    | `MYSQL_PASSWORD` | ä½¿ç”¨è€…å¯†ç¢¼ |\n\n#### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• WordPress å®¹å™¨\n\n```bash title=\"å•Ÿå‹• WordPress\"\ndocker run -d \\\n  --name wp-app \\\n  --network wp-network \\\n  -p 8080:80 \\\n  -v wordpress-data:/var/www/html \\\n  -e WORDPRESS_DB_HOST=wp-mysql:3306 \\\n  -e WORDPRESS_DB_NAME=wordpress \\\n  -e WORDPRESS_DB_USER=wpuser \\\n  -e WORDPRESS_DB_PASSWORD=wppassword \\\n  wordpress:latest\n```\n\n#### æ­¥é©Ÿ 4ï¼šé©—è­‰éƒ¨ç½²\n\n```bash title=\"é©—è­‰å®¹å™¨ç‹€æ…‹\"\n# æª¢æŸ¥å®¹å™¨æ˜¯å¦é‹è¡Œ\ndocker ps\n\n# æª¢æŸ¥å®¹å™¨æ—¥èªŒ\ndocker logs wp-mysql\ndocker logs wp-app\n\n# æ¸¬è©¦ MySQL é€£ç·š\ndocker exec wp-mysql mysql -uwpuser -pwppassword -e \"SHOW DATABASES;\"\n```\n\n#### æ­¥é©Ÿ 5ï¼šå­˜å– WordPress\n\né–‹å•Ÿç€è¦½å™¨ï¼Œå‰å¾€ `http://localhost:8080`ï¼Œå®Œæˆ WordPress å®‰è£ç²¾éˆã€‚\n\n### ä½¿ç”¨ Docker Composeï¼ˆé¡å¤–èªªæ˜ï¼‰\n\n!!! tip \"æ›´ç°¡æ½”çš„æ–¹å¼\"\n    ä½¿ç”¨ Docker Compose å¯ä»¥å°‡ä»¥ä¸Šæ‰€æœ‰è¨­å®šé›†ä¸­åœ¨ä¸€å€‹æª”æ¡ˆä¸­ã€‚\n\n```yaml title=\"docker-compose.yml\"\nversion: '3.8'\n\nservices:\n  db:\n    image: mysql:8.0\n    container_name: wp-mysql\n    volumes:\n      - mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpassword\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wpuser\n      MYSQL_PASSWORD: wppassword\n    networks:\n      - wp-network\n\n  wordpress:\n    image: wordpress:latest\n    container_name: wp-app\n    depends_on:\n      - db\n    ports:\n      - \"8080:80\"\n    volumes:\n      - wordpress-data:/var/www/html\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_NAME: wordpress\n      WORDPRESS_DB_USER: wpuser\n      WORDPRESS_DB_PASSWORD: wppassword\n    networks:\n      - wp-network\n\nnetworks:\n  wp-network:\n    driver: bridge\n\nvolumes:\n  mysql-data:\n  wordpress-data:\n```\n\n```bash title=\"ä½¿ç”¨ Docker Compose å•Ÿå‹•\"\n# å•Ÿå‹•æ‰€æœ‰æœå‹™\ndocker compose up -d\n\n# æª¢è¦–ç‹€æ…‹\ndocker compose ps\n\n# æª¢è¦–æ—¥èªŒ\ndocker compose logs -f\n\n# åœæ­¢ä¸¦ç§»é™¤\ndocker compose down\n\n# åœæ­¢ä¸¦ç§»é™¤ï¼ˆåŒ…å« Volumeï¼‰\ndocker compose down -v\n```\n\n### æ¸…ç†è³‡æº\n\n```bash title=\"æ¸…ç†å¯¦ä½œç’°å¢ƒ\"\n# åœæ­¢å®¹å™¨\ndocker stop wp-app wp-mysql\n\n# åˆªé™¤å®¹å™¨\ndocker rm wp-app wp-mysql\n\n# åˆªé™¤ç¶²è·¯\ndocker network rm wp-network\n\n# åˆªé™¤ Volumeï¼ˆè­¦å‘Šï¼šæœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼‰\ndocker volume rm mysql-data wordpress-data\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šContainer å•Ÿå‹•å¾Œç«‹å³é€€å‡ºæ€éº¼è¾¦ï¼Ÿ\"\n    **è¨ºæ–·æ­¥é©Ÿ**ï¼š\n    ```bash\n    # æª¢è¦–å®¹å™¨æ—¥èªŒ\n    docker logs container-name\n    \n    # æª¢è¦–å®¹å™¨è©³ç´°è³‡è¨Š\n    docker inspect container-name\n    \n    # æª¢è¦–æœ€å¾Œé€€å‡ºç‹€æ…‹\n    docker ps -a --filter \"name=container-name\"\n    ```\n    \n    **å¸¸è¦‹åŸå› **ï¼š\n    \n    - å•Ÿå‹•æŒ‡ä»¤éŒ¯èª¤\n    - ç’°å¢ƒè®Šæ•¸ç¼ºå¤±\n    - ä¾è³´æœå‹™æœªå°±ç·’\n    - è¨­å®šæª”éŒ¯èª¤\n\n??? question \"Q2ï¼šå¦‚ä½•è®“å®¹å™¨åœ¨ä¸»æ©Ÿé‡å•Ÿå¾Œè‡ªå‹•å•Ÿå‹•ï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ `--restart` é¸é …\n    ```bash\n    # always: ç¸½æ˜¯é‡å•Ÿ\n    docker run -d --restart=always nginx\n    \n    # unless-stopped: é™¤éæ‰‹å‹•åœæ­¢\n    docker run -d --restart=unless-stopped nginx\n    \n    # on-failure: åªåœ¨ç•°å¸¸é€€å‡ºæ™‚é‡å•Ÿ\n    docker run -d --restart=on-failure:3 nginx\n    ```\n\n??? question \"Q3ï¼šVolume è³‡æ–™å¦‚ä½•å‚™ä»½ï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æ–¹æ³• 1ï¼šä½¿ç”¨è‡¨æ™‚å®¹å™¨å‚™ä»½\n    docker run --rm \\\n      -v mysql-data:/source:ro \\\n      -v $(pwd):/backup \\\n      alpine tar cvf /backup/mysql-backup.tar /source\n    \n    # æ–¹æ³• 2ï¼šä½¿ç”¨ docker cpï¼ˆéœ€è¦å…ˆæ›è¼‰åˆ°å®¹å™¨ï¼‰\n    docker cp container-name:/var/lib/mysql ./mysql-backup\n    ```\n\n??? question \"Q4ï¼šå¦‚ä½•æŸ¥çœ‹ Docker ä½”ç”¨çš„ç£ç¢Ÿç©ºé–“ï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æª¢è¦–æ•´é«”ä½¿ç”¨æƒ…æ³\n    docker system df\n    \n    # è©³ç´°è³‡è¨Š\n    docker system df -v\n    \n    # æ¸…ç†æœªä½¿ç”¨çš„è³‡æº\n    docker system prune\n    \n    # æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨è³‡æºï¼ˆåŒ…å« Volumeï¼‰\n    docker system prune -a --volumes\n    ```\n\n??? question \"Q5ï¼šå®¹å™¨é–“ç„¡æ³•é€šè¨Šæ€éº¼è¾¦ï¼Ÿ\"\n    **è¨ºæ–·æ­¥é©Ÿ**ï¼š\n    ```bash\n    # 1. ç¢ºèªå®¹å™¨åœ¨åŒä¸€å€‹ç¶²è·¯\n    docker network inspect my-network\n    \n    # 2. ç¢ºèªå®¹å™¨ IP\n    docker inspect --format='{{.NetworkSettings.IPAddress}}' container-name\n    \n    # 3. åœ¨å®¹å™¨å…§æ¸¬è©¦é€£ç·š\n    docker exec container1 ping container2\n    \n    # 4. ç¢ºèª Port æ˜¯å¦é–‹æ”¾\n    docker exec container1 nc -zv container2 port\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Registry é¡å‹**ï¼šPublic Registryï¼ˆå¦‚ Docker Hubï¼‰èˆ‡ Private Registryï¼ˆå¦‚ Harborï¼‰\n- âœ… **Container ç®¡ç†**ï¼šrunã€execã€logsã€inspect ç­‰æ ¸å¿ƒæŒ‡ä»¤\n- âœ… **æŒä¹…åŒ–å„²å­˜**ï¼šVolumeï¼ˆDocker ç®¡ç†ï¼‰vs Bind Mountï¼ˆä¸»æ©Ÿç›®éŒ„ï¼‰\n- âœ… **Docker ç¶²è·¯**ï¼šbridgeã€hostã€none ç¶²è·¯é¡å‹ï¼Œè‡ªè¨‚ç¶²è·¯å¯¦ç¾å®¹å™¨é–“é€šè¨Š\n- âœ… **Image æ“ä½œ**ï¼šsearchã€pullã€pushã€tag å®Œæ•´æµç¨‹\n- âœ… **å¯¦ä½œç¶“é©—**ï¼šWordPress + MySQL å®¹å™¨åŒ–éƒ¨ç½²\n\n## å»¶ä¼¸é–±è®€\n\n- [Docker å®˜æ–¹æ–‡ä»¶ - Storage](https://docs.docker.com/storage/)\n- [Docker å®˜æ–¹æ–‡ä»¶ - Networking](https://docs.docker.com/network/)\n- [Docker Hub å®˜æ–¹ç¶²ç«™](https://hub.docker.com/)\n- [Harbor - ä¼æ¥­ç´š Registry](https://goharbor.io/)\n- [Docker Compose å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/compose/)\n"
  },
  {
    "title": "æŸ¥çœ‹ä¸»æ©Ÿåç¨±",
    "url": "https://caocharles.github.io/dcka-class-notes/lab06_docker_basics/",
    "content": "ï»¿# LAB 06 Docker åŸºæœ¬æ“ä½œ\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ `docker run` å•Ÿå‹•å®¹å™¨\n- [ ] ä½¿ç”¨ `docker ps` æŸ¥çœ‹å®¹å™¨ç‹€æ…‹\n- [ ] ä½¿ç”¨ `docker logs` æŸ¥çœ‹å®¹å™¨æ—¥èªŒ\n- [ ] ä½¿ç”¨ `docker inspect` æŸ¥çœ‹å®¹å™¨è©³ç´°è³‡è¨Š\n- [ ] ä½¿ç”¨ `docker exec` é€²å…¥é‹è¡Œä¸­çš„å®¹å™¨\n- [ ] ç†è§£ç’°å¢ƒè®Šæ•¸ `-e` çš„ä½¿ç”¨\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 05 Private Registry å»ºç½®\n- Docker å·²å®‰è£ä¸¦æ­£å¸¸é‹è¡Œ\n- å·²è¨­å®š Private Registryï¼ˆinsecure-registriesï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### Docker å®¹å™¨ç”Ÿå‘½é€±æœŸ\n\n```mermaid\ngraph LR\n    Image[\"æ˜ åƒæª”\"] --> Create[\"å»ºç«‹\"]\n    Create --> Running[\"é‹è¡Œä¸­\"]\n    Running --> Stopped[\"åœæ­¢\"]\n    Stopped --> Running\n    Stopped --> Removed[\"åˆªé™¤\"]\n    Running --> Removed\n```\n\n### å¸¸ç”¨ Docker æŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `docker run` | å»ºç«‹ä¸¦å•Ÿå‹•å®¹å™¨ |\n| `docker ps` | åˆ—å‡ºé‹è¡Œä¸­çš„å®¹å™¨ |\n| `docker ps -a` | åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…å«åœæ­¢çš„ï¼‰ |\n| `docker logs` | æŸ¥çœ‹å®¹å™¨æ—¥èªŒ |\n| `docker inspect` | æŸ¥çœ‹å®¹å™¨è©³ç´°è³‡è¨Š |\n| `docker exec` | åœ¨é‹è¡Œä¸­çš„å®¹å™¨åŸ·è¡ŒæŒ‡ä»¤ |\n| `docker stop` | åœæ­¢å®¹å™¨ |\n| `docker rm` | åˆªé™¤å®¹å™¨ |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! note \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab åœ¨ **docker2** è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• MySQL å®¹å™¨ï¼ˆèƒŒæ™¯åŸ·è¡Œï¼‰\n\nä½¿ç”¨ `-itd` åƒæ•¸åœ¨èƒŒæ™¯å•Ÿå‹• MySQL å®¹å™¨ï¼š\n\n```bash title=\"å•Ÿå‹• MySQL å®¹å™¨\"\ndocker run -itd -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.6\n```\n\n**åƒæ•¸èªªæ˜**ï¼š\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `-i` | ä¿æŒæ¨™æº–è¼¸å…¥é–‹å•Ÿï¼ˆinteractiveï¼‰ |\n| `-t` | åˆ†é…å½çµ‚ç«¯ï¼ˆttyï¼‰ |\n| `-d` | èƒŒæ™¯åŸ·è¡Œï¼ˆdetachedï¼‰ |\n| `-e` | è¨­å®šç’°å¢ƒè®Šæ•¸ |\n\n!!! info \"MYSQL_ROOT_PASSWORD\"\n    MySQL å®¹å™¨**å¿…é ˆ**æŒ‡å®š `MYSQL_ROOT_PASSWORD` ç’°å¢ƒè®Šæ•¸ï¼Œå¦å‰‡å®¹å™¨æœƒå•Ÿå‹•å¤±æ•—ã€‚\n\né©—è­‰ï¼š\n\n```bash title=\"æª¢æŸ¥é‹è¡Œä¸­çš„å®¹å™¨\"\ndocker ps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCONTAINER ID   IMAGE                                    COMMAND                  STATUS         PORTS      NAMES\na28f39cbe620   docker1.training.lab:5000/mysql:5.6     \"docker-entrypoint.sâ€¦\"   Up 10 seconds  3306/tcp   pensive_einstein\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šä½¿ç”¨ --name æŒ‡å®šå®¹å™¨åç¨±\n\nå•Ÿå‹•ç¬¬äºŒå€‹ MySQL å®¹å™¨ï¼Œä¸¦æŒ‡å®šåç¨±ï¼š\n\n```bash title=\"å•Ÿå‹•ä¸¦å‘½åå®¹å™¨\"\ndocker run -itd --name mysql-2 -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.5\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æª¢æŸ¥å®¹å™¨\"\ndocker ps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCONTAINER ID   IMAGE                                    COMMAND                  STATUS         NAMES\n4ba163c72270   docker1.training.lab:5000/mysql:5.5     \"docker-entrypoint.sâ€¦\"   Up 5 seconds   mysql-2\na28f39cbe620   docker1.training.lab:5000/mysql:5.6     \"docker-entrypoint.sâ€¦\"   Up 2 minutes   pensive_einstein\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹å®¹å™¨æ—¥èªŒ\n\nä½¿ç”¨ `docker logs` æŸ¥çœ‹å®¹å™¨çš„è¼¸å‡ºæ—¥èªŒï¼š\n\n```bash title=\"æŸ¥çœ‹ mysql-2 æ—¥èªŒ\"\ndocker logs mysql-2\n```\n\n**é æœŸçµæœ**ï¼ˆéƒ¨åˆ†ï¼‰ï¼š\n\n```\nInitializing database\n...\nMySQL init process done. Ready for start up.\n...\nmysqld: ready for connections.\nVersion: '5.5.62'  socket: '/tmp/mysql.sock'  port: 3306  MySQL Community Server (GPL)\n```\n\n!!! tip \"å³æ™‚è¿½è¹¤æ—¥èªŒ\"\n    ä½¿ç”¨ `-f` åƒæ•¸å¯ä»¥å³æ™‚è¿½è¹¤æ—¥èªŒè¼¸å‡ºï¼š\n    ```bash\n    docker logs -f mysql-2\n    ```\n    æŒ‰ `Ctrl+C` åœæ­¢è¿½è¹¤ã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šä½¿ç”¨ docker inspect æŸ¥çœ‹å®¹å™¨è©³ç´°è³‡è¨Š\n\n`docker inspect` æœƒè¼¸å‡ºå®¹å™¨çš„å®Œæ•´ JSON è³‡è¨Šï¼š\n\n```bash title=\"æŸ¥çœ‹å®Œæ•´è³‡è¨Š\"\ndocker inspect mysql-2\n```\n\nè¼¸å‡ºå…§å®¹éå¸¸é•·ï¼ŒåŒ…å«ï¼š\n\n- **State**ï¼šå®¹å™¨ç‹€æ…‹ï¼ˆé‹è¡Œä¸­ã€åœæ­¢ç­‰ï¼‰\n- **Config**ï¼šå®¹å™¨è¨­å®šï¼ˆç’°å¢ƒè®Šæ•¸ã€æŒ‡ä»¤ç­‰ï¼‰\n- **NetworkSettings**ï¼šç¶²è·¯è¨­å®šï¼ˆIP ä½å€ç­‰ï¼‰\n- **Mounts**ï¼šæ›è¼‰çš„ Volume\n\n---\n\n### æ­¥é©Ÿ 5ï¼šä½¿ç”¨ -f æ ¼å¼åŒ–è¼¸å‡º\n\nä½¿ç”¨ `-f` åƒæ•¸æ­é… Go Template èªæ³•ï¼Œå¯ä»¥åªå–å‡ºéœ€è¦çš„è³‡è¨Šï¼š\n\n```bash title=\"å–å¾—å®¹å™¨ IP ä½å€\"\ndocker inspect -f '{{ .NetworkSettings.IPAddress }}' mysql-2\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n172.17.0.3\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ `grep` éæ¿¾ï¼š\n\n```bash title=\"ä½¿ç”¨ grep éæ¿¾\"\ndocker inspect mysql-2 | grep -i ipadd\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n            \"SecondaryIPAddresses\": null,\n            \"IPAddress\": \"172.17.0.3\",\n                    \"IPAddress\": \"172.17.0.3\",\n```\n\n---\n\n### æ­¥é©Ÿ 6ï¼šä½¿ç”¨ docker exec é€²å…¥å®¹å™¨\n\nä½¿ç”¨ `docker exec` å¯ä»¥åœ¨é‹è¡Œä¸­çš„å®¹å™¨å…§åŸ·è¡ŒæŒ‡ä»¤ï¼š\n\n```bash title=\"é€²å…¥å®¹å™¨åŸ·è¡Œ bash\"\ndocker exec -it mysql-2 /bin/bash\n```\n\né€²å…¥å®¹å™¨å¾Œï¼Œå¯ä»¥åŸ·è¡Œå„ç¨®æŒ‡ä»¤ï¼š\n\n```bash title=\"åœ¨å®¹å™¨å…§æ“ä½œ\"\n# æŸ¥çœ‹ä¸»æ©Ÿåç¨±\nhostname\n\n# æŸ¥çœ‹ MySQL ç‰ˆæœ¬\nmysql --version\n\n# é€£ç·šåˆ° MySQL\nmysql -u root -pcontainer\n\n# é€€å‡º MySQL\nexit\n\n# é€€å‡ºå®¹å™¨\nexit\n```\n\n!!! info \"exec vs run\"\n    - `docker run`ï¼šå»ºç«‹**æ–°å®¹å™¨**ä¸¦åŸ·è¡ŒæŒ‡ä»¤\n    - `docker exec`ï¼šåœ¨**å·²é‹è¡Œ**çš„å®¹å™¨ä¸­åŸ·è¡ŒæŒ‡ä»¤\n\n---\n\n### æ­¥é©Ÿ 7ï¼šå•Ÿå‹•å®¹å™¨æ™‚åŸ·è¡Œè‡ªè¨‚æŒ‡ä»¤\n\nå¯ä»¥åœ¨ `docker run` å¾Œé¢æŒ‡å®šè¦åŸ·è¡Œçš„æŒ‡ä»¤ï¼ˆè¦†è“‹é è¨­ CMDï¼‰ï¼š\n\n```bash title=\"å•Ÿå‹•å®¹å™¨ä¸¦é€²å…¥ bash\"\ndocker run -it --name mysql-3 -e MYSQL_ROOT_PASSWORD=container docker1.training.lab:5000/mysql:5.5 /bin/bash\n```\n\né€™æ¨£å®¹å™¨å•Ÿå‹•å¾Œæœƒç›´æ¥é€²å…¥ bashï¼Œè€Œä¸æ˜¯å•Ÿå‹• MySQL æœå‹™ï¼š\n\n```\nroot@6502526623f3:/# hostname\n6502526623f3\nroot@6502526623f3:/# exit\n```\n\n!!! warning \"æ³¨æ„\"\n    ä½¿ç”¨è‡ªè¨‚æŒ‡ä»¤å•Ÿå‹•æ™‚ï¼ŒMySQL æœå‹™ä¸æœƒè‡ªå‹•å•Ÿå‹•ï¼\n\n---\n\n### æ­¥é©Ÿ 8ï¼šåœæ­¢èˆ‡åˆªé™¤å®¹å™¨\n\n```bash title=\"åœæ­¢å®¹å™¨\"\ndocker stop mysql-2 mysql-3\n```\n\n```bash title=\"åˆªé™¤å®¹å™¨\"\ndocker rm mysql-2 mysql-3\n```\n\nä¸€æ¬¡åˆªé™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ï¼š\n\n```bash title=\"åˆªé™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨\"\ndocker rm $(docker ps -aq -f status=exited)\n```\n\n---\n\n## æ¸…ç†è…³æœ¬\n\nå»ºç«‹ä¸€å€‹æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œæ˜ åƒæª”çš„è…³æœ¬ï¼š\n\n```bash title=\"docker_clean_all.sh\"\n#!/bin/bash\n# åœæ­¢æ‰€æœ‰å®¹å™¨\ndocker stop $(docker ps -aq)\n# åˆªé™¤æ‰€æœ‰å®¹å™¨\ndocker rm $(docker ps -aq)\n# åˆªé™¤æ‰€æœ‰æ˜ åƒæª”\ndocker rmi -f $(docker images -aq)\n```\n\n```bash title=\"è¨­å®šåŸ·è¡Œæ¬Šé™\"\nchmod +x docker_clean_all.sh\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šå•Ÿå‹• MySQL å®¹å™¨å¤±æ•—\"\n    **åŸå› **ï¼šæ²’æœ‰è¨­å®š `MYSQL_ROOT_PASSWORD` ç’°å¢ƒè®Šæ•¸\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    docker run -itd -e MYSQL_ROOT_PASSWORD=yourpassword mysql:5.6\n    ```\n\n??? question \"Q2ï¼šdocker exec ç„¡æ³•é€²å…¥å®¹å™¨\"\n    **åŸå› **ï¼šå®¹å™¨å·²åœæ­¢æˆ– bash ä¸å­˜åœ¨\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. ç¢ºèªå®¹å™¨é‹è¡Œä¸­ï¼š`docker ps`\n    2. å¦‚æœæ²’æœ‰ bashï¼Œå˜—è©¦ `/bin/sh`\n\n??? question \"Q3ï¼šå®¹å™¨åç¨±è¡çª\"\n    **éŒ¯èª¤è¨Šæ¯**ï¼š`Conflict. The container name \"xxx\" is already in use`\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # åˆªé™¤èˆŠå®¹å™¨\n    docker rm xxx\n    # æˆ–ä½¿ç”¨ä¸åŒåç¨±\n    docker run --name xxx-new ...\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **docker run**ï¼šä½¿ç”¨ `-itd` èƒŒæ™¯åŸ·è¡Œï¼Œ`--name` å‘½åï¼Œ`-e` è¨­å®šç’°å¢ƒè®Šæ•¸\n- âœ… **docker logs**ï¼šæŸ¥çœ‹å®¹å™¨æ—¥èªŒï¼Œ`-f` å³æ™‚è¿½è¹¤\n- âœ… **docker inspect**ï¼šæŸ¥çœ‹å®¹å™¨è©³ç´°è³‡è¨Šï¼Œ`-f` æ ¼å¼åŒ–è¼¸å‡º\n- âœ… **docker exec**ï¼šé€²å…¥é‹è¡Œä¸­çš„å®¹å™¨åŸ·è¡ŒæŒ‡ä»¤\n\n## å»¶ä¼¸é–±è®€\n\n- [Docker run å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/engine/reference/run/)\n- [Docker exec å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/engine/reference/commandline/exec/)\n- [Docker logs å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/engine/reference/commandline/logs/)\n"
  },
  {
    "title": "åˆªé™¤æœªä½¿ç”¨çš„ Volume",
    "url": "https://caocharles.github.io/dcka-class-notes/lab07_persistent_storage/",
    "content": "ï»¿# LAB 07 Persistent Storage\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ Docker Volume çš„ç”¨é€”\n- [ ] ä½¿ç”¨ `-v` åƒæ•¸æ›è¼‰ç›®éŒ„\n- [ ] ä½¿ç”¨ Docker Volume ç®¡ç†è³‡æ–™æŒä¹…åŒ–\n- [ ] å¯¦ä½œ MariaDB è³‡æ–™æŒä¹…åŒ–\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 06 Docker åŸºæœ¬æ“ä½œ\n- ç†Ÿæ‚‰ `docker run` æŒ‡ä»¤\n- æº–å‚™å¥½ docker2 è™›æ“¬æ©Ÿç’°å¢ƒ\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### ç‚ºä»€éº¼éœ€è¦ Persistent Storageï¼Ÿ\n\nDocker å®¹å™¨æ˜¯ã€Œç„¡ç‹€æ…‹ã€çš„ï¼Œç•¶å®¹å™¨è¢«åˆªé™¤æ™‚ï¼Œå®¹å™¨å…§çš„æ‰€æœ‰è³‡æ–™ä¹Ÿæœƒä¸€ä½µæ¶ˆå¤±ã€‚å°æ–¼è³‡æ–™åº«é€™é¡éœ€è¦æŒä¹…åŒ–è³‡æ–™çš„æ‡‰ç”¨ï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨ **Volume** ä¾†ä¿å­˜è³‡æ–™ã€‚\n\n```mermaid\ngraph TB\n    subgraph problem[\"å•é¡Œï¼šè³‡æ–™éš¨å®¹å™¨æ¶ˆå¤±\"]\n        C1[\"å®¹å™¨ 1\"] --> Data1[\"è³‡æ–™\"]\n        C1 --> |åˆªé™¤| Gone[\"è³‡æ–™æ¶ˆå¤± âŒ\"]\n    end\n    \n    subgraph solution[\"è§£æ±ºï¼šä½¿ç”¨ Volume\"]\n        C2[\"å®¹å™¨ 2\"] --> Volume[\"Volume\"]\n        Volume --> Host[\"/docker_data\"]\n        C2 --> |åˆªé™¤| Keep[\"è³‡æ–™ä¿ç•™ âœ…\"]\n    end\n```\n\n### Volume é¡å‹\n\n| é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |\n|------|------|------|\n| **Bind Mount** | æ›è¼‰ä¸»æ©Ÿç›®éŒ„ | `-v /host/path:/container/path` |\n| **Named Volume** | Docker ç®¡ç†çš„ Volume | `-v myvolume:/container/path` |\n| **Anonymous Volume** | è‡ªå‹•å»ºç«‹çš„ Volume | æ˜ åƒæª”ä¸­ VOLUME æŒ‡ä»¤å®šç¾© |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! note \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab åœ¨ **docker2** è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šæº–å‚™ä¸»æ©Ÿç›®éŒ„\n\nåœ¨ä¸»æ©Ÿä¸Šå»ºç«‹ç”¨æ–¼å­˜æ”¾è³‡æ–™åº«è³‡æ–™çš„ç›®éŒ„ï¼š\n\n```bash title=\"å»ºç«‹è³‡æ–™ç›®éŒ„\"\nmkdir -p /docker_data/db1\n```\n\n```bash title=\"ç¢ºèªç›®éŒ„\"\nls -l /docker_data/\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ntotal 0\ndrwxr-xr-x 2 root root 6 Feb  4 12:22 db1\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå•Ÿå‹• MariaDB ä¸¦æ›è¼‰ Volume\n\nä½¿ç”¨ `-v` åƒæ•¸å°‡ä¸»æ©Ÿç›®éŒ„æ›è¼‰åˆ°å®¹å™¨å…§ï¼š\n\n```bash title=\"ä¸‹è¼‰ MariaDB æ˜ åƒæª”\"\ndocker pull docker1.training.lab:5000/mariadb\n```\n\n```bash title=\"å•Ÿå‹• MariaDB ä¸¦æ›è¼‰ Volume\"\ndocker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n```\n\n**åƒæ•¸èªªæ˜**ï¼š\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `-p 3306:3306` | å°‡ä¸»æ©Ÿ 3306 åŸ å°æ‡‰åˆ°å®¹å™¨ 3306 åŸ  |\n| `-v /docker_data/db1:/var/lib/mysql` | æ›è¼‰ä¸»æ©Ÿç›®éŒ„åˆ°å®¹å™¨çš„ MySQL è³‡æ–™ç›®éŒ„ |\n| `-e MYSQL_ROOT_PASSWORD=container` | è¨­å®š root å¯†ç¢¼ |\n\n---\n\n### æ­¥é©Ÿ 3ï¼šç¢ºèªè³‡æ–™å·²å¯«å…¥ä¸»æ©Ÿç›®éŒ„\n\nç­‰å¾…å®¹å™¨å•Ÿå‹•å®Œæˆå¾Œï¼Œæª¢æŸ¥ä¸»æ©Ÿç›®éŒ„ï¼š\n\n```bash title=\"æª¢æŸ¥è³‡æ–™ç›®éŒ„\"\nls -l /docker_data/db1/\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ntotal 122928\n-rw-rw---- 1 systemd-coredump root    417792 Feb  4 12:24 aria_log.00000001\n-rw-rw---- 1 systemd-coredump root        52 Feb  4 12:24 aria_log_control\n-rw-rw---- 1 systemd-coredump root         0 Feb  4 12:24 multi-master.info\ndrwx------ 2 systemd-coredump root      4096 Feb  4 12:24 mysql\ndrwx------ 2 systemd-coredump root        20 Feb  4 12:24 performance_schema\n...\n```\n\n!!! success \"è³‡æ–™æŒä¹…åŒ–æˆåŠŸ\"\n    çœ‹åˆ°é€™äº›æª”æ¡ˆè¡¨ç¤º MariaDB çš„è³‡æ–™å·²ç¶“å¯«å…¥åˆ°ä¸»æ©Ÿçš„ `/docker_data/db1` ç›®éŒ„ä¸­ï¼\n\n---\n\n### æ­¥é©Ÿ 4ï¼šé©—è­‰è³‡æ–™æŒä¹…åŒ–\n\nå»ºç«‹æ¸¬è©¦è³‡æ–™åº«ï¼š\n\n```bash title=\"é€£ç·šåˆ° MariaDB\"\ndocker exec -it db1 mysql -u root -pcontainer\n```\n\n```sql title=\"å»ºç«‹æ¸¬è©¦è³‡æ–™åº«\"\nCREATE DATABASE testdb;\nSHOW DATABASES;\nEXIT;\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| testdb             |\n+--------------------+\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šåˆªé™¤å®¹å™¨ä¸¦é‡æ–°å»ºç«‹\n\nåˆªé™¤å®¹å™¨ï¼š\n\n```bash title=\"åœæ­¢ä¸¦åˆªé™¤å®¹å™¨\"\ndocker stop db1\ndocker rm db1\n```\n\né‡æ–°å»ºç«‹å®¹å™¨ï¼ˆä½¿ç”¨ç›¸åŒçš„ Volumeï¼‰ï¼š\n\n```bash title=\"é‡æ–°å»ºç«‹å®¹å™¨\"\ndocker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n```\n\né©—è­‰è³‡æ–™æ˜¯å¦ä¿ç•™ï¼š\n\n```bash title=\"ç¢ºèªè³‡æ–™åº«ä»ç„¶å­˜åœ¨\"\ndocker exec -it db1 mysql -u root -pcontainer -e \"SHOW DATABASES;\"\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| testdb             |   <-- è³‡æ–™ä¿ç•™ï¼\n+--------------------+\n```\n\n!!! success \"è³‡æ–™æŒä¹…åŒ–é©—è­‰æˆåŠŸ\"\n    å³ä½¿å®¹å™¨è¢«åˆªé™¤é‡å»ºï¼Œè³‡æ–™ä»ç„¶ä¿ç•™ï¼\n\n---\n\n### æ­¥é©Ÿ 6ï¼šæŸ¥çœ‹ Docker Volume\n\nä½¿ç”¨ `docker volume` æŒ‡ä»¤ç®¡ç† Volumeï¼š\n\n```bash title=\"åˆ—å‡ºæ‰€æœ‰ Volume\"\ndocker volume ls\n```\n\n```bash title=\"æª¢æŸ¥å®¹å™¨çš„ Volume æ›è¼‰\"\ndocker inspect db1 | grep -A 10 Mounts\n```\n\n**é æœŸçµæœ**ï¼š\n\n```json\n\"Mounts\": [\n    {\n        \"Type\": \"bind\",\n        \"Source\": \"/docker_data/db1\",\n        \"Destination\": \"/var/lib/mysql\",\n        \"Mode\": \"\",\n        \"RW\": true,\n        \"Propagation\": \"rprivate\"\n    }\n],\n```\n\n---\n\n### æ­¥é©Ÿ 7ï¼šä½¿ç”¨ Named Volume\n\né™¤äº† Bind Mountï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Docker ç®¡ç†çš„ Named Volumeï¼š\n\n```bash title=\"å»ºç«‹ Named Volume\"\ndocker volume create mydata\n```\n\n```bash title=\"ä½¿ç”¨ Named Volume\"\ndocker run -itd \\\n  --name db2 \\\n  -v mydata:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n```\n\n```bash title=\"æŸ¥çœ‹ Volume è©³ç´°è³‡è¨Š\"\ndocker volume inspect mydata\n```\n\n**é æœŸçµæœ**ï¼š\n\n```json\n[\n    {\n        \"CreatedAt\": \"2025-02-04T12:30:00+08:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {},\n        \"Mountpoint\": \"/var/lib/docker/volumes/mydata/_data\",\n        \"Name\": \"mydata\",\n        \"Options\": {},\n        \"Scope\": \"local\"\n    }\n]\n```\n\n---\n\n## Bind Mount vs Named Volume\n\n| ç‰¹æ€§ | Bind Mount | Named Volume |\n|------|------------|--------------|\n| è·¯å¾‘æŒ‡å®š | å¿…é ˆæŒ‡å®šå®Œæ•´è·¯å¾‘ | åªéœ€æŒ‡å®šåç¨± |\n| è³‡æ–™ä½ç½® | è‡ªè¨‚è·¯å¾‘ | `/var/lib/docker/volumes/` |\n| å‚™ä»½æ–¹ä¾¿æ€§ | è¼ƒæ–¹ä¾¿ | éœ€é€é Docker æŒ‡ä»¤ |\n| é©ç”¨å ´æ™¯ | é–‹ç™¼ç’°å¢ƒã€éœ€è¦ç›´æ¥å­˜å– | ç”Ÿç”¢ç’°å¢ƒã€è³‡æ–™éš”é›¢ |\n\n---\n\n## æ¸…ç†è³‡æº\n\n```bash title=\"æ¸…ç†å®¹å™¨å’Œ Volume\"\ndocker stop db1 db2\ndocker rm db1 db2\ndocker volume rm mydata\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šæ›è¼‰ç›®éŒ„å¾Œå®¹å™¨å…§çœ‹ä¸åˆ°è³‡æ–™\"\n    **åŸå› **ï¼šå®¹å™¨å…§åŸæœ‰çš„è³‡æ–™è¢«ä¸»æ©Ÿç©ºç›®éŒ„è¦†è“‹\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ç¢ºä¿ä¸»æ©Ÿç›®éŒ„æ˜¯ç©ºçš„ï¼Œè®“å®¹å™¨åˆå§‹åŒ–è³‡æ–™\n\n??? question \"Q2ï¼šæ¬Šé™å•é¡Œå°è‡´ç„¡æ³•å¯«å…¥\"\n    **åŸå› **ï¼šä¸»æ©Ÿç›®éŒ„æ¬Šé™ä¸è¶³\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    chmod 777 /docker_data/db1\n    ```\n\n??? question \"Q3ï¼šVolume ä½”ç”¨ç©ºé–“å¦‚ä½•æ¸…ç†\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # åˆªé™¤æœªä½¿ç”¨çš„ Volume\n    docker volume prune\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Bind Mount**ï¼šä½¿ç”¨ `-v /host/path:/container/path` æ›è¼‰ä¸»æ©Ÿç›®éŒ„\n- âœ… **Named Volume**ï¼šä½¿ç”¨ `docker volume create` å»ºç«‹ç®¡ç†å‹ Volume\n- âœ… **è³‡æ–™æŒä¹…åŒ–**ï¼šå®¹å™¨åˆªé™¤å¾Œè³‡æ–™ä»ä¿ç•™åœ¨ Volume ä¸­\n- âœ… **Volume ç®¡ç†**ï¼šä½¿ç”¨ `docker volume ls/inspect/rm/prune` ç®¡ç†\n\n## å»¶ä¼¸é–±è®€\n\n- [Docker Volume å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/storage/volumes/)\n- [Bind Mounts å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/storage/bind-mounts/)\n"
  },
  {
    "title": "ç¢ºèªå®¹å™¨é‹è¡Œä¸­",
    "url": "https://caocharles.github.io/dcka-class-notes/lab08_wordpress/",
    "content": "ï»¿# LAB 08 æ¶è¨­éƒ¨è½æ ¼ - WordPress\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ `--link` é€£æ¥å¤šå€‹å®¹å™¨\n- [ ] éƒ¨ç½² WordPress + MariaDB æ¶æ§‹\n- [ ] è¨­å®š WordPress ç’°å¢ƒè®Šæ•¸\n- [ ] å®Œæˆ WordPress åˆå§‹åŒ–è¨­å®š\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 07 Persistent Storage\n- ç†Ÿæ‚‰ Docker Volume æ›è¼‰\n- æº–å‚™å¥½ docker2 è™›æ“¬æ©Ÿç’°å¢ƒ\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### WordPress æ¶æ§‹\n\nWordPress æ˜¯ä¸€å€‹é–‹æºçš„éƒ¨è½æ ¼/CMS ç³»çµ±ï¼Œéœ€è¦æ­é…è³‡æ–™åº«ä½¿ç”¨ã€‚æœ¬ Lab å°‡éƒ¨ç½²ï¼š\n\n```mermaid\ngraph LR\n    subgraph docker2[\"docker2 è™›æ“¬æ©Ÿ\"]\n        Browser[\"ç€è¦½å™¨\"] --> WP[\"WordPress\"]\n        WP --> |\"--link\"| DB[\"MariaDB\"]\n        WP --> WPData[\"/docker_data/wordpress\"]\n        DB --> DBData[\"/docker_data/db1\"]\n    end\n```\n\n### å®¹å™¨é–“é€šè¨Š\n\nä½¿ç”¨ `--link` å¯ä»¥è®“å®¹å™¨ä¹‹é–“é€éåç¨±äº’ç›¸å­˜å–ï¼š\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `--link db1:mysql` | é€£æ¥åˆ° db1 å®¹å™¨ï¼Œä¸¦å»ºç«‹åˆ¥å mysql |\n\né€£æ¥å¾Œï¼ŒWordPress å®¹å™¨å¯ä»¥é€é `mysql` é€™å€‹åç¨±å­˜å– MariaDBã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! note \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab åœ¨ **docker2** è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šæº–å‚™è³‡æ–™ç›®éŒ„\n\nå»ºç«‹ WordPress å’Œè³‡æ–™åº«çš„è³‡æ–™ç›®éŒ„ï¼š\n\n```bash title=\"å»ºç«‹è³‡æ–™ç›®éŒ„\"\nmkdir -p /docker_data/db1\nmkdir -p /docker_data/wordpress\n```\n\n```bash title=\"ç¢ºèªç›®éŒ„\"\nls -l /docker_data/\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ntotal 4\ndrwxr-xr-x 4 systemd-coredump root 4096 Feb  4 12:24 db1\ndrwxr-xr-x 2 root             root    6 Feb  4 12:25 wordpress\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå•Ÿå‹• MariaDB è³‡æ–™åº«\n\né¦–å…ˆå•Ÿå‹•è³‡æ–™åº«å®¹å™¨ï¼š\n\n```bash title=\"ä¸‹è¼‰ MariaDB\"\ndocker pull docker1.training.lab:5000/mariadb\n```\n\n```bash title=\"å•Ÿå‹• MariaDB\"\ndocker run -itd \\\n  --name db1 \\\n  -p 3306:3306 \\\n  -v /docker_data/db1:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD=container \\\n  docker1.training.lab:5000/mariadb\n```\n\né©—è­‰è³‡æ–™åº«å•Ÿå‹•ï¼š\n\n```bash title=\"æª¢æŸ¥å®¹å™¨ç‹€æ…‹\"\ndocker ps\n```\n\n```bash title=\"æŸ¥çœ‹æ—¥èªŒç¢ºèªå•Ÿå‹•å®Œæˆ\"\ndocker logs db1\n```\n\n!!! tip \"ç­‰å¾…è³‡æ–™åº«åˆå§‹åŒ–\"\n    é¦–æ¬¡å•Ÿå‹• MariaDB éœ€è¦ä¸€äº›æ™‚é–“åˆå§‹åŒ–ï¼Œè«‹ç­‰å¾…çœ‹åˆ° `ready for connections` è¨Šæ¯å¾Œå†ç¹¼çºŒã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• WordPress\n\nä¸‹è¼‰ä¸¦å•Ÿå‹• WordPress å®¹å™¨ï¼š\n\n```bash title=\"ä¸‹è¼‰ WordPress\"\ndocker pull docker1.training.lab:5000/wordpress\n```\n\n```bash title=\"å•Ÿå‹• WordPress\"\ndocker run -itd \\\n  --name wordpress \\\n  -p 80:80 \\\n  --link db1:mysql \\\n  -v /docker_data/wordpress:/var/www/html \\\n  -e WORDPRESS_DB_NAME=wp \\\n  -e WORDPRESS_DB_USER=root \\\n  -e WORDPRESS_DB_PASSWORD=container \\\n  -e ServerName=localhost \\\n  docker1.training.lab:5000/wordpress\n```\n\n**åƒæ•¸èªªæ˜**ï¼š\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `-p 80:80` | å°‡ä¸»æ©Ÿ 80 åŸ å°æ‡‰åˆ°å®¹å™¨ 80 åŸ  |\n| `--link db1:mysql` | é€£æ¥åˆ° db1 å®¹å™¨ï¼Œåˆ¥åç‚º mysql |\n| `-v /docker_data/wordpress:/var/www/html` | æ›è¼‰ WordPress æª”æ¡ˆç›®éŒ„ |\n| `WORDPRESS_DB_NAME=wp` | WordPress ä½¿ç”¨çš„è³‡æ–™åº«åç¨± |\n| `WORDPRESS_DB_USER=root` | è³‡æ–™åº«ä½¿ç”¨è€… |\n| `WORDPRESS_DB_PASSWORD=container` | è³‡æ–™åº«å¯†ç¢¼ |\n\n---\n\n### æ­¥é©Ÿ 4ï¼šé©—è­‰éƒ¨ç½²\n\næª¢æŸ¥å…©å€‹å®¹å™¨éƒ½åœ¨é‹è¡Œï¼š\n\n```bash title=\"æª¢æŸ¥å®¹å™¨ç‹€æ…‹\"\ndocker ps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCONTAINER ID   IMAGE                                   COMMAND                  STATUS         PORTS                 NAMES\n36aa6bc3480c   docker1.training.lab:5000/wordpress    \"docker-entrypoint.sâ€¦\"   Up 10 seconds  0.0.0.0:80->80/tcp    wordpress\n45f821b7df69   docker1.training.lab:5000/mariadb      \"docker-entrypoint.sâ€¦\"   Up 2 minutes   0.0.0.0:3306->3306/tcp db1\n```\n\næª¢æŸ¥ WordPress æª”æ¡ˆæ˜¯å¦å·²å»ºç«‹ï¼š\n\n```bash title=\"æª¢æŸ¥ WordPress ç›®éŒ„\"\nls -l /docker_data/wordpress/\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ntotal 236\n-rw-r--r--  1 www-data www-data   405 Feb  6  2020 index.php\n-rw-r--r--  1 www-data www-data 19915 Jan  1  2020 license.txt\n-rw-r--r--  1 www-data www-data  7278 Jun 26  2020 readme.html\n-rw-r--r--  1 www-data www-data  7101 Jul 28  2020 wp-activate.php\ndrwxr-xr-x  9 www-data www-data  4096 Dec  8  2020 wp-admin\n...\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šé–‹å•Ÿ WordPress ç¶²é \n\nåœ¨åœ–å½¢ç’°å¢ƒä¸­é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ° docker2ï¼š\n\n```\nhttp://192.168.66.22\n```\n\næˆ–åœ¨æœ¬æ©Ÿï¼š\n\n```\nhttp://localhost\n```\n\nä½ æœƒçœ‹åˆ° WordPress å®‰è£é é¢ï¼\n\n---\n\n### æ­¥é©Ÿ 6ï¼šå®Œæˆ WordPress å®‰è£\n\n1. é¸æ“‡èªè¨€ï¼ˆç¹é«”ä¸­æ–‡ï¼‰\n2. å¡«å¯«ç¶²ç«™è³‡è¨Šï¼š\n   - **ç¶²ç«™æ¨™é¡Œ**ï¼šMy Blog\n   - **ä½¿ç”¨è€…åç¨±**ï¼šadmin\n   - **å¯†ç¢¼**ï¼šè¨­å®šä½ çš„å¯†ç¢¼\n   - **é›»å­éƒµä»¶**ï¼šyour@email.com\n3. é»é¸ã€Œå®‰è£ WordPressã€\n\n!!! success \"å®‰è£å®Œæˆ\"\n    çœ‹åˆ°ã€ŒæˆåŠŸï¼ã€è¨Šæ¯è¡¨ç¤º WordPress å·²å®‰è£å®Œæˆï¼\n\n---\n\n### æ­¥é©Ÿ 7ï¼šé©—è­‰è³‡æ–™æŒä¹…åŒ–\n\nåˆªé™¤ä¸¦é‡å»º WordPress å®¹å™¨ï¼š\n\n```bash title=\"åˆªé™¤ WordPress å®¹å™¨\"\ndocker stop wordpress\ndocker rm wordpress\n```\n\né‡æ–°å»ºç«‹ï¼ˆä½¿ç”¨ç›¸åŒçš„ Volumeï¼‰ï¼š\n\n```bash title=\"é‡æ–°å»ºç«‹ WordPress\"\ndocker run -itd \\\n  --name wordpress \\\n  -p 80:80 \\\n  --link db1:mysql \\\n  -v /docker_data/wordpress:/var/www/html \\\n  -e WORDPRESS_DB_NAME=wp \\\n  -e WORDPRESS_DB_USER=root \\\n  -e WORDPRESS_DB_PASSWORD=container \\\n  docker1.training.lab:5000/wordpress\n```\n\né‡æ–°é–‹å•Ÿç€è¦½å™¨ï¼Œä½ çš„ WordPress ç¶²ç«™å’Œæ‰€æœ‰è¨­å®šéƒ½é‚„åœ¨ï¼\n\n---\n\n## æ¶æ§‹ç¸½è¦½\n\n| å®¹å™¨ | æ˜ åƒæª” | Port | Volume | èªªæ˜ |\n|------|--------|------|--------|------|\n| db1 | mariadb | 3306 | /docker_data/db1 | è³‡æ–™åº« |\n| wordpress | wordpress | 80 | /docker_data/wordpress | ç¶²é ä¼ºæœå™¨ |\n\n---\n\n## æ¸…ç†è³‡æº\n\n```bash title=\"åœæ­¢ä¸¦åˆªé™¤å®¹å™¨\"\ndocker stop wordpress db1\ndocker rm wordpress db1\n```\n\nå¦‚éœ€æ¸…é™¤è³‡æ–™ï¼š\n\n```bash title=\"æ¸…é™¤è³‡æ–™ç›®éŒ„\"\nrm -rf /docker_data/db1/*\nrm -rf /docker_data/wordpress/*\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šWordPress é¡¯ç¤ºç„¡æ³•é€£æ¥è³‡æ–™åº«\"\n    **åŸå› **ï¼šMariaDB å°šæœªå•Ÿå‹•å®Œæˆï¼Œæˆ– --link è¨­å®šéŒ¯èª¤\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. ç¢ºèª db1 å®¹å™¨å·²å•Ÿå‹•ï¼š`docker ps`\n    2. ç¢ºèª --link åƒæ•¸æ­£ç¢ºï¼š`--link db1:mysql`\n    3. ç­‰å¾… MariaDB åˆå§‹åŒ–å®Œæˆå¾Œå†å•Ÿå‹• WordPress\n\n??? question \"Q2ï¼šç„¡æ³•é€£ç·šåˆ° 80 åŸ \"\n    **åŸå› **ï¼šé˜²ç«ç‰†é˜»æ“‹æˆ– WordPress å®¹å™¨æœªå•Ÿå‹•\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # ç¢ºèªå®¹å™¨é‹è¡Œä¸­\n    docker ps\n    \n    # ç¢ºèªåŸ å°æ‡‰\n    docker port wordpress\n    ```\n\n??? question \"Q3ï¼šWordPress å®‰è£å¾Œè³‡æ–™æ¶ˆå¤±\"\n    **åŸå› **ï¼šæ²’æœ‰ä½¿ç”¨ Volume æ›è¼‰\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ç¢ºä¿ä½¿ç”¨ `-v /docker_data/wordpress:/var/www/html` åƒæ•¸\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **--link**ï¼šé€£æ¥å®¹å™¨ï¼Œè®“ WordPress å¯ä»¥å­˜å– MariaDB\n- âœ… **å¤šå®¹å™¨æ¶æ§‹**ï¼šåˆ†é›¢æ‡‰ç”¨ç¨‹å¼å’Œè³‡æ–™åº«\n- âœ… **ç’°å¢ƒè®Šæ•¸**ï¼šé€é `-e` è¨­å®š WordPress è³‡æ–™åº«é€£ç·šè³‡è¨Š\n- âœ… **è³‡æ–™æŒä¹…åŒ–**ï¼šä½¿ç”¨ Volume ä¿å­˜ WordPress æª”æ¡ˆå’Œè³‡æ–™åº«\n\n## å»¶ä¼¸é–±è®€\n\n- [WordPress Docker Hub](https://hub.docker.com/_/wordpress)\n- [MariaDB Docker Hub](https://hub.docker.com/_/mariadb)\n- [Docker Compose ç°¡åŒ–å¤šå®¹å™¨éƒ¨ç½²](https://docs.docker.com/compose/)\n"
  },
  {
    "title": "LAB 09 å®¢è£½åŒ– Container Images - docker commit",
    "url": "https://caocharles.github.io/dcka-class-notes/lab09_commit/",
    "content": "---\nauthors:\n  - name: èª²ç¨‹ä½œè€…\n    email: author@example.com\ndate: 2026-01-27\nupdated: 2026-01-27\ntags:\n  - Docker\n  - Container\n  - Image\n---\n\n# LAB 09 å®¢è£½åŒ– Container Images - docker commit\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ `docker commit` å¾å®¹å™¨å»ºç«‹æ–°çš„ Image\n- [ ] ä½¿ç”¨ `docker save` å°‡ Image åŒ¯å‡ºç‚º tar æª”\n- [ ] ä½¿ç”¨ `docker load` å¾ tar æª”è¼‰å…¥ Image\n- [ ] å»ºç«‹æ¸…ç† Docker ç’°å¢ƒçš„è…³æœ¬\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 06 çš„å…§å®¹\n- ç†Ÿæ‚‰ Docker åŸºæœ¬æ“ä½œ\n- å·²è¨­å®š Private Registryï¼ˆdocker1.training.lab:5000ï¼‰\n\n---\n\n## 9.1 ç’°å¢ƒæº–å‚™\n\n### åˆ‡æ›åˆ° docker2 è™›æ“¬æ©Ÿ\n\næœ¬ Lab åœ¨ docker2 è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n### ç¢ºèªç¾æœ‰ç’°å¢ƒ\n\n```bash title=\"æª¢è¦–ç¾æœ‰çš„ Container Images\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\n192.168.66.51:5000/nginx:1.9.1          667cfe3b0942        289MB          139MB        \ndocker1.training.lab:5000/nginx:1.7.1   b1590b02702d       1.06GB          515MB        \n```\n\n```bash title=\"æª¢è¦–ç¾æœ‰çš„ Container\"\ndocker ps -a\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n```\n\n### å»ºç«‹æ¸…ç†è…³æœ¬\n\nå»ºç«‹ä¸€å€‹è…³æœ¬ä¾†æ¸…ç†æ‰€æœ‰ Container èˆ‡ Imageï¼š\n\n```bash title=\"å»ºç«‹ docker_clean_all.sh\"\nvi docker_clean_all.sh\n```\n\nè…³æœ¬å…§å®¹ï¼š\n\n```bash title=\"docker_clean_all.sh\"\n#!/bin/bash\n# åœæ­¢ä¸¦åˆªé™¤æ‰€æœ‰ Container\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\n# åˆªé™¤æ‰€æœ‰ Image\ndocker rmi $(docker images -q)\n```\n\n!!! note \"è…³æœ¬èªªæ˜\"\n    - `docker ps -aq`ï¼šåˆ—å‡ºæ‰€æœ‰ Container çš„ IDï¼ˆ`-a` åŒ…å«å·²åœæ­¢çš„ï¼Œ`-q` åªé¡¯ç¤º IDï¼‰\n    - `docker images -q`ï¼šåˆ—å‡ºæ‰€æœ‰ Image çš„ ID\n    - å¦‚æœæ²’æœ‰ Container æˆ– Imageï¼ŒæŒ‡ä»¤æœƒé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œä½†ä¸å½±éŸ¿å¾ŒçºŒæ“ä½œ\n\n```bash title=\"è¨­å®šåŸ·è¡Œæ¬Šé™\"\nchmod 755 ./docker_clean_all.sh\n```\n\n```bash title=\"åŸ·è¡Œæ¸…ç†è…³æœ¬\"\n./docker_clean_all.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndocker: 'docker stop' requires at least 1 argument\ndocker: 'docker rm' requires at least 1 argument\nUntagged: 192.168.66.51:5000/nginx:1.9.1\nDeleted: sha256:667cfe3b094262dcd2323f28a800d8376221b017a9dd14b6fff78e4ec96a6177\nUntagged: docker1.training.lab:5000/nginx:1.7.1\nDeleted: sha256:b1590b02702d926755e02ca8f01baa42c9789758a3fb6d40aa87bdcfe871965d\n```\n\n!!! info \"éŒ¯èª¤è¨Šæ¯èªªæ˜\"\n    ç•¶æ²’æœ‰ Container æ™‚ï¼Œ`docker stop` å’Œ `docker rm` æœƒé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±éŸ¿å¾ŒçºŒæ“ä½œã€‚\n\n---\n\n## 9.2 ä¸‹è¼‰ Docker Image\n\n### å¾ Private Registry ä¸‹è¼‰ Alpine\n\n```bash title=\"ä¸‹è¼‰ Alpine Image\"\ndocker pull docker1.training.lab:5000/alpine\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nUsing default tag: latest\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\ndocker1.training.lab:5000/alpine:latest\n```\n\n!!! note \"docker pull èªªæ˜\"\n    - å¦‚æœæ²’æœ‰æŒ‡å®š tagï¼Œé è¨­æœƒä½¿ç”¨ `latest`\n    - å¾ Private Registry ä¸‹è¼‰éœ€è¦æŒ‡å®šå®Œæ•´çš„ Registry ä½å€\n\n```bash title=\"ç¢ºèª Image å·²ä¸‹è¼‰\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB        \n```\n\n---\n\n## 9.3 é€²å…¥ Alpine åŸ·è¡Œ sh\n\n### å•Ÿå‹•äº’å‹•å¼ Container\n\n```bash title=\"å•Ÿå‹• Alpine Container\"\ndocker run -it --name alpine-1 docker1.training.lab:5000/alpine:latest\n```\n\n!!! note \"docker run åƒæ•¸èªªæ˜\"\n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `-i` | ä¿æŒ STDIN é–‹å•Ÿï¼ˆinteractiveï¼‰ |\n    | `-t` | åˆ†é…è™›æ“¬çµ‚ç«¯æ©Ÿï¼ˆttyï¼‰ |\n    | `--name alpine-1` | æŒ‡å®š Container åç¨± |\n\né€²å…¥å®¹å™¨å¾Œæœƒçœ‹åˆ°æç¤ºç¬¦è™Ÿ `/ #`ï¼Œè¡¨ç¤ºå·²åœ¨ Container å…§éƒ¨ã€‚\n\n---\n\n## 9.4 åœ¨ Alpine ä¸­å®‰è£ Bash\n\n### æ¸¬è©¦ Bash æ˜¯å¦å­˜åœ¨\n\n```bash title=\"æ¸¬è©¦ bashï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\nbash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n/bin/sh: bash: not found\n```\n\n!!! info \"ç‚ºä»€éº¼ Alpine æ²’æœ‰ Bashï¼Ÿ\"\n    Alpine Linux æ˜¯ä¸€å€‹æ¥µè¼•é‡çš„ Linux ç™¼è¡Œç‰ˆï¼Œä½¿ç”¨ BusyBox ä½œç‚ºæ ¸å¿ƒå·¥å…·é›†ï¼Œé è¨­åªæä¾› `/bin/sh`ï¼ˆash shellï¼‰ä»¥ç¶­æŒæ¥µå°çš„æ˜ åƒå¤§å°ï¼ˆç´„ 5MBï¼‰ã€‚\n\n### ä½¿ç”¨ apk å®‰è£ Bash\n\n```bash title=\"å®‰è£ bashï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\napk add --no-cache --update-cache bash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.10/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing ncurses-terminfo-base (6.1_p20190518-r2)\n(2/4) Installing ncurses-libs (6.1_p20190518-r2)\n(3/4) Installing readline (8.0.0-r0)\n(4/4) Installing bash (5.0.0-r0)\nExecuting bash-5.0.0-r0.post-install\nExecuting busybox-1.30.1-r2.trigger\nOK: 8 MiB in 18 packages\n```\n\n!!! tip \"apk åƒæ•¸èªªæ˜\"\n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `add` | å®‰è£å¥—ä»¶ |\n    | `--no-cache` | ä¸ä½¿ç”¨æœ¬åœ°å¿«å–ï¼Œæ¸›å°‘ Image å¤§å° |\n    | `--update-cache` | æ›´æ–°å¥—ä»¶ç´¢å¼• |\n\n### é©—è­‰å®‰è£æˆåŠŸ\n\n```bash title=\"åˆ‡æ›åˆ° bashï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\nbash\n```\n\n**é æœŸçµæœ**ï¼š\n\næˆåŠŸé€²å…¥ bashï¼Œæç¤ºç¬¦è™Ÿè®Šæˆ `bash-5.0#`\n\n```bash title=\"é€€å‡º Container\"\nexit  # é€€å‡º bash\nexit  # é€€å‡º Container\n```\n\n---\n\n## 9.5 Commit æ–°çš„ Container Image\n\n### ä½¿ç”¨ docker commit å»ºç«‹æ–° Image\n\n```bash title=\"å»ºç«‹æ–° Image\"\ndocker commit -m \"alpine + bash\" alpine-1 alpine-bash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nsha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n```\n\n!!! note \"docker commit èªæ³•\"\n    ```\n    docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]\n    ```\n    \n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `-m` | æäº¤è¨Šæ¯ï¼ˆæè¿°è®Šæ›´å…§å®¹ï¼‰ |\n    | `-a` | æŒ‡å®šä½œè€…ï¼ˆå¯é¸ï¼‰ |\n    | `alpine-1` | ä¾†æº Container åç¨± |\n    | `alpine-bash` | æ–° Image åç¨±ï¼ˆé è¨­ tag ç‚º latestï¼‰ |\n\n```bash title=\"ç¢ºèªæ–° Image å·²å»ºç«‹\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                                     ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest                        4326afd8916b       14.5MB          6.6MB        \ndocker1.training.lab:5000/alpine:latest   d0a0f8e7bf9a       11.6MB         5.82MB    U   \n```\n\n!!! info \"Image å¤§å°è®ŠåŒ–\"\n    å®‰è£ Bash å¾Œï¼ŒImage å¾ 5.82MB å¢åŠ åˆ° 6.6MBï¼Œå¢åŠ ç´„ 0.78MBï¼ˆä¸»è¦æ˜¯ Bash åŠå…¶ç›¸ä¾å¥—ä»¶ï¼‰ã€‚\n\n---\n\n## 9.6 åŒ¯å‡ºä¸¦å£“ç¸®ç‚º Tar Ball æª”æ¡ˆ\n\n### ä½¿ç”¨ docker save åŒ¯å‡º Image\n\n```bash title=\"åŒ¯å‡º Image ç‚º tar æª”\"\ndocker save --output=alpine-bash.tar alpine-bash\n```\n\n!!! note \"docker save èªæ³•\"\n    ```\n    docker save [OPTIONS] IMAGE [IMAGE...]\n    ```\n    \n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `--output` æˆ– `-o` | æŒ‡å®šè¼¸å‡ºæª”æ¡ˆåç¨± |\n    | å¯ä¸€æ¬¡åŒ¯å‡ºå¤šå€‹ Image | |\n\n```bash title=\"ç¢ºèª tar æª”æ¡ˆå¤§å°\"\nls -lh alpine-bash.tar\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n-rw------- 1 root root 6.3M Jan 27 11:05 alpine-bash.tar\n```\n\n### ä½¿ç”¨ gzip å£“ç¸®\n\n```bash title=\"å£“ç¸® tar æª”æ¡ˆ\"\ngzip -9 alpine-bash.tar\n```\n\n!!! tip \"gzip åƒæ•¸èªªæ˜\"\n    - `-9`ï¼šæœ€é«˜å£“ç¸®æ¯”ï¼ˆ1-9ï¼Œ9 ç‚ºæœ€é«˜ï¼‰\n    - å£“ç¸®å¾Œæª”æ¡ˆæœƒè‡ªå‹•åŠ ä¸Š `.gz` å‰¯æª”å\n\n```bash title=\"ç¢ºèªå£“ç¸®å¾Œå¤§å°\"\nls -lh alpine-bash.tar.gz\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n-rw------- 1 root root 3.4M Jan 27 11:05 alpine-bash.tar.gz\n```\n\n!!! success \"å£“ç¸®æ•ˆæœ\"\n    æª”æ¡ˆå¾ 6.3MB å£“ç¸®åˆ° 3.4MBï¼Œæ¸›å°‘ç´„ 46% çš„ç©ºé–“ã€‚\n\n---\n\n## 9.7 æ¸¬è©¦ - æ¸…é™¤å…¨éƒ¨çš„ Container åŠ Images\n\n```bash title=\"æ¸…é™¤æ‰€æœ‰ Container èˆ‡ Image\"\n./docker_clean_all.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n20fb31307e87\n20fb31307e87\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n```\n\n```bash title=\"ç¢ºèªç’°å¢ƒå·²æ¸…ç†\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n```\n\n---\n\n## 9.8 è¼‰å…¥ Container Image\n\n### ä½¿ç”¨ docker load è¼‰å…¥å£“ç¸®æª”\n\n```bash title=\"å¾å£“ç¸®æª”è¼‰å…¥ Image\"\ndocker load -i alpine-bash.tar.gz\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nLoaded image: alpine-bash:latest\n```\n\n!!! note \"docker load èªæ³•\"\n    ```\n    docker load [OPTIONS]\n    ```\n    \n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `-i` æˆ– `--input` | æŒ‡å®šè¼¸å…¥æª”æ¡ˆ |\n    | æ”¯æ´ `.tar` å’Œ `.tar.gz` æ ¼å¼ | |\n\n```bash title=\"ç¢ºèª Image å·²è¼‰å…¥\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash:latest   4326afd8916b       14.5MB          6.6MB        \n```\n\n---\n\n## 9.9 ç¢ºèªæ˜¯å¦æœ‰ Bash\n\n```bash title=\"ä½¿ç”¨è¼‰å…¥çš„ Image å•Ÿå‹• Container\"\ndocker run -it --name alpine-2 alpine-bash /bin/bash\n```\n\né€²å…¥å®¹å™¨å¾Œæœƒçœ‹åˆ°æç¤ºç¬¦è™Ÿ `bash-5.0#`ï¼Œè¡¨ç¤º Bash å·²æˆåŠŸå®‰è£ã€‚\n\n```bash title=\"ç¢ºèª bash å·²å®‰è£ï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\nls -l /bin/bash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n```\n\n```bash title=\"é€€å‡º Container\"\nexit\n```\n\n---\n\n## 9.10 æ¸…é™¤å…¨éƒ¨çš„ Container åŠ Images\n\n```bash title=\"æœ€çµ‚æ¸…ç†\"\n./docker_clean_all.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndb10817df336\ndb10817df336\nUntagged: alpine-bash:latest\nDeleted: sha256:4326afd8916bbf220fcb95d27fd5cac5096b74fa6ccba7c8929d5a70820875ec\n```\n\n!!! success \"Lab å®Œæˆ\"\n    æ­å–œä½ å·²æˆåŠŸå®Œæˆæœ¬ Labï¼\n\n---\n\n## æŒ‡ä»¤åƒè€ƒ\n\n### docker commit\n\n| é¸é … | èªªæ˜ | ç¯„ä¾‹ |\n|------|------|------|\n| `-m` | æäº¤è¨Šæ¯ | `-m \"alpine + bash\"` |\n| `-a` | æŒ‡å®šä½œè€… | `-a \"John Doe\"` |\n| `-c` | å¥—ç”¨ Dockerfile æŒ‡ä»¤ | `-c 'CMD [\"bash\"]'` |\n| `-p` | æäº¤å‰æš«åœå®¹å™¨ | `-p` |\n\n### docker save èˆ‡ docker load\n\n| æŒ‡ä»¤ | èªªæ˜ | ç¯„ä¾‹ |\n|------|------|------|\n| `docker save` | å°‡ Image åŒ¯å‡ºç‚º tar æª” | `docker save -o image.tar my-image` |\n| `docker load` | å¾ tar æª”è¼‰å…¥ Image | `docker load -i image.tar` |\n\n!!! warning \"docker save vs docker export\"\n    | æ¯”è¼ƒ | docker save | docker export |\n    |------|-------------|---------------|\n    | å°è±¡ | Image | Container |\n    | ä¿ç•™ | å®Œæ•´ Layer èˆ‡ metadata | å–®ä¸€æª”æ¡ˆç³»çµ± |\n    | è¼‰å…¥æŒ‡ä»¤ | docker load | docker import |\n    | ç”¨é€” | Image å‚™ä»½/å‚³è¼¸ | Container æª”æ¡ˆç³»çµ±å‚™ä»½ |\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **docker commit**ï¼šå°‡åŸ·è¡Œä¸­çš„ Container ç‹€æ…‹å„²å­˜ç‚ºæ–° Image\n- âœ… **docker save**ï¼šå°‡ Image åŒ¯å‡ºç‚º tar æª”æ¡ˆ\n- âœ… **docker load**ï¼šå¾ tar æª”è¼‰å…¥ Image\n- âœ… **gzip å£“ç¸®**ï¼šæ¸›å°‘åŒ¯å‡ºæª”æ¡ˆçš„å¤§å°\n- âœ… **æ¸…ç†è…³æœ¬**ï¼šä½¿ç”¨è…³æœ¬æ‰¹æ¬¡æ¸…ç† Container èˆ‡ Image\n"
  },
  {
    "title": "LAB 10 å®¢è£½åŒ– Container Images - Dockerfile",
    "url": "https://caocharles.github.io/dcka-class-notes/lab10_dockerfile/",
    "content": "ï»¿---\nauthors:\n  - name: èª²ç¨‹ä½œè€…\n    email: author@example.com\ndate: 2026-01-27\nupdated: 2026-01-27\ntags:\n  - Docker\n  - Dockerfile\n  - Docker Hub\n---\n\n# LAB 10 å®¢è£½åŒ– Container Images - Dockerfile\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] æ’°å¯« Dockerfile å»ºç«‹å®¢è£½åŒ– Image\n- [ ] ä½¿ç”¨ `docker build` å»ºç½® Image\n- [ ] ä½¿ç”¨ `docker login` ç™»å…¥ Docker Hub\n- [ ] ä½¿ç”¨ `docker tag` æ¨™è¨˜ Image\n- [ ] ä½¿ç”¨ `docker push` ä¸Šå‚³ Image åˆ° Docker Hub\n- [ ] å¾ Docker Hub ä¸‹è¼‰è‡ªå·±ä¸Šå‚³çš„ Image\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 09 çš„å…§å®¹\n- äº†è§£ Docker Image çš„åŸºæœ¬æ¦‚å¿µ\n- å·²è¨»å†Š Docker Hub å¸³è™Ÿï¼ˆhttps://hub.docker.comï¼‰\n\n---\n\n## 10.1 ç’°å¢ƒæº–å‚™\n\n### åˆ‡æ›åˆ° docker2 è™›æ“¬æ©Ÿ\n\næœ¬ Lab åœ¨ docker2 è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n### ç¢ºèªç’°å¢ƒå·²æ¸…ç†\n\n```bash title=\"æª¢è¦–ç¾æœ‰çš„ Container Images\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n```\n\n```bash title=\"æª¢è¦–ç¾æœ‰çš„ Container\"\ndocker ps -a\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n```\n\n### åŸ·è¡Œæ¸…ç†è…³æœ¬ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰\n\n```bash title=\"åŸ·è¡Œæ¸…ç†è…³æœ¬\"\n./docker_clean_all.sh\n```\n\n!!! info \"è…³æœ¬èªªæ˜\"\n    å¦‚æœæ²’æœ‰ Container æˆ– Imageï¼ŒæŒ‡ä»¤æœƒé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±éŸ¿å¾ŒçºŒæ“ä½œã€‚\n\n---\n\n## 10.2 å»ºç«‹å°ˆç”¨ç›®éŒ„èˆ‡ Dockerfile\n\n### å»ºç«‹å·¥ä½œç›®éŒ„\n\n```bash title=\"å»ºç«‹ Dockerfile å°ˆç”¨ç›®éŒ„\"\nmkdir /root/dockerfile-1\ncd /root/dockerfile-1\n```\n\n### å»ºç«‹ Dockerfile\n\n```bash title=\"ç·¨è¼¯ Dockerfile\"\nvi dockerfile\n```\n\nDockerfile å…§å®¹ï¼š\n\n```dockerfile title=\"dockerfile\"\nFROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n```\n\n!!! note \"Dockerfile æŒ‡ä»¤èªªæ˜\"\n    | æŒ‡ä»¤ | èªªæ˜ |\n    |------|------|\n    | `FROM` | æŒ‡å®šåŸºç¤æ˜ åƒï¼Œé€™è£¡ä½¿ç”¨ Private Registry çš„ Alpine |\n    | `RUN` | åœ¨å»ºç½®éç¨‹ä¸­åŸ·è¡ŒæŒ‡ä»¤ï¼Œé€™è£¡å®‰è£ bash |\n    | `CMD` | æŒ‡å®šå®¹å™¨å•Ÿå‹•æ™‚é è¨­åŸ·è¡Œçš„æŒ‡ä»¤ |\n\n```bash title=\"ç¢ºèª Dockerfile å…§å®¹\"\ncat dockerfile\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nFROM docker1.training.lab:5000/alpine\n#FROM 192.168.66.51:5000/alpine\nRUN apk add --no-cache --update-cache bash\nCMD [\"/bin/bash\"]\n```\n\n---\n\n## 10.3 æ¸¬è©¦åŸºç¤ Alpine Image\n\nåœ¨å»ºç½®è‡ªè¨‚ Image ä¹‹å‰ï¼Œå…ˆç¢ºèªåŸºç¤ Alpine æ²’æœ‰ Bashï¼š\n\n```bash title=\"å•Ÿå‹• Alpine Container æ¸¬è©¦\"\ndocker run -it --name alpine-1 docker1.training.lab:5000/alpine /bin/sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nUnable to find image 'docker1.training.lab:5000/alpine:latest' locally\nlatest: Pulling from alpine\n77cae8ab23bf: Pull complete \nDigest: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\nStatus: Downloaded newer image for docker1.training.lab:5000/alpine:latest\n```\n\nåœ¨å®¹å™¨å…§æ¸¬è©¦ Bashï¼š\n\n```bash title=\"æ¸¬è©¦ bashï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\nbash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n/bin/sh: bash: not found\n```\n\n```bash title=\"é€€å‡ºå®¹å™¨\"\nexit\n```\n\n---\n\n## 10.4 ä½¿ç”¨ Dockerfile å»ºç½®æ–°çš„ Docker Image\n\n### åŸ·è¡Œ docker build\n\n```bash title=\"å»ºç½® Docker Image\"\ndocker build -t alpine-bash-2 .\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n[+] Building 2.9s (6/6) FINISHED                                                docker:default\n => [internal] load build definition from dockerfile                                      0.0s\n => => transferring dockerfile: 171B                                                      0.0s\n => [internal] load metadata for docker1.training.lab:5000/alpine:latest                  0.0s\n => [internal] load .dockerignore                                                         0.0s\n => => transferring context: 2B                                                           0.0s\n => [1/2] FROM docker1.training.lab:5000/alpine:latest                                    0.0s\n => [2/2] RUN apk add --no-cache --update-cache bash                                      2.7s\n => exporting to image                                                                    0.2s\n => => exporting layers                                                                   0.1s\n => => naming to docker.io/library/alpine-bash-2:latest                                   0.0s\n => => unpacking to docker.io/library/alpine-bash-2:latest                                0.0s\n```\n\n!!! note \"docker build èªæ³•\"\n    ```\n    docker build -t <image_name>:<tag> <path>\n    ```\n    \n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `-t` | æŒ‡å®š Image åç¨±å’Œæ¨™ç±¤ |\n    | `.` | æŒ‡å®š Dockerfile æ‰€åœ¨ç›®éŒ„ï¼ˆç•¶å‰ç›®éŒ„ï¼‰ |\n\n!!! info \"å»ºç½®éç¨‹èªªæ˜\"\n    - `[1/2] FROM`ï¼šè¼‰å…¥åŸºç¤æ˜ åƒ\n    - `[2/2] RUN`ï¼šåŸ·è¡Œ Dockerfile ä¸­çš„ RUN æŒ‡ä»¤ï¼ˆå®‰è£ bashï¼‰\n    - `exporting to image`ï¼šåŒ¯å‡ºç‚ºæ–°çš„ Image\n\n---\n\n## 10.5 æ¸¬è©¦æ–°çš„ Container Image\n\n### ä½¿ç”¨æ–° Image å•Ÿå‹•å®¹å™¨\n\n```bash title=\"ä½¿ç”¨æ–° Image å•Ÿå‹• Container\"\ndocker run -it --name alpine-3 alpine-bash-2 /bin/bash\n```\n\né€²å…¥å®¹å™¨å¾Œæœƒçœ‹åˆ° `bash-5.0#` æç¤ºç¬¦è™Ÿï¼Œè¡¨ç¤º Bash å·²æˆåŠŸå®‰è£ã€‚\n\n### ç¢ºèª Bash å·²å®‰è£\n\n```bash title=\"ç¢ºèª bashï¼ˆåœ¨ Container å…§åŸ·è¡Œï¼‰\"\nls -l /bin/bash\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n-rwxr-xr-x    1 root     root        735488 May  3  2019 /bin/bash\n```\n\n```bash title=\"é€€å‡ºå®¹å™¨\"\nexit\n```\n\n!!! success \"å»ºç½®æˆåŠŸ\"\n    ä½¿ç”¨ Dockerfile å»ºç½®çš„ Image å·²åŒ…å« Bashï¼Œèˆ‡ LAB 09 ä½¿ç”¨ `docker commit` çš„çµæœç›¸åŒï¼Œä½† Dockerfile æ–¹å¼æ›´å…·å¯é‡ç¾æ€§ã€‚\n\n---\n\n## 10.6 æ¸…ç†ç’°å¢ƒ\n\n```bash title=\"åˆ‡æ›åˆ°å®¶ç›®éŒ„ä¸¦æ¸…ç†\"\ncd\n./docker_clean_all.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n254f09eaadac\n9ae97d52cd65\n254f09eaadac\n9ae97d52cd65\nUntagged: alpine-bash-2:latest\nDeleted: sha256:fe1c0340426860bdd7792a7e560d3dfbb1c6a4d0bf4caadd5e987a4b71fbd169\nUntagged: docker1.training.lab:5000/alpine:latest\nDeleted: sha256:d0a0f8e7bf9a6287c7dab568b947b6c3dd6b84e9c67ab9f1e95f79751d808641\n```\n\n---\n\n## 10.7 ä¸Šå‚³ Docker Image åˆ° Docker Hub\n\n### è¨»å†Š Docker Hub å¸³è™Ÿ\n\n!!! tip \"äº‹å‰æº–å‚™\"\n    è«‹å…ˆåˆ° [https://hub.docker.com](https://hub.docker.com) è¨»å†Šå¸³è™Ÿã€‚\n\n### ä½¿ç”¨ docker login ç™»å…¥\n\n```bash title=\"ç™»å…¥ Docker Hub\"\ndocker login -u <ä½ çš„å¸³è™Ÿ>\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\ndocker login -u caocharles\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nPassword: \nWARNING! Your credentials are stored unencrypted in '/root/.docker/config.json'.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/go/credential-store/\n\nLogin Succeeded\n```\n\n!!! warning \"å¯†ç¢¼å„²å­˜è­¦å‘Š\"\n    ç™»å…¥å¾Œï¼ŒDocker æœƒå°‡èªè­‰è³‡è¨Šå„²å­˜åœ¨ `/root/.docker/config.json`ï¼Œé€™æ˜¯ Base64 ç·¨ç¢¼ï¼ˆéåŠ å¯†ï¼‰ï¼Œè«‹æ³¨æ„å®‰å…¨ã€‚\n\n### é‡æ–°å»ºç½® Docker Image\n\n```bash title=\"åˆ‡æ›åˆ° Dockerfile ç›®éŒ„\"\ncd /root/dockerfile-1\n```\n\n```bash title=\"å»ºç½®è¦ä¸Šå‚³çš„ Image\"\ndocker build -t alpine-bash-charles .\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n[+] Building 0.1s (6/6) FINISHED                                                docker:default\n => [internal] load build definition from dockerfile                                      0.0s\n => CACHED [2/2] RUN apk add --no-cache --update-cache bash                               0.0s\n => exporting to image                                                                    0.0s\n => => naming to docker.io/library/alpine-bash-charles:latest                             0.0s\n```\n\n!!! info \"CACHED èªªæ˜\"\n    å¦‚æœä¹‹å‰å·²å»ºç½®éç›¸åŒçš„å±¤ï¼ŒDocker æœƒä½¿ç”¨å¿«å–ï¼ŒåŠ å¿«å»ºç½®é€Ÿåº¦ã€‚\n\n### ç‚º Image åŠ ä¸Š Tag\n\nè¦ä¸Šå‚³åˆ° Docker Hubï¼ŒImage åç¨±å¿…é ˆåŒ…å«ä½ çš„ Docker Hub å¸³è™Ÿåç¨±ï¼š\n\n```bash title=\"ç‚º Image åŠ ä¸Š Tag\"\ndocker tag alpine-bash-charles:latest <ä½ çš„å¸³è™Ÿ>/alpine-bash-charles:latest\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\ndocker tag alpine-bash-charles:latest caocharles/alpine-bash-charles:latest\n```\n\n!!! note \"docker tag èªæ³•\"\n    ```\n    docker tag <source_image>:<tag> <target_image>:<tag>\n    ```\n    \n    - Target image æ ¼å¼ï¼š`<Docker Hub å¸³è™Ÿ>/<Image åç¨±>:<tag>`\n\n```bash title=\"ç¢ºèª Tag å·²å»ºç«‹\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\nalpine-bash-charles:latest              28024b3ae76e       14.5MB          6.6MB        \ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB        \n```\n\n!!! info \"å…©å€‹ Image ä½¿ç”¨ç›¸åŒ ID\"\n    `docker tag` åªæ˜¯å»ºç«‹ä¸€å€‹æ–°çš„æ¨™ç±¤æŒ‡å‘åŒä¸€å€‹ Imageï¼Œä¸æœƒä½”ç”¨é¡å¤–ç©ºé–“ã€‚\n\n---\n\n## 10.8 ä¸Šå‚³ Docker Image\n\n### åŸ·è¡Œ docker push\n\n```bash title=\"ä¸Šå‚³ Image åˆ° Docker Hub\"\ndocker push <ä½ çš„å¸³è™Ÿ>/alpine-bash-charles:latest\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\ndocker push caocharles/alpine-bash-charles:latest\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nThe push refers to repository [docker.io/caocharles/alpine-bash-charles]\n77cae8ab23bf: Pushed \n34b2f2a4fe94: Pushed \n01bc7f934740: Pushed \nlatest: digest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f size: 855\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤ï¼špush access denied\"\n    å¦‚æœå‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š\n    ```\n    push access denied, repository does not exist or may require authorization\n    ```\n    \n    **å¯èƒ½åŸå› **ï¼š\n    \n    1. Image æ¨™ç±¤çš„å¸³è™Ÿåç¨±èˆ‡ç™»å…¥å¸³è™Ÿä¸ç¬¦\n    2. å°šæœªç™»å…¥æˆ–ç™»å…¥æ†‘è­‰éæœŸ\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # ç¢ºèªä½¿ç”¨æ­£ç¢ºçš„å¸³è™Ÿåç¨±\n    docker tag alpine-bash-charles:latest <æ­£ç¢ºå¸³è™Ÿ>/alpine-bash-charles:latest\n    \n    # é‡æ–°ç™»å…¥\n    docker logout\n    docker login -u <ä½ çš„å¸³è™Ÿ>\n    ```\n\n---\n\n## 10.9 é©—è­‰ä¸Šå‚³çµæœ\n\n### åœ¨ Docker Hub ç¶²ç«™ç¢ºèª\n\n1. é–‹å•Ÿ [https://hub.docker.com](https://hub.docker.com)\n2. ç™»å…¥ä½ çš„å¸³è™Ÿ\n3. é€²å…¥ Repositories\n4. ç¢ºèªå¯ä»¥çœ‹åˆ°å‰›ä¸Šå‚³çš„ Image\n\n### æ¸…ç†æœ¬åœ°ç’°å¢ƒä¸¦å¾ Docker Hub ä¸‹è¼‰\n\n```bash title=\"æ¸…ç†æœ¬åœ°ç’°å¢ƒ\"\ncd\n./docker_clean_all.sh\n```\n\n```bash title=\"ç¢ºèªå·²æ¸…ç†\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE   ID             DISK USAGE   CONTENT SIZE   EXTRA\n```\n\n```bash title=\"å¾ Docker Hub ä¸‹è¼‰ Image\"\ndocker pull <ä½ çš„å¸³è™Ÿ>/alpine-bash-charles\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\ndocker pull caocharles/alpine-bash-charles\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nUsing default tag: latest\nlatest: Pulling from caocharles/alpine-bash-charles\n01bc7f934740: Pull complete \n34b2f2a4fe94: Download complete \nDigest: sha256:28024b3ae76eb1a9400407051085821a6f0a76b1b96cb2f4a92cec35f350d29f\nStatus: Downloaded newer image for caocharles/alpine-bash-charles:latest\ndocker.io/caocharles/alpine-bash-charles:latest\n```\n\n```bash title=\"ç¢ºèªä¸‹è¼‰æˆåŠŸ\"\ndocker images\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nIMAGE                                   ID             DISK USAGE   CONTENT SIZE   EXTRA\ncaocharles/alpine-bash-charles:latest   28024b3ae76e       14.5MB          6.6MB    \n```\n\n!!! success \"å®Œæˆç¢ºèª\"\n    æˆåŠŸå¾ Docker Hub ä¸‹è¼‰å‰›æ‰ä¸Šå‚³çš„ Imageï¼\n\n---\n\n## æŒ‡ä»¤åƒè€ƒ\n\n### Dockerfile åŸºæœ¬æŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ | ç¯„ä¾‹ |\n|------|------|------|\n| `FROM` | æŒ‡å®šåŸºç¤æ˜ åƒ | `FROM alpine:latest` |\n| `RUN` | å»ºç½®æ™‚åŸ·è¡ŒæŒ‡ä»¤ | `RUN apk add bash` |\n| `CMD` | å®¹å™¨å•Ÿå‹•æ™‚é è¨­æŒ‡ä»¤ | `CMD [\"/bin/bash\"]` |\n| `COPY` | è¤‡è£½æª”æ¡ˆåˆ° Image | `COPY ./src /app` |\n| `WORKDIR` | è¨­å®šå·¥ä½œç›®éŒ„ | `WORKDIR /app` |\n| `EXPOSE` | å®£å‘Šé–‹æ”¾çš„ Port | `EXPOSE 80` |\n| `ENV` | è¨­å®šç’°å¢ƒè®Šæ•¸ | `ENV APP_HOME=/app` |\n\n### Docker Hub ç›¸é—œæŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ | ç¯„ä¾‹ |\n|------|------|------|\n| `docker login` | ç™»å…¥ Docker Registry | `docker login -u username` |\n| `docker logout` | ç™»å‡º Docker Registry | `docker logout` |\n| `docker tag` | ç‚º Image åŠ ä¸Šæ¨™ç±¤ | `docker tag image:tag user/image:tag` |\n| `docker push` | ä¸Šå‚³ Image | `docker push user/image:tag` |\n| `docker pull` | ä¸‹è¼‰ Image | `docker pull user/image:tag` |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šdocker build æ™‚å‡ºç¾ 'no such file or directory' éŒ¯èª¤ï¼Ÿ\"\n    **å¯èƒ½åŸå› **ï¼š\n    \n    1. Dockerfile æª”åä¸æ­£ç¢ºï¼ˆæ³¨æ„å¤§å°å¯«ï¼‰\n    2. ä¸åœ¨æ­£ç¢ºçš„ç›®éŒ„\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # ç¢ºèªæª”æ¡ˆå­˜åœ¨\n    ls -la dockerfile\n    \n    # ä½¿ç”¨ -f æŒ‡å®š Dockerfile è·¯å¾‘\n    docker build -f ./dockerfile -t my-image .\n    ```\n\n??? question \"Q2ï¼šdocker push å¤±æ•—ï¼Œé¡¯ç¤º 'access denied'ï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    \n    1. ç¢ºèªå·²ç™»å…¥ï¼š`docker login`\n    2. ç¢ºèª Image æ¨™ç±¤åŒ…å«æ­£ç¢ºçš„å¸³è™Ÿåç¨±\n    3. æ¨™ç±¤æ ¼å¼å¿…é ˆæ˜¯ï¼š`<å¸³è™Ÿ>/<imageåç¨±>:<tag>`\n\n??? question \"Q3ï¼šDockerfile èˆ‡ docker commit æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿ\"\n    | æ¯”è¼ƒ | docker commit | Dockerfile |\n    |------|---------------|------------|\n    | å¯è¿½è¹¤æ€§ | ç„¡æ³•è¿½è¹¤è®Šæ›´ | å¯ç‰ˆæœ¬æ§åˆ¶ |\n    | å¯é‡ç¾æ€§ | é›£ä»¥é‡ç¾ | å¯é‡è¤‡å»ºç½® |\n    | è‡ªå‹•åŒ– | æ‰‹å‹•æ“ä½œ | å¯è‡ªå‹•åŒ– |\n    | å»ºè­°ç”¨é€” | æ¸¬è©¦/é™¤éŒ¯ | ç”Ÿç”¢ç’°å¢ƒ |\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Dockerfile**ï¼šä½¿ç”¨ FROMã€RUNã€CMD æŒ‡ä»¤å»ºç«‹å®¢è£½åŒ– Image\n- âœ… **docker build**ï¼šæ ¹æ“š Dockerfile å»ºç½® Image\n- âœ… **docker login**ï¼šç™»å…¥ Docker Hub\n- âœ… **docker tag**ï¼šç‚º Image åŠ ä¸Šç¬¦åˆ Docker Hub æ ¼å¼çš„æ¨™ç±¤\n- âœ… **docker push**ï¼šä¸Šå‚³ Image åˆ° Docker Hub\n- âœ… **docker pull**ï¼šå¾ Docker Hub ä¸‹è¼‰ Image\n"
  },
  {
    "title": "LAB 11 Standalone Kubernetes å®‰è£",
    "url": "https://caocharles.github.io/dcka-class-notes/lab11_standalone_k8s/",
    "content": "ï»¿---\nauthors:\n  - name: èª²ç¨‹ä½œè€…\n    email: author@example.com\ndate: 2026-01-27\nupdated: 2026-01-27\ntags:\n  - Kubernetes\n  - Installation\n  - Standalone\n---\n\n# LAB 11 Standalone Kubernetes å®‰è£\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ Shell Script è‡ªå‹•åŒ–å®‰è£ Kubernetes\n- [ ] äº†è§£ Standalone Kubernetes çš„æ¶æ§‹\n- [ ] ç›£æ§ Kubernetes å¢é›†ç‹€æ…‹\n- [ ] åœ¨ Standalone Master ç¯€é»ä¸Šéƒ¨ç½² Pod\n- [ ] å»ºç«‹è™›æ“¬æ©Ÿå¿«ç…§ä¿ç•™ç‹€æ…‹\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ Docker ç›¸é—œç« ç¯€\n- äº†è§£åŸºæœ¬çš„ Linux æŒ‡ä»¤æ“ä½œ\n- äº†è§£å®¹å™¨åŒ–çš„åŸºæœ¬æ¦‚å¿µ\n\n---\n\n## 11.1 ç’°å¢ƒèªªæ˜\n\n### ä»€éº¼æ˜¯ Standalone Kubernetesï¼Ÿ\n\nStandalone Kubernetes æ˜¯ä¸€å€‹å–®ç¯€é»çš„ Kubernetes å¢é›†ï¼ŒMaster ç¯€é»åŒæ™‚ä¹Ÿä½œç‚º Worker ç¯€é»ä½¿ç”¨ã€‚é€™ç¨®æ¶æ§‹é©åˆï¼š\n\n- å­¸ç¿’èˆ‡æ¸¬è©¦ç’°å¢ƒ\n- é–‹ç™¼ç’°å¢ƒ\n- å°å‹å°ˆæ¡ˆ\n\n```mermaid\ngraph TB\n    subgraph \"Standalone Kubernetes\"\n        M[k8s-standalone<br/>Master + Worker<br/>192.168.66.61]\n        subgraph \"Control Plane\"\n            API[API Server]\n            ETCD[etcd]\n            SCHED[Scheduler]\n            CM[Controller Manager]\n        end\n        subgraph \"Node Components\"\n            KL[Kubelet]\n            KP[Kube-Proxy]\n            CR[CRI-O]\n        end\n        subgraph \"Pods\"\n            P1[Pod 1]\n            P2[Pod 2]\n        end\n    end\n```\n\n### è™›æ“¬æ©Ÿè³‡è¨Š\n\n| é …ç›® | å€¼ |\n|------|------|\n| ä¸»æ©Ÿåç¨± | k8s-standalone.training.lab |\n| IP ä½å€ | 192.168.66.61 |\n| ä½œæ¥­ç³»çµ± | Rocky Linux 9 |\n| Kubernetes ç‰ˆæœ¬ | 1.32 |\n\n---\n\n## 11.2 åˆ‡æ›åˆ° k8s-standalone è™›æ“¬æ©Ÿ\n\n### ç¢ºèªç¶²è·¯è¨­å®š\n\n```bash title=\"æª¢è¦–ç¶²è·¯ä»‹é¢\"\nifconfig ens160\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nens160: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.66.61  netmask 255.255.255.0  broadcast 192.168.66.255\n        inet6 fe80::20c:29ff:fe91:c3  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:91:00:c3  txqueuelen 1000  (Ethernet)\n        RX packets 41897  bytes 25015527 (23.8 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 672  bytes 55461 (54.1 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n```\n\n### ç¢ºèªä¸»æ©Ÿåç¨±\n\n```bash title=\"æª¢è¦–ä¸»æ©Ÿåç¨±\"\nhostname\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nk8s-standalone.training.lab\n```\n\n### ç¢ºèª hosts æª”æ¡ˆ\n\n```bash title=\"æª¢è¦– /etc/hosts\"\ncat /etc/hosts\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.10\tmaster.training.lab\tmaster\n192.168.66.11\tnode1.training.lab\tnode1\n192.168.66.12\tnode2.training.lab\tnode2\n192.168.66.21\tdocker.training.lab\tdocker\n192.168.66.22\tminikube.training.lab\tminikube\n\n192.168.66.51\t\tdocker1.training.lab\t\tdocker1\n192.168.66.52\t\tdocker2.training.lab\t\tdocker2\n192.168.66.61\t\tk8s-standalone.training.lab\tk8s-standalone\n192.168.66.71\t\tk8s-master1.training.lab\tk8s-master1\n192.168.66.81\t\tk8s-node1.training.lab\t\tk8s-node1\n192.168.66.82\t\tk8s-node2.training.lab\t\tk8s-node2\n```\n\n---\n\n## 11.3 ä¸‹è¼‰å®‰è£ Script\n\n### ä½¿ç”¨ wget ä¸‹è¼‰\n\n```bash title=\"ä¸‹è¼‰å®‰è£è…³æœ¬\"\nwget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n--2026-01-27 11:21:14--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh       100%[========================================>]  21.99K  --.-KB/s    in 0s      \n\n2026-01-27 11:21:14 (61.0 MB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n```\n\n### è¨­å®šåŸ·è¡Œæ¬Šé™\n\n```bash title=\"è¨­å®šåŸ·è¡Œæ¬Šé™\"\nchmod 755 install_k8s-latest.sh\n```\n\n---\n\n## 11.4 ä½¿ç”¨ Shell Script è‡ªå‹•åŒ–å®‰è£ Kubernetes\n\n### æŸ¥çœ‹å®‰è£é¸é …\n\n```bash title=\"åŸ·è¡Œè…³æœ¬æŸ¥çœ‹ä½¿ç”¨èªªæ˜\"\n./install_k8s-latest.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nè«‹è¼¸å…¥ å®Œæ•´å®‰è£(full) æˆ–æ˜¯ standalone\n./install_k8s-latest.sh -full\næˆ– \n./install_k8s-latest.sh -standalone\n```\n\n!!! note \"å®‰è£æ¨¡å¼èªªæ˜\"\n    | æ¨¡å¼ | èªªæ˜ |\n    |------|------|\n    | `-full` | å®Œæ•´å®‰è£ï¼ŒåŒ…å« Master èˆ‡ Worker ç¯€é»è¨­å®š |\n    | `-standalone` | å–®æ©Ÿå®‰è£ï¼ŒMaster ç¯€é»åŒæ™‚ä½œç‚º Worker ç¯€é» |\n\n### åŸ·è¡Œ Standalone å®‰è£\n\n```bash title=\"åŸ·è¡Œ Standalone å®‰è£\"\n./install_k8s-latest.sh -standalone\n```\n\n!!! info \"å®‰è£éç¨‹èªªæ˜\"\n    è…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š\n    \n    1. **å®‰è£å¿…è¦å¥—ä»¶**ï¼šsshpassã€bash-completion\n    2. **å®‰è£ Docker CE**ï¼šåŒ…å« containerd.ioã€docker-ce-cli\n    3. **é—œé–‰ Swap**ï¼šKubernetes è¦æ±‚é—œé–‰ Swap\n    4. **è¨­å®šæ ¸å¿ƒåƒæ•¸**ï¼šå•Ÿç”¨ IP è½‰ç™¼ã€è¨­å®šç¶²è·¯åƒæ•¸\n    5. **å®‰è£ Kubernetes å¥—ä»¶**ï¼škubeletã€kubeadmã€kubectl\n    6. **å®‰è£ CRI-O**ï¼šContainer Runtime Interface\n    7. **é—œé–‰é˜²ç«ç‰†**ï¼šåœç”¨ firewalld\n    8. **åŸ·è¡Œ kubeadm init**ï¼šåˆå§‹åŒ– Kubernetes å¢é›†\n    9. **å®‰è£ CNI**ï¼šå®‰è£ Antrea ç¶²è·¯å¥—ä»¶\n    10. **ç§»é™¤ Taint**ï¼šå…è¨±åœ¨ Master ç¯€é»ä¸Šéƒ¨ç½² Pod\n\n### å®‰è£éç¨‹è¼¸å‡ºï¼ˆéƒ¨åˆ†ï¼‰\n\nå®‰è£ Docker CEï¼š\n\n```\nInstalling:\n docker-ce                    x86_64    3:29.2.0-1.el9    docker-ce-stable     24 M\n containerd.io                x86_64    2.2.1-1.el9       docker-ce-stable     35 M\n docker-ce-cli                x86_64    1:29.2.0-1.el9    docker-ce-stable    8.4 M\n docker-buildx-plugin         x86_64    0.30.1-1.el9      docker-ce-stable     17 M\n docker-compose-plugin        x86_64    5.0.2-1.el9       docker-ce-stable    8.1 M\n\nComplete!\n```\n\nå®‰è£ Kubernetes å¥—ä»¶ï¼š\n\n```\nInstalling:\n kubeadm       x86_64    1.32.11-150500.1.1    kubernetes    12 M\n kubectl       x86_64    1.32.11-150500.1.1    kubernetes    11 M\n kubelet       x86_64    1.32.11-150500.1.1    kubernetes    15 M\n cri-tools     x86_64    1.32.0-150500.1.1     kubernetes   7.1 M\n kubernetes-cni x86_64   1.6.0-150500.1.1      kubernetes   8.0 M\n\nComplete!\n```\n\nå®‰è£ CRI-Oï¼š\n\n```\nInstalling:\n cri-o         x86_64    1.32.1-150500.1.1     cri-o         20 M\n\nComplete!\n```\n\n### kubeadm init è¼¸å‡º\n\n```\n[init] Using Kubernetes version: v1.32.11\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s-standalone.training.lab kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [172.30.0.1 192.168.66.61]\n...\n[kubelet-start] Starting the kubelet\n[kubelet-check] The kubelet is healthy after 515.21134ms\n[api-check] The API server is healthy after 3.001460102s\n...\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n```\n\n!!! success \"åˆå§‹åŒ–æˆåŠŸ\"\n    çœ‹åˆ° `Your Kubernetes control-plane has initialized successfully!` è¡¨ç¤º Kubernetes æ§åˆ¶å¹³é¢å·²æˆåŠŸåˆå§‹åŒ–ã€‚\n\n### å®‰è£ Antrea CNI\n\nè…³æœ¬æœƒè‡ªå‹•å®‰è£ Antrea ä½œç‚º CNIï¼ˆContainer Network Interfaceï¼‰ï¼š\n\n```\ncustomresourcedefinition.apiextensions.k8s.io/antreaagentinfos.crd.antrea.io created\nserviceaccount/antrea-agent created\nserviceaccount/antrea-controller created\nclusterrole.rbac.authorization.k8s.io/antrea-agent created\nclusterrole.rbac.authorization.k8s.io/antrea-controller created\n...\ndeployment.apps/antrea-controller created\ndaemonset.apps/antrea-agent created\n```\n\n### ç§»é™¤ Master ç¯€é»çš„ Taint\n\né è¨­æƒ…æ³ä¸‹ï¼ŒKubernetes ä¸å…è¨±åœ¨ Master ç¯€é»ä¸Šéƒ¨ç½² Podã€‚è…³æœ¬æœƒè‡ªå‹•ç§»é™¤é€™å€‹é™åˆ¶ï¼š\n\n```\nnode/k8s-standalone.training.lab untainted\n```\n\n!!! note \"Taint èªªæ˜\"\n    Taintï¼ˆæ±™é»ï¼‰æ˜¯ Kubernetes ç”¨ä¾†é™åˆ¶ Pod èª¿åº¦çš„æ©Ÿåˆ¶ã€‚Master ç¯€é»é è¨­æœ‰ `node-role.kubernetes.io/control-plane:NoSchedule` çš„ Taintï¼Œè¡¨ç¤ºä¸æ¥å—ä¸€èˆ¬ Pod çš„èª¿åº¦ã€‚\n\n---\n\n## 11.5 ç›£æ§ Kubernetes ç‹€æ…‹\n\n### æª¢è¦–ç¯€é»ç‹€æ…‹\n\n```bash title=\"æª¢è¦–ç¯€é»ç‹€æ…‹\"\nkubectl get nodes\n```\n\n**é æœŸçµæœ**ï¼ˆåˆå§‹ç‹€æ…‹ï¼‰ï¼š\n\n```\nNAME                          STATUS     ROLES           AGE   VERSION\nk8s-standalone.training.lab   NotReady   control-plane   35s   v1.32.11\n```\n\n!!! warning \"NotReady ç‹€æ…‹\"\n    ç¯€é»å‰›åˆå§‹åŒ–æ™‚æœƒé¡¯ç¤º `NotReady`ï¼Œç­‰å¾… CNI å¥—ä»¶å®Œå…¨å•Ÿå‹•å¾Œæœƒè®Šæˆ `Ready`ã€‚\n\nç­‰å¾…ç´„ 30 ç§’å¾Œå†æ¬¡æª¢æŸ¥ï¼š\n\n```bash title=\"å†æ¬¡æª¢è¦–ç¯€é»ç‹€æ…‹\"\nkubectl get nodes\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                          STATUS   ROLES           AGE   VERSION\nk8s-standalone.training.lab   Ready    control-plane   2m    v1.32.11\n```\n\n### æª¢è¦–ç³»çµ± Pod ç‹€æ…‹\n\n```bash title=\"æª¢è¦– kube-system namespace çš„ Pod\"\nkubectl get pods -n kube-system\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                                                  READY   STATUS    RESTARTS   AGE\nantrea-agent-xxxxx                                    2/2     Running   0          2m\nantrea-controller-xxxxx                               1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\ncoredns-xxxxx                                         1/1     Running   0          2m\netcd-k8s-standalone.training.lab                      1/1     Running   0          2m\nkube-apiserver-k8s-standalone.training.lab            1/1     Running   0          2m\nkube-controller-manager-k8s-standalone.training.lab   1/1     Running   0          2m\nkube-proxy-xxxxx                                      1/1     Running   0          2m\nkube-scheduler-k8s-standalone.training.lab            1/1     Running   0          2m\n```\n\n### æŒçºŒç›£æ§ç¯€é»ç‹€æ…‹\n\n```bash title=\"ä½¿ç”¨ watch æŒçºŒç›£æ§\"\nwatch kubectl get nodes\n```\n\n!!! tip \"watch æŒ‡ä»¤\"\n    `watch` æŒ‡ä»¤æœƒæ¯ 2 ç§’é‡æ–°åŸ·è¡Œä¸€æ¬¡æŒ‡ä»¤ï¼ŒæŒ‰ `Ctrl+C` å¯ä»¥é€€å‡ºã€‚\n\n---\n\n## 11.6 éƒ¨ç½²æ¸¬è©¦\n\n### å»ºç«‹æ¸¬è©¦ Deployment\n\n```bash title=\"å»ºç«‹ nginx Deployment\"\nkubectl create deployment test1 --image=nginx\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 created\n```\n\n!!! note \"kubectl create deployment èªæ³•\"\n    ```\n    kubectl create deployment <name> --image=<image>\n    ```\n    \n    | åƒæ•¸ | èªªæ˜ |\n    |------|------|\n    | `<name>` | Deployment åç¨± |\n    | `--image` | ä½¿ç”¨çš„å®¹å™¨æ˜ åƒ |\n\n### æª¢è¦– Deployment ç‹€æ…‹\n\n```bash title=\"æª¢è¦– Deployment\"\nkubectl get deployments.apps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   0/1     1            0           15s\n```\n\n!!! info \"Deployment æ¬„ä½èªªæ˜\"\n    | æ¬„ä½ | èªªæ˜ |\n    |------|------|\n    | `READY` | å°±ç·’çš„ Pod æ•¸é‡ / é æœŸæ•¸é‡ |\n    | `UP-TO-DATE` | å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Pod æ•¸é‡ |\n    | `AVAILABLE` | å¯ç”¨çš„ Pod æ•¸é‡ |\n\n### æª¢è¦– Pod ç‹€æ…‹\n\n```bash title=\"æª¢è¦– Pod ç‹€æ…‹\"\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          27s\n```\n\n### æª¢è¦– Pod è©³ç´°è³‡è¨Š\n\n```bash title=\"æª¢è¦– Pod è©³ç´°è³‡è¨Šï¼ˆå«ç¯€é»è³‡è¨Šï¼‰\"\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   0/1     Pending   0          33s   <none>   <none>   <none>           <none>\n```\n\n!!! warning \"Pod è™•æ–¼ Pending ç‹€æ…‹\"\n    å¦‚æœ Pod æŒçºŒè™•æ–¼ `Pending` ç‹€æ…‹ä¸” `NODE` é¡¯ç¤º `<none>`ï¼Œå¯èƒ½æ˜¯å› ç‚ºï¼š\n    \n    1. ç¯€é»å°šæœªå°±ç·’ï¼ˆNotReadyï¼‰\n    2. ç¯€é»ä»æœ‰ Taint é™åˆ¶\n    \n    éœ€è¦ç­‰å¾…ç¯€é»è®Šæˆ Ready ç‹€æ…‹ï¼Œæˆ–ç¢ºèª Taint å·²ç§»é™¤ã€‚\n\n### ç­‰å¾…ç¯€é»å°±ç·’å¾Œç¢ºèª\n\nç­‰å¾…ç¯€é»è®Šæˆ Ready å¾Œï¼ŒPod æœƒè‡ªå‹•èª¿åº¦ä¸¦å•Ÿå‹•ï¼š\n\n```bash title=\"ç¢ºèªç¯€é»ç‹€æ…‹\"\nkubectl get nodes\n```\n\nç•¶ç¯€é»é¡¯ç¤º `Ready` å¾Œï¼š\n\n```bash title=\"å†æ¬¡æª¢è¦– Pod ç‹€æ…‹\"\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼ˆç¯€é»å°±ç·’å¾Œï¼‰ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE   IP            NODE                          NOMINATED NODE   READINESS GATES\ntest1-7d9bdc56f4-mbtc5   1/1     Running   0          2m    10.244.0.5    k8s-standalone.training.lab   <none>           <none>\n```\n\n!!! success \"éƒ¨ç½²æˆåŠŸ\"\n    ç•¶ Pod ç‹€æ…‹è®Šæˆ `Running` ä¸” `NODE` é¡¯ç¤º `k8s-standalone.training.lab`ï¼Œè¡¨ç¤ºå·²æˆåŠŸåœ¨ Standalone Master ç¯€é»ä¸Šéƒ¨ç½² Podã€‚\n\n### æ¸…ç†æ¸¬è©¦ Deployment\n\n```bash title=\"åˆªé™¤æ¸¬è©¦ Deployment\"\nkubectl delete deployment test1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps \"test1\" deleted\n```\n\n---\n\n## 11.7 å»ºç«‹å¿«ç…§ Snapshot\n\n!!! tip \"å»ºè­°\"\n    å®Œæˆå®‰è£å¾Œï¼Œå»ºè­°åœ¨ VMware ä¸­å»ºç«‹è™›æ“¬æ©Ÿå¿«ç…§ï¼Œä»¥ä¾¿æ—¥å¾Œéœ€è¦æ™‚å¯ä»¥å¿«é€Ÿé‚„åŸåˆ°ä¹¾æ·¨çš„ Kubernetes ç’°å¢ƒã€‚\n\n### å»ºç«‹å¿«ç…§æ­¥é©Ÿ\n\n1. åœ¨ VMware vSphere Client æˆ– VMware Workstation ä¸­\n2. é¸æ“‡ k8s-standalone è™›æ“¬æ©Ÿ\n3. å³éµé¸æ“‡ **å¿«ç…§** > **æ‹æ”å¿«ç…§**\n4. è¼¸å…¥å¿«ç…§åç¨±ï¼Œä¾‹å¦‚ï¼š`K8s 1.32 å®‰è£å®Œæˆ`\n5. é»æ“Šç¢ºå®š\n\n---\n\n## æŒ‡ä»¤åƒè€ƒ\n\n### kubectl åŸºæœ¬æŒ‡ä»¤\n\n| æŒ‡ä»¤ | èªªæ˜ |\n|------|------|\n| `kubectl get nodes` | æª¢è¦–ç¯€é»ç‹€æ…‹ |\n| `kubectl get pods` | æª¢è¦– Pod åˆ—è¡¨ |\n| `kubectl get pods -n kube-system` | æª¢è¦–ç³»çµ± Pod |\n| `kubectl describe node <name>` | æª¢è¦–ç¯€é»è©³ç´°è³‡è¨Š |\n| `kubectl describe pod <name>` | æª¢è¦– Pod è©³ç´°è³‡è¨Š |\n| `kubectl run <name> --image=<image>` | å»ºç«‹ Pod |\n| `kubectl delete pod <name>` | åˆªé™¤ Pod |\n| `kubectl exec -it <name> -- <cmd>` | åœ¨ Pod ä¸­åŸ·è¡ŒæŒ‡ä»¤ |\n\n### å®‰è£ç›¸é—œå…ƒä»¶ç‰ˆæœ¬\n\n| å…ƒä»¶ | ç‰ˆæœ¬ |\n|------|------|\n| Kubernetes | 1.32.11 |\n| Docker CE | 29.2.0 |\n| containerd.io | 2.2.1 |\n| CRI-O | 1.32.1 |\n| Antrea CNI | æœ€æ–°ç‰ˆ |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šç¯€é»ä¸€ç›´é¡¯ç¤º NotReadyï¼Ÿ\"\n    **å¯èƒ½åŸå› **ï¼š\n    \n    1. CNI å¥—ä»¶å°šæœªå®Œå…¨å•Ÿå‹•\n    2. kubelet æœå‹™ç•°å¸¸\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æª¢è¦– kubelet ç‹€æ…‹\n    systemctl status kubelet\n    \n    # æª¢è¦– kubelet æ—¥èªŒ\n    journalctl -u kubelet -f\n    \n    # æª¢è¦–ç³»çµ± Pod ç‹€æ…‹\n    kubectl get pods -n kube-system\n    ```\n\n??? question \"Q2ï¼šPod ç„¡æ³•åœ¨ Master ç¯€é»ä¸ŠåŸ·è¡Œï¼Ÿ\"\n    **å¯èƒ½åŸå› **ï¼šMaster ç¯€é»æœ‰ Taint é™åˆ¶\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æª¢è¦–ç¯€é» Taint\n    kubectl describe node k8s-standalone.training.lab | grep Taint\n    \n    # ç§»é™¤ control-plane Taint\n    kubectl taint nodes k8s-standalone.training.lab node-role.kubernetes.io/control-plane:NoSchedule-\n    ```\n\n??? question \"Q3ï¼šå¦‚ä½•é‡æ–°å®‰è£ Kubernetesï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # é‡ç½® kubeadm\n    kubeadm reset -f\n    \n    # æ¸…ç† iptables\n    iptables -F && iptables -t nat -F && iptables -t mangle -F && iptables -X\n    \n    # é‡æ–°åŸ·è¡Œå®‰è£è…³æœ¬\n    ./install_k8s-latest.sh -standalone\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **ç’°å¢ƒæº–å‚™**ï¼šåˆ‡æ›åˆ° k8s-standalone è™›æ“¬æ©Ÿï¼Œç¢ºèªç¶²è·¯è¨­å®š\n- âœ… **ä¸‹è¼‰å®‰è£è…³æœ¬**ï¼šä½¿ç”¨ wget ä¸‹è¼‰è‡ªå‹•åŒ–å®‰è£è…³æœ¬\n- âœ… **è‡ªå‹•åŒ–å®‰è£**ï¼šä½¿ç”¨ `-standalone` åƒæ•¸åŸ·è¡Œå–®æ©Ÿå®‰è£\n- âœ… **ç›£æ§ç‹€æ…‹**ï¼šä½¿ç”¨ `kubectl get nodes` ç¢ºèªç¯€é» Ready\n- âœ… **éƒ¨ç½²æ¸¬è©¦**ï¼šæˆåŠŸåœ¨ Standalone Master ä¸Šéƒ¨ç½² Pod\n- âœ… **å»ºç«‹å¿«ç…§**ï¼šä¿ç•™ä¹¾æ·¨çš„ Kubernetes ç’°å¢ƒ\n"
  },
  {
    "title": "Lab12 K8S Install",
    "url": "https://caocharles.github.io/dcka-class-notes/lab12_k8s_install/",
    "content": "ï»¿# LAB 12 Kubernetes å¢é›†å®‰è£\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ Shell Script è‡ªå‹•åŒ–å®‰è£ Kubernetes å¢é›†\n- [ ] é…ç½®å¤šç¯€é»ï¼ˆMaster + Workerï¼‰Kubernetes ç’°å¢ƒ\n- [ ] ç†è§£ kubeadmã€kubeletã€kubectl çš„è§’è‰²\n- [ ] å®‰è£ä¸¦é…ç½® CRI-O å®¹å™¨åŸ·è¡Œç’°å¢ƒ\n- [ ] éƒ¨ç½² Antrea CNI ç¶²è·¯æ’ä»¶\n- [ ] å°‡ Worker Node åŠ å…¥å¢é›†\n- [ ] ç›£æ§å¢é›†ç‹€æ…‹èˆ‡é©—è­‰éƒ¨ç½²\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 11 ç¨ç«‹ Kubernetes ç’°å¢ƒ\n- ç†Ÿæ‚‰ Docker åŸºæœ¬æ“ä½œ\n- ç†è§£å®¹å™¨åŒ–çš„åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ä¸‰å°è™›æ“¬æ©Ÿï¼ˆK8S-MASTER1ã€K8S-NODE1ã€K8S-NODE2ï¼‰\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šä½¿ç”¨ Shell Script å®‰è£ Kubernetes å¢é›†\n\n### ç’°å¢ƒæ¶æ§‹\n\n```mermaid\ngraph TB\n    subgraph \"Kubernetes Cluster\"\n        Master[k8s-master1<br/>192.168.66.71<br/>Control Plane]\n        Node1[k8s-node1<br/>192.168.66.81<br/>Worker Node]\n        Node2[k8s-node2<br/>192.168.66.82<br/>Worker Node]\n        Master --> Node1\n        Master --> Node2\n    end\n    \n    subgraph \"å®‰è£å…ƒä»¶\"\n        CRI[CRI-O 1.32]\n        K8S[Kubernetes 1.32]\n        CNI[Antrea CNI]\n    end\n```\n\n| ä¸»æ©Ÿåç¨± | IP ä½å€ | è§’è‰² |\n|---------|---------|------|\n| k8s-master1.training.lab | 192.168.66.71 | Control Plane (Master) |\n| k8s-node1.training.lab | 192.168.66.81 | Worker Node |\n| k8s-node2.training.lab | 192.168.66.82 | Worker Node |\n\n!!! info \"å®‰è£ç‰¹é»\"\n    - **å…¨ç¨‹åœ¨ Master ç¯€é»æ“ä½œ**ï¼šé€é SSH è‡ªå‹•åŒ–å®‰è£ Worker ç¯€é»\n    - **ä½¿ç”¨ CRI-O**ï¼šKubernetes åŸç”Ÿçš„å®¹å™¨åŸ·è¡Œç’°å¢ƒ\n    - **Antrea CNI**ï¼šVMware é–‹ç™¼çš„é«˜æ•ˆèƒ½ç¶²è·¯æ’ä»¶\n\n---\n\n### æ­¥é©Ÿ 1ï¼šå•Ÿå‹•è™›æ“¬æ©Ÿä¸¦ç¢ºèªç’°å¢ƒ\n\né¦–å…ˆï¼Œåœ¨ VMware Workstation ä¸­å•Ÿå‹•ä¸‰å°è™›æ“¬æ©Ÿï¼š\n\n- K8S-MASTER1\n- K8S-NODE1  \n- K8S-NODE2\n\nç™»å…¥ `k8s-master1`ï¼Œç¢ºèªä¸»æ©Ÿåç¨±èˆ‡ç¶²è·¯è¨­å®šï¼š\n\n```bash title=\"ç¢ºèªä¸»æ©Ÿåç¨±\"\nhostname\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nk8s-master1.training.lab\n```\n\n```bash title=\"ç¢ºèª IP ä½å€\"\nifconfig ens160\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nens160: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.66.71  netmask 255.255.255.0  broadcast 192.168.66.255\n```\n\n```bash title=\"ç¢ºèª /etc/hosts è¨­å®š\"\ncat /etc/hosts\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.66.71\t\tk8s-master1.training.lab\tk8s-master1\n192.168.66.81\t\tk8s-node1.training.lab\t\tk8s-node1\n192.168.66.82\t\tk8s-node2.training.lab\t\tk8s-node2\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šç¢ºèªç¶²è·¯é€£ç·š\n\næ¸¬è©¦èˆ‡å…¶ä»–ç¯€é»çš„é€£ç·šï¼š\n\n```bash title=\"Ping Worker Node 1\"\nping k8s-node1 -c3\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nPING k8s-node1.training.lab (192.168.66.81) 56(84) bytes of data.\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=1 ttl=64 time=0.430 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=2 ttl=64 time=0.345 ms\n64 bytes from k8s-node1.training.lab (192.168.66.81): icmp_seq=3 ttl=64 time=0.243 ms\n\n--- k8s-node1.training.lab ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss\n```\n\n```bash title=\"Ping Worker Node 2\"\nping k8s-node2 -c3\n```\n\n```bash title=\"æ¸¬è©¦ç¶²éš›ç¶²è·¯é€£ç·š\"\nping google.com -c3\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nPING google.com (142.250.66.78) 56(84) bytes of data.\n64 bytes from lctsaa-aa-in-f14.1e100.net (142.250.66.78): icmp_seq=1 ttl=128 time=66.8 ms\n...\n3 packets transmitted, 3 received, 0% packet loss\n```\n\n!!! success \"é€£ç·šç¢ºèª\"\n    ç¢ºä¿ä¸‰å°è™›æ“¬æ©Ÿä¹‹é–“å¯ä»¥äº’ç›¸ ping é€šï¼Œä¸”å¯ä»¥é€£æ¥ç¶²éš›ç¶²è·¯ä¸‹è¼‰å¥—ä»¶ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šä¸‹è¼‰å®‰è£ Script\n\nå¾èª²ç¨‹ä¼ºæœå™¨ä¸‹è¼‰ Kubernetes å®‰è£è…³æœ¬ï¼š\n\n```bash title=\"ä¸‹è¼‰å®‰è£è…³æœ¬\"\nwget http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n--2026-01-27 15:55:16--  http://10.0.1.249/k8s/scripts/install_k8s-latest.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22517 (22K) [application/x-sh]\nSaving to: 'install_k8s-latest.sh'\n\ninstall_k8s-latest.sh    100%[==>]  21.99K  51.0KB/s    in 0.4s    \n\n2026-01-27 15:55:17 (51.0 KB/s) - 'install_k8s-latest.sh' saved [22517/22517]\n```\n\nè¨­å®šåŸ·è¡Œæ¬Šé™ï¼š\n\n```bash title=\"è¨­å®šåŸ·è¡Œæ¬Šé™\"\nchmod 755 install_k8s-latest.sh\n```\n\næŸ¥çœ‹ä½¿ç”¨èªªæ˜ï¼š\n\n```bash title=\"æŸ¥çœ‹è…³æœ¬ä½¿ç”¨æ–¹å¼\"\n./install_k8s-latest.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nè«‹è¼¸å…¥ å®Œæ•´å®‰è£(full) æˆ–æ˜¯ standalone\n./install_k8s-latest.sh -full\næˆ– \n./install_k8s-latest.sh -standalone\n```\n\n---\n\n### æ­¥é©Ÿ 4ï¼šåŸ·è¡Œå®Œæ•´å®‰è£\n\nåŸ·è¡Œè…³æœ¬é€²è¡Œå®Œæ•´å¢é›†å®‰è£ï¼ˆåŒ…å« Master å’Œ Worker ç¯€é»ï¼‰ï¼š\n\n```bash title=\"åŸ·è¡Œå®Œæ•´å®‰è£\"\n./install_k8s-latest.sh -full\n```\n\n!!! warning \"å®‰è£æ™‚é–“\"\n    å®Œæ•´å®‰è£éç¨‹ç´„éœ€ 5-10 åˆ†é˜ï¼Œå–æ±ºæ–¼ç¶²è·¯é€Ÿåº¦ã€‚è«‹è€å¿ƒç­‰å¾…ã€‚\n\n#### å®‰è£éç¨‹èªªæ˜\n\nè…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š\n\n```mermaid\ngraph LR\n    A[å®‰è£ sshpass] --> B[å®‰è£ Docker CE]\n    B --> C[è¨­å®š bash-completion]\n    C --> D[é—œé–‰ Swap]\n    D --> E[è¨­å®š Kernel åƒæ•¸]\n    E --> F[å®‰è£ kubeadm/kubectl/kubelet]\n    F --> G[å®‰è£ CRI-O]\n    G --> H[kubeadm init]\n    H --> I[Worker åŠ å…¥å¢é›†]\n    I --> J[å®‰è£ Antrea CNI]\n```\n\n**ä¸»è¦å®‰è£é …ç›®**ï¼š\n\n| éšæ®µ | èªªæ˜ |\n|------|------|\n| **sshpass** | ç”¨æ–¼è‡ªå‹•åŒ– SSH ç™»å…¥ Worker ç¯€é» |\n| **Docker CE** | å®‰è£ Docker 29.2.0ï¼ˆæ‰€æœ‰ç¯€é»ï¼‰ |\n| **bash-completion** | kubectl æŒ‡ä»¤è‡ªå‹•è£œé½Š |\n| **Swap é—œé–‰** | Kubernetes è¦æ±‚é—œé–‰ Swap |\n| **Kernel åƒæ•¸** | è¨­å®š ip_forwardã€bridge-nf-call ç­‰ |\n| **kubeadm/kubectl/kubelet** | Kubernetes 1.32.11 æ ¸å¿ƒå…ƒä»¶ |\n| **CRI-O** | å®¹å™¨åŸ·è¡Œç’°å¢ƒ 1.32.1 |\n| **Antrea** | CNI ç¶²è·¯æ’ä»¶ |\n\n---\n\n### æ­¥é©Ÿ 5ï¼šé©—è­‰å®‰è£çµæœ\n\nå®‰è£å®Œæˆå¾Œï¼Œè…³æœ¬æœƒé¡¯ç¤ºé¡ä¼¼ä»¥ä¸‹è¨Šæ¯ï¼š\n\n```\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.66.71:6443 --token hv80nh.sji1vjeju8b5l10n \\\n\t--discovery-token-ca-cert-hash sha256:f2af63e6d5dafedcc62702dcb939b51bfa98b96ab996af3556665a05a7cf0a6c\n```\n\n!!! success \"å®‰è£æˆåŠŸ\"\n    çœ‹åˆ° \"Your Kubernetes control-plane has initialized successfully!\" è¡¨ç¤º Master ç¯€é»å®‰è£æˆåŠŸã€‚\n\n---\n\n### æ­¥é©Ÿ 6ï¼šç›£æ§å¢é›†ç‹€æ…‹\n\nä½¿ç”¨ `while` è¿´åœˆæŒçºŒç›£æ§ç¯€é»ç‹€æ…‹ï¼š\n\n```bash title=\"æŒçºŒç›£æ§ç¯€é»ç‹€æ…‹\"\nwhile true\ndo\n  date\n  kubectl get nodes\n  sleep 5\ndone\n```\n\n**åˆå§‹ç‹€æ…‹**ï¼ˆNotReadyï¼‰ï¼š\n\n```\nTue Jan 27 04:05:22 PM CST 2026\nNAME                       STATUS     ROLES           AGE   VERSION\nk8s-master1.training.lab   NotReady   control-plane   84s   v1.32.11\nk8s-node1.training.lab     NotReady   <none>          76s   v1.32.11\nk8s-node2.training.lab     NotReady   <none>          75s   v1.32.11\n```\n\n!!! info \"NotReady ç‹€æ…‹\"\n    å‰›å®‰è£å®Œæˆæ™‚ï¼Œç¯€é»æœƒé¡¯ç¤º `NotReady`ï¼Œç­‰å¾… CNI ç¶²è·¯æ’ä»¶å®Œæˆåˆå§‹åŒ–å¾Œæœƒè®Šæˆ `Ready`ã€‚\n\n**æœ€çµ‚ç‹€æ…‹**ï¼ˆReadyï¼‰ï¼š\n\n```\nNAME                       STATUS   ROLES           AGE    VERSION\nk8s-master1.training.lab   Ready    control-plane   5m     v1.32.11\nk8s-node1.training.lab     Ready    <none>          4m52s  v1.32.11\nk8s-node2.training.lab     Ready    <none>          4m51s  v1.32.11\n```\n\næŒ‰ `Ctrl+C` åœæ­¢ç›£æ§ã€‚\n\n---\n\n### æ­¥é©Ÿ 7ï¼šé©—è­‰éƒ¨ç½²åŠŸèƒ½\n\nå»ºç«‹ä¸€å€‹æ¸¬è©¦ Deployment ä¾†é©—è­‰å¢é›†åŠŸèƒ½ï¼š\n\n```bash title=\"å»ºç«‹æ¸¬è©¦ Deployment\"\nkubectl create deployment test1 --image=httpd\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 created\n```\n\næŸ¥çœ‹ Deployment ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ Deployment\"\nkubectl get deployments\n```\n\n```bash title=\"æŸ¥çœ‹ Pod è©³ç´°è³‡è¨Š\"\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼ˆPod Runningï¼‰ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE   IP            NODE\ntest1-5b88789dbb-h99dh   1/1     Running   0          30s   10.244.1.2    k8s-node1.training.lab\n```\n\n!!! tip \"æ¸…ç†æ¸¬è©¦è³‡æº\"\n    æ¸¬è©¦å®Œæˆå¾Œï¼Œå¯ä»¥åˆªé™¤æ¸¬è©¦ Deploymentï¼š\n    ```bash\n    kubectl delete deployment test1\n    ```\n\n---\n\n### å¸¸ç”¨æª¢æŸ¥æŒ‡ä»¤\n\n```bash title=\"æª¢æŸ¥æ‰€æœ‰ Podï¼ˆåŒ…å«ç³»çµ± Podï¼‰\"\nkubectl get pods -A\n```\n\n```bash title=\"æª¢æŸ¥å¢é›†è³‡è¨Š\"\nkubectl cluster-info\n```\n\n```bash title=\"æŸ¥çœ‹ç¯€é»è©³ç´°è³‡è¨Š\"\nkubectl describe node k8s-master1.training.lab\n```\n\n```bash title=\"æª¢æŸ¥ CRI-O ç‹€æ…‹\"\nsystemctl status crio\n```\n\n```bash title=\"æª¢æŸ¥ kubelet ç‹€æ…‹\"\nsystemctl status kubelet\n```\n\n---\n\n### å®‰è£æ‘˜è¦\n\n| é …ç›® | ç‰ˆæœ¬/å€¼ |\n|------|---------|\n| **Kubernetes** | 1.32.11 |\n| **CRI-O** | 1.32.1 |\n| **Docker CE** | 29.2.0 |\n| **CNI** | Antrea |\n| **Pod Network CIDR** | 10.244.0.0/16 |\n| **Service CIDR** | 172.30.0.0/16 |\n\n!!! success \"å®Œæˆç¢ºèª\"\n    ç•¶æ‰€æœ‰ç¯€é»é¡¯ç¤º `Ready` ç‹€æ…‹ï¼Œä¸”æ¸¬è©¦ Pod å¯ä»¥æ­£å¸¸é‹è¡Œï¼Œè¡¨ç¤º Kubernetes å¢é›†å®‰è£æˆåŠŸï¼\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **ç’°å¢ƒæº–å‚™**ï¼šå•Ÿå‹•ä¸‰å°è™›æ“¬æ©Ÿï¼ˆk8s-master1ã€k8s-node1ã€k8s-node2ï¼‰\n- âœ… **ç¶²è·¯ç¢ºèª**ï¼šç¢ºä¿ç¯€é»é–“å¯ä»¥äº’ç›¸é€šè¨Šï¼Œä¸”å¯é€£æ¥ç¶²éš›ç¶²è·¯\n- âœ… **è…³æœ¬å®‰è£**ï¼šä½¿ç”¨ `install_k8s-latest.sh -full` è‡ªå‹•åŒ–å®‰è£\n- âœ… **æ ¸å¿ƒå…ƒä»¶**ï¼šå®‰è£ kubeadmã€kubectlã€kubelet v1.32.11\n- âœ… **å®¹å™¨åŸ·è¡Œç’°å¢ƒ**ï¼šå®‰è£ CRI-O v1.32.1\n- âœ… **CNI ç¶²è·¯**ï¼šéƒ¨ç½² Antrea ç¶²è·¯æ’ä»¶\n- âœ… **å¢é›†é©—è­‰**ï¼šç¢ºèªæ‰€æœ‰ç¯€é» Ready ä¸¦æ¸¬è©¦ Deployment\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes å®˜æ–¹æ–‡ä»¶](https://kubernetes.io/docs/)\n- [kubeadm å®‰è£æŒ‡å—](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/)\n- [CRI-O å®˜æ–¹æ–‡ä»¶](https://cri-o.io/)\n- [Antrea CNI](https://antrea.io/)\n"
  },
  {
    "title": "å®Œæ•´å¯«æ³•",
    "url": "https://caocharles.github.io/dcka-class-notes/lab13_k8s_commands/",
    "content": "ï»¿# LAB 13 Kubernetes å¸¸ç”¨æŒ‡ä»¤\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ kubectl å»ºç«‹èˆ‡ç®¡ç† Deployment\n- [ ] ä½¿ç”¨ kubectl run å»ºç«‹ç¨ç«‹ Pod\n- [ ] ä½¿ç”¨ kubectl scale æ‰‹å‹•æ“´å±• Deployment\n- [ ] ä½¿ç”¨ kubectl autoscale è¨­å®šè‡ªå‹•æ“´å±•ï¼ˆHPAï¼‰\n- [ ] ä½¿ç”¨ Labels æ¨™ç±¤ç®¡ç†èˆ‡æŸ¥è©¢ Pod\n- [ ] ä½¿ç”¨ YAML æª”æ¡ˆéƒ¨ç½²èˆ‡åˆªé™¤è³‡æº\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 12 Kubernetes å¢é›†å®‰è£\n- ç†Ÿæ‚‰ Kubernetes åŸºæœ¬æ¦‚å¿µï¼ˆPodã€Deploymentã€Serviceï¼‰\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### kubectl æ˜¯ä»€éº¼ï¼Ÿ\n\n`kubectl`ï¼ˆè®€éŸ³ï¼škube-control æˆ– kube-C-T-Lï¼‰æ˜¯ Kubernetes çš„**å‘½ä»¤åˆ—å·¥å…·ï¼ˆCLIï¼‰**ï¼Œç”¨ä¾†èˆ‡ Kubernetes å¢é›†é€²è¡Œäº’å‹•ã€‚\n\n```mermaid\ngraph LR\n    User[ä½¿ç”¨è€…] --> kubectl[kubectl æŒ‡ä»¤]\n    kubectl --> API[API Server]\n    API --> Controller[Controller Manager]\n    API --> Scheduler[Scheduler]\n    API --> etcd[(etcd)]\n```\n\n!!! info \"kubectl åŠŸèƒ½\"\n    - å»ºç«‹ã€æŸ¥çœ‹ã€æ›´æ–°ã€åˆªé™¤ Kubernetes è³‡æº\n    - æŸ¥çœ‹å¢é›†ç‹€æ…‹èˆ‡æ—¥èªŒ\n    - é€²å…¥å®¹å™¨åŸ·è¡ŒæŒ‡ä»¤\n    - éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼\n\n---\n\n### Pod æ˜¯ä»€éº¼ï¼Ÿ\n\n**Podï¼ˆè±†è¢ï¼‰** æ˜¯ Kubernetes ä¸­**æœ€å°çš„éƒ¨ç½²å–®ä½**ï¼Œä¸€å€‹ Pod å¯ä»¥åŒ…å«ä¸€å€‹æˆ–å¤šå€‹å®¹å™¨ï¼ˆContainerï¼‰ã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Pod\"\n        C1[Container 1]\n        C2[Container 2]\n        Volume[(Shared Volume)]\n        C1 -.-> Volume\n        C2 -.-> Volume\n    end\n    Network[Shared Network<br/>åŒä¸€å€‹ IP]\n    Pod --> Network\n```\n\n| ç‰¹æ€§ | èªªæ˜ |\n|------|------|\n| **å…±äº«ç¶²è·¯** | åŒä¸€å€‹ Pod å…§çš„å®¹å™¨å…±äº«ç›¸åŒçš„ IP ä½å€å’Œ Port |\n| **å…±äº«å„²å­˜** | å¯ä»¥æ›è¼‰å…±äº«çš„ Volume |\n| **ç”Ÿå‘½é€±æœŸ** | Pod æ˜¯è‡¨æ™‚æ€§çš„ï¼Œå¯èƒ½éš¨æ™‚è¢«é‡æ–°èª¿åº¦ |\n| **æœ€å°å–®ä½** | ç„¡æ³•éƒ¨ç½²ã€ŒåŠå€‹å®¹å™¨ã€ï¼ŒPod æ˜¯ä¸å¯åˆ†å‰²çš„ |\n\n---\n\n### Deployment æ˜¯ä»€éº¼ï¼Ÿ\n\n**Deploymentï¼ˆéƒ¨ç½²ï¼‰** æ˜¯ Kubernetes ä¸­ç”¨ä¾†**ç®¡ç† Pod å‰¯æœ¬æ•¸é‡å’Œæ›´æ–°ç­–ç•¥**çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚\n\n```mermaid\ngraph TB\n    D[Deployment] --> RS[ReplicaSet]\n    RS --> P1[Pod 1]\n    RS --> P2[Pod 2]\n    RS --> P3[Pod 3]\n```\n\n| Deployment åŠŸèƒ½ | èªªæ˜ |\n|-----------------|------|\n| **å‰¯æœ¬ç®¡ç†** | ç¢ºä¿æŒ‡å®šæ•¸é‡çš„ Pod å‰¯æœ¬å§‹çµ‚é‹è¡Œ |\n| **è‡ªå‹•ä¿®å¾©** | Pod æ›æ‰æ™‚è‡ªå‹•å»ºç«‹æ–°çš„ Pod |\n| **æ»¾å‹•æ›´æ–°** | æ›´æ–°æ‡‰ç”¨ç¨‹å¼æ™‚é€æ­¥æ›¿æ›èˆŠ Pod |\n| **å›æ»¾** | ç™¼ç¾å•é¡Œæ™‚å¯ä»¥å›åˆ°å…ˆå‰ç‰ˆæœ¬ |\n\n!!! tip \"Pod vs Deployment\"\n    - **ç›´æ¥å»ºç«‹ Pod**ï¼ˆä½¿ç”¨ `kubectl run`ï¼‰ï¼šé©åˆæ¸¬è©¦ï¼Œä½† Pod æ›æ‰å¾Œ**ä¸æœƒè‡ªå‹•é‡å»º**\n    - **ä½¿ç”¨ Deployment**ï¼ˆä½¿ç”¨ `kubectl create deployment`ï¼‰ï¼šæ­£å¼ç’°å¢ƒæ¨è–¦ï¼Œæœƒ**è‡ªå‹•ç¶­è­·æŒ‡å®šæ•¸é‡çš„ Pod**\n\n---\n\n### API è³‡æºç°¡ç¨±\n\nåœ¨ `kubectl` æŒ‡ä»¤ä¸­ï¼Œä½ å¯èƒ½æœƒçœ‹åˆ°ä¸åŒçš„è³‡æºåç¨±å¯«æ³•ï¼š\n\n| å®Œæ•´åç¨± | ç°¡ç¨± | èªªæ˜ |\n|----------|------|------|\n| `pods` | `po` | Pod è³‡æº |\n| `deployments.apps` | `deploy` | Deployment è³‡æº |\n| `services` | `svc` | Service è³‡æº |\n| `replicasets.apps` | `rs` | ReplicaSet è³‡æº |\n| `namespaces` | `ns` | Namespace è³‡æº |\n| `configmaps` | `cm` | ConfigMap è³‡æº |\n| `secrets` | `secret` | Secret è³‡æº |\n| `persistentvolumeclaims` | `pvc` | PVC è³‡æº |\n\n**ç¯„ä¾‹**ï¼šä»¥ä¸‹æŒ‡ä»¤æ•ˆæœç›¸åŒï¼š\n\n```bash\n# å®Œæ•´å¯«æ³•\nkubectl get deployments.apps\n\n# ç°¡ç¨±å¯«æ³•\nkubectl get deploy\n```\n\n!!! note \"deployments.apps çš„ç”±ä¾†\"\n    `deployments.apps` è¡¨ç¤º Deployment è³‡æºå±¬æ–¼ `apps` API ç¾¤çµ„ã€‚é€™æ˜¯å› ç‚º Kubernetes çš„ API åˆ†æˆå¤šå€‹ç¾¤çµ„ï¼ˆå¦‚ `core`ã€`apps`ã€`batch`ï¼‰ï¼Œå®Œæ•´å¯«æ³•å¯ä»¥æ˜ç¢ºæŒ‡å®šè³‡æºä¾†æºã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šKubernetes åŸºæœ¬æŒ‡ä»¤æ“ä½œ\n\n### ç’°å¢ƒæº–å‚™\n\n```mermaid\ngraph TB\n    subgraph \"Kubernetes Cluster\"\n        Master[k8s-master1<br/>192.168.66.71<br/>Control Plane]\n        Node1[k8s-node1<br/>192.168.66.81<br/>Worker Node]\n        Node2[k8s-node2<br/>192.168.66.82<br/>Worker Node]\n        Master --> Node1\n        Master --> Node2\n    end\n    \n    subgraph \"Private Registry\"\n        Docker1[docker1.training.lab:5000<br/>ç§æœ‰æ˜ åƒæª”å€‰åº«]\n    end\n    \n    Master -.-> Docker1\n    Node1 -.-> Docker1\n    Node2 -.-> Docker1\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–ç§æœ‰ Registry é€£ç·šè¨­å®š\n\nç‚ºäº†è®“æ‰€æœ‰ç¯€é»éƒ½èƒ½å¾ç§æœ‰ Registry æ‹‰å–æ˜ åƒæª”ï¼Œéœ€è¦å…ˆåŸ·è¡Œåˆå§‹åŒ–è…³æœ¬ï¼š\n\n```bash title=\"ä¸‹è¼‰åˆå§‹åŒ–è…³æœ¬\"\nwget http://10.0.1.249/k8s/scripts/init_pull_from_private_registry.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n--2026-01-28 10:40:26--  http://10.0.1.249/k8s/scripts/init_pull_from_private_registry.sh\nConnecting to 10.0.1.249:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3711 (3.6K) [application/x-sh]\nSaving to: 'init_pull_from_private_registry.sh'\n\ninit_pull_from_private_registry.sh   100%[======>]   3.62K  --.-KB/s    in 0s      \n\n2026-01-28 10:40:26 (760 MB/s) - 'init_pull_from_private_registry.sh' saved [3711/3711]\n```\n\nè¨­å®šåŸ·è¡Œæ¬Šé™ä¸¦åŸ·è¡Œè…³æœ¬ï¼š\n\n```bash title=\"è¨­å®šæ¬Šé™ä¸¦åŸ·è¡Œ\"\nchmod 755 init_pull_from_private_registry.sh\n./init_pull_from_private_registry.sh\n```\n\n**é æœŸçµæœ**ï¼ˆéƒ¨åˆ†è¼¸å‡ºï¼‰ï¼š\n\n```\ndocker1\nWarning: Permanently added 'docker1' (ED25519) to the list of known hosts.\ndocker1.training.lab\ndocker-ce-29.1.5-1.el9.x86_64\nInstall docker-ce...\ncontainerd.io-2.2.1-1.el9.x86_64\nInstall containerd.io...\n...\nk8s-master1\nk8s-master1.training.lab\ndocker-ce-29.2.0-1.el9.x86_64\nInstall docker-ce...\ncontainerd.io-2.2.1-1.el9.x86_64\nInstall containerd.io...\ncri-o-1.32.1-150500.1.1.x86_64\nInstall cri-o...\n```\n\n!!! info \"è…³æœ¬åŠŸèƒ½\"\n    æ­¤è…³æœ¬æœƒè‡ªå‹•è¨­å®šæ‰€æœ‰ç¯€é»ï¼ˆdocker1ã€docker2ã€k8s-standaloneã€k8s-master1ã€k8s-node1ã€k8s-node2ï¼‰çš„ Dockerã€containerd å’Œ CRI-O ç’°å¢ƒï¼Œä½¿å…¶èƒ½å¤ å¾ç§æœ‰ Registry æ‹‰å–æ˜ åƒæª”ã€‚\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæ¸…ç†ç¾æœ‰è³‡æº\n\nä¸‹è¼‰ä¸¦åŸ·è¡Œæ¸…ç†è…³æœ¬ï¼š\n\n```bash title=\"ä¸‹è¼‰æ¸…ç†è…³æœ¬\"\ncurl -LO http://10.0.1.249/k8s/scripts/kube_clean_all.sh\nchmod 755 kube_clean_all.sh\n```\n\nåŸ·è¡Œæ¸…ç†ï¼š\n\n```bash title=\"æ¸…ç†æ‰€æœ‰è³‡æº\"\n./kube_clean_all.sh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nservice \"kubernetes\" deleted\ndeployment.apps \"test1\" deleted\nNo resources found\nconfigmap \"kube-root-ca.crt\" deleted\nnamespace \"kube-node-lease\" deleted\nError from server (Forbidden): namespaces \"default\" is forbidden: this namespace may not be deleted\nError from server (Forbidden): namespaces \"kube-public\" is forbidden: this namespace may not be deleted\nError from server (Forbidden): namespaces \"kube-system\" is forbidden: this namespace may not be deleted\n```\n\n!!! warning \"ç³»çµ±å‘½åç©ºé–“\"\n    `default`ã€`kube-public`ã€`kube-system` ç‚ºç³»çµ±ä¿è­·çš„å‘½åç©ºé–“ï¼Œç„¡æ³•è¢«åˆªé™¤ï¼Œå‡ºç¾éŒ¯èª¤è¨Šæ¯æ˜¯æ­£å¸¸çš„ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå»ºç«‹ Deployment\n\nä½¿ç”¨ `kubectl create deployment` å»ºç«‹ Deploymentï¼š\n\n```bash title=\"å»ºç«‹ Deployment (4 å€‹å‰¯æœ¬)\"\nkubectl create deployment test1 --image=docker1.training.lab:5000/httpd --replicas=4\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 created\n```\n\næŸ¥çœ‹ Deployment ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ Deployment\"\nkubectl get deployments.apps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   0/4     4            0           13s\n```\n\næŸ¥çœ‹ Pod è©³ç´°è³‡è¨Šï¼š\n\n```bash title=\"æŸ¥çœ‹ Pod è©³ç´°ä½ç½®\"\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                    READY   STATUS    RESTARTS   AGE     IP       NODE     NOMINATED NODE   READINESS GATES\ntest1-dcd787f9d-9rkdj   0/1     Pending   0          5m49s   <none>   <none>   <none>           <none>\ntest1-dcd787f9d-cqqmc   0/1     Pending   0          5m49s   <none>   <none>   <none>           <none>\ntest1-dcd787f9d-l5rmx   0/1     Pending   0          5m49s   <none>   <none>   <none>           <none>\ntest1-dcd787f9d-rznwh   0/1     Pending   0          5m49s   <none>   <none>   <none>           <none>\n```\n\n!!! note \"Pending ç‹€æ…‹\"\n    å¦‚æœ Pod é¡¯ç¤º `Pending` ç‹€æ…‹ï¼Œå¯èƒ½æ˜¯å› ç‚ºï¼š\n    \n    - Worker Node å°šæœª Ready\n    - è³‡æºä¸è¶³\n    - ç„¡æ³•æ‹‰å–æ˜ åƒæª”\n    \n    ä½¿ç”¨ `kubectl describe pod <pod-name>` æŸ¥çœ‹è©³ç´°åŸå› ã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šåˆªé™¤ Pod èˆ‡ Deployment\n\nåˆªé™¤å–®ä¸€ Podï¼š\n\n```bash title=\"åˆªé™¤æŒ‡å®š Pod\"\nkubectl delete pod/test1-dcd787f9d-rznwh\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod \"test1-dcd787f9d-rznwh\" deleted\n```\n\n!!! tip \"Pod åç¨±æ ¼å¼\"\n    Pod åç¨±æ ¼å¼ç‚º `<deployment-name>-<replicaset-hash>-<pod-hash>`ã€‚\n    æ³¨æ„ä¸è¦å¤šæ‰“é€£å­—è™Ÿï¼ˆ`--`ï¼‰ï¼Œå¦å‰‡æœƒæ‰¾ä¸åˆ° Podã€‚\n\nåˆªé™¤æ•´å€‹ Deploymentï¼ˆæœƒåŒæ™‚åˆªé™¤æ‰€æœ‰ç›¸é—œ Podï¼‰ï¼š\n\n```bash title=\"åˆªé™¤ Deployment\"\nkubectl delete deployments.apps test1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps \"test1\" deleted\n```\n\né©—è­‰åˆªé™¤çµæœï¼š\n\n```bash title=\"ç¢ºèªåˆªé™¤å®Œæˆ\"\nkubectl get deployments.apps\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNo resources found in default namespace.\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šä½¿ç”¨ kubectl run å»ºç«‹ Pod\n\nä½¿ç”¨ `kubectl run` ç›´æ¥å»ºç«‹ç¨ç«‹ Podï¼ˆä¸é€é Deploymentï¼‰ï¼š\n\n```bash title=\"å»ºç«‹ Pod ä¸¦è¨­å®šç’°å¢ƒè®Šæ•¸\"\nkubectl run test4 --image=docker1.training.lab:5000/nginx --env=\"TEST=test4\"\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod/test4 created\n```\n\né€²å…¥ Pod åŸ·è¡ŒæŒ‡ä»¤ï¼ˆä½¿ç”¨ `kubectl exec`ï¼‰ï¼š\n\n```bash title=\"é€²å…¥ Pod åŸ·è¡Œ bash\"\nkubectl exec test4 -it -- bash\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤\"\n    **éŒ¯èª¤å¯«æ³•**ï¼š`kubectl exec test4 -it --bash`ï¼ˆç¼ºå°‘ `--` åˆ†éš”ç¬¦ï¼‰\n    \n    **æ­£ç¢ºå¯«æ³•**ï¼š`kubectl exec test4 -it -- bash`\n    \n    `--` ç”¨ä¾†åˆ†éš” kubectl åƒæ•¸å’Œå®¹å™¨å…§è¦åŸ·è¡Œçš„æŒ‡ä»¤ã€‚\n\n---\n\n### æ­¥é©Ÿ 6ï¼šå»ºç«‹èˆ‡æ“´å±• Deployment\n\nå»ºç«‹ Deploymentï¼š\n\n```bash title=\"å»ºç«‹ test5 Deployment\"\nkubectl create deployment test5 --image=docker1.training.lab:5000/nginx\n```\n\n```bash title=\"å»ºç«‹ test6 Deploymentï¼ˆ2 å€‹å‰¯æœ¬ï¼‰\"\nkubectl create deployment test6 --image=docker1.training.lab:5000/nginx --replicas=2\n```\n\næŸ¥çœ‹ Deployment ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ç‰¹å®š Deployment\"\nkubectl get deployments.apps test5\nkubectl get deployments.apps test6\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/1     1            0           28s\n\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest6   0/2     2            0           4m43s\n```\n\n---\n\n### æ­¥é©Ÿ 7ï¼šæ‰‹å‹•æ“´å±• Deploymentï¼ˆScaleï¼‰\n\nä½¿ç”¨ `kubectl scale` æ‰‹å‹•èª¿æ•´å‰¯æœ¬æ•¸é‡ï¼š\n\n```bash title=\"æ“´å±• test5 åˆ° 3 å€‹å‰¯æœ¬\"\nkubectl scale deployment test5 --replicas=3\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test5 scaled\n```\n\né©—è­‰æ“´å±•çµæœï¼š\n\n```bash title=\"æŸ¥çœ‹æ“´å±•å¾Œçš„ç‹€æ…‹\"\nkubectl get deployments.apps test5\nkubectl get pods | grep test5\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/3     3            0           10m\n\ntest5-8464657978-5jgj6   0/1     Pending   0          10m\ntest5-8464657978-fc7zg   0/1     Pending   0          28s\ntest5-8464657978-sqgql   0/1     Pending   0          28s\n```\n\n---\n\n### æ­¥é©Ÿ 8ï¼šè¨­å®šè‡ªå‹•æ“´å±•ï¼ˆAutoscale / HPAï¼‰\n\nä½¿ç”¨ `kubectl autoscale` å»ºç«‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼š\n\n```bash title=\"è¨­å®šè‡ªå‹•æ“´å±•\"\nkubectl autoscale deployment test5 --min=4 --max=9 --cpu-percent=80\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nhorizontalpodautoscaler.autoscaling/test5 autoscaled\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤\"\n    **éŒ¯èª¤å¯«æ³•**ï¼š\n    \n    - `--cpu80%`ï¼ˆç¼ºå°‘ç­‰è™Ÿå’Œ percentï¼‰\n    - `--cpu 80%`ï¼ˆæœ‰ç©ºæ ¼ã€ç¼ºå°‘ percentï¼‰\n    - `--cpu=80%`ï¼ˆflag åç¨±éŒ¯èª¤ï¼‰\n    \n    **æ­£ç¢ºå¯«æ³•**ï¼š`--cpu-percent=80`\n\né©—è­‰ HPA æ•ˆæœï¼š\n\n```bash title=\"æŸ¥çœ‹æ“´å±•å¾Œçš„ Deployment\"\nkubectl get deployments.apps test5\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest5   0/4     4            0           12m\n```\n\n!!! info \"HPA èªªæ˜\"\n    HPA æœƒæ ¹æ“š CPU ä½¿ç”¨ç‡è‡ªå‹•èª¿æ•´ Pod æ•¸é‡ï¼š\n    \n    - **--min=4**ï¼šæœ€å°‘ç¶­æŒ 4 å€‹å‰¯æœ¬\n    - **--max=9**ï¼šæœ€å¤šæ“´å±•åˆ° 9 å€‹å‰¯æœ¬\n    - **--cpu-percent=80**ï¼šç•¶ CPU ä½¿ç”¨ç‡è¶…é 80% æ™‚è§¸ç™¼æ“´å±•\n\n---\n\n### æ­¥é©Ÿ 9ï¼šä½¿ç”¨ Labels æ¨™ç±¤ç®¡ç† Pod\n\nå»ºç«‹å¸¶æœ‰è‡ªè¨‚ Label çš„ Podï¼š\n\n```bash title=\"å»ºç«‹å¸¶æœ‰ Label çš„ Pod\"\nkubectl run test7 --image=docker1.training.lab:5000/nginx --labels=\"os=linux\"\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod/test7 created\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤\"\n    **éŒ¯èª¤å¯«æ³•**ï¼š`kubectl run test8 --image=nginx ==labels=\"os=windows\"`ï¼ˆå…©å€‹ç­‰è™Ÿï¼‰\n    \n    **æ­£ç¢ºå¯«æ³•**ï¼š`kubectl run test8 --image=nginx --labels=\"os=windows\"`\n\næŸ¥çœ‹ Pod Labelsï¼š\n\n```bash title=\"é¡¯ç¤ºæ‰€æœ‰ Pod çš„ Labels\"\nkubectl get pods --show-labels\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE     LABELS\ntest4                    0/1     Pending   0          18m     run=test4\ntest5-8464657978-5jgj6   0/1     Pending   0          14m     app=test5,pod-template-hash=8464657978\ntest7                    0/1     Pending   0          47s     os=linux\ntest8                    0/1     Pending   0          13s     run=test8\n```\n\nä¾æ“š Label éæ¿¾ Podï¼š\n\n```bash title=\"éæ¿¾åŒ…å« os Label çš„ Pod\"\nkubectl get pods --show-labels | grep 'os='\n```\n\n```bash title=\"é¡¯ç¤ºç‰¹å®š Label æ¬„ä½\"\nkubectl get pods -L os\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                     READY   STATUS    RESTARTS   AGE     OS\ntest4                    0/1     Pending   0          20m     \ntest5-8464657978-5jgj6   0/1     Pending   0          16m     \ntest7                    0/1     Pending   0          2m57s   linux\ntest8                    0/1     Pending   0          2m23s   \n```\n\n!!! tip \"Label ä½¿ç”¨æŠ€å·§\"\n    - `--show-labels`ï¼šé¡¯ç¤ºæ‰€æœ‰ Labels\n    - `-L <label-key>`ï¼šå°‡æŒ‡å®šçš„ Label é¡¯ç¤ºç‚ºç¨ç«‹æ¬„ä½\n    - `-l <label-selector>`ï¼šä¾æ“š Label éæ¿¾è³‡æº\n\n---\n\n### æ­¥é©Ÿ 10ï¼šä½¿ç”¨ YAML æª”æ¡ˆéƒ¨ç½²\n\nå¾ URL ç›´æ¥å¥—ç”¨ YAML æª”æ¡ˆï¼š\n\n```bash title=\"å¾ URL å¥—ç”¨ YAML\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/test9.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod/test9 created\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤\"\n    æ³¨æ„ URL è·¯å¾‘è¦æ­£ç¢ºï¼ˆ`/k8s/yaml/`ï¼‰ï¼Œæ‰“éŒ¯æœƒå‡ºç¾ 404 éŒ¯èª¤ï¼š\n    ```\n    error: unable to read URL \"http://10.0.1.249/k8s/taml/test9.yaml\", \n    server reported 404 Not Found, status code=404\n    ```\n\nä¸‹è¼‰ YAML æª”æ¡ˆæŸ¥çœ‹å…§å®¹ï¼š\n\n```bash title=\"ä¸‹è¼‰ YAML æª”æ¡ˆ\"\nwget http://10.0.1.249/k8s/yaml/test9.yaml\n```\n\n```bash title=\"æŸ¥çœ‹ YAML å…§å®¹\"\ncat test9.yaml\n```\n\n**YAML å…§å®¹**ï¼š\n\n```yaml title=\"test9.yaml\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: test9\nspec:\n  containers:\n  - name: test9\n    image: docker1.training.lab:5000/nginx\n```\n\nä½¿ç”¨æœ¬åœ° YAML æª”æ¡ˆåˆªé™¤è³‡æºï¼š\n\n```bash title=\"ä½¿ç”¨ YAML åˆªé™¤è³‡æº\"\nkubectl delete -f test9.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod \"test9\" deleted\n```\n\n!!! tip \"YAML éƒ¨ç½²çš„å„ªé»\"\n    - **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¯ä»¥å°‡ YAML æª”æ¡ˆç´å…¥ Git ç®¡ç†\n    - **é‡è¤‡ä½¿ç”¨**ï¼šåŒä¸€å€‹ YAML å¯ä»¥é‡è¤‡éƒ¨ç½²\n    - **å®Œæ•´å®šç¾©**ï¼šYAML å¯ä»¥åŒ…å«æ›´å¤šé€²éšè¨­å®š\n\n---\n\n## å¸¸ç”¨ kubectl æŒ‡ä»¤å°ç…§è¡¨\n\n| æ“ä½œ | æŒ‡ä»¤ | ç¯„ä¾‹ |\n|------|------|------|\n| **å»ºç«‹ Deployment** | `kubectl create deployment` | `kubectl create deployment test --image=nginx --replicas=3` |\n| **å»ºç«‹ Pod** | `kubectl run` | `kubectl run test --image=nginx --env=\"KEY=value\"` |\n| **æŸ¥çœ‹è³‡æº** | `kubectl get` | `kubectl get pods -o wide` |\n| **æ“´å±•å‰¯æœ¬** | `kubectl scale` | `kubectl scale deployment test --replicas=5` |\n| **è‡ªå‹•æ“´å±•** | `kubectl autoscale` | `kubectl autoscale deployment test --min=2 --max=10 --cpu-percent=80` |\n| **é€²å…¥å®¹å™¨** | `kubectl exec` | `kubectl exec test -it -- bash` |\n| **åˆªé™¤è³‡æº** | `kubectl delete` | `kubectl delete pod/test` |\n| **å¥—ç”¨ YAML** | `kubectl apply -f` | `kubectl apply -f deployment.yaml` |\n| **åˆªé™¤ YAML è³‡æº** | `kubectl delete -f` | `kubectl delete -f deployment.yaml` |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šPod ä¸€ç›´è™•æ–¼ Pending ç‹€æ…‹æ€éº¼è¾¦ï¼Ÿ\"\n    **åŸå› **ï¼šé€šå¸¸æ˜¯å› ç‚ºæ²’æœ‰å¯ç”¨çš„ Worker Node æˆ–ç¯€é»è³‡æºä¸è¶³ã€‚\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æŸ¥çœ‹è©³ç´°åŸå› \n    kubectl describe pod <pod-name>\n    \n    # ç¢ºèªç¯€é»ç‹€æ…‹\n    kubectl get nodes\n    ```\n\n??? question \"Q2ï¼škubectl exec å‡ºç¾éŒ¯èª¤ 'unknown flag: --bash'\"\n    **åŸå› **ï¼š`--bash` æ‡‰è©²æ”¾åœ¨ `--` å¾Œé¢ï¼Œä½œç‚ºå®¹å™¨å…§åŸ·è¡Œçš„æŒ‡ä»¤ã€‚\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # éŒ¯èª¤\n    kubectl exec test -it --bash\n    \n    # æ­£ç¢º\n    kubectl exec test -it -- bash\n    ```\n\n??? question \"Q3ï¼šå¦‚ä½•æŸ¥çœ‹ç‰¹å®š Label çš„ Podï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ `-l` æˆ– `-L` åƒæ•¸ï¼š\n    \n    ```bash\n    # ä¾æ“š Label éæ¿¾\n    kubectl get pods -l os=linux\n    \n    # é¡¯ç¤º Label æ¬„ä½\n    kubectl get pods -L os\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **ç’°å¢ƒåˆå§‹åŒ–**ï¼šä½¿ç”¨è…³æœ¬è¨­å®šç§æœ‰ Registry é€£ç·š\n- âœ… **Deployment ç®¡ç†**ï¼šä½¿ç”¨ `kubectl create deployment` å»ºç«‹ä¸¦ç®¡ç† Deployment\n- âœ… **Pod æ“ä½œ**ï¼šä½¿ç”¨ `kubectl run` å»ºç«‹ç¨ç«‹ Podï¼Œ`kubectl exec` é€²å…¥å®¹å™¨\n- âœ… **æ‰‹å‹•æ“´å±•**ï¼šä½¿ç”¨ `kubectl scale` èª¿æ•´å‰¯æœ¬æ•¸é‡\n- âœ… **è‡ªå‹•æ“´å±•**ï¼šä½¿ç”¨ `kubectl autoscale` è¨­å®š HPA\n- âœ… **Labels ç®¡ç†**ï¼šä½¿ç”¨ `--labels` å»ºç«‹æ¨™ç±¤ï¼Œ`--show-labels` å’Œ `-L` æŸ¥è©¢\n- âœ… **YAML éƒ¨ç½²**ï¼šä½¿ç”¨ `kubectl apply -f` å’Œ `kubectl delete -f` ç®¡ç†è³‡æº\n\n## å»¶ä¼¸é–±è®€\n\n- [kubectl å®Œæ•´æŒ‡ä»¤åƒè€ƒ](https://kubernetes.io/docs/reference/kubectl/)\n- [Kubernetes Deployments](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)\n- [Horizontal Pod Autoscaler](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)\n- [Labels and Selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)\n"
  },
  {
    "title": "æŸ¥çœ‹å¡ä½çš„è³‡æº",
    "url": "https://caocharles.github.io/dcka-class-notes/lab14_namespace_rolling/",
    "content": "ï»¿# LAB 14 Namespace èˆ‡ Rolling Update\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ä½¿ç”¨ kubectl å»ºç«‹èˆ‡ç®¡ç† Namespace\n- [ ] åœ¨ä¸åŒ Namespace ä¸­éƒ¨ç½²èˆ‡æŸ¥è©¢è³‡æº\n- [ ] ä½¿ç”¨ `--dry-run=client -o yaml` ç”¢ç”Ÿ YAML æª”æ¡ˆ\n- [ ] ä½¿ç”¨ `kubectl apply -f` å¥—ç”¨ YAML æ›´æ–°é€²è¡Œ Rolling Update\n- [ ] ä½¿ç”¨ `kubectl rollout` æŸ¥çœ‹æ­·å²ç´€éŒ„èˆ‡å›æ»¾ç‰ˆæœ¬\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 13 Kubernetes å¸¸ç”¨æŒ‡ä»¤\n- ç†Ÿæ‚‰ Podã€Deployment åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### Namespace æ˜¯ä»€éº¼ï¼Ÿ\n\n**Namespaceï¼ˆå‘½åç©ºé–“ï¼‰** æ˜¯ Kubernetes ä¸­ç”¨ä¾†**éš”é›¢è³‡æºçš„è™›æ“¬åˆ†å€**ã€‚ä¸åŒ Namespace ä¸­çš„è³‡æºåç¨±å¯ä»¥ç›¸åŒï¼Œå½¼æ­¤ä¸æœƒè¡çªã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"default namespace\"\n            D1[Deployment A]\n            P1[Pod A]\n        end\n        subgraph \"ns1 namespace\"\n            D2[Deployment A]\n            P2[Pod A]\n        end\n        subgraph \"kube-system namespace\"\n            D3[CoreDNS]\n            D4[Antrea]\n        end\n    end\n```\n\n| Namespace ç”¨é€” | èªªæ˜ |\n|----------------|------|\n| **è³‡æºéš”é›¢** | ä¸åŒåœ˜éšŠæˆ–å°ˆæ¡ˆä½¿ç”¨ä¸åŒ Namespace |\n| **æ¬Šé™æ§åˆ¶** | å¯ä»¥è¨­å®šä¸åŒ Namespace çš„å­˜å–æ¬Šé™ |\n| **è³‡æºé…é¡** | å¯ä»¥é™åˆ¶å„ Namespace çš„è³‡æºä½¿ç”¨é‡ |\n| **åç¨±å€éš”** | åŒåè³‡æºå¯ä»¥å­˜åœ¨æ–¼ä¸åŒ Namespace |\n\n---\n\n### Rolling Update æ˜¯ä»€éº¼ï¼Ÿ\n\n**Rolling Updateï¼ˆæ»¾å‹•æ›´æ–°ï¼‰** æ˜¯ Kubernetes æ›´æ–° Deployment çš„é è¨­ç­–ç•¥ï¼Œæœƒ**é€æ­¥**å°‡èˆŠç‰ˆ Pod æ›¿æ›æˆæ–°ç‰ˆï¼Œç¢ºä¿æœå‹™ä¸ä¸­æ–·ã€‚\n\n```mermaid\ngraph LR\n    subgraph \"æ›´æ–°å‰\"\n        P1[Pod v1.7.1]\n        P2[Pod v1.7.1]\n        P3[Pod v1.7.1]\n    end\n    \n    subgraph \"æ›´æ–°ä¸­\"\n        P4[Pod v1.7.1]\n        P5[Pod v1.9.1]\n        P6[Pod v1.9.1]\n    end\n    \n    subgraph \"æ›´æ–°å¾Œ\"\n        P7[Pod v1.9.1]\n        P8[Pod v1.9.1]\n        P9[Pod v1.9.1]\n    end\n    \n    æ›´æ–°å‰ --> æ›´æ–°ä¸­ --> æ›´æ–°å¾Œ\n```\n\n| Rolling Update ç‰¹æ€§ | èªªæ˜ |\n|---------------------|------|\n| **é›¶åœæ©Ÿæ™‚é–“** | æ›´æ–°éç¨‹ä¸­æœå‹™ä¸ä¸­æ–· |\n| **é€æ­¥æ›¿æ›** | ä¸€æ¬¡åªæ›¿æ›éƒ¨åˆ† Pod |\n| **å¯å›æ»¾** | ç™¼ç¾å•é¡Œå¯ä»¥å›åˆ°å…ˆå‰ç‰ˆæœ¬ |\n| **æ­·å²ç´€éŒ„** | ä¿ç•™éƒ¨ç½²ç‰ˆæœ¬æ­·å² |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šNamespace ç®¡ç†\n\n### æ­¥é©Ÿ 1ï¼šå•Ÿç”¨ kubectl æŒ‡ä»¤è‡ªå‹•è£œé½Š\n\nè¨­å®š bash è‡ªå‹•è£œé½ŠåŠŸèƒ½ï¼Œæ–¹ä¾¿æ“ä½œï¼š\n\n```bash title=\"å•Ÿç”¨ bash completion\"\nsource <(kubectl completion bash)\n```\n\n!!! tip \"æ°¸ä¹…ç”Ÿæ•ˆ\"\n    å°‡ä¸Šè¿°æŒ‡ä»¤åŠ å…¥ `~/.bashrc`ï¼Œæ¯æ¬¡ç™»å…¥è‡ªå‹•å•Ÿç”¨ï¼š\n    ```bash\n    echo 'source <(kubectl completion bash)' >> ~/.bashrc\n    ```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæ¸…ç†æ‰€æœ‰è³‡æº\n\nä½¿ç”¨ `kubectl delete all --all` åˆªé™¤ç›®å‰ Namespace ä¸­çš„æ‰€æœ‰è³‡æºï¼š\n\n```bash title=\"åˆªé™¤æ‰€æœ‰è³‡æº\"\nkubectl delete all --all\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod \"test4\" deleted\npod \"test5-8464657978-5jgj6\" deleted\nservice \"kubernetes\" deleted\ndeployment.apps \"test5\" deleted\ndeployment.apps \"test6\" deleted\nreplicaset.apps \"test5-8464657978\" deleted\nhorizontalpodautoscaler.autoscaling \"test5\" deleted\n```\n\n!!! info \"all åŒ…å«å“ªäº›è³‡æºï¼Ÿ\"\n    `kubectl delete all --all` æœƒåˆªé™¤ä»¥ä¸‹è³‡æºé¡å‹ï¼š\n    \n    - Pod\n    - Service\n    - Deployment\n    - ReplicaSet\n    - StatefulSet\n    - DaemonSet\n    - Job\n    - CronJob\n    \n    **ä¸åŒ…å«**ï¼šConfigMapã€Secretã€PVã€PVCã€Namespace ç­‰ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹ç¾æœ‰ Namespace\n\n```bash title=\"æŸ¥çœ‹æ‰€æœ‰ Namespace\"\nkubectl get namespaces\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME              STATUS   AGE\ndefault           Active   19h\nkube-node-lease   Active   19h\nkube-public       Active   19h\nkube-system       Active   19h\n```\n\n| Namespace | ç”¨é€” |\n|-----------|------|\n| **default** | é è¨­å‘½åç©ºé–“ï¼ŒæœªæŒ‡å®šæ™‚ä½¿ç”¨ |\n| **kube-system** | Kubernetes ç³»çµ±å…ƒä»¶ï¼ˆCoreDNSã€CNI ç­‰ï¼‰ |\n| **kube-public** | å…¬é–‹è³‡æºï¼Œæ‰€æœ‰ä½¿ç”¨è€…å¯è®€å– |\n| **kube-node-lease** | ç¯€é»å¿ƒè·³è³‡è¨Š |\n\n---\n\n### æ­¥é©Ÿ 4ï¼šå»ºç«‹è‡ªè¨‚ Namespace\n\n```bash title=\"å»ºç«‹ Namespace\"\nkubectl create namespace ns1\nkubectl create namespace ns2\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnamespace/ns1 created\nnamespace/ns2 created\n```\n\né©—è­‰å»ºç«‹çµæœï¼š\n\n```bash title=\"æŸ¥çœ‹ Namespace\"\nkubectl get namespaces\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME              STATUS   AGE\ndefault           Active   19h\nkube-node-lease   Active   19h\nkube-public       Active   19h\nkube-system       Active   19h\nns1               Active   12s\nns2               Active   8s\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šåœ¨ä¸åŒ Namespace å»ºç«‹ Deployment\n\nä½¿ç”¨ `--namespace=` åƒæ•¸æŒ‡å®š Namespaceï¼š\n\n```bash title=\"åœ¨ ns1 å»ºç«‹ Deployment\"\nkubectl create deployment test1 --image=docker1.training.lab:5000/nginx --namespace=ns1\n```\n\n```bash title=\"åœ¨ ns2 å»ºç«‹ Deployment\"\nkubectl create deployment test2 --image=docker1.training.lab:5000/nginx --namespace=ns2\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 created\ndeployment.apps/test2 created\n```\n\n---\n\n### æ­¥é©Ÿ 6ï¼šæŸ¥è©¢ä¸åŒ Namespace çš„è³‡æº\n\næŸ¥è©¢é è¨­ Namespaceï¼ˆæœƒæ‰¾ä¸åˆ°è³‡æºï¼‰ï¼š\n\n```bash title=\"æŸ¥è©¢ default Namespace\"\nkubectl get deployments.apps\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNo resources found in default namespace.\n```\n\næŸ¥è©¢æ‰€æœ‰ Namespaceï¼š\n\n```bash title=\"æŸ¥è©¢æ‰€æœ‰ Namespaceï¼ˆå®Œæ•´åƒæ•¸ï¼‰\"\nkubectl get deployments.apps --all-namespaces\n```\n\n```bash title=\"æŸ¥è©¢æ‰€æœ‰ Namespaceï¼ˆç°¡å¯«ï¼‰\"\nkubectl get deployments.apps -A\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAMESPACE     NAME                READY   UP-TO-DATE   AVAILABLE   AGE\nkube-system   antrea-controller   1/1     1            1           19h\nkube-system   coredns             2/2     2            2           19h\nns1           test1               1/1     1            1           43s\nns2           test2               1/1     1            1           27s\n```\n\næŸ¥è©¢ç‰¹å®š Namespaceï¼š\n\n```bash title=\"æŸ¥è©¢ ns1 çš„ Deployment\"\nkubectl get deployments.apps --namespace=ns1\n```\n\n```bash title=\"æŸ¥è©¢ ns2 çš„ Deploymentï¼ˆç°¡å¯«ï¼‰\"\nkubectl get deployments.apps -n ns2\n```\n\n!!! warning \"å¸¸è¦‹éŒ¯èª¤\"\n    **éŒ¯èª¤å¯«æ³•**ï¼š`--namespaces=ns1`ï¼ˆå¤šäº† sï¼‰\n    \n    **æ­£ç¢ºå¯«æ³•**ï¼š`--namespace=ns1` æˆ– `-n ns1`\n\n---\n\n### æ­¥é©Ÿ 7ï¼šåˆªé™¤ Namespace\n\nåˆªé™¤ Namespace æœƒ**åŒæ™‚åˆªé™¤è©² Namespace ä¸­çš„æ‰€æœ‰è³‡æº**ï¼š\n\n```bash title=\"åˆªé™¤ Namespace\"\nkubectl delete namespace ns1\nkubectl delete namespace ns2\n```\n\n!!! warning \"åˆªé™¤æ™‚é–“\"\n    Namespace åˆªé™¤å¯èƒ½éœ€è¦ä¸€æ®µæ™‚é–“ï¼Œç‹€æ…‹æœƒè®Šæˆ `Terminating`ï¼š\n    ```\n    NAME   STATUS        AGE\n    ns1    Terminating   3m5s\n    ns2    Terminating   3m1s\n    ```\n    ç­‰å¾…åˆªé™¤å®Œæˆå³å¯ã€‚\n\n!!! danger \"ç³»çµ± Namespace ç„¡æ³•åˆªé™¤\"\n    `default`ã€`kube-public`ã€`kube-system` ç‚ºç³»çµ±ä¿è­·çš„ Namespaceï¼Œç„¡æ³•è¢«åˆªé™¤ã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šRolling Update æ»¾å‹•æ›´æ–°\n\n### æ­¥é©Ÿ 1ï¼šä½¿ç”¨ dry-run ç”¢ç”Ÿ YAML\n\nä½¿ç”¨ `--dry-run=client -o yaml` å¯ä»¥ç”¢ç”Ÿ YAML æª”æ¡ˆè€Œä¸å¯¦éš›å»ºç«‹è³‡æºï¼š\n\n```bash title=\"ç”¢ç”Ÿ nginx 1.7.1 çš„ Deployment YAML\"\nkubectl create deployment test1 --image=docker1.training.lab:5000/nginx:1.7.1 --replicas=3 --dry-run=client -o yaml > test1-1.7.1.yaml\n```\n\næŸ¥çœ‹ç”¢ç”Ÿçš„ YAMLï¼š\n\n```bash title=\"æŸ¥çœ‹ YAML å…§å®¹\"\ncat test1-1.7.1.yaml\n```\n\n**YAML å…§å®¹**ï¼š\n\n```yaml title=\"test1-1.7.1.yaml\"\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: test1\n  name: test1\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: test1\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: test1\n    spec:\n      containers:\n      - image: docker1.training.lab:5000/nginx:1.7.1\n        name: nginx\n        resources: {}\nstatus: {}\n```\n\n!!! tip \"dry-run çš„ç”¨é€”\"\n    - **ç”¢ç”Ÿ YAML æ¨¡æ¿**ï¼šå¿«é€Ÿç”¢ç”Ÿæ¨™æº–æ ¼å¼çš„ YAML\n    - **ç‰ˆæœ¬ç®¡ç†**ï¼šå°‡ YAML å­˜å…¥ Git é€²è¡Œç‰ˆæœ¬æ§åˆ¶\n    - **æ¸¬è©¦æŒ‡ä»¤**ï¼šé©—è­‰æŒ‡ä»¤èªæ³•æ­£ç¢ºä½†ä¸å¯¦éš›åŸ·è¡Œ\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå¥—ç”¨ YAML å»ºç«‹ Deployment\n\n```bash title=\"å¥—ç”¨ YAML\"\nkubectl apply -f test1-1.7.1.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 created\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šç›£æ§ Deployment ç‹€æ…‹\n\nä½¿ç”¨ while è¿´åœˆæŒçºŒç›£æ§æ˜ åƒæª”ç‰ˆæœ¬ï¼š\n\n```bash title=\"ç›£æ§ Pod æ˜ åƒæª”ç‰ˆæœ¬\"\nwhile true; do \n  for i in $(kubectl get pods | tail -n +2 | awk '{ print $1 }'); do \n    kubectl get pod ${i} -o yaml | grep \"\\- image: .*nginx\"\n  done\n  echo\n  kubectl get deployments -o wide\n  echo\n  sleep 1\ndone\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n  - image: docker1.training.lab:5000/nginx:1.7.1\n  - image: docker1.training.lab:5000/nginx:1.7.1\n  - image: docker1.training.lab:5000/nginx:1.7.1\n\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                                  SELECTOR\ntest1   3/3     3            3           3m45s   nginx        docker1.training.lab:5000/nginx:1.7.1   app=test1\n```\n\næŒ‰ `Ctrl+C` åœæ­¢ç›£æ§ã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šç”¢ç”Ÿæ–°ç‰ˆæœ¬ YAML\n\nç”¢ç”Ÿ nginx 1.9.1 ç‰ˆæœ¬çš„ YAMLï¼š\n\n```bash title=\"ç”¢ç”Ÿ nginx 1.9.1 çš„ YAML\"\nkubectl create deployment test1 --image=docker1.training.lab:5000/nginx:1.9.1 --replicas=3 --dry-run=client -o yaml > test1-1.9.1.yaml\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šåŸ·è¡Œ Rolling Update\n\nä½¿ç”¨ `kubectl apply -f` å¥—ç”¨æ–°ç‰ˆæœ¬ YAMLï¼Œè§¸ç™¼æ»¾å‹•æ›´æ–°ï¼š\n\n```bash title=\"å¥—ç”¨æ–°ç‰ˆæœ¬é€²è¡Œæ»¾å‹•æ›´æ–°\"\nkubectl apply -f test1-1.9.1.yaml\n```\n\n!!! info \"apply vs create\"\n    - `kubectl create`ï¼šå»ºç«‹æ–°è³‡æºï¼Œå¦‚æœå·²å­˜åœ¨æœƒå ±éŒ¯\n    - `kubectl apply`ï¼šå»ºç«‹æˆ–æ›´æ–°è³‡æºï¼Œå¦‚æœå·²å­˜åœ¨æœƒé€²è¡Œæ›´æ–°\n\n---\n\n### æ­¥é©Ÿ 6ï¼šæŸ¥çœ‹ Rollout æ­·å²ç´€éŒ„\n\n```bash title=\"æŸ¥çœ‹éƒ¨ç½²æ­·å²\"\nkubectl rollout history deployment test1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1\nREVISION  CHANGE-CAUSE\n1         <none>\n2         <none>\n```\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **REVISION** | ç‰ˆæœ¬è™Ÿï¼Œæ¯æ¬¡æ›´æ–°éå¢ |\n| **CHANGE-CAUSE** | è®Šæ›´åŸå› ï¼ˆå¯ç”¨ `--record` è¨˜éŒ„ï¼‰ |\n\n---\n\n### æ­¥é©Ÿ 7ï¼šå›æ»¾åˆ°å…ˆå‰ç‰ˆæœ¬\n\n```bash title=\"å›æ»¾ Deployment\"\nkubectl rollout undo deployment test1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1 rolled back\n```\n\næŸ¥çœ‹å›æ»¾å¾Œçš„æ­·å²ï¼š\n\n```bash title=\"æŸ¥çœ‹å›æ»¾å¾Œçš„æ­·å²\"\nkubectl rollout history deployment test1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/test1\nREVISION  CHANGE-CAUSE\n2         <none>\n3         <none>\n```\n\n!!! note \"ç‰ˆæœ¬è™Ÿèªªæ˜\"\n    å›æ»¾å¾Œï¼ŒREVISION ä¸æœƒå›åˆ° 1ï¼Œè€Œæ˜¯ç”¢ç”Ÿæ–°çš„ç‰ˆæœ¬è™Ÿ 3ã€‚é€™æ˜¯å› ç‚ºå›æ»¾æ“ä½œæœ¬èº«ä¹Ÿç®—æ˜¯ä¸€æ¬¡éƒ¨ç½²ã€‚\n\n---\n\n### æ­¥é©Ÿ 8ï¼šå¾ URL å¥—ç”¨èˆ‡åˆªé™¤ YAML\n\nå¯ä»¥ç›´æ¥å¾ URL å¥—ç”¨ YAML æª”æ¡ˆï¼š\n\n```bash title=\"å¾ URL å¥—ç”¨ YAML\"\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/controllers/nginx-deployment.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps/nginx-deployment created\n```\n\næŸ¥çœ‹éƒ¨ç½²çµæœï¼š\n\n```bash title=\"æŸ¥çœ‹ Deployment\"\nkubectl get deployments.apps\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   3/3     3            3           77s\ntest1              3/3     3            3           9m18s\n\nNAME                                READY   STATUS    RESTARTS   AGE\nnginx-deployment-647677fc66-2m6ww   1/1     Running   0          82s\nnginx-deployment-647677fc66-4zmqw   1/1     Running   0          82s\nnginx-deployment-647677fc66-8h9zg   1/1     Running   0          82s\n```\n\nå¾ URL åˆªé™¤è³‡æºï¼š\n\n```bash title=\"å¾ URL åˆªé™¤ YAML å®šç¾©çš„è³‡æº\"\nkubectl delete -f https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/controllers/nginx-deployment.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ndeployment.apps \"nginx-deployment\" deleted\n```\n\n---\n\n## å¸¸ç”¨æŒ‡ä»¤å°ç…§è¡¨\n\n### Namespace æ“ä½œ\n\n| æ“ä½œ | æŒ‡ä»¤ | ç¯„ä¾‹ |\n|------|------|------|\n| **å»ºç«‹ Namespace** | `kubectl create namespace` | `kubectl create namespace ns1` |\n| **æŸ¥çœ‹ Namespace** | `kubectl get namespaces` | `kubectl get ns` |\n| **åˆªé™¤ Namespace** | `kubectl delete namespace` | `kubectl delete namespace ns1` |\n| **æŒ‡å®š Namespace** | `--namespace=` æˆ– `-n` | `kubectl get pods -n ns1` |\n| **æŸ¥çœ‹æ‰€æœ‰ Namespace** | `--all-namespaces` æˆ– `-A` | `kubectl get pods -A` |\n\n### Rolling Update æ“ä½œ\n\n| æ“ä½œ | æŒ‡ä»¤ | ç¯„ä¾‹ |\n|------|------|------|\n| **ç”¢ç”Ÿ YAML** | `--dry-run=client -o yaml` | `kubectl create deploy test --image=nginx --dry-run=client -o yaml` |\n| **å¥—ç”¨ YAML** | `kubectl apply -f` | `kubectl apply -f deployment.yaml` |\n| **æŸ¥çœ‹æ­·å²** | `kubectl rollout history` | `kubectl rollout history deployment test` |\n| **å›æ»¾ç‰ˆæœ¬** | `kubectl rollout undo` | `kubectl rollout undo deployment test` |\n| **å›æ»¾åˆ°æŒ‡å®šç‰ˆæœ¬** | `--to-revision` | `kubectl rollout undo deployment test --to-revision=1` |\n| **æŸ¥çœ‹ç‹€æ…‹** | `kubectl rollout status` | `kubectl rollout status deployment test` |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šNamespace åˆªé™¤ä¸€ç›´å¡åœ¨ Terminating ç‹€æ…‹ï¼Ÿ\"\n    **åŸå› **ï¼šNamespace ä¸­å¯èƒ½æœ‰ç„¡æ³•æ­£å¸¸åˆªé™¤çš„è³‡æºã€‚\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # æŸ¥çœ‹å¡ä½çš„è³‡æº\n    kubectl get all -n <namespace>\n    \n    # å¼·åˆ¶åˆªé™¤\n    kubectl delete namespace <namespace> --force --grace-period=0\n    ```\n\n??? question \"Q2ï¼šå¦‚ä½•å›æ»¾åˆ°ç‰¹å®šç‰ˆæœ¬ï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ `--to-revision` åƒæ•¸ï¼š\n    \n    ```bash\n    # å…ˆæŸ¥çœ‹ç‰ˆæœ¬æ­·å²\n    kubectl rollout history deployment test1\n    \n    # å›æ»¾åˆ°æŒ‡å®šç‰ˆæœ¬\n    kubectl rollout undo deployment test1 --to-revision=1\n    ```\n\n??? question \"Q3ï¼š--dry-run=client å’Œ --dry-run=server çš„å·®åˆ¥ï¼Ÿ\"\n    **è§£ç­”**ï¼š\n    \n    - `--dry-run=client`ï¼šåœ¨å®¢æˆ¶ç«¯åŸ·è¡Œï¼Œä¸èˆ‡ API Server é€šè¨Š\n    - `--dry-run=server`ï¼šé€åˆ° API Server é©—è­‰ï¼Œä½†ä¸å¯¦éš›å»ºç«‹è³‡æº\n    \n    ä¸€èˆ¬ç”¢ç”Ÿ YAML ä½¿ç”¨ `--dry-run=client` å³å¯ã€‚\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Namespace ç®¡ç†**ï¼šä½¿ç”¨ `kubectl create/delete namespace` å»ºç«‹èˆ‡åˆªé™¤å‘½åç©ºé–“\n- âœ… **è·¨ Namespace æŸ¥è©¢**ï¼šä½¿ç”¨ `--namespace=`ã€`-n`ã€`-A` åƒæ•¸\n- âœ… **YAML ç”¢ç”Ÿ**ï¼šä½¿ç”¨ `--dry-run=client -o yaml` ç”¢ç”Ÿ YAML æ¨¡æ¿\n- âœ… **Rolling Update**ï¼šä½¿ç”¨ `kubectl apply -f` é€²è¡Œæ»¾å‹•æ›´æ–°\n- âœ… **æ­·å²ç´€éŒ„**ï¼šä½¿ç”¨ `kubectl rollout history` æŸ¥çœ‹éƒ¨ç½²æ­·å²\n- âœ… **ç‰ˆæœ¬å›æ»¾**ï¼šä½¿ç”¨ `kubectl rollout undo` å›æ»¾åˆ°å…ˆå‰ç‰ˆæœ¬\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes Namespaces](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/)\n- [Deployment æ»¾å‹•æ›´æ–°](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment)\n- [Rollback éƒ¨ç½²å›æ»¾](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment)\n"
  },
  {
    "title": "1. æª¢æŸ¥ç¯€é»ç‹€æ…‹",
    "url": "https://caocharles.github.io/dcka-class-notes/lab15_service/",
    "content": "ï»¿# LAB 15 Kubernetes Service\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ Kubernetes Service çš„ä¸‰ç¨®é¡å‹\n- [ ] å»ºç«‹ ClusterIP é¡å‹çš„ Service\n- [ ] å»ºç«‹ NodePort é¡å‹çš„ Service\n- [ ] å»ºç«‹ LoadBalancer é¡å‹çš„ Service\n- [ ] ä½¿ç”¨ curl é©—è­‰ Service çš„è² è¼‰å‡è¡¡åŠŸèƒ½\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 14 Namespace èˆ‡ Rolling Update\n- ç†Ÿæ‚‰ Podã€Deployment åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### Service æ˜¯ä»€éº¼ï¼Ÿ\n\n**Serviceï¼ˆæœå‹™ï¼‰** æ˜¯ Kubernetes ä¸­ç”¨ä¾†**æš´éœ²æ‡‰ç”¨ç¨‹å¼çš„ç©©å®šç¶²è·¯ç«¯é»**ã€‚ç”±æ–¼ Pod çš„ IP æ˜¯å‹•æ…‹çš„ï¼Œæ¯æ¬¡é‡å»ºå¯èƒ½æœƒæ”¹è®Šï¼ŒService æä¾›äº†ä¸€å€‹å›ºå®šçš„ IP å’Œ DNS åç¨±ï¼Œè®“å…¶ä»–æ‡‰ç”¨ç¨‹å¼å¯ä»¥ç©©å®šåœ°å­˜å– Podã€‚\n\n```mermaid\ngraph LR\n    Client[å®¢æˆ¶ç«¯] --> Service[Service<br/>å›ºå®š IP]\n    Service --> Pod1[Pod 1<br/>å‹•æ…‹ IP]\n    Service --> Pod2[Pod 2<br/>å‹•æ…‹ IP]\n    Service --> Pod3[Pod 3<br/>å‹•æ…‹ IP]\n```\n\n---\n\n### Service é¡å‹æ¯”è¼ƒ\n\n| é¡å‹ | å­˜å–ç¯„åœ | ä½¿ç”¨å ´æ™¯ |\n|------|----------|----------|\n| **ClusterIP** | å¢é›†å…§éƒ¨ | å…§éƒ¨æœå‹™ã€å¾®æœå‹™é–“é€šè¨Š |\n| **NodePort** | å¢é›†å¤–éƒ¨ï¼ˆé€é Node IPï¼‰ | é–‹ç™¼æ¸¬è©¦ã€å°å‹éƒ¨ç½² |\n| **LoadBalancer** | å¢é›†å¤–éƒ¨ï¼ˆé€é LB IPï¼‰ | ç”Ÿç”¢ç’°å¢ƒã€é›²ç«¯éƒ¨ç½² |\n\n```mermaid\ngraph TB\n    subgraph \"ClusterIP (å¢é›†å…§éƒ¨)\"\n        CI[Service ClusterIP] --> P1[Pod]\n    end\n    \n    subgraph \"NodePort (ç¯€é» Port)\"\n        NP[Node:30000-32767] --> NPSVC[Service]\n        NPSVC --> P2[Pod]\n    end\n    \n    subgraph \"LoadBalancer (è² è¼‰å‡è¡¡å™¨)\"\n        LB[External LB IP] --> LBSVC[Service]\n        LBSVC --> P3[Pod]\n    end\n```\n\n---\n\n### Port å°æ‡‰é—œä¿‚\n\nService æ¶‰åŠä¸‰ç¨® Portï¼š\n\n| Port åç¨± | èªªæ˜ | ç¯„ä¾‹ |\n|-----------|------|------|\n| **port** | Service çš„ Portï¼ˆClusterIP ä½¿ç”¨ï¼‰ | 8081 |\n| **targetPort** | Pod/Container çš„ Port | 80 |\n| **nodePort** | Node å°å¤–é–‹æ”¾çš„ Portï¼ˆ30000-32767ï¼‰ | 30008 |\n\n```mermaid\ngraph LR\n    External[å¤–éƒ¨è«‹æ±‚] -->|nodePort: 30008| Node[Node IP]\n    Node -->|port: 8082| Service[Service ClusterIP]\n    Service -->|targetPort: 80| Pod[Pod]\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šClusterIP Service\n\n### ClusterIP æ¦‚è¿°\n\n**ClusterIP** æ˜¯ Service çš„é è¨­é¡å‹ï¼Œåªèƒ½å¾å¢é›†**å…§éƒ¨**å­˜å–ã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"service-clusterip-2 namespace\"\n            SVC[svc-2-httpd<br/>ClusterIP: 172.30.24.63:8081]\n            SVC --> Pod1[httpd-2<br/>10.128.1.14:80]\n            SVC --> Pod2[httpd-2<br/>10.128.2.9:80]\n        end\n    end\n    External[å¤–éƒ¨ç¶²è·¯] -.->|ç„¡æ³•å­˜å–| SVC\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šä¸‹è¼‰ ClusterIP YAML\n\n```bash title=\"ä¸‹è¼‰ ClusterIP ç¯„ä¾‹\"\nwget http://10.0.1.249/k8s/yaml/service-clusterIP.yaml\n```\n\næŸ¥çœ‹ YAML å…§å®¹ï¼š\n\n```bash title=\"æŸ¥çœ‹ YAML\"\ncat service-clusterIP.yaml\n```\n\n**YAML å…§å®¹**ï¼š\n\n```yaml title=\"service-clusterIP.yaml\"\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: service-clusterip-2\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd\n  labels:\n    app: svc-2-httpd\n  namespace: service-clusterip-2\nspec:\n  type: ClusterIP\n  ports:\n  - port: 8081        # Service Port\n    targetPort: 80    # Pod Port\n  selector:\n    app: httpd-2      # é¸æ“‡å¸¶æœ‰æ­¤ Label çš„ Pod\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: httpd-2\n  labels:\n    app: httpd-2\n  namespace: service-clusterip-2\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: httpd-2\n  template:\n    metadata:\n      labels:\n        app: httpd-2\n    spec:\n      containers:\n      - image: docker1.training.lab:5000/httpd\n        name: httpd\n        ports:\n        - containerPort: 80\n```\n\n!!! info \"YAML çµæ§‹èªªæ˜\"\n    æ­¤ YAML åŒ…å«ä¸‰å€‹è³‡æºï¼š\n    \n    1. **Namespace**ï¼šå»ºç«‹ `service-clusterip-2` å‘½åç©ºé–“\n    2. **Service**ï¼šå»ºç«‹ ClusterIP é¡å‹çš„ Service\n    3. **Deployment**ï¼šå»ºç«‹ 2 å€‹ httpd Pod\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå¥—ç”¨ YAML\n\n```bash title=\"å¥—ç”¨ YAML\"\nkubectl apply -f service-clusterIP.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnamespace/service-clusterip-2 created\nservice/svc-2-httpd created\ndeployment.apps/httpd-2 created\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹ Service\n\n```bash title=\"æŸ¥çœ‹æ‰€æœ‰ Service\"\nkubectl get service -A\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAMESPACE             NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE\ndefault               kubernetes    ClusterIP   172.30.0.1       <none>        443/TCP                  13m\nkube-system           antrea        ClusterIP   172.30.116.178   <none>        443/TCP                  105m\nkube-system           kube-dns      ClusterIP   172.30.0.10      <none>        53/UDP,53/TCP,9153/TCP   106m\nservice-clusterip-2   svc-2-httpd   ClusterIP   172.30.24.63     <none>        8081/TCP                 95s\n```\n\n---\n\n### æ­¥é©Ÿ 4ï¼šæŸ¥çœ‹ Pod ä¸¦ä¿®æ”¹å…§å®¹\n\næŸ¥çœ‹ Podï¼š\n\n```bash title=\"æŸ¥çœ‹ Pod\"\nkubectl get pods --namespace=service-clusterip-2 -o wide\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                       READY   STATUS    RESTARTS   AGE     IP            NODE\nhttpd-2-68b85d46c7-t4v87   1/1     Running   0          5m16s   10.128.1.14   k8s-node1.training.lab\nhttpd-2-68b85d46c7-trhk5   1/1     Running   0          5m16s   10.128.2.9    k8s-node2.training.lab\n```\n\né€²å…¥ç¬¬ä¸€å€‹ Pod ä¿®æ”¹é¦–é ï¼š\n\n```bash title=\"é€²å…¥ Pod 1 ä¿®æ”¹å…§å®¹\"\nkubectl exec httpd-2-68b85d46c7-t4v87 --namespace=service-clusterip-2 -it -- bash\n```\n\n```bash title=\"åœ¨å®¹å™¨å…§åŸ·è¡Œ\"\ncd htdocs/\necho AAA > index.html\nexit\n```\n\né€²å…¥ç¬¬äºŒå€‹ Pod ä¿®æ”¹é¦–é ï¼š\n\n```bash title=\"é€²å…¥ Pod 2 ä¿®æ”¹å…§å®¹\"\nkubectl exec httpd-2-68b85d46c7-trhk5 --namespace=service-clusterip-2 -it -- bash\n```\n\n```bash title=\"åœ¨å®¹å™¨å…§åŸ·è¡Œ\"\ncd htdocs/\necho BBB > index.html\nexit\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šæ¸¬è©¦ ClusterIP è² è¼‰å‡è¡¡\n\nç›´æ¥å­˜å– Pod IPï¼š\n\n```bash title=\"ç›´æ¥å­˜å– Pod IP\"\ncurl 10.128.1.14\ncurl 10.128.2.9\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nAAA\nBBB\n```\n\né€é Service ClusterIP å­˜å–ï¼ˆæœƒè‡ªå‹•è² è¼‰å‡è¡¡ï¼‰ï¼š\n\n```bash title=\"å­˜å– Service ClusterIP\"\ncurl 172.30.24.63:8081\ncurl 172.30.24.63:8081\n```\n\n**é æœŸçµæœ**ï¼ˆæ¯æ¬¡å¯èƒ½ä¸åŒï¼‰ï¼š\n\n```\nBBB\nAAA\n```\n\n!!! success \"è² è¼‰å‡è¡¡é©—è­‰\"\n    å¤šæ¬¡å­˜å– Service IPï¼Œæœƒç™¼ç¾å›æ‡‰å…§å®¹åœ¨ AAA å’Œ BBB ä¹‹é–“åˆ‡æ›ï¼Œé€™è¡¨ç¤º Service æ­£åœ¨é€²è¡Œè² è¼‰å‡è¡¡ã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šNodePort Service\n\n### NodePort æ¦‚è¿°\n\n**NodePort** æœƒåœ¨æ¯å€‹ Node ä¸Šé–‹æ”¾ä¸€å€‹å›ºå®šçš„ Portï¼ˆ30000-32767ï¼‰ï¼Œå…è¨±å¾å¢é›†**å¤–éƒ¨**å­˜å–ã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Kubernetes Cluster\"\n        subgraph \"k8s-node1\"\n            NP1[Port 30008]\n        end\n        subgraph \"k8s-node2\"\n            NP2[Port 30008]\n        end\n        subgraph \"k8s-master1\"\n            NP3[Port 30008]\n        end\n        SVC[Service NodePort<br/>172.30.21.179:8082]\n        NP1 --> SVC\n        NP2 --> SVC\n        NP3 --> SVC\n        SVC --> Pod1[httpd Pod 1]\n        SVC --> Pod2[httpd Pod 2]\n    end\n    External[å¤–éƒ¨ç¶²è·¯] --> NP1\n    External --> NP2\n    External --> NP3\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šä¸‹è¼‰ NodePort YAML\n\n```bash title=\"ä¸‹è¼‰ NodePort ç¯„ä¾‹\"\nwget http://10.0.1.248/k8s/yaml/service-nodeport.yaml\n```\n\næŸ¥çœ‹ YAML å…§å®¹ï¼š\n\n```bash title=\"æŸ¥çœ‹ YAML\"\ncat service-nodeport.yaml\n```\n\n**YAML é‡é»**ï¼š\n\n```yaml title=\"service-nodeport.yamlï¼ˆæ‘˜éŒ„ï¼‰\"\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd-nodeport\n  namespace: service-nodeport-2\nspec:\n  type: NodePort          # NodePort é¡å‹\n  ports:\n  - port: 8082            # Service Port\n    targetPort: 80        # Pod Port\n    nodePort: 30008       # Node å°å¤– Port\n  selector:\n    app: httpd-2-nodeport\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå¥—ç”¨ YAML\n\n```bash title=\"å¥—ç”¨ YAML\"\nkubectl apply -f service-nodeport.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnamespace/service-nodeport-2 created\nservice/svc-2-httpd-nodeport created\ndeployment.apps/httpd-2-nodeport created\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹ Service\n\n```bash title=\"æŸ¥çœ‹ Service\"\nkubectl get services -A\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAMESPACE             NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\nservice-clusterip-2   svc-2-httpd            ClusterIP   172.30.24.63     <none>        8081/TCP         9m25s\nservice-nodeport-2    svc-2-httpd-nodeport   NodePort    172.30.21.179    <none>        8082:30008/TCP   72s\n```\n\n!!! note \"Port æ ¼å¼èªªæ˜\"\n    `8082:30008/TCP` è¡¨ç¤ºï¼š\n    \n    - **8082**ï¼šService çš„ ClusterIP Port\n    - **30008**ï¼šNode å°å¤–çš„ NodePort\n\n---\n\n### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦ NodePort å­˜å–\n\né€é Pod IP å­˜å–ï¼š\n\n```bash title=\"å­˜å– Pod IP\"\nkubectl get pods --namespace=service-nodeport-2 -o wide\ncurl 10.128.1.15\ncurl 10.128.2.10\n```\n\né€é Service ClusterIP å­˜å–ï¼š\n\n```bash title=\"å­˜å– Service ClusterIP\"\ncurl 172.30.21.179:8082\n```\n\n**é€éä»»æ„ Node çš„ NodePort å­˜å–**ï¼š\n\n```bash title=\"å­˜å– NodePort\"\ncurl k8s-node1:30008\ncurl k8s-node2:30008\ncurl k8s-master1:30008\n```\n\n**é æœŸçµæœ**ï¼ˆä¸‰å€‹éƒ½å¯ä»¥å­˜å–ï¼‰ï¼š\n\n```\n<html><body><h1>It works!</h1></body></html>\n```\n\n!!! success \"NodePort ç‰¹æ€§\"\n    NodePort æœƒåœ¨**æ‰€æœ‰ Node**ï¼ˆåŒ…å« Master å’Œ Workerï¼‰ä¸Šé–‹æ”¾ç›¸åŒçš„ Portï¼Œç„¡è«– Pod å¯¦éš›é‹è¡Œåœ¨å“ªå€‹ Node ä¸Šã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šLoadBalancer Service\n\n### LoadBalancer æ¦‚è¿°\n\n**LoadBalancer** æ˜¯æœ€é«˜ç´šçš„ Service é¡å‹ï¼Œæœƒå‘é›²ç«¯ä¾›æ‡‰å•†è«‹æ±‚ä¸€å€‹**å¤–éƒ¨è² è¼‰å‡è¡¡å™¨ IP**ã€‚\n\n```mermaid\ngraph TB\n    subgraph \"Cloud Provider\"\n        LB[External Load Balancer<br/>å…¬é–‹ IP]\n    end\n    subgraph \"Kubernetes Cluster\"\n        SVC[Service LoadBalancer<br/>172.30.227.169:8083]\n        SVC --> Pod1[httpd Pod 1]\n        SVC --> Pod2[httpd Pod 2]\n    end\n    Internet[Internet] --> LB\n    LB --> SVC\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šä¸‹è¼‰ LoadBalancer YAML\n\n```bash title=\"ä¸‹è¼‰ LoadBalancer ç¯„ä¾‹\"\nwget http://192.168.66.248/k8s/yaml/service-loadbalancer.yaml\n```\n\næŸ¥çœ‹ YAML å…§å®¹ï¼š\n\n```bash title=\"æŸ¥çœ‹ YAML\"\ncat service-loadbalancer.yaml\n```\n\n**YAML é‡é»**ï¼š\n\n```yaml title=\"service-loadbalancer.yamlï¼ˆæ‘˜éŒ„ï¼‰\"\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-2-httpd-lb\n  namespace: service-loadbalancer-1\nspec:\n  type: LoadBalancer      # LoadBalancer é¡å‹\n  ports:\n  - port: 8083            # Service Port\n    targetPort: 80        # Pod Port\n  selector:\n    app: httpd-2-lb\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå¥—ç”¨ YAML\n\n```bash title=\"å¥—ç”¨ YAML\"\nkubectl apply -f service-loadbalancer.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnamespace/service-loadbalancer-1 created\nservice/svc-2-httpd-lb created\ndeployment.apps/httpd-2-lb created\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹ Service\n\n```bash title=\"æŸ¥çœ‹ Service\"\nkubectl get services --namespace=service-loadbalancer-1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME             TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\nsvc-2-httpd-lb   LoadBalancer   172.30.227.169   <pending>     8083:32254/TCP   60s\n```\n\n!!! warning \"EXTERNAL-IP é¡¯ç¤º pending\"\n    åœ¨éé›²ç«¯ç’°å¢ƒï¼ˆå¦‚æœ¬åœ° VMwareï¼‰ï¼Œæ²’æœ‰å¤–éƒ¨è² è¼‰å‡è¡¡å™¨å¯ç”¨ï¼Œæ‰€ä»¥ EXTERNAL-IP æœƒä¸€ç›´é¡¯ç¤º `<pending>`ã€‚\n    \n    åœ¨ AWSã€GCPã€Azure ç­‰é›²ç«¯ç’°å¢ƒä¸­ï¼Œæœƒè‡ªå‹•åˆ†é…ä¸€å€‹å…¬é–‹ IPã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦ LoadBalancer å­˜å–\n\n```bash title=\"æŸ¥çœ‹ Pod\"\nkubectl get pods --namespace=service-loadbalancer-1 -o wide\n```\n\né€é Pod IP å­˜å–ï¼š\n\n```bash title=\"å­˜å– Pod IP\"\ncurl 10.128.2.11\ncurl 10.128.1.16\n```\n\né€é Service ClusterIP å­˜å–ï¼š\n\n```bash title=\"å­˜å– Service ClusterIP\"\ncurl 172.30.227.169:8083\n```\n\né€é NodePort å­˜å–ï¼ˆLoadBalancer è‡ªå‹•åˆ†é…ï¼‰ï¼š\n\n```bash title=\"å­˜å–è‡ªå‹•åˆ†é…çš„ NodePort\"\ncurl k8s-node1:32254\ncurl k8s-node2:32254\ncurl k8s-master1:32254\n```\n\n!!! info \"LoadBalancer è‡ªå‹•åˆ†é… NodePort\"\n    LoadBalancer é¡å‹çš„ Service æœƒè‡ªå‹•åˆ†é…ä¸€å€‹ NodePortï¼ˆæ­¤ä¾‹ç‚º 32254ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é€é Node IP:NodePort å­˜å–ã€‚\n\n---\n\n## Service é¡å‹ç¸½çµ\n\n| ç‰¹æ€§ | ClusterIP | NodePort | LoadBalancer |\n|------|-----------|----------|--------------|\n| **å­˜å–ç¯„åœ** | å¢é›†å…§éƒ¨ | å¢é›†å…§å¤– | å¢é›†å…§å¤– |\n| **å›ºå®š IP** | ClusterIP | ClusterIP + NodePort | ClusterIP + NodePort + External IP |\n| **ä½¿ç”¨å ´æ™¯** | å¾®æœå‹™å…§éƒ¨é€šè¨Š | é–‹ç™¼æ¸¬è©¦ | ç”Ÿç”¢ç’°å¢ƒ |\n| **Port ç¯„åœ** | ä¸é™ | 30000-32767 | ä¸é™ |\n| **éœ€è¦é›²ç«¯** | å¦ | å¦ | æ˜¯ |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šService å¦‚ä½•æ‰¾åˆ°å°æ‡‰çš„ Podï¼Ÿ\"\n    **è§£ç­”**ï¼šé€é `selector` æ¨™ç±¤é¸æ“‡å™¨ã€‚Service æœƒå°‡æµé‡å°å‘æ‰€æœ‰ç¬¦åˆ selector æ¢ä»¶çš„ Podã€‚\n    \n    ```yaml\n    spec:\n      selector:\n        app: httpd-2  # é¸æ“‡å¸¶æœ‰ app=httpd-2 æ¨™ç±¤çš„ Pod\n    ```\n\n??? question \"Q2ï¼šLoadBalancer çš„ EXTERNAL-IP ä¸€ç›´æ˜¯ pendingï¼Ÿ\"\n    **åŸå› **ï¼šåœ¨éé›²ç«¯ç’°å¢ƒæ²’æœ‰å¤–éƒ¨è² è¼‰å‡è¡¡å™¨ã€‚\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    \n    - ä½¿ç”¨ MetalLB åœ¨æœ¬åœ°ç’°å¢ƒæ¨¡æ“¬ LoadBalancer\n    - æˆ–ç›´æ¥ä½¿ç”¨ NodePort é¡å‹\n\n??? question \"Q3ï¼šNodePort çš„ Port ç¯„åœå¯ä»¥ä¿®æ”¹å—ï¼Ÿ\"\n    **è§£ç­”**ï¼šå¯ä»¥ï¼Œä¿®æ”¹ kube-apiserver çš„ `--service-node-port-range` åƒæ•¸ã€‚\n    \n    é è¨­ç¯„åœï¼š30000-32767\n\n??? question \"Q4ï¼šPod ä¸€ç›´è™•æ–¼ Pending ç‹€æ…‹ï¼Ÿ\"\n    **åŸå› **ï¼šé€šå¸¸æ˜¯ç¯€é»æˆ– CNI æœªå°±ç·’ã€‚\n    \n    **Debug æµç¨‹**ï¼š\n    \n    ```bash\n    # 1. æª¢æŸ¥ç¯€é»ç‹€æ…‹\n    kubectl get nodes\n    \n    # 2. æª¢æŸ¥ CNI Podï¼ˆAntreaï¼‰\n    kubectl get pods -n kube-system | grep antrea\n    \n    # 3. æŸ¥çœ‹ Pod äº‹ä»¶\n    kubectl describe pod <pod-name> -n <namespace>\n    \n    # 4. æŸ¥çœ‹å®¹å™¨æ—¥èªŒ\n    kubectl logs <pod-name> -n kube-system -c <container-name> --tail=50\n    ```\n    \n    è©³ç´° Debug æµç¨‹è«‹åƒè€ƒ [LAB 18 RBAC èˆ‡ Event/Log](lab18_rbac_event_log.md)ã€‚\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Service æ¦‚å¿µ**ï¼šæä¾›ç©©å®šçš„ç¶²è·¯ç«¯é»å­˜å– Pod\n- âœ… **ClusterIP**ï¼šé è¨­é¡å‹ï¼Œåƒ…å¢é›†å…§éƒ¨å­˜å–\n- âœ… **NodePort**ï¼šé€é Node IP:Port å¾å¤–éƒ¨å­˜å–ï¼ˆ30000-32767ï¼‰\n- âœ… **LoadBalancer**ï¼šé€éå¤–éƒ¨è² è¼‰å‡è¡¡å™¨å­˜å–ï¼ˆéœ€é›²ç«¯ç’°å¢ƒï¼‰\n- âœ… **Port å°æ‡‰**ï¼športï¼ˆServiceï¼‰â†’ targetPortï¼ˆPodï¼‰â†’ nodePortï¼ˆNodeï¼‰\n- âœ… **è² è¼‰å‡è¡¡**ï¼šService è‡ªå‹•å°‡æµé‡åˆ†æ•£åˆ°å¤šå€‹ Pod\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes Service](https://kubernetes.io/docs/concepts/services-networking/service/)\n- [Service Types](https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types)\n- [MetalLB - LoadBalancer for Bare Metal](https://metallb.io/)\n\n## YAML å¯¦ç”¨å·¥å…·\n\n| å·¥å…· | ç”¨é€” | é€£çµ |\n|------|------|------|\n| **YAMLint** | é©—è­‰ YAML èªæ³• | [www.yamllint.com](http://www.yamllint.com/) |\n| **YAML to JSON** | å°‡ YAML è½‰æ›ç‚º JSON | [www.convertjson.com](https://www.convertjson.com/yaml-to-json.htm) |\n| **YAML to JSON/XML/CSV** | å¤šæ ¼å¼è½‰æ› | [codebeautify.org](https://codebeautify.org/yaml-to-json-xml-csv) |\n\n!!! tip \"YAML é©—è­‰æŠ€å·§\"\n    åœ¨å¥—ç”¨ YAML æª”æ¡ˆä¹‹å‰ï¼Œå»ºè­°å…ˆä½¿ç”¨ç·šä¸Šå·¥å…·é©—è­‰èªæ³•æ˜¯å¦æ­£ç¢ºï¼Œé¿å…å› ç¸®æ’æˆ–æ ¼å¼éŒ¯èª¤å°è‡´éƒ¨ç½²å¤±æ•—ã€‚\n\n"
  },
  {
    "title": "Lab16 Pv Pvc",
    "url": "https://caocharles.github.io/dcka-class-notes/lab16_pv_pvc/",
    "content": "ï»¿# LAB 16 Persistent Volumeï¼ˆPVï¼‰èˆ‡ Persistent Volume Claimï¼ˆPVCï¼‰\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ PV èˆ‡ PVC çš„æ¦‚å¿µèˆ‡é—œä¿‚\n- [ ] ä½¿ç”¨ hostPath å»ºç«‹æœ¬åœ°å„²å­˜çš„ PV\n- [ ] å»ºç«‹ PVC ä¸¦ç¶å®š PV\n- [ ] åœ¨ Pod ä¸­æ›è¼‰ PVC\n- [ ] è¨­å®š NFS Server æä¾›ç¶²è·¯å„²å­˜\n- [ ] ä½¿ç”¨ NFS é¡å‹çš„ PV å¯¦ç¾è·¨ç¯€é»å…±äº«å„²å­˜\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 15 Service\n- ç†Ÿæ‚‰ Podã€Deployment åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ã€k8s-node1ã€k8s-node2ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### ç‚ºä»€éº¼éœ€è¦ PV/PVCï¼Ÿ\n\nPod çš„å„²å­˜æ˜¯**è‡¨æ™‚æ€§çš„**ï¼Œç•¶ Pod è¢«åˆªé™¤æˆ–é‡æ–°èª¿åº¦æ™‚ï¼Œå®¹å™¨å…§çš„è³‡æ–™ä¹Ÿæœƒæ¶ˆå¤±ã€‚PV/PVC æä¾›äº†**æŒä¹…åŒ–å„²å­˜**çš„è§£æ±ºæ–¹æ¡ˆã€‚\n\n```mermaid\ngraph TB\n    subgraph \"æ²’æœ‰ PV/PVC\"\n        Pod1[Pod] --> Data1[å®¹å™¨å…§è³‡æ–™]\n        Data1 -.->|Pod åˆªé™¤| Lost[è³‡æ–™éºå¤±]\n    end\n    \n    subgraph \"ä½¿ç”¨ PV/PVC\"\n        Pod2[Pod] --> PVC[PVC]\n        PVC --> PV[PV]\n        PV --> Storage[(å„²å­˜ç©ºé–“)]\n        Pod2 -.->|Pod åˆªé™¤| Storage\n    end\n```\n\n---\n\n### PV èˆ‡ PVC çš„é—œä¿‚\n\n| æ¦‚å¿µ | èªªæ˜ | èª°ç®¡ç† |\n|------|------|--------|\n| **PVï¼ˆPersistent Volumeï¼‰** | å¢é›†ä¸­çš„å„²å­˜è³‡æºï¼Œé¡ä¼¼ Node | ç®¡ç†å“¡ |\n| **PVCï¼ˆPersistent Volume Claimï¼‰** | ä½¿ç”¨è€…å°å„²å­˜çš„è«‹æ±‚ï¼Œé¡ä¼¼ Pod | é–‹ç™¼è€… |\n\n```mermaid\ngraph LR\n    Admin[ç®¡ç†å“¡] -->|å»ºç«‹| PV[PV<br/>10Gi Storage]\n    Dev[é–‹ç™¼è€…] -->|å»ºç«‹| PVC[PVC<br/>è«‹æ±‚ 3Gi]\n    PVC -->|è‡ªå‹•ç¶å®š| PV\n    Pod[Pod] -->|æ›è¼‰| PVC\n```\n\n---\n\n### PV çš„ç”Ÿå‘½é€±æœŸ\n\n```mermaid\nstateDiagram-v2\n    [*] --> Available: å»ºç«‹ PV\n    Available --> Bound: PVC ç¶å®š\n    Bound --> Released: PVC åˆªé™¤\n    Released --> Available: å›æ”¶\n    Released --> [*]: åˆªé™¤\n```\n\n| ç‹€æ…‹ | èªªæ˜ |\n|------|------|\n| **Available** | å¯ç”¨ï¼Œå°šæœªè¢« PVC ç¶å®š |\n| **Bound** | å·²ç¶å®šï¼Œè¢«æŸå€‹ PVC ä½¿ç”¨ä¸­ |\n| **Released** | PVC å·²åˆªé™¤ï¼Œä½†è³‡æºå°šæœªå›æ”¶ |\n| **Failed** | è‡ªå‹•å›æ”¶å¤±æ•— |\n\n---\n\n### å„²å­˜é¡å‹æ¯”è¼ƒ\n\n| é¡å‹ | èªªæ˜ | å„ªé» | ç¼ºé» |\n|------|------|------|------|\n| **hostPath** | ç¯€é»æœ¬åœ°è·¯å¾‘ | ç°¡å–®ã€å¿«é€Ÿ | Pod åªèƒ½åœ¨ç‰¹å®šç¯€é»é‹è¡Œ |\n| **NFS** | ç¶²è·¯æª”æ¡ˆç³»çµ± | è·¨ç¯€é»å…±äº« | éœ€è¦ NFS Server |\n| **CSI** | å®¹å™¨å„²å­˜ä»‹é¢ | æ”¯æ´å„ç¨®é›²ç«¯å„²å­˜ | è¨­å®šè¼ƒè¤‡é›œ |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šhostPath æœ¬åœ°å„²å­˜\n\n### æ¶æ§‹èªªæ˜\n\nä½¿ç”¨ hostPath æ™‚ï¼ŒPod æœƒä½¿ç”¨ç¯€é»ä¸Šçš„æœ¬åœ°ç›®éŒ„ä½œç‚ºå„²å­˜ç©ºé–“ã€‚\n\n```mermaid\ngraph TB\n    subgraph node1[\"k8s-node1\"]\n        Pod1[\"pv1-pod-local\"]\n        Path1[\"/mnt/data\"]\n        Pod1 --> Path1\n    end\n    \n    subgraph node2[\"k8s-node2\"]\n        Path2[\"/mnt/data\"]\n    end\n```\n\n| ç¯€é» | ç›®éŒ„ | æª”æ¡ˆå…§å®¹ |\n|------|------|----------|\n| k8s-node1 | /mnt/data/index.html | node1...AAA |\n| k8s-node2 | /mnt/data/index.html | node2...BBB |\n\n!!! warning \"hostPath é™åˆ¶\"\n    ä½¿ç”¨ hostPath æ™‚ï¼ŒPod åªèƒ½é‹è¡Œåœ¨æœ‰è©²è·¯å¾‘çš„ç¯€é»ä¸Šã€‚å¦‚æœ Pod è¢«èª¿åº¦åˆ°å…¶ä»–ç¯€é»ï¼Œå¯èƒ½æœƒæ‰¾ä¸åˆ°è³‡æ–™æˆ–çœ‹åˆ°ä¸åŒçš„è³‡æ–™ã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šåœ¨ Worker Node æº–å‚™æœ¬åœ°ç›®éŒ„\n\n**åœ¨ k8s-node1 ä¸ŠåŸ·è¡Œ**ï¼š\n\n```bash title=\"åœ¨ node1 å»ºç«‹ç›®éŒ„å’Œæ¸¬è©¦æª”æ¡ˆ\"\nmkdir -p /mnt/data\necho \"node1...AAA\" > /mnt/data/index.html\ncat /mnt/data/index.html\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnode1...AAA\n```\n\n**åœ¨ k8s-node2 ä¸ŠåŸ·è¡Œ**ï¼š\n\n```bash title=\"åœ¨ node2 å»ºç«‹ç›®éŒ„å’Œæ¸¬è©¦æª”æ¡ˆ\"\nmkdir -p /mnt/data\necho \"node2...BBB\" > /mnt/data/index.html\ncat /mnt/data/index.html\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnode2...BBB\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå»ºç«‹ PVï¼ˆPersistent Volumeï¼‰\n\nå›åˆ° k8s-master1ï¼Œä¸‹è¼‰ä¸¦æŸ¥çœ‹ PV YAMLï¼š\n\n```bash title=\"ä¸‹è¼‰ PV YAML\"\nwget http://10.0.1.248/k8s/yaml/pv1-local.yaml\n```\n\n**PV YAML å…§å®¹**ï¼š\n\n```yaml title=\"pv1-local.yaml\"\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv1-local\nspec:\n  capacity:\n    storage: 10Gi            # å„²å­˜å®¹é‡\n  accessModes:\n    - ReadWriteOnce          # å­˜å–æ¨¡å¼\n  persistentVolumeReclaimPolicy: Retain  # å›æ”¶ç­–ç•¥\n  storageClassName: manual   # å„²å­˜é¡åˆ¥\n  hostPath:\n    path: \"/mnt/data\"        # ç¯€é»æœ¬åœ°è·¯å¾‘\n```\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **capacity** | å„²å­˜å®¹é‡ï¼ˆ10Gi = 10 GiBï¼‰ |\n| **accessModes** | RWOï¼ˆå–®ç¯€é»è®€å¯«ï¼‰ã€ROXï¼ˆå¤šç¯€é»å”¯è®€ï¼‰ã€RWXï¼ˆå¤šç¯€é»è®€å¯«ï¼‰ |\n| **persistentVolumeReclaimPolicy** | Retainï¼ˆä¿ç•™ï¼‰ã€Deleteï¼ˆåˆªé™¤ï¼‰ã€Recycleï¼ˆå›æ”¶ï¼‰ |\n| **storageClassName** | ç”¨æ–¼ PVC é…å°çš„é¡åˆ¥åç¨± |\n| **hostPath** | ç¯€é»æœ¬åœ°è·¯å¾‘ |\n\nå¥—ç”¨ PVï¼š\n\n```bash title=\"å»ºç«‹ PV\"\nkubectl apply -f pv1-local.yaml\n```\n\næŸ¥çœ‹ PV ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ PV\"\nkubectl get pv\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Available           manual         3s\n```\n\n!!! success \"PV ç‹€æ…‹\"\n    ç‹€æ…‹é¡¯ç¤º `Available`ï¼Œè¡¨ç¤º PV å¯ç”¨ï¼Œå°šæœªè¢« PVC ç¶å®šã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå»ºç«‹ PVCï¼ˆPersistent Volume Claimï¼‰\n\n```bash title=\"ä¸‹è¼‰ PVC YAML\"\nwget http://10.0.1.248/k8s/yaml/pvc1-local.yaml\n```\n\n**PVC YAML å…§å®¹**ï¼š\n\n```yaml title=\"pvc1-local.yaml\"\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc1-local\nspec:\n  accessModes:\n    - ReadWriteOnce          # å¿…é ˆèˆ‡ PV ç›¸å®¹\n  resources:\n    requests:\n      storage: 3Gi           # è«‹æ±‚çš„å®¹é‡\n  storageClassName: manual   # å¿…é ˆèˆ‡ PV ç›¸åŒ\n```\n\nå¥—ç”¨ PVCï¼š\n\n```bash title=\"å»ºç«‹ PVC\"\nkubectl apply -f pvc1-local.yaml\n```\n\næŸ¥çœ‹ PV å’Œ PVC ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ PV ç‹€æ…‹\"\nkubectl get pv\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound    default/pvc1-local   manual         95s\n```\n\n```bash title=\"æŸ¥çœ‹ PVC ç‹€æ…‹\"\nkubectl get pvc\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME         STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npvc1-local   Bound    pv1-local   10Gi       RWO            manual         5s\n```\n\n!!! success \"ç¶å®šæˆåŠŸ\"\n    PV å’Œ PVC çš„ç‹€æ…‹éƒ½è®Šæˆ `Bound`ï¼Œè¡¨ç¤ºç¶å®šæˆåŠŸã€‚CLAIM æ¬„ä½é¡¯ç¤º `default/pvc1-local`ï¼Œè¡¨ç¤ºè¢«å“ªå€‹ Namespace çš„ PVC ç¶å®šã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šå»ºç«‹ä½¿ç”¨ PVC çš„ Pod\n\n```bash title=\"ä¸‹è¼‰ Pod YAML\"\nwget http://10.0.1.248/k8s/yaml/pv1-pod-local.yaml\n```\n\n**Pod YAML å…§å®¹**ï¼š\n\n```yaml title=\"pv1-pod-local.yaml\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pv1-pod-local\nspec:\n  containers:\n  - name: nginx\n    image: docker1.training.lab:5000/nginx\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - mountPath: \"/usr/share/nginx/html\"  # å®¹å™¨å…§æ›è¼‰è·¯å¾‘\n      name: pv1-storage\n  volumes:\n  - name: pv1-storage\n    persistentVolumeClaim:\n      claimName: pvc1-local                # ä½¿ç”¨çš„ PVC åç¨±\n```\n\nå¥—ç”¨ Podï¼š\n\n```bash title=\"å»ºç«‹ Pod\"\nkubectl apply -f pv1-pod-local.yaml\n```\n\næŸ¥çœ‹ Pod ç‹€æ…‹ï¼š\n\n```bash title=\"æŸ¥çœ‹ Pod\"\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME            READY   STATUS    RESTARTS   AGE   IP            NODE\npv1-pod-local   1/1     Running   0          21s   10.128.1.17   k8s-node1.training.lab\n```\n\næ¸¬è©¦å­˜å–ï¼š\n\n```bash title=\"æ¸¬è©¦å­˜å–\"\ncurl 10.128.1.17\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnode1...AAA\n```\n\n!!! info \"hostPath çš„ä¾·é™\"\n    Pod è¢«èª¿åº¦åˆ° node1ï¼Œæ‰€ä»¥çœ‹åˆ°çš„æ˜¯ node1 ä¸Šçš„ `/mnt/data/index.html` å…§å®¹ï¼ˆnode1...AAAï¼‰ã€‚å¦‚æœ Pod è¢«èª¿åº¦åˆ° node2ï¼Œæœƒçœ‹åˆ°ä¸åŒçš„å…§å®¹ï¼ˆnode2...BBBï¼‰ã€‚\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šNFS ç¶²è·¯å„²å­˜\n\n### æ¶æ§‹èªªæ˜\n\nä½¿ç”¨ NFS æ™‚ï¼Œæ‰€æœ‰ç¯€é»éƒ½å¯ä»¥å­˜å–ç›¸åŒçš„å…±äº«å„²å­˜ç©ºé–“ã€‚\n\n```mermaid\ngraph TB\n    subgraph master[\"k8s-master1 NFS Server\"]\n        NFS[\"NFS æœå‹™\"]\n        Data[\"/data\"]\n        NFS --> Data\n    end\n    \n    subgraph node1[\"k8s-node1\"]\n        Pod1[\"pv2-pod-nfs\"]\n        Pod1 -.-> NFS\n    end\n    \n    subgraph node2[\"k8s-node2\"]\n        Pod2[\"Pod\"]\n        Pod2 -.-> NFS\n    end\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šå®‰è£ NFS å·¥å…·\n\n**åœ¨æ‰€æœ‰ç¯€é»ï¼ˆmaster1ã€node1ã€node2ï¼‰å®‰è£ nfs-utils**ï¼š\n\n```bash title=\"å®‰è£ nfs-utils\"\nyum install nfs-utils -y\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šè¨­å®š NFS Serverï¼ˆk8s-master1ï¼‰\n\n**åœ¨ k8s-master1 ä¸ŠåŸ·è¡Œ**ï¼š\n\nå»ºç«‹å…±äº«ç›®éŒ„ï¼š\n\n```bash title=\"å»ºç«‹å…±äº«ç›®éŒ„\"\nmkdir -p /data\necho \"master...CCC\" > /data/index.html\n```\n\nè¨­å®š NFS åŒ¯å‡ºï¼š\n\n```bash title=\"ç·¨è¼¯ /etc/exports\"\nvi /etc/exports\n```\n\nåŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š\n\n```title=\"/etc/exports\"\n/data *(rw,no_root_squash)\n```\n\n| é¸é … | èªªæ˜ |\n|------|------|\n| `*` | å…è¨±æ‰€æœ‰ä¸»æ©Ÿå­˜å– |\n| `rw` | è®€å¯«æ¬Šé™ |\n| `no_root_squash` | root ä½¿ç”¨è€…ä¿æŒ root æ¬Šé™ |\n\nå•Ÿå‹• NFS æœå‹™ï¼š\n\n```bash title=\"å•Ÿå‹•ä¸¦å•Ÿç”¨ NFS\"\nsystemctl start nfs-server.service\nsystemctl enable nfs-server.service\nsystemctl status nfs-server.service\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nâ— nfs-server.service - NFS server and services\n     Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; enabled)\n     Active: active (exited)\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦ NFS æ›è¼‰ï¼ˆk8s-node1ï¼‰\n\n**åœ¨ k8s-node1 ä¸ŠåŸ·è¡Œ**ï¼š\n\n```bash title=\"å»ºç«‹æ›è¼‰é»ä¸¦æ›è¼‰ NFS\"\nmkdir -p /mnt/nfs\nmount -t nfs k8s-master1:/data /mnt/nfs\n```\n\né©—è­‰æ›è¼‰ï¼š\n\n```bash title=\"é©—è­‰æ›è¼‰\"\ndf -Th | grep nfs\ncat /mnt/nfs/index.html\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nk8s-master1:/data   nfs4   70G  7.4G  63G  11% /mnt/nfs\nmaster...CCC\n```\n\nå¸è¼‰ï¼ˆæ¸¬è©¦å®Œæˆå¾Œï¼‰ï¼š\n\n```bash title=\"å¸è¼‰ NFS\"\numount /mnt/nfs\n```\n\n---\n\n### æ­¥é©Ÿ 4ï¼šå»ºç«‹ NFS PV\n\n**å›åˆ° k8s-master1**ï¼š\n\n```bash title=\"ä¸‹è¼‰ NFS PV YAML\"\nwget http://10.0.1.248/k8s/yaml/pv2-nfs.yaml\n```\n\n**NFS PV YAML å…§å®¹**ï¼š\n\n```yaml title=\"pv2-nfs.yaml\"\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv2-nfs\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: manual\n  nfs:\n    server: k8s-master1              # NFS Server ä¸»æ©Ÿåç¨±\n    path: \"/data\"                    # NFS å…±äº«è·¯å¾‘\n```\n\nå¥—ç”¨ PVï¼š\n\n```bash title=\"å»ºç«‹ NFS PV\"\nkubectl apply -f pv2-nfs.yaml\nkubectl get pv\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound       default/pvc1-local   manual         19m\npv2-nfs     10Gi       RWO            Retain           Available                        manual         3s\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šå»ºç«‹ NFS PVC\n\n```bash title=\"ä¸‹è¼‰ NFS PVC YAML\"\nwget http://10.0.1.248/k8s/yaml/pvc2-nfs.yaml\n```\n\n**NFS PVC YAML å…§å®¹**ï¼š\n\n```yaml title=\"pvc2-nfs.yaml\"\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc2-nfs\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 3Gi\n  storageClassName: manual\n```\n\nå¥—ç”¨ PVCï¼š\n\n```bash title=\"å»ºç«‹ NFS PVC\"\nkubectl apply -f pvc2-nfs.yaml\nkubectl get pv\nkubectl get pvc\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS   AGE\npv1-local   10Gi       RWO            Retain           Bound    default/pvc1-local   manual         20m\npv2-nfs     10Gi       RWO            Retain           Bound    default/pvc2-nfs     manual         91s\n\nNAME         STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npvc1-local   Bound    pv1-local   10Gi       RWO            manual         19m\npvc2-nfs     Bound    pv2-nfs     10Gi       RWO            manual         5s\n```\n\n---\n\n### æ­¥é©Ÿ 6ï¼šå»ºç«‹ä½¿ç”¨ NFS PVC çš„ Pod\n\n```bash title=\"ä¸‹è¼‰ NFS Pod YAML\"\nwget http://10.0.1.248/k8s/yaml/pv2-pod-nfs.yaml\n```\n\n**NFS Pod YAML å…§å®¹**ï¼š\n\n```yaml title=\"pv2-pod-nfs.yaml\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pv2-pod-nfs\nspec:\n  containers:\n  - name: nginx\n    image: docker1.training.lab:5000/nginx\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - mountPath: \"/usr/share/nginx/html\"\n      name: pv2-storage\n  volumes:\n  - name: pv2-storage\n    persistentVolumeClaim:\n      claimName: pvc2-nfs              # ä½¿ç”¨ NFS PVC\n```\n\nå¥—ç”¨ Podï¼š\n\n```bash title=\"å»ºç«‹ NFS Pod\"\nkubectl apply -f pv2-pod-nfs.yaml\nkubectl get pods -o wide\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME            READY   STATUS    RESTARTS   AGE   IP            NODE\npv1-pod-local   1/1     Running   0          19m   10.128.1.17   k8s-node1.training.lab\npv2-pod-nfs     1/1     Running   0          18s   10.128.1.18   k8s-node1.training.lab\n```\n\næ¸¬è©¦å­˜å–ï¼š\n\n```bash title=\"æ¸¬è©¦ NFS Pod\"\ncurl 10.128.1.18\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nmaster...CCC\n```\n\n!!! success \"NFS å…±äº«å„²å­˜\"\n    ç„¡è«– Pod é‹è¡Œåœ¨å“ªå€‹ç¯€é»ï¼Œéƒ½æœƒçœ‹åˆ°ç›¸åŒçš„å…§å®¹ï¼ˆmaster...CCCï¼‰ï¼Œå› ç‚ºè³‡æ–™ä¾†è‡ªå…±äº«çš„ NFS Serverã€‚\n\n---\n\n## hostPath vs NFS æ¯”è¼ƒ\n\n| ç‰¹æ€§ | hostPath | NFS |\n|------|----------|-----|\n| **è³‡æ–™ä½ç½®** | ç¯€é»æœ¬åœ° | ç¶²è·¯å…±äº« |\n| **è·¨ç¯€é»å­˜å–** | âŒ ä¸æ”¯æ´ | âœ… æ”¯æ´ |\n| **Pod èª¿åº¦** | é™åˆ¶åœ¨ç‰¹å®šç¯€é» | å¯èª¿åº¦åˆ°ä»»æ„ç¯€é» |\n| **è¨­å®šè¤‡é›œåº¦** | ç°¡å–® | éœ€è¦è¨­å®š NFS Server |\n| **ä½¿ç”¨å ´æ™¯** | æ¸¬è©¦ã€å–®ç¯€é» | ç”Ÿç”¢ç’°å¢ƒã€å¤šç¯€é»å…±äº« |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šPVC ä¸€ç›´è™•æ–¼ Pending ç‹€æ…‹ï¼Ÿ\"\n    **åŸå› **ï¼šæ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„ PVã€‚\n    \n    **æª¢æŸ¥é …ç›®**ï¼š\n    \n    - storageClassName æ˜¯å¦ç›¸åŒ\n    - accessModes æ˜¯å¦ç›¸å®¹\n    - è«‹æ±‚çš„ storage æ˜¯å¦è¶…é PV å®¹é‡\n\n??? question \"Q2ï¼šNFS æ›è¼‰å¤±æ•—ï¼Ÿ\"\n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    \n    1. ç¢ºèª NFS Server æœ‰å•Ÿå‹•ï¼š`systemctl status nfs-server`\n    2. ç¢ºèªæ‰€æœ‰ç¯€é»éƒ½å®‰è£äº† nfs-utils\n    3. ç¢ºèªé˜²ç«ç‰†æ²’æœ‰é˜»æ“‹ NFS é€£ç·š\n    4. ä½¿ç”¨ `showmount -e k8s-master1` æŸ¥çœ‹åŒ¯å‡ºçš„ç›®éŒ„\n\n??? question \"Q3ï¼šPV åˆªé™¤å¾Œå¦‚ä½•é‡æ–°ä½¿ç”¨ï¼Ÿ\"\n    **è§£ç­”**ï¼šç•¶ persistentVolumeReclaimPolicy è¨­ç‚º Retain æ™‚ï¼š\n    \n    1. æ‰‹å‹•æ¸…é™¤ PV ä¸Šçš„è³‡æ–™\n    2. åˆªé™¤èˆŠçš„ PV\n    3. é‡æ–°å»ºç«‹ PV\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **PV/PVC æ¦‚å¿µ**ï¼šPV æ˜¯å„²å­˜è³‡æºï¼ŒPVC æ˜¯ä½¿ç”¨è«‹æ±‚ï¼Œå…©è€…é€é storageClassName é…å°\n- âœ… **hostPath**ï¼šä½¿ç”¨ç¯€é»æœ¬åœ°ç›®éŒ„ï¼Œç°¡å–®ä½†ç„¡æ³•è·¨ç¯€é»\n- âœ… **NFS**ï¼šæä¾›ç¶²è·¯å…±äº«å„²å­˜ï¼Œæ”¯æ´è·¨ç¯€é»å­˜å–\n- âœ… **ç¶å®šæµç¨‹**ï¼šå»ºç«‹ PV â†’ å»ºç«‹ PVC â†’ è‡ªå‹•ç¶å®š â†’ Pod æ›è¼‰ PVC\n- âœ… **å­˜å–æ¨¡å¼**ï¼šRWOï¼ˆå–®ç¯€é»è®€å¯«ï¼‰ã€ROXï¼ˆå¤šç¯€é»å”¯è®€ï¼‰ã€RWXï¼ˆå¤šç¯€é»è®€å¯«ï¼‰\n- âœ… **å›æ”¶ç­–ç•¥**ï¼šRetainï¼ˆä¿ç•™ï¼‰ã€Deleteï¼ˆåˆªé™¤ï¼‰\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes Persistent Volumes](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)\n- [Configure a Pod to Use a PersistentVolume](https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/)\n- [NFS å„²å­˜è¨­å®š](https://kubernetes.io/docs/concepts/storage/volumes/#nfs)\n"
  },
  {
    "title": "è§£ç¢¼ base64",
    "url": "https://caocharles.github.io/dcka-class-notes/lab17_secret/",
    "content": "ï»¿# LAB 17 Kubernetes Secret\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ Secret çš„ç”¨é€”èˆ‡é¡å‹\n- [ ] ä½¿ç”¨ä¸‰ç¨®æ–¹å¼å»ºç«‹ Secretï¼ˆå¾æª”æ¡ˆã€å¾æŒ‡ä»¤ã€å¾ YAMLï¼‰\n- [ ] é€éç’°å¢ƒè®Šæ•¸å°‡ Secret å‚³éçµ¦ Pod\n- [ ] é€é Volume æ›è¼‰å°‡ Secret å‚³éçµ¦ Pod\n- [ ] ç†è§£ base64 ç·¨ç¢¼åœ¨ Secret ä¸­çš„ä½œç”¨\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 16 PV/PVC\n- ç†Ÿæ‚‰ Podã€Volume åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### Secret æ˜¯ä»€éº¼ï¼Ÿ\n\n**Secret** æ˜¯ Kubernetes ä¸­ç”¨ä¾†å„²å­˜**æ•æ„Ÿè³‡è¨Š**çš„è³‡æºï¼Œä¾‹å¦‚å¯†ç¢¼ã€API é‡‘é‘°ã€æ†‘è­‰ç­‰ã€‚Secret æœƒä»¥ base64 ç·¨ç¢¼å„²å­˜ï¼Œé¿å…æ˜æ–‡æš´éœ²åœ¨ YAML æª”æ¡ˆä¸­ã€‚\n\n```mermaid\ngraph LR\n    Admin[ç®¡ç†å“¡] -->|å»ºç«‹| Secret[Secret<br/>username: root<br/>password: ****]\n    Secret -->|ç’°å¢ƒè®Šæ•¸| Pod1[Pod]\n    Secret -->|æ›è¼‰ Volume| Pod2[Pod]\n```\n\n---\n\n### Secret å»ºç«‹èˆ‡å­˜å–çš„çµ„åˆ\n\nSecret æœ‰ **3 ç¨®å»ºç«‹æ–¹å¼** å’Œ **2 ç¨®å­˜å–æ–¹å¼**ï¼Œå…± **6 ç¨®çµ„åˆ**ï¼š\n\n| å»ºç«‹æ–¹å¼ | èªªæ˜ | base64 ç·¨ç¢¼ |\n|----------|------|-------------|\n| **å¾æª”æ¡ˆ**ï¼ˆ--from-fileï¼‰ | å°‡æª”æ¡ˆå…§å®¹åŒ¯å…¥æˆ Secret | è‡ªå‹•è™•ç† |\n| **å¾æŒ‡ä»¤**ï¼ˆ--from-literalï¼‰ | ç›´æ¥åœ¨æŒ‡ä»¤ä¸­æŒ‡å®šå€¼ | è‡ªå‹•è™•ç† |\n| **å¾ YAML** | ä½¿ç”¨ YAML æª”æ¡ˆå®šç¾© | âš ï¸ éœ€æ‰‹å‹•ç·¨ç¢¼ |\n\n| å­˜å–æ–¹å¼ | èªªæ˜ |\n|----------|------|\n| **ç’°å¢ƒè®Šæ•¸** | Secret å€¼æ³¨å…¥ç‚ºç’°å¢ƒè®Šæ•¸ |\n| **Volume æ›è¼‰** | Secret æ›è¼‰ç‚ºæª”æ¡ˆ |\n\n```mermaid\ngraph TB\n    subgraph \"å»ºç«‹ Secretï¼ˆ3 ç¨®ï¼‰\"\n        File[å¾æª”æ¡ˆ<br/>--from-file]\n        Literal[å¾æŒ‡ä»¤<br/>--from-literal]\n        YAML[å¾ YAML<br/>éœ€ base64]\n    end\n    \n    subgraph \"å­˜å– Secretï¼ˆ2 ç¨®ï¼‰\"\n        Env[ç’°å¢ƒè®Šæ•¸<br/>env]\n        Mount[Volume æ›è¼‰<br/>volumeMounts]\n    end\n    \n    File --> Env\n    File --> Mount\n    Literal --> Env\n    Literal --> Mount\n    YAML --> Env\n    YAML --> Mount\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šå»ºç«‹ Secret\n\n### æ–¹å¼ä¸€ï¼šå¾æª”æ¡ˆå»ºç«‹ Secret\n\n#### æ­¥é©Ÿ 1ï¼šå»ºç«‹åŒ…å«æ•æ„Ÿè³‡æ–™çš„æª”æ¡ˆ\n\n```bash title=\"å»ºç«‹ username å’Œ password æª”æ¡ˆ\"\necho -n \"root\" > ./username.txt\necho -n \"pass1234\" > ./password.txt\n```\n\n!!! warning \"æ³¨æ„ -n åƒæ•¸\"\n    ä½¿ç”¨ `echo -n` é¿å…åœ¨æª”æ¡ˆæœ«å°¾åŠ å…¥æ›è¡Œç¬¦è™Ÿï¼Œå¦å‰‡å¯†ç¢¼æœƒåŒ…å«å¤šé¤˜çš„æ›è¡Œã€‚\n\né©—è­‰æª”æ¡ˆå…§å®¹ï¼š\n\n```bash title=\"æŸ¥çœ‹æª”æ¡ˆå…§å®¹\"\ncat username.txt\ncat password.txt\n```\n\n**é æœŸçµæœ**ï¼ˆæ³¨æ„æ²’æœ‰æ›è¡Œï¼‰ï¼š\n\n```\nroot[root@k8s-master1 ~]#\npass1234[root@k8s-master1 ~]#\n```\n\n#### æ­¥é©Ÿ 2ï¼šå¾æª”æ¡ˆå»ºç«‹ Secret\n\n```bash title=\"å¾æª”æ¡ˆå»ºç«‹ Secret\"\nkubectl create secret generic demo-secret-from-file \\\n  --from-file=./username.txt \\\n  --from-file=./password.txt\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nsecret/demo-secret-from-file created\n```\n\næŸ¥çœ‹ Secretï¼š\n\n```bash title=\"æŸ¥çœ‹ Secret åˆ—è¡¨\"\nkubectl get secrets\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                    TYPE     DATA   AGE\ndemo-secret-from-file   Opaque   2      7s\n```\n\n```bash title=\"æŸ¥çœ‹ Secret è©³ç´°è³‡è¨Š\"\nkubectl describe secrets demo-secret-from-file\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nName:         demo-secret-from-file\nNamespace:    default\nType:  Opaque\n\nData\n====\npassword.txt:  8 bytes\nusername.txt:  4 bytes\n```\n\n!!! info \"æª”åä½œç‚º Key\"\n    ä½¿ç”¨ `--from-file` æ™‚ï¼Œ**æª”åæœƒæˆç‚º Secret çš„ Key**ï¼ˆå¦‚ `password.txt`ã€`username.txt`ï¼‰ã€‚\n\n---\n\n### æ–¹å¼äºŒï¼šå¾æŒ‡ä»¤å»ºç«‹ Secretï¼ˆ--from-literalï¼‰\n\n```bash title=\"å¾æŒ‡ä»¤å»ºç«‹ Secret\"\nkubectl create secret generic demo-secret-from-literal \\\n  --from-literal=username=root \\\n  --from-literal=password=pass1234\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nsecret/demo-secret-from-literal created\n```\n\næŸ¥çœ‹ Secretï¼š\n\n```bash title=\"æŸ¥çœ‹ Secret\"\nkubectl describe secrets demo-secret-from-literal\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nName:         demo-secret-from-literal\nNamespace:    default\nType:  Opaque\n\nData\n====\npassword:  8 bytes\nusername:  4 bytes\n```\n\n!!! tip \"è‡ªè¨‚ Key åç¨±\"\n    ä½¿ç”¨ `--from-literal` æ™‚ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®š Key åç¨±ï¼ˆå¦‚ `username`ã€`password`ï¼‰ï¼Œæ¯” `--from-file` æ›´éˆæ´»ã€‚\n\n---\n\n### æ–¹å¼ä¸‰ï¼šå¾ YAML å»ºç«‹ Secret\n\n#### æ­¥é©Ÿ 1ï¼šä½¿ç”¨ base64 ç·¨ç¢¼è³‡æ–™\n\n```bash title=\"base64 ç·¨ç¢¼\"\necho -n \"root\" | base64\necho -n \"pass1234\" | base64\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ncm9vdA==\ncGFzczEyMzQ=\n```\n\n!!! warning \"YAML æ–¹å¼éœ€è¦æ‰‹å‹• base64 ç·¨ç¢¼\"\n    åªæœ‰ä½¿ç”¨ YAML å»ºç«‹ Secret æ™‚ï¼Œéœ€è¦å…ˆå°‡è³‡æ–™é€²è¡Œ base64 ç·¨ç¢¼ã€‚`--from-file` å’Œ `--from-literal` æœƒè‡ªå‹•è™•ç†ã€‚\n\n#### æ­¥é©Ÿ 2ï¼šä¸‹è¼‰ä¸¦æŸ¥çœ‹ YAML\n\n```bash title=\"ä¸‹è¼‰ Secret YAML\"\nwget http://10.0.1.248/k8s/yaml/my-secret.yaml\ncat my-secret.yaml\n```\n\n**YAML å…§å®¹**ï¼š\n\n```yaml title=\"my-secret.yaml\"\napiVersion: v1\nkind: Secret\nmetadata:\n  name: demo-secret-from-yaml\ntype: Opaque\ndata:\n  username: cm9vdA==          # base64 ç·¨ç¢¼çš„ \"root\"\n  password: cGFzczEyMzQ=      # base64 ç·¨ç¢¼çš„ \"pass1234\"\n```\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **type: Opaque** | é€šç”¨å‹ Secret |\n| **data** | å­˜æ”¾ base64 ç·¨ç¢¼çš„è³‡æ–™ |\n\n#### æ­¥é©Ÿ 3ï¼šå¥—ç”¨ YAML\n\n```bash title=\"å»ºç«‹ Secret\"\nkubectl apply -f my-secret.yaml\n```\n\næŸ¥çœ‹æ‰€æœ‰ Secretï¼š\n\n```bash title=\"æŸ¥çœ‹æ‰€æœ‰ Secret\"\nkubectl get secrets\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                       TYPE     DATA   AGE\ndemo-secret-from-file      Opaque   2      3m32s\ndemo-secret-from-literal   Opaque   2      2m13s\ndemo-secret-from-yaml      Opaque   2      5s\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šPod å­˜å– Secret\n\n### æ–¹å¼ä¸€ï¼šé€éç’°å¢ƒè®Šæ•¸å­˜å–\n\n```bash title=\"ä¸‹è¼‰ Pod YAML\"\nwget http://10.0.1.248/k8s/yaml/my-pod.yaml\n```\n\n**Pod YAML å…§å®¹**ï¼š\n\n```yaml title=\"my-pod.yaml\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod\nspec:\n  containers:\n  - name: my-container\n    image: docker1.training.lab:5000/nginx\n    env:\n    - name: SECRET_USERNAME           # ç’°å¢ƒè®Šæ•¸åç¨±\n      valueFrom:\n        secretKeyRef:\n          name: demo-secret-from-yaml # Secret åç¨±\n          key: username               # Secret ä¸­çš„ Key\n    - name: SECRET_PASSWORD\n      valueFrom:\n        secretKeyRef:\n          name: demo-secret-from-yaml\n          key: password\n```\n\nå¥—ç”¨ Podï¼š\n\n```bash title=\"å»ºç«‹ Pod\"\nkubectl apply -f my-pod.yaml\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME     READY   STATUS    RESTARTS   AGE\nmy-pod   1/1     Running   0          16s\n```\n\né€²å…¥ Pod é©—è­‰ç’°å¢ƒè®Šæ•¸ï¼š\n\n```bash title=\"é©—è­‰ç’°å¢ƒè®Šæ•¸\"\nkubectl exec my-pod -it -- bash\n```\n\n```bash title=\"åœ¨å®¹å™¨å…§åŸ·è¡Œ\"\nenv | grep SEC\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nSECRET_USERNAME=root\nSECRET_PASSWORD=pass1234\n```\n\n!!! success \"è‡ªå‹•è§£ç¢¼\"\n    Pod å­˜å– Secret æ™‚ï¼ŒKubernetes æœƒ**è‡ªå‹•å°‡ base64 è§£ç¢¼**ï¼Œæ‡‰ç”¨ç¨‹å¼ç›´æ¥å–å¾—åŸå§‹å€¼ã€‚\n\n---\n\n### æ–¹å¼äºŒï¼šé€é Volume æ›è¼‰å­˜å–\n\n```bash title=\"ä¸‹è¼‰ Pod YAML\"\nwget http://192.168.66.248/k8s/yaml/my-pod-with-mounting-secret.yaml\n```\n\n**Pod YAML å…§å®¹**ï¼š\n\n```yaml title=\"my-pod-with-mounting-secret.yaml\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: my-pod-with-mounting-secret\nspec:\n  containers:\n  - name: my-container\n    image: docker1.training.lab:5000/nginx\n    volumeMounts:\n    - name: secret-volume\n      mountPath: \"/etc/creds\"         # æ›è¼‰è·¯å¾‘\n      readOnly: true\n  volumes:\n  - name: secret-volume\n    secret:\n      secretName: demo-secret-from-yaml  # Secret åç¨±\n```\n\nå¥—ç”¨ Podï¼š\n\n```bash title=\"å»ºç«‹ Pod\"\nkubectl apply -f my-pod-with-mounting-secret.yaml\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                          READY   STATUS    RESTARTS   AGE\nmy-pod                        1/1     Running   0          22m\nmy-pod-with-mounting-secret   1/1     Running   0          7s\n```\n\né€²å…¥ Pod é©—è­‰æ›è¼‰çš„æª”æ¡ˆï¼š\n\n```bash title=\"é©—è­‰æ›è¼‰\"\nkubectl exec my-pod-with-mounting-secret -it -- bash\n```\n\n```bash title=\"åœ¨å®¹å™¨å…§åŸ·è¡Œ\"\nls -l /etc/creds\ncat /etc/creds/username\ncat /etc/creds/password\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\ntotal 0\nlrwxrwxrwx 1 root root 15 Feb  4 08:06 password -> ..data/password\nlrwxrwxrwx 1 root root 15 Feb  4 08:06 username -> ..data/username\n\nroot\npass1234\n```\n\n!!! info \"æ›è¼‰æ–¹å¼çš„ç‰¹é»\"\n    - Secret çš„æ¯å€‹ Key æœƒè®Šæˆä¸€å€‹æª”æ¡ˆ\n    - æª”æ¡ˆå…§å®¹æ˜¯è§£ç¢¼å¾Œçš„åŸå§‹å€¼\n    - é©åˆéœ€è¦ä»¥æª”æ¡ˆå½¢å¼è®€å–çš„å ´æ™¯ï¼ˆå¦‚æ†‘è­‰ã€è¨­å®šæª”ï¼‰\n\n---\n\n## ç’°å¢ƒè®Šæ•¸ vs Volume æ›è¼‰\n\n| ç‰¹æ€§ | ç’°å¢ƒè®Šæ•¸ | Volume æ›è¼‰ |\n|------|----------|-------------|\n| **å­˜å–æ–¹å¼** | `$ENV_NAME` | è®€å–æª”æ¡ˆ |\n| **æ›´æ–°è¡Œç‚º** | Pod é‡å•Ÿæ‰æ›´æ–° | è‡ªå‹•æ›´æ–°ï¼ˆkubelet åŒæ­¥ï¼‰ |\n| **è³‡æ–™æ ¼å¼** | å­—ä¸² | æª”æ¡ˆ |\n| **é©ç”¨å ´æ™¯** | ç°¡å–®çš„ key-value | æ†‘è­‰ã€è¨­å®šæª” |\n\n---\n\n## ä¸‰ç¨®å»ºç«‹æ–¹å¼æ¯”è¼ƒ\n\n| ç‰¹æ€§ | --from-file | --from-literal | YAML |\n|------|-------------|----------------|------|\n| **base64 ç·¨ç¢¼** | è‡ªå‹• | è‡ªå‹• | âš ï¸ æ‰‹å‹• |\n| **Key åç¨±** | æª”å | è‡ªè¨‚ | è‡ªè¨‚ |\n| **ç‰ˆæœ¬æ§åˆ¶** | éœ€é¡å¤–ç®¡ç†æª”æ¡ˆ | ä¸æ˜“ç‰ˆæ§ | âœ… æ˜“æ–¼ç‰ˆæ§ |\n| **é©ç”¨å ´æ™¯** | ç¾æœ‰æª”æ¡ˆ | å¿«é€Ÿæ¸¬è©¦ | ç”Ÿç”¢ç’°å¢ƒ |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šå¦‚ä½•æŸ¥çœ‹ Secret çš„å¯¦éš›å…§å®¹ï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ `kubectl get secret -o yaml` ä¸¦è§£ç¢¼ï¼š\n    \n    ```bash\n    kubectl get secret demo-secret-from-yaml -o yaml\n    # è§£ç¢¼ base64\n    echo \"cm9vdA==\" | base64 -d\n    ```\n\n??? question \"Q2ï¼šSecret å’Œ ConfigMap æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿ\"\n    **è§£ç­”**ï¼š\n    \n    | ç‰¹æ€§ | Secret | ConfigMap |\n    |------|--------|-----------|\n    | **ç”¨é€”** | æ•æ„Ÿè³‡æ–™ | ä¸€èˆ¬è¨­å®š |\n    | **ç·¨ç¢¼** | base64 | æ˜æ–‡ |\n    | **å„²å­˜** | è¨˜æ†¶é«”ï¼ˆtmpfsï¼‰ | ä¸€èˆ¬å„²å­˜ |\n\n??? question \"Q3ï¼šå¿˜è¨˜åŠ  -n å°è‡´å¯†ç¢¼åŒ…å«æ›è¡Œæ€éº¼è¾¦ï¼Ÿ\"\n    **è§£ç­”**ï¼šé‡æ–°å»ºç«‹æª”æ¡ˆæˆ–ä½¿ç”¨ `tr` ç§»é™¤æ›è¡Œï¼š\n    \n    ```bash\n    echo \"pass1234\" | tr -d '\\n' > password.txt\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Secret ç”¨é€”**ï¼šå„²å­˜æ•æ„Ÿè³‡è¨Šï¼ˆå¯†ç¢¼ã€é‡‘é‘°ã€æ†‘è­‰ï¼‰\n- âœ… **ä¸‰ç¨®å»ºç«‹æ–¹å¼**ï¼š\n  - `--from-file`ï¼šå¾æª”æ¡ˆå»ºç«‹ï¼Œè‡ªå‹• base64\n  - `--from-literal`ï¼šå¾æŒ‡ä»¤å»ºç«‹ï¼Œè‡ªå‹• base64\n  - YAMLï¼šéœ€æ‰‹å‹• base64 ç·¨ç¢¼\n- âœ… **å…©ç¨®å­˜å–æ–¹å¼**ï¼š\n  - ç’°å¢ƒè®Šæ•¸ï¼ˆenv + secretKeyRefï¼‰\n  - Volume æ›è¼‰ï¼ˆvolumes + volumeMountsï¼‰\n- âœ… **è‡ªå‹•è§£ç¢¼**ï¼šPod å­˜å–æ™‚è‡ªå‹•å°‡ base64 è§£ç¢¼ç‚ºåŸå§‹å€¼\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes Secrets](https://kubernetes.io/docs/concepts/configuration/secret/)\n- [Distribute Credentials Securely Using Secrets](https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/)\n- [Secret Types](https://kubernetes.io/docs/concepts/configuration/secret/#secret-types)\n"
  },
  {
    "title": "Lab18 Rbac Event Log",
    "url": "https://caocharles.github.io/dcka-class-notes/lab18_rbac_event_log/",
    "content": "ï»¿# LAB 18 RBAC èˆ‡ Event/Log\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] ç†è§£ RBACï¼ˆRole-Based Access Controlï¼‰çš„æ¦‚å¿µ\n- [ ] ä½¿ç”¨ ClusterRoleBinding è¨­å®šå¢é›†å±¤ç´šçš„æ¬Šé™\n- [ ] ä½¿ç”¨ kubectl get events æŸ¥çœ‹å¢é›†äº‹ä»¶\n- [ ] ä½¿ç”¨ kubectl logs æŸ¥çœ‹ Pod æ—¥èªŒ\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 17 Secret\n- ç†Ÿæ‚‰ Podã€Deployment åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### RBAC æ˜¯ä»€éº¼ï¼Ÿ\n\n**RBACï¼ˆRole-Based Access Controlï¼‰** æ˜¯ Kubernetes çš„**æ¬Šé™æ§åˆ¶æ©Ÿåˆ¶**ï¼Œç”¨ä¾†æ§åˆ¶ã€Œèª°ã€å¯ä»¥å°ã€Œä»€éº¼è³‡æºã€åŸ·è¡Œã€Œä»€éº¼æ“ä½œã€ã€‚\n\n```mermaid\ngraph LR\n    User[ä½¿ç”¨è€…/ServiceAccount] -->|ç¶å®š| RB[RoleBinding]\n    RB -->|åƒç…§| Role[Role]\n    Role -->|å…è¨±| Actions[æ“ä½œæ¬Šé™<br/>get/list/create/delete]\n    Actions -->|å°è±¡| Resources[è³‡æº<br/>pods/deployments/secrets]\n```\n\n---\n\n### RBAC å››ç¨®è³‡æº\n\n| è³‡æº | ä½œç”¨ç¯„åœ | èªªæ˜ |\n|------|----------|------|\n| **Role** | Namespace | å®šç¾©å–®ä¸€ Namespace å…§çš„æ¬Šé™ |\n| **RoleBinding** | Namespace | å°‡ Role ç¶å®šçµ¦ä½¿ç”¨è€… |\n| **ClusterRole** | å¢é›† | å®šç¾©å¢é›†å±¤ç´šçš„æ¬Šé™ |\n| **ClusterRoleBinding** | å¢é›† | å°‡ ClusterRole ç¶å®šçµ¦ä½¿ç”¨è€… |\n\n```mermaid\ngraph TB\n    subgraph \"Namespace å±¤ç´š\"\n        Role[Role] --> RB[RoleBinding]\n        RB --> User1[User/ServiceAccount]\n    end\n    \n    subgraph \"Cluster å±¤ç´š\"\n        CR[ClusterRole] --> CRB[ClusterRoleBinding]\n        CRB --> User2[User/ServiceAccount]\n    end\n```\n\n---\n\n### å…§å»º ClusterRole\n\nKubernetes é è¨­æä¾›å¤šå€‹å…§å»ºçš„ ClusterRoleï¼š\n\n| ClusterRole | æ¬Šé™ |\n|-------------|------|\n| **view** | å”¯è®€æ¬Šé™ï¼ˆgetã€listã€watchï¼‰ |\n| **edit** | è®€å¯«æ¬Šé™ï¼ˆä¸å« RBAC è¨­å®šï¼‰ |\n| **admin** | å®Œæ•´ç®¡ç†æ¬Šé™ï¼ˆå« RBAC ç›¸é—œï¼‰ |\n| **cluster-admin** | è¶…ç´šç®¡ç†å“¡ï¼ˆæ‰€æœ‰æ¬Šé™ï¼‰ |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šRBAC ClusterRoleBinding\n\n### æ­¥é©Ÿ 1ï¼šå¥—ç”¨ ClusterRoleBinding\n\n```bash title=\"å¥—ç”¨ RBAC YAML\"\nkubectl apply -f http://192.168.66.248/k8s/yaml/rbac3.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nclusterrolebinding.rbac.authorization.k8s.io/my-global-access created\n```\n\n**rbac3.yaml å…§å®¹ç¯„ä¾‹**ï¼š\n\n```yaml title=\"rbac3.yamlï¼ˆç¯„ä¾‹ï¼‰\"\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: my-global-access\nsubjects:\n- kind: User\n  name: my-user              # æˆ– ServiceAccount\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: view                 # ä½¿ç”¨å…§å»ºçš„ view ClusterRole\n  apiGroup: rbac.authorization.k8s.io\n```\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **subjects** | æ¬Šé™æˆäºˆçš„å°è±¡ï¼ˆUserã€Groupã€ServiceAccountï¼‰ |\n| **roleRef** | åƒç…§çš„ Role æˆ– ClusterRole |\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæŸ¥çœ‹ ClusterRoleBinding\n\n```bash title=\"æŸ¥çœ‹ ClusterRoleBinding\"\nkubectl get clusterrolebindings.rbac.authorization.k8s.io | grep my-global\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nmy-global-access   ClusterRole/view   21s\n```\n\n!!! info \"ç¶å®šèªªæ˜\"\n    æ­¤ ClusterRoleBinding å°‡ `view` ClusterRole ç¶å®šçµ¦æŒ‡å®šçš„ä½¿ç”¨è€…ï¼Œè®“è©²ä½¿ç”¨è€…æ“æœ‰å¢é›†çš„å”¯è®€æ¬Šé™ã€‚\n\n---\n\n### æ­¥é©Ÿ 3ï¼šåˆªé™¤ ClusterRoleBinding\n\n```bash title=\"åˆªé™¤ ClusterRoleBinding\"\nkubectl delete -f http://192.168.66.248/k8s/yaml/rbac3.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nclusterrolebinding.rbac.authorization.k8s.io \"my-global-access\" deleted\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šEvent äº‹ä»¶ç›£æ§\n\n### Event æ˜¯ä»€éº¼ï¼Ÿ\n\n**Eventï¼ˆäº‹ä»¶ï¼‰** æ˜¯ Kubernetes è¨˜éŒ„å¢é›†ä¸­ç™¼ç”Ÿçš„é‡è¦äº‹ä»¶ï¼Œä¾‹å¦‚ Pod èª¿åº¦ã€æ˜ åƒæª”æ‹‰å–ã€å®¹å™¨å•Ÿå‹•ç­‰ã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šå»ºç«‹æ¸¬è©¦ Pod\n\n```bash title=\"å»ºç«‹æ¸¬è©¦ Pod\"\nkubectl apply -f http://192.168.66.248/k8s/yaml/log1.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod/log1 created\n```\n\n**log1.yaml å…§å®¹ç¯„ä¾‹**ï¼š\n\n```yaml title=\"log1.yamlï¼ˆç¯„ä¾‹ï¼‰\"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: log1\nspec:\n  containers:\n  - name: count\n    image: docker1.training.lab:5000/nginx\n    command: [\"/bin/sh\", \"-c\"]\n    args:\n    - i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæŸ¥çœ‹äº‹ä»¶\n\n```bash title=\"æŸ¥çœ‹å¢é›†äº‹ä»¶\"\nkubectl get events\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nLAST SEEN   TYPE     REASON      OBJECT     MESSAGE\n13s         Normal   Scheduled   pod/log1   Successfully assigned default/log1 to k8s-node1.training.lab\n13s         Normal   Pulling     pod/log1   Pulling image \"docker1.training.lab:5000/nginx\"\n13s         Normal   Pulled      pod/log1   Successfully pulled image \"docker1.training.lab:5000/nginx\" in 177ms\n13s         Normal   Created     pod/log1   Created container: count\n13s         Normal   Started     pod/log1   Started container count\n```\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **LAST SEEN** | äº‹ä»¶ç™¼ç”Ÿæ™‚é–“ |\n| **TYPE** | äº‹ä»¶é¡å‹ï¼ˆNormalã€Warningï¼‰ |\n| **REASON** | äº‹ä»¶åŸå› ï¼ˆScheduledã€Pullingã€Started ç­‰ï¼‰ |\n| **OBJECT** | ç›¸é—œçš„è³‡æº |\n| **MESSAGE** | è©³ç´°è¨Šæ¯ |\n\n---\n\n### Event ç”Ÿå‘½é€±æœŸ\n\n```mermaid\nsequenceDiagram\n    participant Scheduler\n    participant Node\n    participant Container\n    \n    Scheduler->>Node: Scheduled (èª¿åº¦åˆ°ç¯€é»)\n    Node->>Container: Pulling (æ‹‰å–æ˜ åƒæª”)\n    Node->>Container: Pulled (æ‹‰å–å®Œæˆ)\n    Node->>Container: Created (å»ºç«‹å®¹å™¨)\n    Node->>Container: Started (å•Ÿå‹•å®¹å™¨)\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šLog æ—¥èªŒæŸ¥çœ‹\n\n### æ­¥é©Ÿ 1ï¼šæŸ¥çœ‹ Pod æ—¥èªŒ\n\n```bash title=\"æŸ¥çœ‹ Pod æ—¥èªŒ\"\nkubectl logs pod/log1\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\n0: Tue Feb  4 08:17:29 UTC 2025\n1: Tue Feb  4 08:17:30 UTC 2025\n2: Tue Feb  4 08:17:31 UTC 2025\n3: Tue Feb  4 08:17:32 UTC 2025\n4: Tue Feb  4 08:17:33 UTC 2025\n...\n```\n\n---\n\n### å¸¸ç”¨ logs åƒæ•¸\n\n```bash title=\"å³æ™‚è¿½è¹¤æ—¥èªŒï¼ˆé¡ä¼¼ tail -fï¼‰\"\nkubectl logs pod/log1 -f\n```\n\n```bash title=\"é¡¯ç¤ºæœ€è¿‘ 10 è¡Œ\"\nkubectl logs pod/log1 --tail=10\n```\n\n```bash title=\"é¡¯ç¤ºæœ€è¿‘ 1 å°æ™‚çš„æ—¥èªŒ\"\nkubectl logs pod/log1 --since=1h\n```\n\n```bash title=\"é¡¯ç¤ºæ™‚é–“æˆ³è¨˜\"\nkubectl logs pod/log1 --timestamps\n```\n\n```bash title=\"æŒ‡å®šå®¹å™¨ï¼ˆå¤šå®¹å™¨ Podï¼‰\"\nkubectl logs pod/log1 -c count\n```\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `-f` | å³æ™‚è¿½è¹¤ï¼ˆfollowï¼‰ |\n| `--tail=N` | é¡¯ç¤ºæœ€å¾Œ N è¡Œ |\n| `--since=æ™‚é–“` | é¡¯ç¤ºæŒ‡å®šæ™‚é–“å…§çš„æ—¥èªŒ |\n| `--timestamps` | é¡¯ç¤ºæ™‚é–“æˆ³è¨˜ |\n| `-c å®¹å™¨å` | æŒ‡å®šå®¹å™¨ |\n| `--previous` | é¡¯ç¤ºå‰ä¸€å€‹å®¹å™¨çš„æ—¥èªŒï¼ˆé‡å•Ÿå¾Œï¼‰ |\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæ¸…ç†è³‡æº\n\n```bash title=\"åˆªé™¤æ¸¬è©¦ Pod\"\nkubectl delete -f http://192.168.66.248/k8s/yaml/log1.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\npod \"log1\" deleted\n```\n\n---\n\n## Event vs Log æ¯”è¼ƒ\n\n| ç‰¹æ€§ | Event | Log |\n|------|-------|-----|\n| **å…§å®¹** | å¢é›†äº‹ä»¶ï¼ˆèª¿åº¦ã€æ‹‰å–æ˜ åƒæª”ï¼‰ | å®¹å™¨è¼¸å‡ºï¼ˆstdout/stderrï¼‰ |\n| **ä¾†æº** | Kubernetes å…ƒä»¶ | æ‡‰ç”¨ç¨‹å¼ |\n| **ç”¨é€”** | æ’æŸ¥èª¿åº¦å•é¡Œ | æ’æŸ¥æ‡‰ç”¨ç¨‹å¼å•é¡Œ |\n| **ä¿ç•™æ™‚é–“** | ç´„ 1 å°æ™‚ | å–æ±ºæ–¼æ—¥èªŒè¼ªæ›¿è¨­å®š |\n| **æŒ‡ä»¤** | `kubectl get events` | `kubectl logs` |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’ï¼šDebug å¯¦æˆ°æµç¨‹\n\nç•¶ Pod ç„¡æ³•æ­£å¸¸é‹è¡Œæ™‚ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æµç¨‹é€²è¡Œæ•…éšœæ’é™¤ï¼š\n\n```mermaid\ngraph TD\n    Start[Pod ç•°å¸¸] --> Step1[æª¢æŸ¥ç¯€é»ç‹€æ…‹]\n    Step1 --> Step2[æª¢æŸ¥ CNI Pod]\n    Step2 --> Step3[æŸ¥çœ‹ Pod äº‹ä»¶]\n    Step3 --> Step4[æŸ¥çœ‹å®¹å™¨æ—¥èªŒ]\n    Step4 --> Fix[æ‰¾åˆ°å•é¡Œä¸¦ä¿®å¾©]\n```\n\n---\n\n### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ç¯€é»ç‹€æ…‹\n\n```bash title=\"æª¢æŸ¥ç¯€é»ç‹€æ…‹\"\nkubectl get nodes\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                       STATUS     ROLES           AGE   VERSION\nk8s-master1.training.lab   Ready      control-plane   21h   v1.32.11\nk8s-node1.training.lab     NotReady   <none>          21h   v1.32.11\nk8s-node2.training.lab     Ready      <none>          21h   v1.32.11\n```\n\n!!! warning \"NotReady ç‹€æ…‹\"\n    å¦‚æœç¯€é»é¡¯ç¤º `NotReady`ï¼Œé€šå¸¸æ˜¯ CNIï¼ˆContainer Network Interfaceï¼‰æˆ– kubelet æœ‰å•é¡Œã€‚\n\n---\n\n### æ­¥é©Ÿ 2ï¼šæª¢æŸ¥ CNI Pod ç‹€æ…‹\n\n```bash title=\"æª¢æŸ¥ Antrea CNI Pod\"\nkubectl get pods -n kube-system | grep antrea\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nantrea-agent-7zn4h                                 2/2     Running   0          2m33s\nantrea-agent-mdw2f                                 2/2     Running   0          2m34s\nantrea-agent-sbv79                                 2/2     Running   0          2m34s\nantrea-controller-57964d858f-bqwf8                 1/1     Running   0          37s\n```\n\n!!! tip \"å…¶ä»– CNI\"\n    å¦‚æœä½¿ç”¨çš„æ˜¯ Calico æˆ– Flannelï¼Œè«‹æ”¹ç”¨ï¼š\n    \n    - Calicoï¼š`kubectl get pods -n kube-system | grep calico`\n    - Flannelï¼š`kubectl get pods -n kube-system | grep flannel`\n\n---\n\n### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹ Pod è©³ç´°äº‹ä»¶\n\n```bash title=\"æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆåº•éƒ¨æœƒé¡¯ç¤º Eventsï¼‰\"\nkubectl describe pod <pod-name> -n <namespace>\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\nkubectl describe pod antrea-agent-mdw2f -n kube-system | tail -20\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nEvents:\n  Type     Reason     Age   From               Message\n  ----     ------     ----  ----               -------\n  Normal   Scheduled  82s   default-scheduler  Successfully assigned kube-system/antrea-agent-mdw2f to k8s-node1.training.lab\n  Normal   Pulling    82s   kubelet            Pulling image \"antrea/antrea-agent-ubuntu:v2.2.0\"\n  Normal   Pulled     57s   kubelet            Successfully pulled image\n  Normal   Created    57s   kubelet            Created container: install-cni\n  Normal   Started    57s   kubelet            Started container install-cni\n  Warning  Unhealthy  43s   kubelet            Readiness probe failed: HTTP probe failed with statuscode: 500\n```\n\n---\n\n### æ­¥é©Ÿ 4ï¼šæŸ¥çœ‹å®¹å™¨æ—¥èªŒ\n\n```bash title=\"æŸ¥çœ‹ç‰¹å®šå®¹å™¨çš„æ—¥èªŒ\"\nkubectl logs <pod-name> -n <namespace> -c <container-name> --tail=50\n```\n\n**ç¯„ä¾‹**ï¼š\n\n```bash\nkubectl logs antrea-agent-mdw2f -n kube-system -c antrea-agent --tail=50\n```\n\n---\n\n### å®Œæ•´ç‹€æ…‹æª¢æŸ¥è…³æœ¬\n\n```bash title=\"ä¸€æ¬¡æª¢æŸ¥æ‰€æœ‰é—œéµç‹€æ…‹\"\necho \"=== ç¯€é»ç‹€æ…‹ ===\"\nkubectl get nodes\n\necho -e \"\\n=== CNI Pods ===\"\nkubectl get pods -n kube-system | grep antrea\n\necho -e \"\\n=== æ‡‰ç”¨ Pods ===\"\nkubectl get pods -A -o wide\n\necho -e \"\\n=== ç³»çµ±æ ¸å¿ƒ Pods ===\"\nkubectl get pods -n kube-system | grep -E 'coredns|kube-proxy'\n```\n\n---\n\n## Debug å¸¸è¦‹å•é¡Œå°ç…§è¡¨\n\n| ç—‡ç‹€ | å¯èƒ½åŸå›  | æª¢æŸ¥æŒ‡ä»¤ |\n|------|----------|----------|\n| Node `NotReady` | CNI æœªå°±ç·’ | `kubectl get pods -n kube-system` |\n| Pod `Pending` | ç„¡å¯ç”¨ç¯€é» | `kubectl describe pod <name>` |\n| Pod `ImagePullBackOff` | æ˜ åƒæª”æ‹‰å–å¤±æ•— | `kubectl describe pod <name>` |\n| Pod `CrashLoopBackOff` | å®¹å™¨æŒçºŒå´©æ½° | `kubectl logs <pod> --previous` |\n| Service ç„¡æ³•å­˜å– | Endpoint æœªç¶å®š | `kubectl get endpoints` |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šå¦‚ä½•æŸ¥çœ‹ç‰¹å®š Pod çš„äº‹ä»¶ï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ `kubectl describe pod` æœƒåœ¨åº•éƒ¨é¡¯ç¤ºç›¸é—œäº‹ä»¶ï¼š\n    \n    ```bash\n    kubectl describe pod log1\n    ```\n\n??? question \"Q2ï¼šPod é‡å•Ÿå¾Œæ—¥èªŒæ¶ˆå¤±äº†æ€éº¼è¾¦ï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ `--previous` åƒæ•¸æŸ¥çœ‹å‰ä¸€å€‹å®¹å™¨çš„æ—¥èªŒï¼š\n    \n    ```bash\n    kubectl logs pod/log1 --previous\n    ```\n\n??? question \"Q3ï¼šå¦‚ä½•å°‡æ—¥èªŒå°å‡ºåˆ°æª”æ¡ˆï¼Ÿ\"\n    **è§£ç­”**ï¼šä½¿ç”¨ shell é‡å°å‘ï¼š\n    \n    ```bash\n    kubectl logs pod/log1 > pod-log.txt\n    ```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **RBAC æ¦‚å¿µ**ï¼šRole-Based Access Control æ§åˆ¶è³‡æºå­˜å–æ¬Šé™\n- âœ… **å››ç¨® RBAC è³‡æº**ï¼šRoleã€RoleBindingï¼ˆNamespace å±¤ç´šï¼‰ã€ClusterRoleã€ClusterRoleBindingï¼ˆå¢é›†å±¤ç´šï¼‰\n- âœ… **å…§å»º ClusterRole**ï¼šviewï¼ˆå”¯è®€ï¼‰ã€editï¼ˆè®€å¯«ï¼‰ã€adminï¼ˆç®¡ç†ï¼‰ã€cluster-adminï¼ˆè¶…ç´šç®¡ç†å“¡ï¼‰\n- âœ… **Event ç›£æ§**ï¼š`kubectl get events` æŸ¥çœ‹å¢é›†äº‹ä»¶\n- âœ… **Log æŸ¥çœ‹**ï¼š`kubectl logs` æŸ¥çœ‹å®¹å™¨è¼¸å‡ºï¼Œæ”¯æ´ `-f`ã€`--tail`ã€`--since` ç­‰åƒæ•¸\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)\n- [Using RBAC Authorization](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)\n- [Kubectl Logs](https://kubernetes.io/docs/reference/kubectl/generated/kubectl_logs/)\n"
  },
  {
    "title": "Lab19 K8S Wordpress Mysql",
    "url": "https://caocharles.github.io/dcka-class-notes/lab19_k8s_wordpress_mysql/",
    "content": "ï»¿# LAB 19 Kubernetes + WordPress + MySQL éƒ¨ç½²\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] è¨­å®š NFS Server æä¾›å…±äº«å„²å­˜\n- [ ] è¨­å®š Worker Node é–‹æ©Ÿè‡ªå‹•æ›è¼‰ NFS\n- [ ] å»ºç«‹ ConfigMap å’Œ Secret\n- [ ] å»ºç«‹ PV/PVC æŒä¹…åŒ–å„²å­˜\n- [ ] éƒ¨ç½² MySQL è³‡æ–™åº«å’Œ WordPress\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 16 PV/PVC\n- å®Œæˆ LAB 17 Secret\n- ç†Ÿæ‚‰ Serviceã€Deployment åŸºæœ¬æ¦‚å¿µ\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### æ•´é«”æ¶æ§‹\n\n```mermaid\ngraph TB\n    subgraph master[\"k8s-master1 NFS Server\"]\n        NFS[\"NFS æœå‹™\"]\n        Data[\"/data\"]\n    end\n    \n    subgraph cluster[\"Kubernetes Cluster\"]\n        subgraph wp[\"WordPress\"]\n            WP[\"WordPress Pod\"]\n            WP-SVC[\"WordPress Service\"]\n        end\n        \n        subgraph db[\"MySQL\"]\n            MySQL[\"MySQL Pod\"]\n            MySQL-SVC[\"MySQL Service\"]\n        end\n        \n        PV1[\"local-pv-1\"]\n        PV2[\"local-pv-2\"]\n    end\n    \n    User[\"ä½¿ç”¨è€…\"] --> WP-SVC\n    WP-SVC --> WP\n    WP --> MySQL-SVC\n    MySQL-SVC --> MySQL\n    PV1 -.-> NFS\n    PV2 -.-> NFS\n```\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! info \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab **æ‰€æœ‰æ“ä½œéƒ½åœ¨ k8s-master1** ä¸ŠåŸ·è¡Œï¼Œä¸éœ€è¦åˆ‡æ›åˆ°å…¶ä»–è™›æ“¬æ©Ÿçš„ Consoleã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šç¢ºèª Kubernetes ç’°å¢ƒæ­£å¸¸\n\n```bash title=\"æª¢æŸ¥ç¯€é»ç‹€æ…‹\"\nkubectl get nodes\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                       STATUS   ROLES           AGE   VERSION\nk8s-master1.training.lab   Ready    control-plane   22h   v1.32.11\nk8s-node1.training.lab     Ready    <none>          22h   v1.32.11\nk8s-node2.training.lab     Ready    <none>          22h   v1.32.11\n```\n\n!!! warning \"ç¯€é»å¿…é ˆ Ready\"\n    ç¢ºä¿æ‰€æœ‰ç¯€é»éƒ½æ˜¯ `Ready` ç‹€æ…‹å†ç¹¼çºŒã€‚\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå»ºç«‹ NFS å…±äº«ç›®éŒ„\n\nåœ¨ Master å»ºç«‹è³‡æ–™ç›®éŒ„ï¼š\n\n```bash title=\"åœ¨ k8s-master1 å»ºç«‹ç›®éŒ„\"\nmkdir -p /data/db\nmkdir -p /data/wordpress\n```\n\nåœ¨ Worker Node å»ºç«‹æ›è¼‰é»ï¼š\n\n```bash title=\"é€é SSH åœ¨ Worker Node å»ºç«‹ç›®éŒ„\"\nsshpass -p container ssh -p 22 root@k8s-node1 \"mkdir -p /data\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"mkdir -p /data\"\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå®‰è£ NFS å¥—ä»¶\n\n**åœ¨ k8s-master1ï¼ˆNFS Serverï¼‰å®‰è£**ï¼š\n\n```bash title=\"å®‰è£ NFS Server\"\nyum install nfs-utils -y\n```\n\n**åœ¨ Worker Nodeï¼ˆNFS Clientï¼‰å®‰è£**ï¼š\n\n```bash title=\"é€é SSH å®‰è£ NFS Client\"\nsshpass -p container ssh -p 22 root@k8s-node1 \"yum install nfs-utils -y\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"yum install nfs-utils -y\"\n```\n\n---\n\n### æ­¥é©Ÿ 4ï¼šè¨­å®š NFS Server\n\nç·¨è¼¯ /etc/exportsï¼š\n\n```bash title=\"ç·¨è¼¯ NFS åŒ¯å‡ºè¨­å®š\"\nvi /etc/exports\n```\n\nåŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š\n\n```title=\"/etc/exports\"\n/data *(rw,no_root_squash)\n```\n\nå•Ÿå‹•ä¸¦å•Ÿç”¨ NFS æœå‹™ï¼š\n\n```bash title=\"å•Ÿå‹• NFS Server\"\nsystemctl start nfs-server.service\nsystemctl enable nfs-server.service\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nCreated symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service â†’ /usr/lib/systemd/system/nfs-server.service.\n```\n\n---\n\n### æ­¥é©Ÿ 5ï¼šæ›è¼‰ NFS ä¸¦é©—è­‰\n\nåœ¨ Worker Node æ›è¼‰ NFSï¼š\n\n```bash title=\"æ›è¼‰ NFS\"\nsshpass -p container ssh -p 22 root@k8s-node1 \"mount -t nfs k8s-master1:/data /data\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"mount -t nfs k8s-master1:/data /data\"\n```\n\n!!! warning \"ä¸»æ©Ÿåç¨±å¾ˆé‡è¦\"\n    å¿…é ˆä½¿ç”¨ `k8s-master1:/data`ï¼Œä½¿ç”¨ `master:/data` æœƒå¡ä½ç„¡å›æ‡‰ï¼\n\né©—è­‰æ›è¼‰æˆåŠŸï¼š\n\n```bash title=\"é©—è­‰ NFS æ›è¼‰\"\nsshpass -p container ssh -p 22 root@k8s-node1 \"df -Th | grep nfs\"\nsshpass -p container ssh -p 22 root@k8s-node2 \"df -Th | grep nfs\"\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nk8s-master1:/data   nfs4       70G  8.0G   62G  12% /data\n```\n\n---\n\n### æ­¥é©Ÿ 6ï¼šè¨­å®šé–‹æ©Ÿè‡ªå‹•æ›è¼‰\n\nä¿®æ”¹ fstab ä¸¦è¤‡è£½åˆ° Worker Nodeï¼š\n\n```bash title=\"å»ºç«‹ä¿®æ”¹å¾Œçš„ fstab\"\ncp /etc/fstab /tmp/fstab\necho \"k8s-master1:/data /data nfs defaults 0 0\" >> /tmp/fstab\n```\n\næŸ¥çœ‹ä¿®æ”¹å…§å®¹ï¼š\n\n```bash title=\"ç¢ºèª fstab å…§å®¹\"\ncat /tmp/fstab\n```\n\n**é æœŸçµæœ**ï¼ˆæœ€å¾Œä¸€è¡Œï¼‰ï¼š\n\n```\nk8s-master1:/data /data nfs defaults 0 0\n```\n\nè¤‡è£½åˆ° Worker Nodeï¼š\n\n```bash title=\"è¤‡è£½ fstab åˆ° Worker Node\"\nsshpass -p container scp /tmp/fstab root@k8s-node1:/etc/fstab\nsshpass -p container scp /tmp/fstab root@k8s-node2:/etc/fstab\n```\n\n---\n\n### æ­¥é©Ÿ 7ï¼šå»ºç«‹ ConfigMap\n\n```bash title=\"å»ºç«‹ ConfigMap\"\nkubectl create configmap mydb-env \\\n  --from-literal=MYSQL_ROOT_PASSWORD=container \\\n  --from-literal=TZ=\"Asia/Taipei\"\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æŸ¥çœ‹ ConfigMap\"\nkubectl get configmaps\nkubectl describe configmaps mydb-env\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nData\n====\nMYSQL_ROOT_PASSWORD:\n----\ncontainer\n\nTZ:\n----\nAsia/Taipei\n```\n\n---\n\n### æ­¥é©Ÿ 8ï¼šå»ºç«‹ Secret\n\n```bash title=\"å»ºç«‹ Secret\"\nkubectl create secret generic mysql-pass \\\n  --from-literal=password=container\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æŸ¥çœ‹ Secret\"\nkubectl get secrets\nkubectl describe secrets mysql-pass\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nData\n====\npassword:  9 bytes\n```\n\n---\n\n### æ­¥é©Ÿ 9ï¼šå»ºç«‹ PV\n\n```bash title=\"å»ºç«‹ PV\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/volumes.yaml\nkubectl get pv\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   AGE\nlocal-pv-1   20Gi       RWO            Retain           Available                          8s\nlocal-pv-2   20Gi       RWO            Retain           Available                          8s\n```\n\n---\n\n### æ­¥é©Ÿ 10ï¼šéƒ¨ç½² MySQL\n\n```bash title=\"éƒ¨ç½² MySQL\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/mysql-deployment.yaml\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æŸ¥çœ‹ MySQL è³‡æº\"\nkubectl get services\nkubectl get deployments.apps\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nwordpress-mysql   ClusterIP   None         <none>        3306/TCP   13s\n\nNAME              READY   UP-TO-DATE   AVAILABLE   AGE\nwordpress-mysql   1/1     1            1           28s\n\nNAME                               READY   STATUS    RESTARTS   AGE\nwordpress-mysql-57444c5587-kkwq4   1/1     Running   0          36s\n```\n\n!!! info \"Headless Service\"\n    `wordpress-mysql` Service çš„ ClusterIP æ˜¯ `None`ï¼Œé€™æ˜¯ Headless Serviceï¼ŒWordPress æœƒé€é DNS åç¨±ç›´æ¥é€£æ¥ MySQL Podã€‚\n\n---\n\n### æ­¥é©Ÿ 11ï¼šéƒ¨ç½² WordPress\n\n```bash title=\"éƒ¨ç½² WordPress\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/wordpress-deployment.yaml\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æŸ¥çœ‹ WordPress è³‡æº\"\nkubectl get deployments.apps\nkubectl get services\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME              READY   UP-TO-DATE   AVAILABLE   AGE\nwordpress         1/1     1            1           14s\nwordpress-mysql   1/1     1            1           101s\n\nNAME              TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nwordpress         LoadBalancer   172.30.184.40   <pending>     80:31294/TCP   23s\nwordpress-mysql   ClusterIP      None            <none>        3306/TCP       110s\n```\n\n!!! note \"LoadBalancer é¡å‹\"\n    WordPress Service æ˜¯ `LoadBalancer` é¡å‹ï¼Œåœ¨æœ¬åœ°ç’°å¢ƒ EXTERNAL-IP æœƒé¡¯ç¤º `<pending>`ï¼Œä½†å¯ä»¥é€é NodePortï¼ˆå¦‚ 31294ï¼‰æˆ– ClusterIP å­˜å–ã€‚\n\n---\n\n### æ­¥é©Ÿ 12ï¼šåˆå§‹åŒ– WordPress\n\nä½¿ç”¨ç€è¦½å™¨é–‹å•Ÿ WordPressï¼ˆä½¿ç”¨ ClusterIPï¼‰ï¼š\n\n```bash title=\"é–‹å•Ÿ WordPress\"\nfirefox http://172.30.184.40\n```\n\næˆ–ä½¿ç”¨ Node IP + NodePortï¼š\n\n```bash title=\"ä½¿ç”¨ NodePort å­˜å–\"\nfirefox http://k8s-node1:31294\nfirefox http://k8s-node2:31294\n```\n\n!!! success \"WordPress å®‰è£é é¢\"\n    å¦‚æœçœ‹åˆ° WordPress å®‰è£é é¢ï¼ˆèªè¨€é¸æ“‡ï¼‰ï¼Œè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼é¸æ“‡èªè¨€å¾Œä¾ç…§ç•«é¢æŒ‡ç¤ºå®Œæˆè¨­å®šã€‚\n\n**WordPress å®‰è£æˆåŠŸç•«é¢**ï¼š\n\n![WordPress å®‰è£é é¢ - èªè¨€é¸æ“‡](assets/images/wordpress_install_page.png)\n\n---\n\n## è³‡æºç¸½è¦½\n\n```bash title=\"æŸ¥çœ‹æ‰€æœ‰è³‡æº\"\nkubectl get all\nkubectl get pv,pvc\nkubectl get configmaps,secrets\n```\n\n---\n\n## æ¸…ç†è³‡æº\n\n```bash title=\"æ¸…ç†æ‰€æœ‰è³‡æº\"\nkubectl delete -f http://10.0.1.249/k8s/yaml/wordpress-deployment.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/mysql-deployment.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/volumes.yaml\nkubectl delete secret mysql-pass\nkubectl delete configmap mydb-env\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šNFS æ›è¼‰å¡ä½ç„¡å›æ‡‰ï¼Ÿ\"\n    **åŸå› **ï¼šä½¿ç”¨äº†éŒ¯èª¤çš„ä¸»æ©Ÿåç¨±ã€‚\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨å®Œæ•´ä¸»æ©Ÿåç¨± `k8s-master1:/data`ï¼Œä¸è¦ç”¨ç°¡å¯« `master:/data`ã€‚\n\n??? question \"Q2ï¼šWordPress ç„¡æ³•é€£æ¥ MySQLï¼Ÿ\"\n    **æª¢æŸ¥é …ç›®**ï¼š\n    \n    1. MySQL Pod æ˜¯å¦ Runningï¼š`kubectl get pods -l app=wordpress`\n    2. Secret æ˜¯å¦å­˜åœ¨ï¼š`kubectl get secret mysql-pass`\n    3. æŸ¥çœ‹ WordPress æ—¥èªŒï¼š`kubectl logs -l app=wordpress,tier=frontend`\n\n??? question \"Q3ï¼šPVC è™•æ–¼ Pending ç‹€æ…‹ï¼Ÿ\"\n    **åŸå› **ï¼šæ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„ PVã€‚\n    \n    **æª¢æŸ¥**ï¼šç¢ºèª PV å·²å»ºç«‹ä¸”ç‹€æ…‹æ˜¯ Availableã€‚\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **NFS Server è¨­å®š**ï¼š`/data *(rw,no_root_squash)`\n- âœ… **NFS Client æ›è¼‰**ï¼šä½¿ç”¨ `k8s-master1:/data`ï¼ˆä¸æ˜¯ `master:/data`ï¼‰\n- âœ… **fstab è‡ªå‹•æ›è¼‰**ï¼šé€é scp è¤‡è£½åˆ° Worker Node\n- âœ… **ConfigMap**ï¼šå„²å­˜ MySQL ç’°å¢ƒè®Šæ•¸\n- âœ… **Secret**ï¼šå„²å­˜ MySQL å¯†ç¢¼\n- âœ… **PV/PVC**ï¼šNFS æŒä¹…åŒ–å„²å­˜\n- âœ… **Headless Service**ï¼šMySQL ä½¿ç”¨ `clusterIP: None`\n- âœ… **LoadBalancer Service**ï¼šWordPress å°å¤–æš´éœ²\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes WordPress + MySQL Example](https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/)\n- [NFS Persistent Volumes](https://kubernetes.io/docs/concepts/storage/volumes/#nfs)\n"
  },
  {
    "title": "é‡æ–°ç”¢ç”Ÿ Token",
    "url": "https://caocharles.github.io/dcka-class-notes/lab20_dashboard/",
    "content": "ï»¿# LAB 20 åœ–å½¢ç®¡ç†å·¥å…· Kubernetes Dashboard\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] éƒ¨ç½² Kubernetes Dashboard\n- [ ] ä½¿ç”¨ kubectl proxy é€£æ¥ Dashboard\n- [ ] å»ºç«‹ ServiceAccount ä¸¦å–å¾—ç™»å…¥ Token\n- [ ] é€é Dashboard ç®¡ç† Kubernetes è³‡æº\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 19 WordPress + MySQL éƒ¨ç½²\n- ç†Ÿæ‚‰ RBAC åŸºæœ¬æ¦‚å¿µ\n- æº–å‚™å¥½ Kubernetes å¢é›†ç’°å¢ƒï¼ˆk8s-master1ï¼‰\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### Kubernetes Dashboard æ˜¯ä»€éº¼ï¼Ÿ\n\n**Kubernetes Dashboard** æ˜¯ Kubernetes å®˜æ–¹æä¾›çš„**ç¶²é å¼ç®¡ç†ä»‹é¢**ï¼Œè®“ä½ å¯ä»¥é€éåœ–å½¢åŒ–ç•Œé¢ç®¡ç†å¢é›†ä¸­çš„è³‡æºï¼Œè€Œä¸éœ€è¦è¨˜æ†¶å¤§é‡çš„ kubectl æŒ‡ä»¤ã€‚\n\n```mermaid\ngraph LR\n    subgraph browser[\"ç€è¦½å™¨\"]\n        User[\"ä½¿ç”¨è€…\"]\n    end\n    \n    subgraph master[\"k8s-master1\"]\n        Proxy[\"kubectl proxy\"]\n        Dashboard[\"Dashboard Pod\"]\n        API[\"API Server\"]\n    end\n    \n    User --> Proxy\n    Proxy --> API\n    API --> Dashboard\n```\n\n### Dashboard åŠŸèƒ½\n\n| åŠŸèƒ½ | èªªæ˜ |\n|------|------|\n| **è³‡æºæª¢è¦–** | æŸ¥çœ‹ Podsã€Deploymentsã€Services ç­‰è³‡æºç‹€æ…‹ |\n| **è³‡æºå»ºç«‹** | é€é YAML æˆ–è¡¨å–®å»ºç«‹æ–°è³‡æº |\n| **æ—¥èªŒæŸ¥çœ‹** | å³æ™‚æŸ¥çœ‹ Pod çš„å®¹å™¨æ—¥èªŒ |\n| **Shell é€£ç·š** | ç›´æ¥åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿå®¹å™¨çš„ Shell |\n| **è³‡æºç·¨è¼¯** | ç·¨è¼¯ç¾æœ‰è³‡æºçš„ YAML è¨­å®š |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! note \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab æ‰€æœ‰æ“ä½œéƒ½åœ¨ **k8s-master1** çš„**åœ–å½¢ç’°å¢ƒ**ä¸‹åŸ·è¡Œï¼Œéœ€è¦é–‹å•Ÿ gnome-terminalã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šæ¸…é™¤ç¾æœ‰è³‡æº\n\nåœ¨é–‹å§‹å‰ï¼Œå…ˆæ¸…é™¤ä¹‹å‰ Lab å»ºç«‹çš„è³‡æºï¼š\n\n```bash title=\"æ¸…é™¤è³‡æº\"\nkubectl delete all --all\nkubectl delete pvc --all\nkubectl delete pv --all\nkubectl delete secrets mysql-pass\nkubectl delete configmap mysql-config\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šéƒ¨ç½² Kubernetes Dashboard\n\nDashboard ä½¿ç”¨å®˜æ–¹æä¾›çš„ YAML æª”éƒ¨ç½²ï¼š\n\n!!! info \"YAML ä¾†æº\"\n    å®˜æ–¹ YAMLï¼š`https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml`\n    \n    æœ¬èª²ç¨‹ä½¿ç”¨è¬›å¸«æä¾›çš„ç‰ˆæœ¬ï¼š`http://10.0.1.249/k8s/yaml/recommended.yaml`\n\n```bash title=\"éƒ¨ç½² Dashboard\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/recommended.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nnamespace/kubernetes-dashboard created\nserviceaccount/kubernetes-dashboard created\nservice/kubernetes-dashboard created\nsecret/kubernetes-dashboard-certs created\nsecret/kubernetes-dashboard-csrf created\nsecret/kubernetes-dashboard-key-holder created\nconfigmap/kubernetes-dashboard-settings created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\nclusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created\ndeployment.apps/kubernetes-dashboard created\nservice/dashboard-metrics-scraper created\ndeployment.apps/dashboard-metrics-scraper created\n```\n\né©—è­‰éƒ¨ç½²ç‹€æ…‹ï¼š\n\n```bash title=\"æª¢æŸ¥ Dashboard Pod\"\nkubectl get pods -n kubernetes-dashboard\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME                                         READY   STATUS    RESTARTS   AGE\ndashboard-metrics-scraper-5cb4f4bb9c-xxxxx   1/1     Running   0          30s\nkubernetes-dashboard-6967859bff-xxxxx        1/1     Running   0          30s\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå»ºç«‹ç®¡ç†å“¡å¸³è™Ÿ\n\nDashboard é è¨­çš„ ServiceAccount æ¬Šé™æœ‰é™ï¼Œæˆ‘å€‘éœ€è¦å»ºç«‹ä¸€å€‹æ“æœ‰ç®¡ç†å“¡æ¬Šé™çš„å¸³è™Ÿï¼š\n\n```bash title=\"å»ºç«‹ admin-user\"\nkubectl apply -f http://10.0.1.249/k8s/yaml/KubernetesDashboard.yaml\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nserviceaccount/admin-user created\nclusterrolebinding.rbac.authorization.k8s.io/admin-user created\n```\n\n!!! warning \"æ³¨æ„æª”åå¤§å°å¯«\"\n    æª”åæ˜¯ `KubernetesDashboard.yaml`ï¼ˆK å’Œ D å¤§å¯«ï¼‰ï¼Œä¸æ˜¯ `kubernetesDashboard.yaml`ï¼\n\né€™å€‹ YAML æœƒå»ºç«‹ï¼š\n\n1. **ServiceAccount `admin-user`**ï¼šåœ¨ `kubernetes-dashboard` namespace\n2. **ClusterRoleBinding**ï¼šå°‡ `cluster-admin` è§’è‰²ç¶å®šçµ¦ `admin-user`\n\n---\n\n### æ­¥é©Ÿ 4ï¼šå•Ÿå‹• kubectl proxy\n\nåœ¨åœ–å½¢ç’°å¢ƒä¸­é–‹å•Ÿ **gnome-terminal**ï¼ŒåŸ·è¡Œ kubectl proxyï¼š\n\n```bash title=\"å•Ÿå‹• Proxyï¼ˆä¿æŒæ­¤è¦–çª—é–‹å•Ÿï¼‰\"\nkubectl proxy\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nStarting to serve on 127.0.0.1:8001\n```\n\n![kubectl proxy åŸ·è¡Œç•«é¢](assets/images/kubectl_proxy_terminal.png)\n\n!!! danger \"é‡è¦ï¼šä¸è¦é—œé–‰é€™å€‹è¦–çª—ï¼\"\n    `kubectl proxy` éœ€è¦æŒçºŒåŸ·è¡Œï¼Œé—œé–‰è¦–çª—æœƒä¸­æ–·èˆ‡ Dashboard çš„é€£ç·šã€‚\n\n---\n\n### æ­¥é©Ÿ 5ï¼šé–‹å•Ÿ Dashboard ç¶²é \n\nåœ¨åœ–å½¢ç’°å¢ƒä¸­é–‹å•Ÿç€è¦½å™¨ï¼ˆFirefoxï¼‰ï¼Œé€£ç·šåˆ° Dashboardï¼š\n\n**Dashboard URL**ï¼š\n\n```\nhttp://127.0.0.1:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login\n```\n\n!!! tip \"é–‹å•Ÿæ–°åˆ†é \"\n    åœ¨ gnome-terminal æŒ‰ `Ctrl+Shift+T` é–‹å•Ÿæ–°åˆ†é ï¼Œæˆ–é–‹å•Ÿæ–°è¦–çª—ã€‚\n\nä½ æœƒçœ‹åˆ° Dashboard ç™»å…¥é é¢ï¼š\n\n![Dashboard ç™»å…¥é é¢](assets/images/dashboard_login_page.png)\n\n---\n\n### æ­¥é©Ÿ 6ï¼šå–å¾—ç™»å…¥ Token\n\nåœ¨**å¦ä¸€å€‹çµ‚ç«¯æ©Ÿè¦–çª—**ï¼ˆæ–°åˆ†é ï¼‰åŸ·è¡Œï¼š\n\n```bash title=\"ç”¢ç”Ÿ Token\"\nkubectl create token admin-user -n kubernetes-dashboard\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\neyJhbGciOiJSUzI1NiIsImtpZCI6Ik5na0NBUnl2Z1o4dU1uZmJqcER5ZnVjdDZa...\n```\n\n!!! note \"Token æœ‰æ•ˆæœŸé™\"\n    é è¨­ Token æœ‰æ•ˆæœŸé™ç‚º 1 å°æ™‚ã€‚å¦‚éœ€æ›´é•·æ™‚é–“ï¼Œå¯ä½¿ç”¨ `--duration` åƒæ•¸ï¼š\n    ```bash\n    kubectl create token admin-user -n kubernetes-dashboard --duration=24h\n    ```\n\n---\n\n### æ­¥é©Ÿ 7ï¼šç™»å…¥ Dashboard\n\n1. åœ¨ç™»å…¥é é¢é¸æ“‡ **Token** é¸é …\n2. å°‡ä¸Šä¸€æ­¥ç”¢ç”Ÿçš„ Token è¤‡è£½è²¼ä¸Š\n3. é»é¸ **Sign in**\n\n![è¼¸å…¥ Token ç™»å…¥](assets/images/dashboard_token_input.png)\n\n---\n\n### æ­¥é©Ÿ 8ï¼šä½¿ç”¨ Dashboard ç®¡ç†è³‡æº\n\nç™»å…¥æˆåŠŸå¾Œï¼Œä½ å¯ä»¥é€é Dashboard é€²è¡Œå„ç¨®æ“ä½œï¼š\n\n#### å»ºç«‹æ¸¬è©¦ Deployment\n\nå…ˆç”¨ kubectl å»ºç«‹ä¸€å€‹æ¸¬è©¦è³‡æºï¼š\n\n```bash title=\"å»ºç«‹æ¸¬è©¦ Deployment\"\nkubectl create deployment test1 --image=docker1.training.lab:5000/httpd\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æª¢æŸ¥ Deployment\"\nkubectl get deployments.apps\nkubectl get pods\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\ntest1   1/1     1            1           11s\n\nNAME                    READY   STATUS    RESTARTS   AGE\ntest1-dcd787f9d-pmklm   1/1     Running   0          22s\n```\n\n#### æª¢è¦– Deployments\n\nåœ¨å·¦å´é¸å–®é»é¸ **Workloads** > **Deployments**ï¼Œå¯ä»¥çœ‹åˆ°å‰›å»ºç«‹çš„ test1ï¼š\n\n![Dashboard Deployments åˆ—è¡¨](assets/images/dashboard_deployments.png)\n\nå¯ä»¥çœ‹åˆ°ï¼š\n\n- **Name**ï¼šDeployment åç¨±ï¼ˆtest1ï¼‰\n- **Namespace**ï¼šæ‰€å±¬å‘½åç©ºé–“ï¼ˆdefaultï¼‰\n- **Pods**ï¼šPod æ•¸é‡ï¼ˆ1/1 è¡¨ç¤º 1 å€‹å°±ç·’ï¼‰\n- **Images**ï¼šä½¿ç”¨çš„æ˜ åƒæª”ï¼ˆdocker1.training.lab:5000/httpdï¼‰\n\n#### æª¢è¦– Deployment è©³ç´°è³‡è¨Š\n\né»é¸ Deployment åç¨±å¯ä»¥æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼š\n\n![Dashboard Deployment è©³ç´°é é¢](assets/images/dashboard_deployment_detail.png)\n\nè©³ç´°é é¢é¡¯ç¤ºï¼š\n\n- **Metadata**ï¼šåç¨±ã€å‘½åç©ºé–“ã€å»ºç«‹æ™‚é–“ã€UID\n- **Labels**ï¼šæ¨™ç±¤ï¼ˆapp: test1ï¼‰\n- **Resource information**ï¼šæ›´æ–°ç­–ç•¥ï¼ˆRollingUpdateï¼‰ã€Selector\n- **Rolling update strategy**ï¼šæ»¾å‹•æ›´æ–°åƒæ•¸ï¼ˆmaxSurge: 25%, maxUnavailable: 25%ï¼‰\n\n#### æª¢è¦– Pods\n\nåœ¨å·¦å´é¸å–®é»é¸ **Workloads** > **Pods**ï¼š\n\n![Dashboard Pods åˆ—è¡¨](assets/images/dashboard_pods.png)\n\nPods åˆ—è¡¨é¡¯ç¤ºï¼š\n\n- **Name**ï¼šPod å®Œæ•´åç¨±\n- **Node**ï¼šPod é‹è¡Œçš„ç¯€é»ï¼ˆk8s-node1.training.labï¼‰\n- **Status**ï¼šé‹è¡Œç‹€æ…‹ï¼ˆRunningï¼‰\n- **Restarts**ï¼šé‡å•Ÿæ¬¡æ•¸\n- **CPU/Memory Usage**ï¼šè³‡æºä½¿ç”¨é‡\n\n#### æª¢è¦– Pod è©³ç´°è³‡è¨Š\n\né»é¸ Pod åç¨±å¯ä»¥æŸ¥çœ‹å®Œæ•´è©³ç´°è³‡è¨Šï¼š\n\n![Dashboard Pod è©³ç´°é é¢](assets/images/dashboard_pod_detail.png)\n\nPod è©³ç´°é é¢é¡¯ç¤ºï¼š\n\n- **Metadata**ï¼šPod åç¨±ã€å‘½åç©ºé–“ã€å»ºç«‹æ™‚é–“ã€UIDã€Labels\n- **Resource information**ï¼šé‹è¡Œç¯€é»ã€IPï¼ˆ10.128.1.5ï¼‰ã€QoS Classï¼ˆBestEffortï¼‰\n- **Conditions**ï¼šPod ç‹€æ…‹æ¢ä»¶ï¼ˆPodReadyToStartContainersã€Initializedã€Readyã€ContainersReadyï¼‰\n\n!!! success \"Dashboard åŠŸèƒ½\"\n    é™¤äº†æª¢è¦–è³‡æºï¼Œä½ é‚„å¯ä»¥ï¼š\n    \n    - ğŸ“ **ç·¨è¼¯ YAML**ï¼šé»é¸å³ä¸Šè§’çš„ç·¨è¼¯åœ–ç¤º\n    - ğŸ“‹ **æŸ¥çœ‹æ—¥èªŒ**ï¼šé»é¸å³ä¸Šè§’çš„æ—¥èªŒåœ–ç¤º\n    - ğŸ’» **é–‹å•Ÿ Shell**ï¼šç›´æ¥åœ¨ç€è¦½å™¨ä¸­é€£ç·šå®¹å™¨\n\n---\n\n## è³‡æºç¸½è¦½\n\nDashboard éƒ¨ç½²å¾Œæœƒå»ºç«‹ä»¥ä¸‹è³‡æºï¼š\n\n| è³‡æºé¡å‹ | åç¨± | èªªæ˜ |\n|----------|------|------|\n| Namespace | kubernetes-dashboard | Dashboard å°ˆç”¨å‘½åç©ºé–“ |\n| Deployment | kubernetes-dashboard | Dashboard ä¸»ç¨‹å¼ |\n| Deployment | dashboard-metrics-scraper | æŒ‡æ¨™æ”¶é›†å™¨ |\n| Service | kubernetes-dashboard | Dashboard æœå‹™ |\n| ServiceAccount | admin-user | ç®¡ç†å“¡å¸³è™Ÿ |\n| ClusterRoleBinding | admin-user | ç¶å®š cluster-admin æ¬Šé™ |\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šDashboard é é¢é¡¯ç¤ºç©ºç™½æˆ– 403 éŒ¯èª¤\"\n    **åŸå› **ï¼šToken éæœŸæˆ–æ¬Šé™ä¸è¶³\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    # é‡æ–°ç”¢ç”Ÿ Token\n    kubectl create token admin-user -n kubernetes-dashboard\n    ```\n\n??? question \"Q2ï¼šç„¡æ³•é€£ç·šåˆ° Dashboard\"\n    **åŸå› **ï¼škubectl proxy æ²’æœ‰åŸ·è¡Œ\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. ç¢ºèª kubectl proxy è¦–çª—æ˜¯å¦é–‹å•Ÿ\n    2. é‡æ–°åŸ·è¡Œ `kubectl proxy`\n\n??? question \"Q3ï¼šDashboard Pod ä¸€ç›´è™•æ–¼ Pending\"\n    **åŸå› **ï¼šè³‡æºä¸è¶³æˆ– Node æ²’æœ‰ Ready\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ```bash\n    kubectl get nodes\n    kubectl describe pod -n kubernetes-dashboard\n    ```\n\n---\n\n## æ¸…ç†è³‡æº\n\nå®Œæˆç·´ç¿’å¾Œï¼Œå¯ä»¥æ¸…ç† Dashboard ç›¸é—œè³‡æºï¼š\n\n```bash title=\"æ¸…ç† Dashboard\"\nkubectl delete -f http://10.0.1.249/k8s/yaml/KubernetesDashboard.yaml\nkubectl delete -f http://10.0.1.249/k8s/yaml/recommended.yaml\nkubectl delete deployment test1\n```\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **Dashboard éƒ¨ç½²**ï¼šä½¿ç”¨å®˜æ–¹ recommended.yaml éƒ¨ç½²\n- âœ… **kubectl proxy**ï¼šå»ºç«‹æœ¬åœ°ä»£ç†é€£ç·šåˆ° API Server\n- âœ… **Token èªè­‰**ï¼šä½¿ç”¨ `kubectl create token` ç”¢ç”Ÿç™»å…¥æ†‘è­‰\n- âœ… **åœ–å½¢åŒ–ç®¡ç†**ï¼šé€éç¶²é ä»‹é¢ç®¡ç† Kubernetes è³‡æº\n\n## å»¶ä¼¸é–±è®€\n\n- [Kubernetes Dashboard å®˜æ–¹æ–‡ä»¶](https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/)\n- [Dashboard GitHub](https://github.com/kubernetes/dashboard)\n- [Dashboard èªè­‰æ–¹å¼](https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/README.md)\n"
  },
  {
    "title": "LAB 21 ç§åº«åœ–å½¢ç®¡ç†å·¥å…· docker-registry-web",
    "url": "https://caocharles.github.io/dcka-class-notes/lab21_registry_web/",
    "content": "# LAB 21 ç§åº«åœ–å½¢ç®¡ç†å·¥å…· docker-registry-web\n\n## å­¸ç¿’ç›®æ¨™\n\nå®Œæˆæœ¬ç« ç¯€å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š\n\n- [ ] éƒ¨ç½² docker-registry-web åœ–å½¢ä»‹é¢\n- [ ] é€éç¶²é ç®¡ç† Private Registry\n- [ ] æŸ¥çœ‹æ˜ åƒæª”æ¸…å–®èˆ‡æ¨™ç±¤\n\n## å‰ç½®çŸ¥è­˜\n\né–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿ä½ å·²ç¶“ï¼š\n\n- å®Œæˆ LAB 05 Private Registry å»ºç½®\n- ç†Ÿæ‚‰ Docker åŸºæœ¬æ“ä½œ\n- æº–å‚™å¥½ docker1 è™›æ“¬æ©Ÿç’°å¢ƒ\n\n---\n\n## æ ¸å¿ƒæ¦‚å¿µèªªæ˜\n\n### docker-registry-web æ˜¯ä»€éº¼ï¼Ÿ\n\n**docker-registry-web** æ˜¯ä¸€å€‹é–‹æºçš„ Web UI å·¥å…·ï¼Œè®“ä½ å¯ä»¥é€éç€è¦½å™¨ç®¡ç† Private Registryï¼š\n\n- æŸ¥çœ‹ Registry ä¸­çš„æ‰€æœ‰æ˜ åƒæª”ï¼ˆRepositoriesï¼‰\n- ç€è¦½æ˜ åƒæª”çš„æ¨™ç±¤ï¼ˆTagsï¼‰\n- æŸ¥çœ‹æ˜ åƒæª”çš„è©³ç´°è³‡è¨Š\n\n!!! info \"å®˜æ–¹æ–‡ä»¶\"\n    Docker Hub: [https://hub.docker.com/r/hyper/docker-registry-web](https://hub.docker.com/r/hyper/docker-registry-web)\n\n### æ¶æ§‹èªªæ˜\n\n```mermaid\ngraph LR\n    subgraph docker1[\"docker1 è™›æ“¬æ©Ÿ\"]\n        Registry[\"registry-srv\"]\n        Web[\"registry-web-1\"]\n    end\n    \n    Browser[\"ç€è¦½å™¨\"] --> Web\n    Web --> Registry\n    Registry --> Data[\"/opt/data/registry\"]\n```\n\n| å®¹å™¨ | èªªæ˜ | Port |\n|------|------|------|\n| registry-srv | Private Registry æœå‹™ | 5000 |\n| registry-web-1 | Web ç®¡ç†ä»‹é¢ | 8080 |\n\n---\n\n## Lab å¯¦ä½œç·´ç¿’\n\n!!! note \"æ“ä½œç’°å¢ƒ\"\n    æœ¬ Lab æ‰€æœ‰æ“ä½œéƒ½åœ¨ **docker1** è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œã€‚\n\n---\n\n### æ­¥é©Ÿ 1ï¼šæ¸…é™¤ç¾æœ‰å®¹å™¨èˆ‡æ˜ åƒæª”\n\né¦–å…ˆæ¸…é™¤ docker1 ä¸Šçš„æ‰€æœ‰å®¹å™¨å’Œæ˜ åƒæª”ï¼š\n\n```bash title=\"æ¸…é™¤æ‰€æœ‰å®¹å™¨å’Œæ˜ åƒæª”\"\n./docker_clean_all.sh\n```\n\næˆ–æ‰‹å‹•åŸ·è¡Œï¼š\n\n```bash title=\"æ‰‹å‹•æ¸…é™¤\"\ndocker stop $(docker ps -aq)\ndocker rm $(docker ps -aq)\ndocker rmi $(docker images -q)\n```\n\n---\n\n### æ­¥é©Ÿ 2ï¼šå•Ÿå‹• Private Registry\n\n!!! warning \"å®¹å™¨åç¨±æ³¨æ„äº‹é …\"\n    æ ¹æ“šå®˜æ–¹æ–‡ä»¶èªªæ˜ï¼Œ**å®¹å™¨åç¨±ä¸å¯ä»¥ä½¿ç”¨ `registry`**ï¼\n    \n    å› ç‚º docker-registry-web ä½¿ç”¨ `--link` é€£æ¥ï¼Œå¦‚æœ Registry å®¹å™¨åç¨±æ˜¯ `registry`ï¼Œæœƒèˆ‡ç’°å¢ƒè®Šæ•¸è¡çªå°è‡´éŒ¯èª¤ã€‚\n\nå•Ÿå‹• Registry æœå‹™ï¼ˆä½¿ç”¨ `registry-srv` ä½œç‚ºåç¨±ï¼‰ï¼š\n\n```bash title=\"å•Ÿå‹• Registry\"\ndocker run -d \\\n  -p 5000:5000 \\\n  -v /opt/data/registry:/var/lib/registry \\\n  --restart=always \\\n  --name registry-srv \\\n  registry\n```\n\n**é æœŸçµæœ**ï¼š\n\n```\nUnable to find image 'registry:latest' locally\nlatest: Pulling from library/registry\n...\nStatus: Downloaded newer image for registry:latest\n238cf2ffba02232cb0356f437f9e6dafb9d0f531827b2feea7da24a35da670eb\n```\n\né©—è­‰ï¼š\n\n```bash title=\"æª¢æŸ¥ Registry\"\ndocker ps\n```\n\n---\n\n### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• docker-registry-web\n\nå•Ÿå‹• Web ç®¡ç†ä»‹é¢ï¼š\n\n```bash title=\"å•Ÿå‹• docker-registry-web\"\ndocker run -it \\\n  -p 8080:8080 \\\n  --name registry-web-1 \\\n  --link registry-srv \\\n  -e REGISTRY_URL=http://registry-srv:5000/v2 \\\n  -e REGISTRY_NAME=localhost:5000 \\\n  hyper/docker-registry-web\n```\n\n**åƒæ•¸èªªæ˜**ï¼š\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| `-p 8080:8080` | æ˜ å°„ Web ä»‹é¢åˆ° port 8080 |\n| `--link registry-srv` | é€£æ¥åˆ° Registry å®¹å™¨ |\n| `REGISTRY_URL` | Registry API ä½å€ |\n| `REGISTRY_NAME` | é¡¯ç¤ºåœ¨ Web ä»‹é¢çš„ Registry åç¨± |\n\n**é æœŸçµæœ**ï¼ˆç­‰å¾… Tomcat å•Ÿå‹•ï¼‰ï¼š\n\n```\nJan 28, 2026 8:49:21 AM org.apache.coyote.AbstractProtocol start\nINFO: Starting ProtocolHandler [\"http-bio-8080\"]\nJan 28, 2026 8:49:21 AM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 12013 ms\n```\n\n!!! danger \"ä¿æŒæ­¤è¦–çª—é–‹å•Ÿ\"\n    docker-registry-web ä½¿ç”¨ `-it` å‰æ™¯åŸ·è¡Œï¼Œé—œé–‰è¦–çª—æœƒåœæ­¢æœå‹™ã€‚\n    \n    å¦‚éœ€èƒŒæ™¯åŸ·è¡Œï¼Œå¯æ”¹ç”¨ `-d` åƒæ•¸ã€‚\n\n---\n\n### æ­¥é©Ÿ 4ï¼šé–‹å•Ÿ Web ç®¡ç†ä»‹é¢\n\nåœ¨åœ–å½¢ç’°å¢ƒä¸­é–‹å•Ÿç€è¦½å™¨ï¼Œé€£ç·šåˆ°ï¼š\n\n```\nhttp://192.168.66.21:8080\n```\n\næˆ–åœ¨ docker1 æœ¬æ©Ÿï¼š\n\n```\nhttp://localhost:8080\n```\n\nä½ æœƒçœ‹åˆ° Registry ä¸­çš„æ‰€æœ‰æ˜ åƒæª”æ¸…å–®ï¼š\n\n![docker-registry-web æ˜ åƒæª”åˆ—è¡¨](assets/images/registry_web_repositories.png)\n\n### ä»‹é¢èªªæ˜\n\n| æ¬„ä½ | èªªæ˜ |\n|------|------|\n| **Registry** | Registry åç¨±ï¼ˆlocalhost:5000ï¼‰ |\n| **Repository** | æ˜ åƒæª”åç¨± |\n| **Tags** | è©²æ˜ åƒæª”çš„æ¨™ç±¤æ•¸é‡ |\n\nå¾ç•«é¢å¯ä»¥çœ‹åˆ° Registry ä¸­æœ‰å¤šå€‹æ˜ åƒæª”ï¼š\n\n- alpine (1 tag)\n- httpd (1 tag)\n- mariadb (1 tag)\n- mysql (3 tags)\n- nginx (3 tags)\n- ubuntu (1 tag)\n- wordpress (1 tag)\n\né»é¸æ˜ åƒæª”åç¨±å¯ä»¥æŸ¥çœ‹è©²æ˜ åƒæª”çš„æ‰€æœ‰æ¨™ç±¤å’Œè©³ç´°è³‡è¨Šã€‚\n\n---\n\n## æ¸…ç†è³‡æº\n\nå®Œæˆç·´ç¿’å¾Œï¼Œå¯ä»¥æ¸…ç†ç›¸é—œè³‡æºï¼š\n\n```bash title=\"åœæ­¢ä¸¦åˆªé™¤å®¹å™¨\"\ndocker stop registry-web-1 registry-srv\ndocker rm registry-web-1 registry-srv\n```\n\n---\n\n## å¸¸è¦‹å•é¡Œ\n\n??? question \"Q1ï¼šWeb ä»‹é¢é¡¯ç¤ºç©ºç™½æˆ–é€£ç·šéŒ¯èª¤\"\n    **åŸå› **ï¼šRegistry å®¹å™¨åç¨±ä½¿ç”¨äº† `registry`\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    åˆªé™¤å®¹å™¨å¾Œé‡æ–°å»ºç«‹ï¼Œä½¿ç”¨ä¸åŒçš„åç¨±ï¼ˆå¦‚ `registry-srv`ï¼‰\n\n??? question \"Q2ï¼šç„¡æ³•é€£ç·šåˆ° 8080 åŸ \"\n    **åŸå› **ï¼šdocker-registry-web å°šæœªå•Ÿå‹•å®Œæˆ\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    ç­‰å¾… Tomcat å•Ÿå‹•å®Œæˆï¼ˆçœ‹åˆ° `Server startup in xxxxx ms`ï¼‰\n\n??? question \"Q3ï¼šæ˜ åƒæª”åˆ—è¡¨æ˜¯ç©ºçš„\"\n    **åŸå› **ï¼šRegistry æ²’æœ‰æ˜ åƒæª”ï¼Œæˆ– REGISTRY_URL è¨­å®šéŒ¯èª¤\n    \n    **è§£æ±ºæ–¹æ¡ˆ**ï¼š\n    1. ç¢ºèª Registry æœ‰æ˜ åƒæª”ï¼š`curl http://localhost:5000/v2/_catalog`\n    2. ç¢ºèª REGISTRY_URL æŒ‡å‘æ­£ç¢ºçš„ Registry å®¹å™¨\n\n---\n\n## å°çµ\n\næœ¬ç« ç¯€é‡é»å›é¡§ï¼š\n\n- âœ… **docker-registry-web**ï¼šPrivate Registry çš„ç¶²é ç®¡ç†ä»‹é¢\n- âœ… **å®¹å™¨å‘½åæ³¨æ„**ï¼šRegistry å®¹å™¨åç¨±ä¸å¯ä½¿ç”¨ `registry`\n- âœ… **--link é€£æ¥**ï¼šWeb å®¹å™¨é€é Docker link é€£æ¥ Registry\n- âœ… **æ˜ åƒæª”ç®¡ç†**ï¼šé€éåœ–å½¢ä»‹é¢æŸ¥çœ‹ Repository å’Œ Tags\n\n## å»¶ä¼¸é–±è®€\n\n- [docker-registry-web Docker Hub](https://hub.docker.com/r/hyper/docker-registry-web)\n- [docker-registry-web GitHub](https://github.com/mkuchin/docker-registry-web)\n- [Docker Registry API v2](https://docs.docker.com/registry/spec/api/)\n"
  }
]